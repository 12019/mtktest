/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *  PhoneSetup.c
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  This file is intends for phone setup application
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/

/***************************************************************************** 
* Include
*****************************************************************************/
/*  Include: MMI header file */
#include "MMI_include.h"
#include "ProtocolEvents.h"
#include "CommonScreens.h"
#include "SettingsGexdcl.h"
#include "settingGprots.h"
#include "SettingDefs.h"
#include "PhnsetProt.h"
#include "WPSSProtos.h"
#include "ATHandlerProt.h"      /* SendATSetGreeting() */
#include "MainMenuDef.h"        /* MAIN_MENU_TITLE_SETTINGS_ICON */
#include "settingprot.h"        /* PhoneSetup Prototype */
#include "CSP.h"        /* CSP_VALUE_ADDED_SERVICES_SERVICE_GROUP, CSP_Language */
#include "SettingProfile.h"     /* WARNING_TONE */
#include "ProfileGprots.h"      /* playRequestedTone() */
#include "MessagesExDcl.h"      /* GetChildMenuIDIndexByParentMenuID()  */
#include "ScheduledPowerOnOffGProt.h"
#include "ScreenSaverDefs.h"
#include "WallpaperDefs.h"
#include "DownloadDefs.h"
#include "PhoneSetup.h"
#include "PhoneSetupGprots.h"
#include "Conversions.h"
#include "GpioInc.h"    /* Backlight */
#include "SimDetectionDef.h"    /* for g_pwr_context */
#include "SimDetectionGprot.h"
#include "mmi_common_enum.h"
#include "IdleAppProt.h"

#ifdef __GEMINI__
#include "AlarmFrameWorkProt.h"			/* for UART setup reboot message */
#endif /* __GEMINI__ */

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)

#ifdef __MTK_TARGET__
#include "Touch_Panel.h"
#endif 

#ifdef __MMI_HANDWRITING_PAD__
#include "touch_panel_custom.h"
#endif 

#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 

#ifdef __MMI_UI_TECHNO_IDLESCREEN_BAR__
#include "wgui_datetime.h"
#endif 

#ifdef __MMI_AUTO_LANG_EN__
#include "CustResDef.h"
#include "SSCStringHandle.h"
#endif /* __MMI_AUTO_LANG_EN__ */ 

#if defined(__MMI_DEDICATED_KEY_SHORTCUTS__)
#include "ShortcutsProts.h"
#endif 

#ifdef __MMI_PREFER_INPUT_METHOD__
#include "PreferedInputMethodProt.h"    /* GetInputMethodIndex(),  InitPreferedInputMethod() */
#endif 

#if defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__)
#endif

/*  Include: PS header file */
#ifdef MMI_ON_HARDWARE_P
#include "lcd_if.h"
#include "lcd_sw.h"
#include "lcd_sw_inc.h"
#include "sublcd.h"
#endif /* MMI_ON_HARDWARE_P */ 

#ifdef __MMI_TVOUT__
#include "med_api.h"    /* media task */
#include "mdi_tv.h"
#endif /* __MMI_TVOUT__ */ 

#ifdef __MMI_DUAL_SIM_MASTER__
#include "MTPNP_AD_master_header.h"
#include "MTPNP_PFAL_Network.h"
#endif  /* __MMI_DUAL_SIM_MASTER__ */

/***************************************************************************** 
* Define
*****************************************************************************/
#ifdef __MMI_AUTO_LANG_EN__
#define MMI_NUM_OF_AUTOLANG_ELEM   (sizeof(auto_lang_struct) / sizeof(auto_lang_struct[0]))
#endif 

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)
/* Handwriting setting */
#define MAX_PEN_SPEED 3
#define MAX_PEN_COLORS 8

#define DEFAULT_PEN_SPEED 1
#define DEFAULT_PEN_COLOR 1

/* Calibration */
#define NUM_CALIBRATION_POINTS 3
#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
#define phone_setup_language GetChildMenuIDIndexByParentMenuID(MENU9102_INITIAL_SETUP,MENU_SETTING_LANGUAGE)
#define phone_setup_preferred_input_method GetChildMenuIDIndexByParentMenuID(MENU9102_INITIAL_SETUP,MENU_SETTING_PREFERED_INPUT_METHOD)
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
#define phone_setup_encoding_type GetChildMenuIDIndexByParentMenuID(MENU9102_INITIAL_SETUP,MENU_SETTING_DEF_ENCODING_TYPE)
#define encoding_type_big2 GetChildMenuIDIndexByParentMenuID(MENU_SETTING_DEF_ENCODING_TYPE,MENU_SETTING_DEF_ENCODING_BIG2)
#define encoding_type_gb2312 GetChildMenuIDIndexByParentMenuID(MENU_SETTING_DEF_ENCODING_TYPE,MENU_SETTING_DEF_ENCODING_GB2312)
#define encoding_type_ucs2 GetChildMenuIDIndexByParentMenuID(MENU_SETTING_DEF_ENCODING_TYPE,MENU_SETTING_DEF_ENCODING_UCS2)
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 
#ifdef __GEMINI__
#define phone_setup_uart GetChildMenuIDIndexByParentMenuID(MENU9102_INITIAL_SETUP,MENU_ID_PHNSET_UART_SETUP)
#define phone_setup_uart_sim1 GetChildMenuIDIndexByParentMenuID(MENU_ID_PHNSET_UART_SETUP,MENU_ID_PHNSET_UART_SIM1)
#define phone_setup_uart_sim2 GetChildMenuIDIndexByParentMenuID(MENU_ID_PHNSET_UART_SETUP,MENU_ID_PHNSET_UART_SIM2)
#endif /* __GEMINI__ */
#endif /* __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__ */ 

/***************************************************************************** 
* Typedef
*****************************************************************************/

typedef struct _AutoLang
{
    mmi_phnset_language_enum LanType;
    S8 *LanSSC;
} StructAutoLang;

/***************************************************************************** 
* Local Variable
*****************************************************************************/
static U8 *greet_text_on_off[2];

#ifdef __MMI_AUTO_LANG_EN__
static StructAutoLang auto_lang_struct[] = 
{
    /* ISO 639 2-alphabet Language Codes */
    {CBS2_ZH, SSC_SCHINESE},
    {CBS2_TW, SSC_TCHINESE},
    {CBS0_ENGLISH, SSC_ENGLISH},
    {CBS0_SPANISH, SSC_SPANISH},
    {CBS2_TH, SSC_THAI},
    {CBS0_FRENCH, SSC_FRENCH},
    {CBS0_GERMAN, SSC_GERMAN},
    {CBS0_ITALIAN, SSC_ITALIAN},
    {CBS0_PORTUGUESE, SSC_PORTUGUESE},
    {CBS1_RUSSIAN, SSC_RUSSIAN},
    {CBS2_BG, SSC_BULGARIAN},
    {CBS0_TURKISH, SSC_TURKISH},
    {CBS2_VI, SSC_VIETNAMESE},
    {CBS2_ID, SSC_INDONESIAN},
    {CBS2_MS, SSC_MALAY},
    {CBS1_ARABIC, SSC_ARABIC},
    {CBS2_FA, SSC_PERSIAN},
    {CBS2_SK, SSC_SLOVAK},
    //{CBS2_NL, SSC_DUTCH},
    //{CBS1_FINNISH, SSC_FINNISH},
    //{CBS2_SV, SSC_SWEDISH},
    {CBS2_HR, SSC_CROATIAN},
    {CBS2_RO, SSC_ROMANIAN},
    {CBS2_SL, SSC_SLOVENIAN},
    //{CBS2_EL, SSC_GREEK},
    //{CBS2_CS, SSC_CZECH},
    {CBS0_LANG_UNSPECIFIED, NULL /* Language UnSpecificed */ },
    {CBS_INVALID, NULL /* Language UnSpecificed */ }
};
#endif /* __MMI_AUTO_LANG_EN__ */ 

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)
/* Handwriting setting */
static S32 gInlinePenSpeed;
static S32 gInlinePenColorIndex;

static U8 *g_pen_speed_str_list[MAX_PEN_SPEED];
static const color g_pen_color_list[MAX_PEN_COLORS] = 
{
    {0, 255, 255},
    {255, 0, 0},
    {0, 255, 0},
    {255, 255, 0},
    {255, 0, 255},
    {255, 128, 0},
    {0, 0, 128},
    {0, 0, 0}
};

/* Current state of calibration screen */
typedef struct
{
    /* Calibration point */
    mmi_pen_point_struct points[NUM_CALIBRATION_POINTS];
    /* Flag to check whether calibration has finished or not */
    BOOL finished;
    /* Sasve to factory default or user calibration data */
    BOOL save_to_factory_default;
    /* Original calibration setting before entring Calibration Application */
    mmi_pen_calibration_struct backup_data;
    /* Finish callback */
    void (*finish_callback) (void);
} mmi_phnset_calibration_struct;

static PHNSET_CALIBRATION_STATE_ENUM g_phnset_calibration_screen_state = CALIBRATION_NULL_STATE;

static mmi_phnset_calibration_struct *g_phnset_calibration_cntx_p;

#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
static S32 languages_default_item;
static S32 is_inline_menu_exist = 0;

#ifdef __MMI_SET_DEF_ENCODING_TYPE__
static S32 default_encoding_type;
#endif 
#endif /* __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__ */ 

#if defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__)
static U8 currWritingLangIdx = 0;

#if defined(__MMI_MIXED_LANG_SUPPORT__)
static MMI_BOOL currWLangIsMain = MMI_TRUE;
#endif 
#endif /* defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__) */ 

#ifdef __GEMINI__
static U8 g_uart_status = 0;
#endif /* __GEMINI__ */

/***************************************************************************** 
* Global Variable
*****************************************************************************/
PHNSET_CNTX g_phnset_cntx;
PHNSET_CNTX *g_phnset_cntx_p = &g_phnset_cntx;
extern U8 g_dst;

/***************************************************************************** 
* External Variable
*****************************************************************************/
/* Lagnuage */
extern sLanguageDetails *gLanguageArray;
extern U16 gCurrLangIndex;
extern U8 *ItemType[8];
extern U8 gPLMN[];
extern PU8 subMenuDataPtrs[MAX_SUB_MENUS];

#ifdef __MMI_PREFER_INPUT_METHOD__
extern U8 *inputMethodList[9];
extern U16 currInputMethodIndex;
#endif /* __MMI_PREFER_INPUT_METHOD__ */ 

#if defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__)
extern ime_writing_lang_struct g_ime_writing_lang_array[MAX_WRITING_LANG];
extern S16 g_ime_main_writing_lang;

#if defined(__MMI_MIXED_LANG_SUPPORT__)
extern S16 g_ime_sub_writing_lang;
#endif 
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) || defined(__MMI_PREFER_WRITING_LANG__) */ 

#ifdef __GEMINI__
extern alm_queue_node_struct gAlmQueue[ALM_NUM_OF_ALAMRS];
extern alm_framework_context_struct g_alm_frm_cntx;
#endif /* __GEMINI__ */

/***************************************************************************** 
* Global Function
*****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_event_hdlr(MDI_RESULT result);
#endif 
#ifdef __MMI_AUDIO_PLAYER__	
void mmi_audply_encoding_type_change_callback(void);
#endif

/***************************************************************************** 
* External Function
*****************************************************************************/
extern void SetProfileSettingCustomFuns(void);
extern void RefreshNwProviderName(U8 *UpdatePlmn);

#ifdef __MMI_PREFER_INPUT_METHOD__
extern U16 GetInputMethodIndex(U16 inputType);
#endif 

/*****************************************************************************
* Local Function 
*****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_highlight_tvout(void);
static void mmi_phnset_entry_tvout_screen(void);
static void mmi_phnset_highlight_tvout_setting(void);
static void mmi_phnset_highlight_tvout_adjust(void);
static void mmi_phnset_tvout_set_adjust(void);
static void mmi_phnset_tvout_cancel_adjust(void);
static void mmi_phnset_entry_tvout_setting_screen(void);
static void mmi_phnset_exit_tvout_setting_screen(void);
static void mmi_phnset_entry_tvout_adjust_screen(void);
static void mmi_phnset_tvout_adjust_y_gamma_callback(S32 value);
static void mmi_phnset_tvout_adjust_u_callback(S32 value);
static void mmi_phnset_tvout_adjust_v_callback(S32 value);
#endif /* __MMI_TVOUT__ */ 

#if defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__)
static void mmi_phnset_writing_lang_highlight_hdlr(S32 index);
static void mmi_phnset_writing_lang_save(void);
static void mmi_phnset_entry_writing_lang_screen(void);
static void mmi_phnset_hint_writing_lang(U16 index);

#if defined(__MMI_MIXED_LANG_SUPPORT__)
static void mmi_phnset_writing_lang_highlight_main(void);
static void mmi_phnset_writing_lang_highlight_sub(void);
static void mmi_phnset_writing_lang_hint_sub(U16 index);
static void mmi_phnset_entry_mixed_language_screen(void);
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
static void mmi_phnset_highlight_prefered_writing_lang(void);
#endif /* defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__) */ 

#ifdef __GEMINI__
static void HighlightPhnsetUARTSetup(void);
static void HintPhnsetUARTSetup(U16 index);
static void EntryPhnsetUARTSetup(void);
static void PhnsetUARTSetupSelectYes(void);
static void PhnsetUARTSetupSelectNo(void);
static void PhnsetUARTSetupHiliteHandler(S32 index);
static void PhnsetUARTSetupSelectHandler(void);
static void PhnSetUARTSetupReboot(void);
static void PhnSetUARTSetupRebootRsp(void *msg);
static void EntryPhnsetUARTSetupRebootProcessing(void);
#endif /* __MMI_DUAL_SIM_MASTER__ */

/*****************************************************************************
 * FUNCTION
 *  InitPhoneSetupCntx
 * DESCRIPTION
 *  This function is to initialize phone setup context
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void InitPhoneSetupCntx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 Err = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Common */
    g_phnset_cntx_p->curHightlightItem = 0;
    g_phnset_cntx_p->ScrAnchor = IDLE_SCREEN_ID;

    /* Set Time and Date */
    g_phnset_cntx_p->currentCity = 0;
    g_phnset_cntx_p->CurHomeCityStrID = 0;
    g_phnset_cntx_p->CurHomeCityStrPtr = 0;
    g_phnset_cntx_p->CurTimeFmt = 0;
    g_phnset_cntx_p->CurDateFmt = 0;
    g_phnset_cntx_p->AM_PM_flag = NULL;

    ReadValue(NVRAM_SETTING_DT_DST, &(g_phnset_cntx_p->currentDST), DS_BYTE, &Err);
    if (g_phnset_cntx_p->currentDST == 0xff)
    {
        g_phnset_cntx_p->currentDST = 0;
        WriteValue(NVRAM_SETTING_DT_DST, &g_phnset_cntx_p->currentDST, DS_BYTE, &Err);
        g_dst = g_phnset_cntx_p->currentDST;
    }

    memset(&(g_phnset_cntx_p->settime), 0, sizeof(PHNSET_DATETIME_STRUCT));

    /* NITZ */
    g_phnset_cntx_p->curNITZStatus = 0;

    /* Phone Setup */
    g_phnset_cntx_p->ShowOwnNumDirtyFlag = MMI_FALSE;
    g_phnset_cntx_p->ShowDtDirtyFlag = MMI_FALSE;
    g_phnset_cntx_p->curShowDtStatus = 0;
    g_phnset_cntx_p->curShowOwnNumStatus = 0;
    /* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)
    g_phnset_cntx_p->curShowOPNStatus = 0;
#endif 

#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
    g_phnset_cntx_p->MenuStyle = 0;
#endif 

    /* Language */
    g_phnset_cntx_p->ppLang = NULL;
    g_phnset_cntx_p->UsrLangIdx = 0;
    g_phnset_cntx_p->LP = CBS0_LANG_UNSPECIFIED;

    /* Wallpaper & Screen Saver */
    g_phnset_cntx_p->curtWpID = 0;
#ifdef __MMI_SUB_WALLPAPER__
    g_phnset_cntx_p->curtSubWpID = 0;
#endif 
    g_phnset_cntx_p->WPSSPreviewScrFlag = 1;
    g_phnset_cntx_p->WPFctyImgNum = 0;
    g_phnset_cntx_p->SSFctyImgNum = 0;
    g_phnset_cntx_p->WPDwnlImgNum = 0;
    g_phnset_cntx_p->SSDwnlImgNum = 0;
    g_phnset_cntx_p->curSSStatus = 0;
    g_phnset_cntx_p->curSSWaitTime = 0;
    g_phnset_cntx_p->SSStatusInlineHilite = 0;
    g_phnset_cntx_p->SSWaitStatusInlineHilite = 2;
    g_phnset_cntx_p->wpss_type = MMI_PHNSET_TYPE_WP;

    memset(g_phnset_cntx_p->SysWPSSList, 0, sizeof(g_phnset_cntx_p->SysWPSSList));
    memset(g_phnset_cntx_p->DwnlWPSSList, 0, sizeof(g_phnset_cntx_p->DwnlWPSSList));

#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    SetHiliteHandler(MENU_SETTING_DEF_ENCODING_TYPE, HighlightPhnsetDefEncoding);
    SetHintHandler(MENU_SETTING_DEF_ENCODING_TYPE, HintPhnsetDefEncoding);
    ReadValue(NVRAM_SETTING_DEF_ENCODING, &(g_phnset_cntx_p->EncodingType), DS_BYTE, &Err);
    if (g_phnset_cntx_p->EncodingType == 0xFF || Err != NVRAM_READ_SUCCESS)
    {
    #ifdef __MMI_CHSET_BIG5__
        g_phnset_cntx_p->EncodingType = PHNSET_ENCOD_BIG5;
    #elif defined (__MMI_CHSET_GB2312__)
        g_phnset_cntx_p->EncodingType = PHNSET_ENCOD_GB2312;
    #endif
    }

    switch (g_phnset_cntx_p->EncodingType)
    {
    #ifdef __MMI_CHSET_BIG5__    
        case PHNSET_ENCOD_BIG5:
            g_chset_text_encoding = MMI_CHSET_BIG5;
            break;
    #endif 

    #ifdef __MMI_CHSET_GB2312__
        case PHNSET_ENCOD_GB2312:
            g_chset_text_encoding = MMI_CHSET_GB2312;
            break;
    #endif 

    #ifdef __MMI_CHSET_GB18030__
        case PHNSET_ENCOD_GB18030:
            g_chset_text_encoding = MMI_CHSET_GB18030;
            break;
    #endif 
            
    }

#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */

#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
    ReadValue(NVRAM_SET_MAINMENU_STYLE, &(g_phnset_cntx_p->MenuStyle), DS_BYTE, &Err);
    if (g_phnset_cntx_p->MenuStyle == 0xFF || g_phnset_cntx_p->MenuStyle >= PHNSET_MAINMENU_STYLE_MAX)
    {
        g_phnset_cntx_p->MenuStyle = 0;
    }
#endif /* __MMI_MAINMENU_STYLE_CHANGE_EN__ */ 

/* Read Dual Mode UART Setup config */
#ifdef __GEMINI__
	{
		U8 buffer[NVRAM_EF_SYS_CACHE_OCTET_SIZE];

		ReadRecord(NVRAM_EF_SYS_CACHE_OCTET_LID, NVRAM_SYS_FLIGHTMODE_STATE, (void*)buffer, 
               NVRAM_EF_SYS_CACHE_OCTET_SIZE, &Err);

		if (buffer[L4C_SETTING_DUAL_SIM_UART] == L4C_UART_TO_SIM1)
		{
			g_phnset_cntx_p->uart_status = MMI_PHNSET_UART_SIM1;
		}
		else if (buffer[L4C_SETTING_DUAL_SIM_UART] == L4C_UART_TO_SIM2)
		{
			g_phnset_cntx_p->uart_status = MMI_PHNSET_UART_SIM2;
		}
		else
		{
			g_phnset_cntx_p->uart_status = MMI_PHNSET_UART_SIM_NONE;
		}

		g_uart_status = g_phnset_cntx_p->uart_status;
	}
#endif /* __GEMINI__ */

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)

    ReadValue(NVRAM_PEN_SPEED, &(g_phnset_cntx_p->pen_speed), DS_BYTE, &Err);
    if (g_phnset_cntx_p->pen_speed == 0xFF || Err != NVRAM_READ_SUCCESS || g_phnset_cntx_p->pen_speed >= MAX_PEN_SPEED)
    {
        g_phnset_cntx_p->pen_speed = DEFAULT_PEN_SPEED;
    }

    ReadValue(NVRAM_PEN_COLOR, &(g_phnset_cntx_p->pen_color), DS_BYTE, &Err);
    if (g_phnset_cntx_p->pen_color == 0xFF || Err != NVRAM_READ_SUCCESS || g_phnset_cntx_p->pen_color >= MAX_PEN_COLORS)
    {
        g_phnset_cntx_p->pen_color = DEFAULT_PEN_COLOR;
    }
#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 
}


/*****************************************************************************
 * FUNCTION
 *  InitPhoneSetupApp
 * DESCRIPTION
 *  This function is to register highlight handler for Phonesetup
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void InitPhoneSetupApp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION("File: [%s]  Line: [%d] <<InitNetworkSetupApp.>\n", __FILE__, __LINE__);

    /* Robin 0603: G12C request -- Add Display Setup menu */
#ifdef __MMI_DISP_SETUP_LEVEL_UP__
    SetHiliteHandler(MENU_DISP_SETUP, HighlightDispSetup);
#endif 

    // SetHiliteHandler(MENU_SETTING_SPEED_DIAL,  HighlightPhbSpeedDial);  /* Move to SpeedDial.c */

    SetHiliteHandler(MENU_SETTING_SCHEDULE_POWER, HighlightSPOF);
    SetHiliteHandler(MENU_IDLE_SCR_DISP, HighlightPhnsetIdleScrDisp);
    SetHiliteHandler(MENU_SETTING_SHOW_OWN_NUMBER, HighlightPhnsetShowOwnNo);
    /* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)
    SetHiliteHandler(MENU_SETTING_SHOW_OPN, HighlightPhnsetShowOPN);
#endif 
    SetHiliteHandler(MENU_SETTING_SHOW_DT_TIME, HighlightPhnsetShowDtTime);
    //SetHiliteHandler(MITEM113_PBOOK_SPEED_DIAL,HighlightPhbSpeedDialSetNum); /* Move to SpeedDial.c */
    //SetHiliteHandler(MENU_SETTING_SPEED_STATUS,HighlightPhbSpeedDialStatus); /* Move to SpeedDial.c */
    SetHiliteHandler(MENU_SETTING_LANGUAGE, HighlightPhnsetLang);

    SetHiliteHandler(MENU9146_WELCOME_TEXT, HighlightPhnsetWelcomeText);
    SetHiliteHandler(MENU_SETTING_SCR_SVR, HighlightPhnsetScreenSaver);

    SetHiliteHandler(MENU_SETTING_WALLPAPER, HighlightPhnsetMainWallpaper);
#ifdef __MMI_SUB_WALLPAPER__
    SetHiliteHandler(MENU_SETTING_WALLPAPER_SUB, HighlightPhnsetSubWallpaper);
#endif 

#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
    SetHintHandler(MENU_SETTING_MAINMENU_STYLE, HintPhnsetMainMenuStyle);

    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE, HighlightPhnsetMainMenuStyle);
    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE_MATRIX, HighlightPhnsetMainMenuStyleSelect);
    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE_PAGE, HighlightPhnsetMainMenuStyleSelect);
    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE_CIRCULAR, HighlightPhnsetMainMenuStyleSelect);
    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE_ROTATE, HighlightPhnsetMainMenuStyleSelect);   /* PDG1   Manish */
    SetHiliteHandler(MENU_SETTING_MAINMENU_STYLE_LIST, HighlightPhnsetMainMenuStyleSelect);
#endif /* __MMI_MAINMENU_STYLE_CHANGE_EN__ */ 
#if defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)
    SetHintHandler(MENU_SETTING_IDLE_CLOCK_TYPE, HintPhnsetIdleClockType);
    SetHiliteHandler(MENU_SETTING_IDLE_CLOCK_TYPE, HighlightPhnsetIdleClockType);
#endif /* defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__) */ 

#ifndef __MMI_HIDE_HOMECITY__
    SetHiliteHandler(MENU9142_SETHOMECITY, HighlightPhnsetSetHomeCity);
#endif 

	/* Set highlight and hint function of UART setup */
#ifdef __GEMINI__
	SetHiliteHandler(MENU_ID_PHNSET_UART_SETUP, HighlightPhnsetUARTSetup);
	SetHintHandler(MENU_ID_PHNSET_UART_SETUP, HintPhnsetUARTSetup);
#endif /* __GEMINI__ */

#ifndef __MMI_SEPARATE_DT_SETTING__
    SetHiliteHandler(MENU9143_SETTIMEANDDATE, HighlightPhnsetSetDT);
    SetHiliteHandler(MENU9144_SETTIMEANDDATEFORMAT, HighlightPhnsetSetFormat);
#else /* __MMI_SEPARATE_DT_SETTING__ */ 
    SetHiliteHandler(MENU_ID_SETTING_DATEANDFORMAT, HighlightPhnsetSetDateAndFormat);
    SetHiliteHandler(MENU_ID_SETTING_TIMEANDFORMAT, HighlightPhnsetSetTimeAndFormat);
#endif /* __MMI_SEPARATE_DT_SETTING__ */ 
    /* diamond, 2005/07/05 Flight mode */
#ifdef __FLIGHT_MODE_SUPPORT__
#ifndef __MMI_DUAL_SIM_MASTER__
    SetHiliteHandler(MENU_SETTING_FLIGHT_MODE, HighlightPhnsetFlightMode);
#endif  /* __MMI_DUAL_SIM_MASTER__ */
#endif 
    /* end, diamond */

#ifndef __MMI_HIDE_HOMECITY__
    SetHintHandler((U16) MENU9142_SETHOMECITY, HintPhnsetTimeAndDate);
#endif 

    SetHintHandler(MENU9146_WELCOME_TEXT, HintPhnsetWelcomeText);
    SetHintHandler(MENU_SETTING_LANGUAGE, HintPhnsetLanguage);

    SetHintHandler(MENU_SETTING_SHOW_OWN_NUMBER, HintPhnsetOwnerNum);
    /* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)
    SetHintHandler(MENU_SETTING_SHOW_OPN, HintPhnsetOPN);
#endif 

    SetHintHandler(MENU_SETTING_SHOW_DT_TIME, HintPhnsetShowDateTime);
    SetHintHandler(MENU_SETTING_WALLPAPER, HintPhnsetWallpaper);
#ifdef __MMI_SUB_WALLPAPER__
    SetHintHandler(MENU_SETTING_WALLPAPER_SUB, HintPhnsetSubWallpaper);
#endif 
    SetHintHandler(MENU_SETTING_SCR_SVR, HintPhnsetScreenSaver);

#ifdef __DAILY_WALLPAPER__
    SetHiliteHandler(MENU_SETTING_WALLPAPER_FIX, HighlightPhnsetWallpaperFix);
    SetHintHandler(MENU_SETTING_WALLPAPER_ROTATE, HintPhnsetWallpaperRotate);
#endif /* __DAILY_WALLPAPER__ */ 

#ifdef __MMI_NITZ__
#ifdef __MMI_AUTOTIMEZONE_IN_DATEANDTIME__
    SetHintHandler(MENU9145_SETTIMEANDDATENITZ, HintPhnsetNITZ);
    SetHiliteHandler(MENU9145_SETTIMEANDDATENITZ, HighlightPhnsetNITZ);
#else /* __MMI_AUTOTIMEZONE_IN_DATEANDTIME__ */ 
    SetHintHandler(MENU_SETTING_MENU_TREE, HintPhnsetNITZ);
    SetHiliteHandler(MENU_SETTING_MENU_TREE, HighlightPhnsetNITZ);
#endif /* __MMI_AUTOTIMEZONE_IN_DATEANDTIME__ */ 
#endif /* __MMI_NITZ__ */ 

#ifdef __MMI_PREFER_INPUT_METHOD__
    SetHintHandler(MENU_SETTING_PREFERED_INPUT_METHOD, HintPhnsetPreferedInputMethod);
#endif 

#if defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__)
    SetHintHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG, mmi_phnset_hint_writing_lang);
    SetHiliteHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG, mmi_phnset_highlight_prefered_writing_lang);
#if defined(__MMI_MIXED_LANG_SUPPORT__)
    SetHintHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG_MAIN, mmi_phnset_hint_writing_lang);
    SetHiliteHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG_MAIN, mmi_phnset_writing_lang_highlight_main);
    SetHintHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG_SUB, mmi_phnset_writing_lang_hint_sub);
    SetHiliteHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG_SUB, mmi_phnset_writing_lang_highlight_sub);
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
#endif /* defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__) */ 

#if defined(__MMI_DEDICATED_KEY_SHORTCUTS__) && !defined(__DISABLE_SHORTCUTS_IMPL__)
    SetHiliteHandler(MENU_SETTING_DEDICATED_KEYS, HighlightDedicatedKeys);
#endif 

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)
    SetHiliteHandler(MENU_SETTING_HANDWRITING, HighlightHandwritingSetting);
    SetHiliteHandler(MENU_SETTING_CALIBRATION, HighlightCalibrationSetting);
#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 

#ifdef __MMI_POWER_ON_OFF_DISPLAY__
    SetHiliteHandler(MENU_SETTING_POWER_ON_DISPLAY, HighlightPhnsetPowerOn);
    SetHintHandler(MENU_SETTING_POWER_ON_DISPLAY, HintPhnsetPwrOnDisplay);
    SetHiliteHandler(MENU_SETTING_POWER_OFF_DISPLAY, HighlightPhnsetPowerOff);
    SetHintHandler(MENU_SETTING_POWER_OFF_DISPLAY, HintPhnsetPwrOffDisplay);
#endif /* __MMI_POWER_ON_OFF_DISPLAY__ */ 
    /* Cylen 2005/08/23 GPIO Setting */
#ifdef __MMI_CHANGABLE_FONT__
    SetHiliteHandler(MENU_ID_PHNSET_FONT_SIZE, HighlightPhnsetFontSize);
    SetHintHandler(MENU_ID_PHNSET_FONT_SIZE, HintPhnsetFontSize);
    PhnsetReadFontSize();   /* __USB_IN_NORMAL_MODE__ */
#endif /* __MMI_CHANGABLE_FONT__ */ 

    /* diamond, 2005/07/05 Flight mode */
#ifdef __FLIGHT_MODE_SUPPORT__
#ifndef __MMI_DUAL_SIM_MASTER__
    SetHintHandler(MENU_SETTING_FLIGHT_MODE, HintPhnsetFlightMode);
#endif  /* __MMI_DUAL_SIM_MASTER__ */
#endif 
    /* end, diamond */

#ifdef __MMI_TVOUT__
    SetHiliteHandler(MENU_ID_SETTING_TVOUT, mmi_phnset_highlight_tvout);
    SetHiliteHandler(MENU_ID_SETTING_TVOUT_SETTING, mmi_phnset_highlight_tvout_setting);
    SetHiliteHandler(MENU_ID_SETTING_TVOUT_ADJUST, mmi_phnset_highlight_tvout_adjust);
#endif /* __MMI_TVOUT__ */ 

    InitPhoneSetupGPIO();
}

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_is_exist
 * DESCRIPTION
 *  To check the the existence of two line display
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
S32 mmi_phnset_2line_is_exist(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return is_inline_menu_exist;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_lang_get_data
 * DESCRIPTION
 *  This function is to get the language data for the two line item
 * PARAMETERS
 *  inline_item_index       [IN]        Index of the inline item to be shown
 *  str_buff                [IN]        Language to be shown
 *  img_buff_p              [?]         Image to be shown with the inline item
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_2line_lang_get_data(S32 inline_item_index, UI_string_type str_buff, PU8 *img_buff_p)
{
#ifdef __MMI_AUTO_LANG_EN__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index == 0)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STR_LANGUAGESCR_AUTO));
    }
    else
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) g_phnset_cntx_p->ppLang[inline_item_index - 1]);
    }
#else /* __MMI_AUTO_LANG_EN__ */ 
    mmi_ucs2cpy((PS8) str_buff, (PS8) g_phnset_cntx_p->ppLang[inline_item_index]);
#endif /* __MMI_AUTO_LANG_EN__ */ 
    if (inline_item_index < IMG_GLOBAL_LEND - IMG_GLOBAL_LSTART - 1)
    {
        *img_buff_p = get_image((U16) (IMG_GLOBAL_LSTART + inline_item_index + 1));
    }
    else
    {
        *img_buff_p = NULL;
    }
    g_phnset_cntx_p->curHightlightItem = inline_item_index;
    languages_default_item = inline_item_index;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_encod_get_data
 * DESCRIPTION
 *  This function is to get the encoding type for the two line item
 * PARAMETERS
 *  inline_item_index       [IN]        Index of the inline item to be shown
 *  str_buff                [IN]        Encoding type string to be shown
 *  img_buff_p              [?]         Image to be shown with the inline item
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
static void mmi_phnset_2line_encod_get_data(S32 inline_item_index, UI_string_type str_buff, PU8 *img_buff_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (inline_item_index == encoding_type_big2)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STR_DEF_ENCODING_TYPE_BIG5));
    }
    else if (inline_item_index == encoding_type_gb2312)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STR_DEF_ENCODING_TYPE_GB2312));
    }
    else if (inline_item_index == encoding_type_ucs2)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STR_DEF_ENCODING_TYPE_UCS2));
    }

    if (inline_item_index < IMG_GLOBAL_LEND - IMG_GLOBAL_LSTART - 1)
    {
        *img_buff_p = get_image((U16) (IMG_GLOBAL_LSTART + inline_item_index + 1));
    }
    else
    {
        *img_buff_p = NULL;
    }
    g_phnset_cntx_p->curHightlightItem = inline_item_index;
    default_encoding_type = inline_item_index;
}
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 

#ifdef __GEMINI__
static void mmi_phnset_2line_uart_get_data(S32 inline_item_index, UI_string_type str_buff, PU8 *img_buff_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	if (inline_item_index == phone_setup_uart_sim1)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STRING_MTPNP_UART_SIM1));
    }
    else if (inline_item_index == phone_setup_uart_sim2)
    {
        mmi_ucs2cpy((PS8) str_buff, (PS8) GetString(STRING_MTPNP_UART_SIM2));
    }

	/*
    if (inline_item_index < IMG_GLOBAL_LEND - IMG_GLOBAL_LSTART - 1)
    {
	*img_buff_p = get_image((U16) (IMG_GLOBAL_LSTART + inline_item_index + 1));
    }
    else
	*/
    {
        *img_buff_p = NULL;
    }
	
    g_phnset_cntx_p->curHightlightItem = inline_item_index;
    g_uart_status = inline_item_index;
}
#endif /* __GEMINI__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_read_setting
 * DESCRIPTION
 *  This function is to set the current values of the inline items
 * PARAMETERS
 *  void
 *  Input: None(?)
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_2line_read_setting()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    languages_default_item = gCurrLangIndex;
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    default_encoding_type = g_phnset_cntx_p->EncodingType;
#endif 
    mmi_phnset_2line_prfr_input_set_default();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_lang_complete_callback
 * DESCRIPTION
 *  This function is called when language menu item is unhighlighted
 * PARAMETERS
 *  menuitem_index      [IN]        Menuitem index
 *  selected_index      [IN]        Inline item index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_2line_lang_complete_callback(S32 menuitem_index, S32 selected_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curHightlightItem = gCurrLangIndex;
    languages_default_item = gCurrLangIndex;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_encod_complete_callback
 * DESCRIPTION
 *  This function is called when encoding type menu item is unhighlighted
 * PARAMETERS
 *  menuitem_index      [IN]        Menuitem index
 *  selected_index      [IN]        Inline item index
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
static void mmi_phnset_2line_encod_complete_callback(S32 menuitem_index, S32 selected_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    default_encoding_type = g_phnset_cntx_p->EncodingType;
}
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 

#ifdef __GEMINI__
static void mmi_phnset_2line_uart_complete_callback(S32 menuitem_index, S32 selected_index)
{
	g_uart_status = g_phnset_cntx_p->uart_status;
}
#endif /* __GEMINI__ */

/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_get_current
 * DESCRIPTION
 *  This function returns the default value to be shown with the two line menu item for phone setup
 * PARAMETERS
 *  item_index      [IN]        Menuitem index
 * RETURNS
 *  S32
 *****************************************************************************/
static S32 mmi_phnset_2line_get_current(S32 item_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 current_value = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (item_index == phone_setup_language)
    {
        current_value = (S32) gCurrLangIndex;
    }
    else if (item_index == phone_setup_preferred_input_method)
    {
        current_value = mmi_phnset_get_current_preferr_input();
    }
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    else if (item_index == phone_setup_encoding_type)
    {
        current_value = (S32) g_phnset_cntx_p->EncodingType;
    }
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 
#ifdef __GEMINI__
	else if (item_index == phone_setup_uart)
	{
		current_value = (S32) g_phnset_cntx_p->uart_status;
	}
#endif /* __GEMINI__ */
    else
    {
        return 0;
    }

    return current_value;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_select_data
 * DESCRIPTION
 *  This function used to get the two line menu item data for phone setup
 * PARAMETERS
 *  item_index              [IN]        Menuitem index
 *  inline_item_index       [IN]        Inline item index
 *  str_buff                [IN]        Inline Item String to be shown
 *  img_buff_p              [?]         Image to be shown with the inline item
 *  thumbnail               [?]         Thumbnail picture to be shown with the inline item
 * RETURNS
 *  pBOOL
 *****************************************************************************/
static pBOOL mmi_phnset_2line_select_data(
                S32 item_index,
                S32 inline_item_index,
                UI_string_type str_buff,
                PU8 *img_buff_p,
                wgui_thumbnail_image_union *thumbnail)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (item_index == phone_setup_language)
    {
        mmi_phnset_2line_lang_get_data(inline_item_index, str_buff, img_buff_p);
    }
    else if (item_index == phone_setup_preferred_input_method)
    {
        mmi_phnset_2line_prfr_input_get_data(inline_item_index, str_buff, img_buff_p);
    }
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    else if (item_index == phone_setup_encoding_type)
    {
        mmi_phnset_2line_encod_get_data(inline_item_index, str_buff, img_buff_p);
    }
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 
#ifdef __GEMINI__
	else if (item_index == phone_setup_uart)
	{
		mmi_phnset_2line_uart_get_data(inline_item_index, str_buff, img_buff_p);
	}
#endif /* __GEMINI__ */
    else
    {
        return FALSE;
    }
    return TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_get_display_style
 * DESCRIPTION
 *  This function used to get the two line menu item display style
 *  whether TWO_LINE_MENUITEM_STYLE_DISPLAY_HORIZONTAL_SELECT or TWO_LINE_MENUITEM_STYLE_DISPLAY_LEVEL_SELECT
 * PARAMETERS
 *  index       [IN]        Menuitem index
 * RETURNS
 *  U8
 *****************************************************************************/
U8 mmi_phnset_2line_get_display_style(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index == phone_setup_language || index == phone_setup_preferred_input_method
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
        || index == phone_setup_encoding_type
#endif 
        )
        return TWO_LINE_MENUITEM_STYLE_DISPLAY_HORIZONTAL_SELECT;
    else
    {
        return 0;   /* TWO_LINE_MENUITEM_STYLE_DISPLAY_LEVEL_SELECT? */
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_2line_get_menuitem_properties
 * DESCRIPTION
 *  This function is used to get the properties of the selected menu item
 * PARAMETERS
 *  index                           [IN]        Menu item index
 *  current_menuitem_properties     [?]         Structure to be filled for menuitem properties
 * RETURNS
 *  U8(?)
 *****************************************************************************/
static void mmi_phnset_2line_get_menuitem_properties(
                int index,
                wgui_two_line_menuitem_struct *current_menuitem_properties)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index == phone_setup_language)
    {
        current_menuitem_properties->num_of_items = (S32) GetLanguages(&(g_phnset_cntx_p->ppLang));
        current_menuitem_properties->image_flags = UI_TWO_LINE_MENUITEM_NO_THUMBNAIL;
        current_menuitem_properties->defualt_value_callback = mmi_phnset_2line_get_current;
        current_menuitem_properties->complete_callback = mmi_phnset_2line_lang_complete_callback;
        current_menuitem_properties->two_line_data_callback.get_data_for_horizontal_select =
            mmi_phnset_2line_select_data;
    }
    else if (index == phone_setup_preferred_input_method)
    {
        current_menuitem_properties->num_of_items = mmi_phnset_2line_prfr_input_get_total_items(index);
        current_menuitem_properties->image_flags = UI_TWO_LINE_MENUITEM_NO_THUMBNAIL;
        current_menuitem_properties->defualt_value_callback = mmi_phnset_2line_prfr_input_get_default;
        current_menuitem_properties->complete_callback = mmi_phnset_2line_prfr_input_complete_callback;
        current_menuitem_properties->two_line_data_callback.get_data_for_horizontal_select =
            mmi_phnset_2line_select_data;
    }
#ifdef __MMI_SET_DEF_ENCODING_TYPE__
    else if (index == phone_setup_encoding_type)
    {
        current_menuitem_properties->num_of_items = (S32) GetNumOfChild(MENU_SETTING_DEF_ENCODING_TYPE);
        current_menuitem_properties->image_flags = UI_TWO_LINE_MENUITEM_NO_THUMBNAIL;
        current_menuitem_properties->defualt_value_callback = mmi_phnset_2line_get_current;
        current_menuitem_properties->complete_callback = mmi_phnset_2line_encod_complete_callback;
        current_menuitem_properties->two_line_data_callback.get_data_for_horizontal_select =
            mmi_phnset_2line_select_data;
    }
#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 
#ifdef __GEMINI__
	else if (index == phone_setup_uart)
	{
        current_menuitem_properties->num_of_items = (S32)GetNumOfChild(MENU_ID_PHNSET_UART_SETUP);
        current_menuitem_properties->image_flags = UI_TWO_LINE_MENUITEM_NO_THUMBNAIL;
        current_menuitem_properties->defualt_value_callback = mmi_phnset_2line_get_current;
        current_menuitem_properties->complete_callback = mmi_phnset_2line_uart_complete_callback;
        current_menuitem_properties->two_line_data_callback.get_data_for_horizontal_select =
            mmi_phnset_2line_select_data;
	}
#endif /* __GEMINI__ */
}
#endif /* __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__ */ 


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetScr
 * DESCRIPTION
 *  This function is Entry function for Phonesetup
 *  Following functions: HintPhnsetTimeAndDate
 *  HighlighPhnsettSPOF
 *  HighlightPhnsetLang
 *  HintPhnsetPreferedInputMethod
 *  HighlightPhnsetContrastLevel
 *  HighlightPhnsetWelcomeText
 *  HighlightPhbSpeedDial
 *  HighlightPhnsetNITZ
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U8 *ItemType[MAX_SUB_MENUS];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* U32 maskingByte=-1;
       U32 menuItemId=-1; */

    /* 1 Call Exit Handler */
    EntryNewScreen(SCR9003_INITIALSETUP, ExitPhnsetScr, EntryPhnsetScr, NULL);

    /* 2 Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR9003_INITIALSETUP);

    /* 3. Retrieve no of child of menu item to be displayed */
    /* diamond, 2005/07/01 add _Ext to menu item functions */
    nNumofItem = GetNumOfChild_Ext(MENU9102_INITIAL_SETUP);

    /* 4. Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU9102_INITIAL_SETUP);

    /* 5. Retrieve string ids in sequence of given menu item to be displayed */
    /* diamond, 2005/07/01 add _Ext to menu item functions */
    GetSequenceStringIds_Ext(MENU9102_INITIAL_SETUP, nStrItemList);

    /* 6 Set current parent id */
    SetParentHandler(MENU9102_INITIAL_SETUP);

    /* 7 Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    /* 8 Construct the Hints List */
    ConstructHintsList(MENU9102_INITIAL_SETUP, ItemType);

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    if (!guiBuffer)
    {
        mmi_phnset_2line_read_setting();
    }
    is_inline_menu_exist = 1;
    wgui_set_pfn_to_get_display_style(mmi_phnset_2line_get_display_style);
    wgui_set_pfn_to_get_current_menu_item_properties(mmi_phnset_2line_get_menuitem_properties);
#endif /* __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__ */ 

    ShowCategory52Screen(
        STR_MENU9102_INITIAL_SETUP,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (PU16) gIndexIconsImageList,
        ItemType,
        0,
        0,
        guiBuffer);

    /* 9.Register function with right softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

#ifndef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
#endif 

}


/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetScr
 * DESCRIPTION
 *  This function is Exit function for Phonesetup
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/


#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    is_inline_menu_exist = 0;
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetScr
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup
 *  Follow functions: EntryPhnsetScr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    /* 3 Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetScr, KEY_EVENT_UP);
    SetKeyHandler(EntryPhnsetScr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* 4 Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}

/* Robin 0603: G12C request -- Add Display Setup menu */
#ifdef __MMI_DISP_SETUP_LEVEL_UP__


/*****************************************************************************
 * FUNCTION
 *  HighlightDispSetup
 * DESCRIPTION
 *  This function is highlight handler for Display Setup menu item (same level with pPhone Setup)
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightDispSetup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(EntryDispSetup, KEY_EVENT_UP);
    SetKeyHandler(EntryDispSetup, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  EntryDispSetup
 * DESCRIPTION
 *  This function is Entry function for Display Setup
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryDispSetup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U8 *ItemType[MAX_SUB_MENUS];
    U32 maskingByte = -1;
    U32 menuItemId = -1;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Call Exit Handler */
    EntryNewScreen(SCR_DISP_SETUP, NULL, EntryDispSetup, NULL);

    /* 2 Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_DISP_SETUP);

    /* 3. Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild(MENU_DISP_SETUP);

    /* 4. Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_DISP_SETUP);

    /* 5. Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds(MENU_DISP_SETUP, nStrItemList);

    /* 6 Set current parent id */
    SetParentHandler(MENU_DISP_SETUP);

    /* 7 Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    /* 8 Construct the Hints List */
    ConstructHintsList(MENU_DISP_SETUP, ItemType);

    ShowCategory52Screen(
        STR_DISP_SETUP,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (PU16) gIndexIconsImageList,
        ItemType,
        0,
        0,
        guiBuffer);

    /* 9.Register function with right softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    /* 10. Register Exit handler */
    //SetExitHandler(SCR9003_INITIALSETUP, ExitPhnsetScr);
    //SetGenericExitHandler( SCR_DISP_SETUP, NULL, EntryDispSetup);
}

#endif /* __MMI_DISP_SETUP_LEVEL_UP__ */ 


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetIdleScrDisp
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup-> IdleScreenDisplay
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetIdleScrDisp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetIdleScrDisp, KEY_EVENT_UP);
    SetKeyHandler(EntryPhnsetIdleScrDisp, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetIdleScrDisp
 * DESCRIPTION
 *  This function is Exit function for Phonesetup->IdleScreenDisplay
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetIdleScrDisp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */
    U8 *IdleScrDispType[MAX_SUB_MENUS];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Call Exit Handler */
    EntryNewScreen(SCR_IDLE_SCR_DISP, ExitPhnsetIdleScrDisp, EntryPhnsetIdleScrDisp, NULL);

    /* Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_IDLE_SCR_DISP);

    /* Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild_Ext(MENU_IDLE_SCR_DISP);

    /* Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_IDLE_SCR_DISP);

    /* Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds_Ext(MENU_IDLE_SCR_DISP, nStrItemList);

    /* Set current parent id */
    SetParentHandler(MENU_IDLE_SCR_DISP);

    /* Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    SetHintHandler(MENU_SETTING_SCR_SVR, HintPhnsetScreenSaver);

    /* Constrct Hint for Idle Screen Display */
    ConstructHintsList(MENU_IDLE_SCR_DISP, IdleScrDispType);

    /* Display Category Screen */
    ShowCategory52Screen(
        STR_IDLE_SCR_DISP,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        (PU16) gIndexIconsImageList,
        IdleScrDispType,
        0,
        0,
        guiBuffer);

    /* Register function with softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetIdleScrDisp
 * DESCRIPTION
 *  This function is Exit function for Phonesetup->IdleScreenDisplay
 *  Functionality: Save 1. Save Owner number  2. Show date and time status
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetIdleScrDisp(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Save NVRAM only when value is changed for date time and 
       own type on idle screen */
    if (g_phnset_cntx_p->ShowDtDirtyFlag == TRUE)
    {
        WriteValue(NVRAM_SETTING_STATUS_DT_TIME, &(g_phnset_cntx_p->curShowDtStatus), DS_BYTE, &error);
        g_phnset_cntx_p->ShowDtDirtyFlag = FALSE;
    }
    if (g_phnset_cntx_p->ShowOwnNumDirtyFlag == TRUE)
    {
        WriteValue(NVRAM_SETTING_OWNER_NO, &(g_phnset_cntx_p->curShowOwnNumStatus), DS_BYTE, &error);
        g_phnset_cntx_p->ShowOwnNumDirtyFlag = FALSE;
    }
    /* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)
    if (g_phnset_cntx_p->ShowOPNDirtyFlag == TRUE)
    {
        WriteValue(NVRAM_SETTING_OPN_DISPLAY, &(g_phnset_cntx_p->curShowOPNStatus), DS_BYTE, &error);
        g_phnset_cntx_p->ShowOPNDirtyFlag = FALSE;
    }
#endif /* defined(__MMI_OPERATOR_NAME_MENU__) */ 
}

#ifdef __MMI_MAINMENU_STYLE_CHANGE_EN__
/*****************************************************************************
 * FUNCTION
 *  HintPhnsetMainMenuStyle
 * DESCRIPTION
 *  This function is Hint handler for Phonesetup->IdleScreenDisplay --> Mainmenu style
 *  Follow functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetMainMenuStyle(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 p = NULL;
    U8 style = PhnsetGetMainMenuStyle();

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (style)
    {
    #ifdef __MMI_MAINMENU_MATRIX_SUPPORT__  /* 071705 Calvin added */
        case PHNSET_MAINMENU_STYLE_MATRIX:
            p = GetString(STR_MAINMENU_STYLE_MATRIX);
            break;
    #endif /* __MMI_MAINMENU_MATRIX_SUPPORT__ */ 

    #ifdef __MMI_MAINMENU_PAGE_SUPPORT__    /* 071705 Calvin added */
        case PHNSET_MAINMENU_STYLE_PAGE:
            p = GetString(STR_MAINMENU_STYLE_PAGE);
            break;
    #endif /* __MMI_MAINMENU_PAGE_SUPPORT__ */ 

    #ifdef __MMI_MAINMENU_LIST_SUPPORT__    /* 071705 Calvin added */
        case PHNSET_MAINMENU_STYLE_LIST:
            p = GetString(STR_MAINMENU_STYLE_LIST);
            break;
    #endif /* __MMI_MAINMENU_LIST_SUPPORT__ */ 

    #ifdef __MMI_MAINMENU_CIRCULAR_SUPPORT__        /* 071705 Calvin modified */
        case PHNSET_MAINMENU_STYLE_CIRCULE:
            p = GetString(STR_MAINMENU_STYLE_CIRCULAR);
            break;
    #endif /* __MMI_MAINMENU_CIRCULAR_SUPPORT__ */ 

    #ifdef __MMI_MAINMENU_ROTATE_SUPPORT__
        case PHNSET_MAINMENU_STYLE_ROTATE:
            p = GetString(STR_MAINMENU_STYLE_ROTATE);   /* PDG1   Manish */
            break;
    #endif /* __MMI_MAINMENU_ROTATE_SUPPORT__ */ 

    #ifdef __MMI_MAINMENU_TAB_SUPPORT__     /* 071705 Calvin modified */
        case PHNSET_MAINMENU_STYLE_TAB:
            p = GetString(STR_MAINMENU_STYLE_TAB);
            break;
    #endif /* __MMI_MAINMENU_TAB_SUPPORT__ */ 

        default:
            p = GetString(STR_GLOBAL_EMPTY);
            break;
    }
    mmi_ucs2cpy((PS8) hintData[index], (PS8) p);

}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetMainMenuStyle
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->IdleScreenDisplay --> Mainmenu style
 *  Follow functions: EntryPhnsetMainMenuStyle
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetMainMenuStyle(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetMainMenuStyle, KEY_EVENT_UP);
    SetKeyHandler(EntryPhnsetMainMenuStyle, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetMainMenuStyle
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay --> Main Menu Style
 *  Following functions: HighlightPhnsetMainMenuStyleSelect
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetMainMenuStyle(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //S16 Err=0;
    //U8 *IdleScrDispType[MAX_SUB_MENUS];

    /* Call Exit Handler */
    EntryNewScreen(SCR_MAINMENU_STYLE, NULL, EntryPhnsetMainMenuStyle, NULL);

    /* Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_MAINMENU_STYLE);

    /* Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild(MENU_SETTING_MAINMENU_STYLE);

    /* Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_SETTING_MAINMENU_STYLE);

    /* Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds(MENU_SETTING_MAINMENU_STYLE, nStrItemList);

    /* Set current parent id */
    SetParentHandler(MENU_SETTING_MAINMENU_STYLE);

    /* Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    /* Display Category Screen */
    ShowCategory11Screen(
        STR_MAINMENU_STYLE,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        g_phnset_cntx_p->MenuStyle,
        guiBuffer);

    /* Register function with softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetMainMenuStyleSelect
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->IdleScreenDisplay --> Mainmenu style
 *  Follow functions: PhnsetMainMenuStyleSelectLskHdlr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetMainMenuStyleSelect(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(PhnsetMainMenuStyleSelectLskHdlr, KEY_EVENT_UP);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetMainMenuStyleSelectLskHdlr
 * DESCRIPTION
 *  This function is left softkey handling function
 *  for Phonesetup->IdleScreenDisplay -> MainMenu style -> Select
 *  Functionality: Save the setting menu style
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetMainMenuStyleSelectLskHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 HighlightItem = 0;
    S16 Err;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    HighlightItem = (U8) GetHighlightedItem();

    if (g_phnset_cntx_p->MenuStyle != HighlightItem)
    {
        g_phnset_cntx_p->MenuStyle = HighlightItem;
        WriteValue(NVRAM_SET_MAINMENU_STYLE, &(g_phnset_cntx_p->MenuStyle), DS_BYTE, &Err);
    }

    DisplayPopup((U8*) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
    DeleteNScrId(SCR_MAINMENU_STYLE);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetMainMenuStyle
 * DESCRIPTION
 *  This function is to get setting main menu style
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetMainMenuStyle(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_phnset_cntx_p->MenuStyle;
}
#endif /* __MMI_MAINMENU_STYLE_CHANGE_EN__ */ 


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetShowDtTime
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup->IdleScreenDisplay-> Show Date and Time
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetShowDtTime(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* If Show Date Time if On Show LSK as OFF otherwise On. */
    if (g_phnset_cntx_p->curShowDtStatus)
    {
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    SetLeftSoftkeyFunction(PhnsetToggleShowDtTime, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetToggleShowDtTime
 * DESCRIPTION
 *  This function is Left softkey handler
 *  for Phonesetup->IdleScreenDisplay-> Show Date and Time
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetToggleShowDtTime(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* if show date time is on chnage it off */
    if (g_phnset_cntx_p->curShowDtStatus)
    {
        g_phnset_cntx_p->curShowDtStatus = 0;
    }
    /* else chnage it on */
    else
    {
        g_phnset_cntx_p->curShowDtStatus = 1;
    }

    /* Flag to Indicate Value is changed, will be used on exit Handler of menu */
    g_phnset_cntx_p->ShowDtDirtyFlag = TRUE;

    if (g_phnset_cntx_p->curShowDtStatus)
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    /* Redraw the Category Screen As Hint Handler and LSK are going to Chnage */
    RedrawCategoryFunction();

    /* After redraw hight the ShowDateTime */
    HighlightPhnsetShowDtTime();
}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetShowOwnNo
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup->IdleScreenDisplay->Show Owner Number
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetShowOwnNo(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* If Owner Number Is On Change The LSK to OFF otherwise ON. */
    if (g_phnset_cntx_p->curShowOwnNumStatus == 1)
    {
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    SetLeftSoftkeyFunction(PhnsetToggleShowOwnNo, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetToggleShowOwnNo
 * DESCRIPTION
 *  This function is Left softkey handler
 *  for Phonesetup->IdleScreenDisplay-> Show owner number
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetToggleShowOwnNo(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* If Own Number Display if Off then turn it On Pressing LSK */
    if (g_phnset_cntx_p->curShowOwnNumStatus == 0)
    {
        g_phnset_cntx_p->curShowOwnNumStatus = 1;
    }
    else
    {
        g_phnset_cntx_p->curShowOwnNumStatus = 0;
    }

    /* Flag to write NVRAM in Exit Handler */
    g_phnset_cntx_p->ShowOwnNumDirtyFlag = TRUE;

    if (g_phnset_cntx_p->curShowOwnNumStatus)
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    RedrawCategoryFunction();
    HighlightPhnsetShowOwnNo();
}

/* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetShowOPN
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup->IdleScreenDisplay->Show Operator Name
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetShowOPN(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* If Owner Number Is On Change The LSK to OFF otherwise ON. */
    if (g_phnset_cntx_p->curShowOPNStatus == 1)
    {
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    SetLeftSoftkeyFunction(PhnsetToggleShowOPN, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetToggleShowOPN
 * DESCRIPTION
 *  This function is Left softkey handler
 *  for Phonesetup->IdleScreenDisplay-> Show Operator Name
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetToggleShowOPN(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* If Own Number Display if Off then turn it On Pressing LSK */
    if (g_phnset_cntx_p->curShowOPNStatus == 0)
    {
        g_phnset_cntx_p->curShowOPNStatus = 1;
    }
    else
    {
        g_phnset_cntx_p->curShowOPNStatus = 0;
    }

    /* Flag to write NVRAM in Exit Handler */
    g_phnset_cntx_p->ShowOPNDirtyFlag = TRUE;

    if (g_phnset_cntx_p->curShowOPNStatus)
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    RedrawCategoryFunction();
    HighlightPhnsetShowOPN();
}
#endif /* defined(__MMI_OPERATOR_NAME_MENU__) */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetShowDTStatus
 * DESCRIPTION
 *  This function is to set show data time statu on/off
 *  Follow functions:
 * PARAMETERS
 *  status      [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetShowDTStatus(U8 status)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curShowDtStatus = status;
}

/*
 * ( Phonesetup-> SpeedDial -> Set Number ) functions are in speedDial.c
 */



/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetWelcomeText
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup-> Greeting Text
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetWelcomeText(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetWelcomeText, KEY_EVENT_UP);
    SetKeyHandler(EntryPhnsetWelcomeText, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetFillWelcomeInlineEditStruct
 * DESCRIPTION
 *  This function is to fill inline editor screen for Phonesetup-> Greeting Text
 * PARAMETERS
 *  pInlineStruct       [?]             
 *  a(?)                [IN/OUT]        
 *  b(?)                [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetFillWelcomeInlineEditStruct(void *pInlineStruct)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 *WelcomeString = NULL;
    InlineItem *InlineStruct = (InlineItem*) pInlineStruct;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    WelcomeString = GetWelcomeText();
    /* CurrSelect */
    g_phnset_cntx_p->curHightlightItem = (U32) IsShowWelcomeScr1();

    mmi_ucs2ncpy((S8*) WelcomeText, WelcomeString, MAX_SETTING_WELCOME_TEXT);
    OslMfree(WelcomeString);

    greet_text_on_off[1] = (U8*) GetString(STR_GLOBAL_ON);
    greet_text_on_off[0] = (U8*) GetString(STR_GLOBAL_OFF);

    SetInlineItemActivation(&InlineStruct[0], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemCaption(&InlineStruct[0], (PU8) (U8*) GetString(STR_MENU9146_OFF));

    SetInlineItemActivation(&InlineStruct[2], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemCaption(&InlineStruct[2], (PU8) (U8*) GetString(STR_MENU9146_ON));

    SetInlineItemActivation(&InlineStruct[1], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemSelect(
        &InlineStruct[1],
        2,
        greet_text_on_off,
        (S32*) & (g_phnset_cntx_p->curHightlightItem) /* CurrSelect */ );

    SetInlineItemActivation(&InlineStruct[3], KEY_LSK, KEY_EVENT_UP);
    /* disable new line */
    SetInlineItemFullScreenEdit_ext(
        &InlineStruct[3],
        STR_MENU9146_WELCOME_TEXT,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        (PU8) WelcomeText,
        MAX_SETTING_WELCOME_TEXT + 1,
        INPUT_TYPE_ALPHANUMERIC_SENTENCECASE,
        INPUT_TYPE_EXT_NO_SHOW_NEW_LINE_SYMBOL);

    SetInlineFullScreenEditCustomFunction(&InlineStruct[3], SettingInlineCustomFunction);

}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetWelcomeText
 * DESCRIPTION
 *  This function is Entry function for Phonesetup-> Greeting Text
 *  Following functions: EntryWelcomeTextOn
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetWelcomeText(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nNumofItem = 4; /* Stores no of children in the submenu */
    U8 *inputBuffer;    /* added for inline edit history */
    U8 *guiBuffer;      /* Buffer holding history data */
    U16 inputBufferSize;
    U16 ItemIcons[4] = {IMG_SETTING_GREET_STATUS, 0, IMG_SETTING_GREET_TEXT, 0};
    InlineItem greet_text_inline_edit_list[4];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR9146_WELCOME_TEXT, ExitPhnsetWelcomeText, NULL, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR9146_WELCOME_TEXT);

    InitializeCategory57Screen();
    memset(greet_text_inline_edit_list, 0, sizeof(greet_text_inline_edit_list));
    PhnsetFillWelcomeInlineEditStruct((void*)greet_text_inline_edit_list);
    inputBuffer = GetCurrNInputBuffer(SCR9146_WELCOME_TEXT, &inputBufferSize);  /* added for inline edit history */
    if (inputBuffer != NULL)
    {
        SetCategory57Data(greet_text_inline_edit_list, nNumofItem, inputBuffer);
    }

    ClearHighlightHandler();

    ShowCategory57Screen(
        STR_MENU9146_WELCOME_TEXT,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        ItemIcons,
        greet_text_inline_edit_list,
        0,
        guiBuffer);

    /* Register function for right soft key */
    SetCategory57RightSoftkeyFunctions(EntryPhnsetWelcomeTextDoneHdlr, GoBackHistory);

}


/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetWelcomeText
 * DESCRIPTION
 *  This function is Exit function for Phonesetup-> Greeting Text
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetWelcomeText(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history Scr;
    S16 nHistory = 0;
    U16 inputBufferSize;    /* added for inline edit history */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    Scr.scrnID = SCR9146_WELCOME_TEXT;
    CloseCategory57Screen();
    Scr.entryFuncPtr = EntryPhnsetWelcomeText;
    mmi_ucs2cpy((S8*) Scr.inputBuffer, (S8*) & nHistory);
    GetCategory57History(Scr.guiBuffer);
    inputBufferSize = (U16) GetCategory57DataSize();    /* added for inline edit history */
    GetCategory57Data((U8*) Scr.inputBuffer);           /* added for inline edit history */
    AddNHistory(Scr, (U16) inputBufferSize);            /* added for inline edit history */
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetWelcomeTextDoneHdlr
 * DESCRIPTION
 *  This function is done key handler  for Phonesetup-> Greeting Text -> Done
 *  Functionality: Query Yes/No
 *  Following functions:  PhnsetWelcomeTextDoneLskHdlr
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetWelcomeTextDoneHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;  /* Buffer holding history data */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Call Exit Handler */
    EntryNewScreen(SCR9146_WELCOME_TEXT_ON, NULL, NULL, NULL);

    /* Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR9146_WELCOME_TEXT_ON);

    /* Display Category1 Screen */
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (PU16) GetString(STR_ID_SETTING_SAVE_ASK),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);
    
    SetLeftSoftkeyFunction(PhnsetWelcomeTextDoneLskHdlr, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBack2TheHistory, KEY_EVENT_UP);

    /* Play warning tone */
    playRequestedTone(WARNING_TONE);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetWelcomeTextDoneLskHdlr
 * DESCRIPTION
 *  This function is Left softkey handler
 *  for Phonesetup-> Greeting Text -> Done -> Yes
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetWelcomeTextDoneLskHdlr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* ExecuteCurrExitHandler(); */

    ClearInputEventHandler(MMI_DEVICE_ALL);
    ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);

    WriteValue(
        NVRAM_SETTING_WELCOME_TEXT,
        (U8*) & (g_phnset_cntx_p->curHightlightItem) /* CurrSelect */ ,
        DS_BYTE,
        &error);
    WriteRecord(
        NVRAM_EF_SETTING_LID,
        1,
        (void*)WelcomeText,
        (U16) (MAX_SETTING_WELCOME_TEXT * ENCODING_LENGTH),
        &error);

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* 0 */ 

    DisplayPopup((PU8) GetString(STR_GLOBAL_SAVED), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
    DeleteNHistory(1);

}


/*****************************************************************************
 * FUNCTION
 *  HighlightSPOF
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->IdleScreenDisplay --> Mainmenu style
 *  Follow functions: EntryPhnsetMainMenuStyle
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightSPOF(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);

    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);

    /* 3 Register function for left soft key */
#ifdef MMI_ON_HARDWARE_P
    SetLeftSoftkeyFunction(EntrySpofApp, KEY_EVENT_UP);
    SetKeyHandler(EntrySpofApp, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#else /* MMI_ON_HARDWARE_P */ 
    SetLeftSoftkeyFunction(PopupNoSupport, KEY_EVENT_UP);
    SetKeyHandler(PopupNoSupport, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#endif /* MMI_ON_HARDWARE_P */ 

    /* 4 Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

/*
 * ( Phonesetup-> SPOF ) functions are in ScheduledPowerOnOff.c
 */

/*
 * Query function begin:
 */


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetShowOwnerNumStatus
 * DESCRIPTION
 *  This function is to get show owner number on/off status
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetGetShowOwnerNumStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data = 0;
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_OWNER_NO, &data, DS_BYTE, &error);

    if (data == 1)
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}

/* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetShowOPNStatus
 * DESCRIPTION
 *  This function is to get show owner number on/off status
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetGetShowOPNStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data = 0;
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_OPN_DISPLAY, &data, DS_BYTE, &error);

    if (data == 0)
    {
        return MMI_FALSE;
    }
    else
    {
        return MMI_TRUE;
    }
}
#endif /* defined(__MMI_OPERATOR_NAME_MENU__) */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetShowDateTimeStatus
 * DESCRIPTION
 *  This function is to get show date/time on/off status
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetGetShowDateTimeStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data = 0;
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_STATUS_DT_TIME, &data, DS_BYTE, &error);

    if (data == 0)
    {
        return MMI_FALSE;
    }
    else
    {
        return MMI_TRUE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetWelcomeText
 * DESCRIPTION
 *  This function is to set welcome text for AT command
 *  Functionality:
 * PARAMETERS
 *  mode        [IN]            
 *  dcs         [IN]            
 *  text        [?]             
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetSetWelcomeText(MMI_BOOL mode, U8 dcs, U8 *text, U8 length)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    S32 AtMode;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (length != 0xFF)
    {
        U8 AtWelcomeText[(MAX_SETTING_WELCOME_TEXT + 1) * ENCODING_LENGTH];

        memset(AtWelcomeText, 0, sizeof(AtWelcomeText));
        if (dcs == L4_ASCII)
        {
            mmi_asc_n_to_ucs2((S8*) AtWelcomeText, (S8*) text, MAX_SETTING_WELCOME_TEXT);
        }
        else if (dcs == L4_UCS2)
        {
            memcpy(AtWelcomeText, text, sizeof(AtWelcomeText));
        }

        WriteRecord(
            NVRAM_EF_SETTING_LID,
            1,
            (void*)AtWelcomeText,
            (U16) (MAX_SETTING_WELCOME_TEXT * ENCODING_LENGTH),
            &error);
            
        if (error != NVRAM_WRITE_SUCCESS)
        {
            return MMI_FALSE;
        }
    }

    if (mode == 0)
    {
        AtMode = 0;
    }
    else
    {
        AtMode = 1;
    }

    WriteValue(NVRAM_SETTING_WELCOME_TEXT, (U8*) & AtMode, DS_BYTE, &error);

    if (error != NVRAM_WRITE_SUCCESS)
    {
        return MMI_FALSE;
    }

    return MMI_TRUE;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetWelcomeText
 * DESCRIPTION
 *  This function is to get welcome text for AT command
 *  Functionality:
 * PARAMETERS
 *  buf             [?]             
 *  buf_size        [IN]            
 *  a(?)            [IN/OUT]        
 *  b(?)            [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetGetWelcomeText(S8 *buf, U16 buf_size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U8 data[(MAX_SETTING_WELCOME_TEXT + 1) * ENCODING_LENGTH];
    U16 max_buf_size;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset(data, 0, sizeof(data));
    ReadRecord(NVRAM_EF_SETTING_LID, 1, data, (MAX_SETTING_WELCOME_TEXT * ENCODING_LENGTH), &error);

    if (buf_size < (MAX_SETTING_WELCOME_TEXT + 1) * ENCODING_LENGTH)
    {
        max_buf_size = buf_size;
    }
    else
    {
        max_buf_size = (MAX_SETTING_WELCOME_TEXT + 1) * ENCODING_LENGTH;
    }

    memset(buf, 0, buf_size);
    if (data[0] != 0xFF)
    {
        memcpy(buf, data, (max_buf_size - ENCODING_LENGTH));
    }

}


/*
 * Hint Handler begin:
 */


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetLanguage
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetLanguage(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U8 data = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);

#ifdef __MMI_AUTO_LANG_EN__
    if (data == 0xFF)   /* Auto Language Selected */
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_LANGUAGESCR_AUTO));
    }
    else
#endif /* __MMI_AUTO_LANG_EN__ */ 
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) gLanguageArray[data].aName);
    }

}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetPreferedInputMethod
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_PREFER_INPUT_METHOD__
void HintPhnsetPreferedInputMethod(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U16 data = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_PREFER_INPUT_METHOD, &data, DS_SHORT, &error);
    InitPreferedInputMethod();
    mmi_ucs2cpy((PS8) hintData[index], (PS8) inputMethodList[GetInputMethodIndex(data)]);
}
#endif /* __MMI_PREFER_INPUT_METHOD__ */ 

#if defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__)
/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_writing_lang_highlight_hdlr
 * DESCRIPTION
 *  This function is highlight handler for Prefered WritingLang setting screen
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_writing_lang_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* update selected index */
    currWritingLangIdx = (U8) index;
    return;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_writing_lang_save
 * DESCRIPTION
 *  Save current preferred writing language and go back to prev screen
 * NA
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_writing_lang_save(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    S16 value;

#if defined(__MMI_MIXED_LANG_SUPPORT__)
    U8 i, j;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MIXED_LANG_SUPPORT__)
    if (!currWLangIsMain)
    {
        i = 0;
        j = (U8) currWritingLangIdx;
        do
        {
            if (g_ime_writing_lang_array[i].mixed_lang_support)
            {
                if (j == 0)
                    break;
                j--;
            }
            i++;
        } while (g_ime_writing_lang_array[i - 1].lang_id != IME_WRITING_LANG_NONE);
        MMI_ASSERT(i < MAX_WRITING_LANG);
        g_ime_sub_writing_lang = g_ime_writing_lang_array[i].lang_id;
        value = g_ime_sub_writing_lang;
        WriteValue(NVRAM_SETTING_WRITING_LANG_SUB, &value, DS_SHORT, &error);
    }
    else
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
    {
        extern const sIMEModeDetails *gIMEModeArray;
        extern U8 wgui_map_inputmode_to_inputtype(S32 input_mode, const sIMEModeDetails *IMEModeArray);
        extern S16 MMI_prefered_input_type;

        MMI_ASSERT(currWritingLangIdx < MAX_WRITING_LANG);
        g_ime_main_writing_lang = g_ime_writing_lang_array[currWritingLangIdx].lang_id;
        value = g_ime_main_writing_lang;
        WriteValue(NVRAM_SETTING_WRITING_LANG, &value, DS_SHORT, &error);

        MMI_prefered_input_type = 
            wgui_map_inputmode_to_inputtype(
                g_ime_writing_lang_array[currWritingLangIdx].default_input_mode, 
                gIMEModeArray); 
        value = MMI_prefered_input_type;
        WriteValue(NVRAM_SETTING_PREFER_INPUT_METHOD, &value, DS_SHORT, &error);
    }

    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_writing_lang_screen
 * DESCRIPTION
 *  Entry function
 * NA
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_entry_writing_lang_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_string_type langList[MAX_WRITING_LANG];
    U8 *pGuiBuffer;
    U8 i, totalLang;

#if defined(__MMI_MIXED_LANG_SUPPORT__)
    U8 j;
    S16 currLangSetting = currWLangIsMain ? g_ime_main_writing_lang : g_ime_sub_writing_lang;
#else /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
#define currLangSetting g_ime_main_writing_lang
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MIXED_LANG_SUPPORT__)
    if (!currWLangIsMain)
    {
        /* init sub writing language list */
        i = j = 0;
        do
        {
            if (g_ime_writing_lang_array[i].mixed_lang_support)
            {
                langList[j] = g_ime_writing_lang_array[i].lang_str_ptr;
                if (currLangSetting == g_ime_writing_lang_array[i].lang_id)
                    currWritingLangIdx = j;
                j++;
            }
            i++;
        } while (g_ime_writing_lang_array[i - 1].lang_id != IME_WRITING_LANG_NONE);     /* include None */
        totalLang = j;
    }
    else
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
    {
        /* init main writing language list */
        i = 0;
        do
        {
            langList[i] = g_ime_writing_lang_array[i].lang_str_ptr;

            if (currLangSetting == g_ime_writing_lang_array[i].lang_id)
                currWritingLangIdx = i;

            i++;
        } while (g_ime_writing_lang_array[i].lang_id != IME_WRITING_LANG_NONE); /* exclude None */
        totalLang = i;
    }

    MMI_ASSERT(totalLang <= MAX_WRITING_LANG);

    EntryNewScreen(SCR_ID_PHNSET_PREFERRED_WRITING_LANG, NULL, mmi_phnset_entry_writing_lang_screen, NULL);
    /* Get current screen info into gui buffer  for history purposes */
    pGuiBuffer = GetCurrGuiBuffer(SCR_ID_PHNSET_PREFERRED_WRITING_LANG);
    /* Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(mmi_phnset_writing_lang_highlight_hdlr);
    /* Display Screen */
    ShowCategory36Screen(
        STR_ID_PHNSET_PREFERED_WRITING_LANG,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        totalLang,
        (U8 **) langList,
        currWritingLangIdx,
        pGuiBuffer);

    /* Register function with left/right softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_phnset_writing_lang_save, KEY_EVENT_UP);
    /* Register function with left/right arrow key */
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_phnset_writing_lang_save, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* Register Exit handler */
    return;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_hint_writing_lang
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Writing language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_hint_writing_lang(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    i = 0;
    while(g_ime_writing_lang_array[i].lang_id != IME_WRITING_LANG_NONE)
    {
        if(g_ime_writing_lang_array[i].lang_id == IME_WRITING_LANG_123)
            g_ime_writing_lang_array[i].lang_str_ptr = (UI_string_type)GetString(STR_ID_IME_WRITING_LANGUAGE_123);
        i++;
    }
    g_ime_writing_lang_array[i].lang_str_ptr = (UI_string_type)GetString(STR_ID_IMG_WRITING_LANGUAGE_NONE);
    i = 0;
    do
    {
        if (g_ime_main_writing_lang == g_ime_writing_lang_array[i].lang_id)
        {
            mmi_ucs2cpy((S8*) hintData[index], (S8*) g_ime_writing_lang_array[i].lang_str_ptr);
            return;
        }
        i++;
    } while (g_ime_writing_lang_array[i - 1].lang_id != IME_WRITING_LANG_NONE);

}

#if defined(__MMI_MIXED_LANG_SUPPORT__)


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_writing_lang_highlight_main
 * DESCRIPTION
 *  This function is highlight handler for Prefered WritingLang setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_writing_lang_highlight_main(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    SetLeftSoftkeyFunction(mmi_phnset_entry_writing_lang_screen, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_writing_lang_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    currWLangIsMain = MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_writing_lang_highlight_sub
 * DESCRIPTION
 *  This function is highlight handler for Prefered WritingLang setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_writing_lang_highlight_sub(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_phnset_writing_lang_highlight_main();
    currWLangIsMain = MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_writing_lang_hint_sub
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Sub Writing language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_writing_lang_hint_sub(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    i = 0;
    do
    {
        if (g_ime_sub_writing_lang == g_ime_writing_lang_array[i].lang_id)
        {
            mmi_ucs2cpy((S8*) hintData[index], (S8*) g_ime_writing_lang_array[i].lang_str_ptr);
            return;
        }
        i++;
    } while (g_ime_writing_lang_array[i - 1].lang_id != IME_WRITING_LANG_NONE);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_mixed_language_screen
 * DESCRIPTION
 *  Entry function
 * NA
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_entry_mixed_language_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[4];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;         /* Stores no of children in the submenu */
    U16 nDispAttribute;     /* Stores display attribue */
    U8 *guiBuffer;          /* Buffer holding history data */
    U8 *ItemType[4];
    U8 *StringItem[4];
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Call Exit Handler */
    EntryNewScreen(SCR_ID_PHNSET_MIXED_LANG, NULL, mmi_phnset_entry_mixed_language_screen, NULL);

    /* 2 Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_ID_PHNSET_MIXED_LANG);

    /* 3. Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild_Ext(MENU_ID_PHNSET_PREFERED_WRITING_LANG);
    MMI_ASSERT(nNumofItem <= 4);

    /* 4. Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_ID_PHNSET_PREFERED_WRITING_LANG);

    /* 5. Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds_Ext(MENU_ID_PHNSET_PREFERED_WRITING_LANG, nStrItemList);
    for (i = 0; i < nNumofItem; i++)
        StringItem[i] = (U8*) GetString(nStrItemList[i]);

    /* 6 Set current parent id */
    SetParentHandler(MENU_ID_PHNSET_PREFERED_WRITING_LANG);

    /* 7 Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    /* 8 Construct the Hints List */
    ConstructHintsList(MENU_ID_PHNSET_PREFERED_WRITING_LANG, ItemType);

    ShowCategory354Screen(
        (U8*) GetString(STR_ID_PHNSET_PREFERED_WRITING_LANG),
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        StringItem,
        ItemType,
        (PU16) gIndexIconsImageList,
        0,
        guiBuffer);

    /* 9.Register function with right softkey */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_highlight_prefered_writing_lang
 * DESCRIPTION
 *  This function is highlight handler for Prefered WritingLang setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_phnset_highlight_prefered_writing_lang(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
#if defined(__MMI_MIXED_LANG_SUPPORT__)
    SetLeftSoftkeyFunction(mmi_phnset_entry_mixed_language_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_mixed_language_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#else /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
    SetLeftSoftkeyFunction(mmi_phnset_entry_writing_lang_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_writing_lang_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#endif /* defined(__MMI_MIXED_LANG_SUPPORT__) */ 
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

#endif /* defined(__MMI_PREFER_WRITING_LANG__) || defined(__MMI_MIXED_LANG_SUPPORT__) */ 

#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)


/*****************************************************************************
 * FUNCTION
 *  HighlightHandwritingSetting
 * DESCRIPTION
 *  This function is highlight handler for Handwriting setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightHandwritingSetting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    SetLeftSoftkeyFunction(EntryHandWritingSettingScr, KEY_EVENT_UP);
    SetKeyHandler(EntryHandWritingSettingScr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  HighlightCalibrationSetting
 * DESCRIPTION
 *  This function is highlight handler for Calibration setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightCalibrationSetting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
    SetLeftSoftkeyFunction(EntryCalibrationSettingScr, KEY_EVENT_UP);
    SetKeyHandler(EntryCalibrationSettingScr, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  SaveHandwritingSetting
 * DESCRIPTION
 *  This function saves pen setting in Settings->PhoneSetup->PenSetting screen
 *  Functionality:
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void SaveHandwritingSetting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 pError;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->pen_speed = gInlinePenSpeed;
    g_phnset_cntx_p->pen_color = gInlinePenColorIndex;

    WriteValue(NVRAM_PEN_SPEED, &(g_phnset_cntx_p->pen_speed), DS_BYTE, &pError);
    if (pError != NVRAM_WRITE_SUCCESS)
    {
        PRINT_INFORMATION("NVRAM PenSetting Write Failed. Error -%d", pError);
    }
    WriteValue(NVRAM_PEN_COLOR, &(g_phnset_cntx_p->pen_color), DS_BYTE, &pError);
    if (pError != NVRAM_WRITE_SUCCESS)
    {
        PRINT_INFORMATION("NVRAM Pen Setting Write Failed. Error -%d", pError);
    }

    DisplayPopup(
        (U8*)GetString(STR_GLOBAL_SAVED),
        IMG_GLOBAL_ACTIVATED,
        MMI_FALSE,
        UI_POPUP_NOTIFYDURATION_TIME,
        (U8)SUCCESS_TONE);

    DeleteScreenIfPresent(SCR_HANDWRITING_SETTING);
}


/*****************************************************************************
 * FUNCTION
 *  GoBackHandwritingSettingConfirm
 * DESCRIPTION
 *  This function exits pen setting screen when user doesn't save pen settings after changing in Settings->PhoneSetup->PenSetting screen
 *  Functionality:
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GoBackHandwritingSettingConfirm(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    GoBeyondMarkerScr(SCR_HANDWRITING_SETTING);
}


/*****************************************************************************
 * FUNCTION
 *  EntryScrHandwritingSettingConfirm
 * DESCRIPTION
 *  This function displays pop up to confirm pen settings change before saving them in Settings->PhoneSetup->PenSetting screen
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryScrHandwritingSettingConfirm(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_ID_SETTING_SAVE_ASK),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);

    SetLeftSoftkeyFunction(SaveHandwritingSetting, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHandwritingSettingConfirm, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  HandwritingSettingInlineColor
 * DESCRIPTION
 *  This function updates softkey and iInlinePen color according to change in Pen Color
 * PARAMETERS
 *  index       [IN]        
 *  a(?)        [IN]        
 *  b(?)        [OUT]       
 * RETURNS
 *  void
 *****************************************************************************/
void HandwritingSettingInlineColor(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index < MAX_PEN_COLORS)
    {
        if (index != gInlinePenColorIndex)
        {
            set_wgui_inline_list_menu_changed();
        }
        gInlinePenColorIndex = index;
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryHandWritingSettingScr
 * DESCRIPTION
 *  Entry function for Pen Setting Screen
 * PARAMETERS
 *  void
 *  a(?)        [IN]        
 *  b(?)        [OUT]       
 * RETURNS
 *  void
 *****************************************************************************/
void EntryHandWritingSettingScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U8 *inputBuffer;
    U16 inputBufferSize;
    U16 list_of_icons[4];

    S32 iCount;
    S16 item_offset = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_HANDWRITING_SETTING, ExitHandWritingSettingScr, NULL, NULL);
    guiBuffer = GetCurrGuiBuffer(SCR_HANDWRITING_SETTING);
    inputBuffer = GetCurrNInputBuffer(SCR_HANDWRITING_SETTING, &inputBufferSize);

    for (iCount = 0; iCount < MAX_PEN_SPEED; ++iCount)
    {
        g_pen_speed_str_list[iCount] = (U8*) GetString((U16) (iCount + STR_HANDWRITING_FAST));
    }

    gInlinePenSpeed = g_phnset_cntx_p->pen_speed;
    gInlinePenColorIndex = g_phnset_cntx_p->pen_color;

    /* start of Category 57 */
    InitializeCategory57Screen();

    /* Pen speed */
    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString(STR_HANDWRITING_PEN_SPEED));

    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemSelect(&wgui_inline_items[item_offset++], MAX_PEN_SPEED, g_pen_speed_str_list, &gInlinePenSpeed);

    /* Pen Color */
    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString(STR_HANDWRITING_PEN_COLOR));

    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemColorSelect(
        &wgui_inline_items[item_offset++],
        MAX_PEN_COLORS,
        (U16) gInlinePenColorIndex,
        (color*) g_pen_color_list,
        HandwritingSettingInlineColor);

    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, item_offset, inputBuffer);
    }

    list_of_icons[0] = IMG_GLOBAL_L1;
    list_of_icons[1] = 0;
    list_of_icons[2] = IMG_GLOBAL_L2;
    list_of_icons[3] = 0;

    ShowCategory57Screen(
        STR_HANDWRITING_SETTING,
        GetRootTitleIcon(MENU_SETTING_HANDWRITING),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_offset,
        list_of_icons,
        wgui_inline_items,
        0,
        guiBuffer);

    SetCategory57RightSoftkeyFunctions(EntryScrHandwritingSettingConfirm, GoBackHistory);
}


/*****************************************************************************
 * FUNCTION
 *  ExitHandWritingSettingScr
 * DESCRIPTION
 *  Exit function for Pen Setting Screen
 * PARAMETERS
 *  void
 *  a(?)        [IN]        
 *  b(?)        [OUT]       
 * RETURNS
 *  void
 *****************************************************************************/
void ExitHandWritingSettingScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;
    U16 inputBufferSize;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_HANDWRITING_SETTING;
    h.entryFuncPtr = EntryHandWritingSettingScr;
    GetCategoryHistory(h.guiBuffer);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);
}


/*****************************************************************************
 * FUNCTION
 *  WriteNvramCalibrationData
 * DESCRIPTION
 *  Writes calibration setting in NVRAM
 * PARAMETERS
 *  calibration_data        [IN]        
 * RETURNS
 *  void
 * REMARKS
 *  This function assumes that NVRAM Values of Calibration data are stored in
 *  a fixed order in NVRAMEnum.h file . Order should not be changed.
 *  
 *  It is not atomic operation between ReadRecord and WriteRecord, but it's okay.
 *****************************************************************************/
static void WriteNvramCalibrationData(mmi_pen_calibration_struct *calibration_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 tempBuffer[NVRAM_CACHE_SIZE];
    S16 pError = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Note: It is not atomic operation between ReadRecord and WriteRecord. */
    if (ReadRecord(NVRAM_EF_CACHE_DOUBLE_LID, 1, tempBuffer, NVRAM_CACHE_SIZE, &pError) < 0)
    {
        PRINT_INFORMATION("Calibration NVRAM data read failed , Error = %d", (int)pError);
        /* Do some error handling */
    }
    else
    {
        S16 i, j;

        for (i = NVRAM_PEN_CALIBRATION_VALUE1, j = 0; i <= NVRAM_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1;
             i++, j++)
        {
            memcpy(&tempBuffer[i * DS_DOUBLE], &calibration_data->data[j], DS_DOUBLE);
        }
        WriteRecord(NVRAM_EF_CACHE_DOUBLE_LID, 1, tempBuffer, NVRAM_CACHE_SIZE, &pError);
    }

    g_phnset_cntx_p->is_default_calibration_set = MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  WriteNvramFactoryDefaultCalibrationData
 * DESCRIPTION
 *  Writes factory default calibration setting in NVRAM
 * PARAMETERS
 *  calibration_data        [IN]        
 * RETURNS
 *  void
 * REMARKS
 *  This function assumes that NVRAM Values of Calibration data are stored in
 *  a fixed order in NVRAMEnum.h file . Order should not be changed.
 *  
 *  It is not atomic operation between ReadRecord and WriteRecord, but it's okay.
 *****************************************************************************/
static void WriteNvramFactoryDefaultCalibrationData(mmi_pen_calibration_struct *calibration_data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 tempBuffer[NVRAM_CACHE_SIZE];
    S16 pError = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Note: It is not atomic operation between ReadRecord and WriteRecord. */
    if (ReadRecord(NVRAM_EF_CACHE_DOUBLE_LID, 1, tempBuffer, NVRAM_CACHE_SIZE, &pError) < 0)
    {
        PRINT_INFORMATION("Calibration NVRAM data read failed , Error = %d", (int)pError);
        /* Do some error handling */
    }
    else
    {
        S16 i, j;

        for (i = NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1, j = 0;
             i <= NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1; i++, j++)
        {
            memcpy(&tempBuffer[i * DS_DOUBLE], &calibration_data->data[j], DS_DOUBLE);
        }
        WriteRecord(NVRAM_EF_CACHE_DOUBLE_LID, 1, tempBuffer, NVRAM_CACHE_SIZE, &pError);
    }

    g_phnset_cntx_p->is_default_calibration_set = MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  ValidateNvramCalibrationData
 * DESCRIPTION
 *  Function to validate calibration data read from NVRAM
 * PARAMETERS
 *  buffer          [?]         
 *  start_index     [IN]        
 *  end_index       [IN]        
 *  a(?)            [IN]        U8* , S16, S16
 *  b(?)            [OUT]       BOOL
 * RETURNS
 *  void
 *****************************************************************************/
static BOOL ValidateNvramCalibrationData(U8 *buffer, S16 start_index, S16 end_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i;
    unsigned char default_value[] = "\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF";

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = start_index; i <= end_index; i++)
    {
        if (memcmp(&buffer[i * DS_DOUBLE], default_value, DS_DOUBLE))
        {
            return MMI_TRUE;
        }
    }

    return MMI_FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetReadNvramCalibrationData
 * DESCRIPTION
 *  Function to read calibration data from NVRAM
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadNvramCalibrationData(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 tempBuffer[NVRAM_CACHE_SIZE];
    S16 pError = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->is_default_calibration_set = MMI_FALSE;

    if (ReadRecord(NVRAM_EF_CACHE_DOUBLE_LID, 1, tempBuffer, NVRAM_CACHE_SIZE, &pError) < 0)
    {
        PRINT_INFORMATION("Calibration NVRAM data read failed , Error = %d", (int)pError);
        /* Do nothing, driver will take care */
        return;
    }
    else
    {
        S16 i, j;
        mmi_pen_calibration_struct calibration_data;

        if (ValidateNvramCalibrationData
            (tempBuffer, NVRAM_PEN_CALIBRATION_VALUE1, NVRAM_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1))
        {
            /* Use user-calibrated data */
            for (i = NVRAM_PEN_CALIBRATION_VALUE1, j = 0;
                 i <= NVRAM_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1; i++, j++)
            {
                memcpy(&calibration_data.data[j], &tempBuffer[i * DS_DOUBLE], DS_DOUBLE);
            }
            mmi_pen_set_calibration_data(&calibration_data);
            g_phnset_cntx_p->is_default_calibration_set = MMI_TRUE;
            return;
        }
        else
        {
            /* Use factory default data */
            if (ValidateNvramCalibrationData
                (tempBuffer, NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1,
                 NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1))
            {
                for (i = NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1, j = 0;
                     i <= NVRAM_RESTORE_DEFAULT_PEN_CALIBRATION_VALUE1 + PEN_CALIBRATION_DATA_SIZE - 1; i++, j++)
                {
                    memcpy(&calibration_data.data[j], &tempBuffer[i * DS_DOUBLE], DS_DOUBLE);
                }
                mmi_pen_set_calibration_data(&calibration_data);
                g_phnset_cntx_p->is_default_calibration_set = MMI_TRUE;
                return;
            }
        }
        PRINT_INFORMATION("NVRAM Calibration Data not found");
        /* Do nothing, driver will take care */
    }
}

#if 0
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
/* under construction !*/
#endif /* 0 */ 


/*****************************************************************************
 * FUNCTION
 *  CalibrationSettingRestoreData
 * DESCRIPTION
 *  Restores calibration setting if user is not able to set calibration data properly
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void CalibrationSettingRestoreData(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_pen_set_calibration_data(&g_phnset_calibration_cntx_p->backup_data);
}


/*****************************************************************************
 * FUNCTION
 *  CalibrationSettingPenDown
 * DESCRIPTION
 *  PenDown Handler for Calibration Setting Screen
 * PARAMETERS
 *  point       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void CalibrationSettingPenDown(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_calibration_screen_state)
    {
        case CALIBRATION_WELCOME_STATE:
            g_phnset_calibration_screen_state = CALIBRATION_TOP_LEFT_POINT_STATE;
            UpdateCalibrationScreen(
                IMG_CALIBRATION_TOP_LEFT,
                g_phnset_calibration_cntx_p->points[0].x,
                g_phnset_calibration_cntx_p->points[0].y,
                STR_CALIBRATION_TOP_LEFT_TEXT,
                CALIBRATION_TOP_LEFT_POINT_STATE,
                MMI_TRUE);

            mmi_pen_start_calibration(NUM_CALIBRATION_POINTS, g_phnset_calibration_cntx_p->points);
            break;

        case CALIBRATION_TOP_LEFT_POINT_STATE:
            g_phnset_calibration_screen_state = CALIBRATION_BOTTOM_RIGHT_POINT_STATE;
            UpdateCalibrationScreen(
                IMG_CALIBRAION_BOTTOM_RIGHT,
                g_phnset_calibration_cntx_p->points[1].x,
                g_phnset_calibration_cntx_p->points[1].y,
                STR_CALIBRATION_BOTTOM_RIGHT_TEXT,
                CALIBRATION_BOTTOM_RIGHT_POINT_STATE,
                MMI_TRUE);
            break;

        case CALIBRATION_BOTTOM_RIGHT_POINT_STATE:
            g_phnset_calibration_screen_state = CALIBRATION_CENTER_POINT_STATE;
            UpdateCalibrationScreen(
                IMG_CALIBRATION_CENTER,
                g_phnset_calibration_cntx_p->points[2].x,
                g_phnset_calibration_cntx_p->points[2].y,
                STR_CALIBRATION_CENTER_TEXT,
                CALIBRATION_CENTER_POINT_STATE,
                MMI_TRUE);
            break;

        case CALIBRATION_CENTER_POINT_STATE:
    #ifndef __MTK_TARGET__  /* Emulate driver's response */
        {
            mmi_pen_calibration_struct calibration_data;

            g_phnset_calibration_cntx_p->finished = MMI_TRUE;

            /* Write calibration data in NVRAM */
            mmi_pen_read_calibration_data(&calibration_data);
            if (g_phnset_calibration_cntx_p->save_to_factory_default)
            {
                WriteNvramFactoryDefaultCalibrationData(&calibration_data);
            }
            else
            {
                WriteNvramCalibrationData(&calibration_data);
            }

            if (g_phnset_calibration_cntx_p->finish_callback)
            {
                DisplayPopupCallBack(
                    (U8*) GetString(STR_GLOBAL_DONE),
                    IMG_GLOBAL_ACTIVATED,
                    MMI_FALSE,
                    UI_POPUP_NOTIFYDURATION_TIME,
                    (U8) SUCCESS_TONE,
                    g_phnset_calibration_cntx_p->finish_callback);
            }
            else
            {
                DisplayPopup(
                    (U8*) GetString(STR_GLOBAL_DONE),
                    IMG_GLOBAL_ACTIVATED,
                    MMI_FALSE,
                    UI_POPUP_NOTIFYDURATION_TIME,
                    (U8) SUCCESS_TONE);
            }
        }
    #endif /* __MTK_TARGET__ */ 
            break;

        default:
            MMI_ASSERT(0);
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetCalibrationDriverRsp
 * DESCRIPTION
 *  Protocol event handler of driver response
 * PARAMETERS
 *  msg     [IN]        Local parameter
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MTK_TARGET__
void PhnsetCalibrationDriverRsp(void *msg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    tp_cali_done_struct *rsp;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    rsp = (tp_cali_done_struct*) msg;

    if (GetExitScrnID() != SCR_CALIBRATION_SETTING)
    {
        /* Race condition that screen is changed. */
        return;
    }

    if (rsp->result)
    {
        mmi_pen_calibration_struct calibration_data;

        g_phnset_calibration_cntx_p->finished = MMI_TRUE;

        /* Write calibration data in NVRAM */
        mmi_pen_read_calibration_data(&calibration_data);
        if (g_phnset_calibration_cntx_p->save_to_factory_default)
        {
            WriteNvramFactoryDefaultCalibrationData(&calibration_data);
        }
        else
        {
            WriteNvramCalibrationData(&calibration_data);
        }

        if (g_phnset_calibration_cntx_p->finish_callback)
        {
            DisplayPopupCallBack(
                (U8*) GetString(STR_GLOBAL_DONE),
                IMG_GLOBAL_ACTIVATED,
                MMI_FALSE,
                UI_POPUP_NOTIFYDURATION_TIME,
                (U8) SUCCESS_TONE,
                g_phnset_calibration_cntx_p->finish_callback);
        }
        else
        {
            DisplayPopup(
                (U8*) GetString(STR_GLOBAL_DONE),
                IMG_GLOBAL_ACTIVATED,
                MMI_FALSE,
                UI_POPUP_NOTIFYDURATION_TIME,
                (U8) SUCCESS_TONE);
        }
    }
    else
    {
        /*
         * Flush pen event queue because Pen Down event of the 3rd point might come after 
         * * MSG_ID_TP_CALI_DONE, but it is changed to CALIBRATION_TOP_LEFT_POINT_STATE.
         */
        mmi_pen_reset();

        /* Restart calibration process */
        CalibrationSettingRestoreData();

        g_phnset_calibration_screen_state = CALIBRATION_TOP_LEFT_POINT_STATE;
        UpdateCalibrationScreen(
            IMG_CALIBRATION_TOP_LEFT,
            g_phnset_calibration_cntx_p->points[0].x,
            g_phnset_calibration_cntx_p->points[0].y,
            STR_CALIBRATION_TOP_LEFT_TEXT,
            CALIBRATION_TOP_LEFT_POINT_STATE,
            MMI_TRUE);

        mmi_pen_start_calibration(NUM_CALIBRATION_POINTS, g_phnset_calibration_cntx_p->points);
    }
}
#endif /* __MTK_TARGET__ */ 


/*****************************************************************************
 * FUNCTION
 *  EntryCalibrationSettingScr
 * DESCRIPTION
 *  Entry function for Calibration Setting Screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryCalibrationSettingScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MTK_TARGET__
    SetProtocolEventHandler(PhnsetCalibrationDriverRsp, MSG_ID_TP_CALI_DONE);
#endif 

    EntryNewScreen(SCR_CALIBRATION_SETTING, ExitCalibrationSettingScr, NULL, NULL);

    g_phnset_calibration_cntx_p = OslMalloc(sizeof(mmi_phnset_calibration_struct));

    g_phnset_calibration_cntx_p->finished = MMI_FALSE;

    g_phnset_calibration_cntx_p->save_to_factory_default = MMI_FALSE;

#ifdef __MMI_TOUCH_SCREEN__
    g_phnset_calibration_cntx_p->finish_callback = NULL;

    /* 1st & 2nd point should not on the margin */
    g_phnset_calibration_cntx_p->points[0].x = UI_device_width / 10;
    g_phnset_calibration_cntx_p->points[0].y = UI_device_height / 10;
    g_phnset_calibration_cntx_p->points[1].x = UI_device_width * 9 / 10;
    g_phnset_calibration_cntx_p->points[1].y = UI_device_height * 9 / 10;
    /*
     * 3rd point should be different from the ceter point 
     * * such that driver can check it's ADC value
     */
    g_phnset_calibration_cntx_p->points[2].x = UI_device_width * 11 / 20;
    g_phnset_calibration_cntx_p->points[2].y = UI_device_height * 11 / 20;
#else /* __MMI_TOUCH_SCREEN__ */ 
    g_phnset_calibration_cntx_p->finish_callback = EntryTestControlAreaScr;

    /* 1st & 2nd point should not on the margin */
    g_phnset_calibration_cntx_p->points[0] = tp_calibration_point[0];
    g_phnset_calibration_cntx_p->points[1] = tp_calibration_point[1];
    g_phnset_calibration_cntx_p->points[2] = tp_calibration_point[2];

#endif /* __MMI_TOUCH_SCREEN__ */ 

    /* 1.Back up user calibration data */
    mmi_pen_read_calibration_data(&g_phnset_calibration_cntx_p->backup_data);

    /* 2 Show Calibration Welcome screen */
    g_phnset_calibration_screen_state = CALIBRATION_WELCOME_STATE;
    ShowCalibrationScreen(0, 0, 0, STR_CALIBRATION_WELCOME_TEXT, CALIBRATION_WELCOME_STATE);

    TurnOnBacklight(0);

    /* 3. Register Pen Handlers 
       Because hardware can not get correct ADC value on PenUp, we use PenDown for calibration. */
    ClearInputEventHandler(MMI_DEVICE_ALL);
    mmi_pen_register_up_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_down_handler(CalibrationSettingPenDown);
    mmi_pen_register_move_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_abort_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_repeat_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_long_tap_handler(mmi_pen_dummy_hdlr);

/* 2009.07.08 added by hongzhe.liu for end key exit calibration scrn + */
#ifdef __MMI_TOUCH_SCREEN__
    ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_END, KEY_EVENT_DOWN);
#endif
/* 2009.07.08 added by hongzhe.liu for end key exit calibration scrn - */
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnseFactoryDefaultCalibrationScr_internal
 * DESCRIPTION
 *  Entry function for Calibration Screen of factory default value
 * PARAMETERS
 *  void
 *  callback(?)     [IN]        Callback function after calibration is finished.
 * RETURNS
 *  void
 *****************************************************************************/
static void (*g_phnset_factory_default_finish_callback) (void);

static void EntryPhnseFactoryDefaultCalibrationScr_internal(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryCalibrationSettingScr();
/* 2009.07.08 added by hongzhe.liu for end key exit calibration scrn + */
    //ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);
/* 2009.07.08 added by hongzhe.liu for end key exit calibration scrn - */
    g_phnset_calibration_cntx_p->save_to_factory_default = MMI_TRUE;
    g_phnset_calibration_cntx_p->finish_callback = g_phnset_factory_default_finish_callback;
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnseFactoryDefaultCalibrationScr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  callback        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnseFactoryDefaultCalibrationScr(void (*callback) (void))
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_factory_default_finish_callback = callback;
    EntryPhnseFactoryDefaultCalibrationScr_internal();
}


/*****************************************************************************
 * FUNCTION
 *  ExitCalibrationSettingScr
 * DESCRIPTION
 *  Exit function for Calibration Setting Screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitCalibrationSettingScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;
    U16 nHistory = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (!g_phnset_calibration_cntx_p->finished)
    {
        /* Restore calibration previously set */
        mmi_pen_set_calibration_data(&g_phnset_calibration_cntx_p->backup_data);

        /* Calibration screen should be put in history, e.g. "Invalid SIM" popup on boot */
        h.scrnID = SCR_CALIBRATION_SETTING;
        if (g_phnset_calibration_cntx_p->save_to_factory_default)
        {
            h.entryFuncPtr = EntryPhnseFactoryDefaultCalibrationScr_internal;
        }
        else
        {
            h.entryFuncPtr = EntryCalibrationSettingScr;
        }
        mmi_ucs2cpy((S8*) h.inputBuffer, (S8*) & nHistory);
        memset(h.guiBuffer, 0, sizeof(h.guiBuffer));
        AddHistory(h);
    }

    g_phnset_calibration_screen_state = CALIBRATION_NULL_STATE;
    OslMfree(g_phnset_calibration_cntx_p);
    g_phnset_calibration_cntx_p = NULL;

    TurnOffBacklight();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetNeedFactoryDefaultCalibration
 * DESCRIPTION
 *  Whether pen is calibrated.
 * PARAMETERS
 *  void
 * RETURNS
 * BOOL
 *****************************************************************************/
BOOL PhnsetNeedFactoryDefaultCalibration(void)
{
#ifdef MMI_ON_WIN32
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* PC Simulator does not support NVRAM */
    return MMI_FALSE;
#else /* MMI_ON_WIN32 */ 
    if (!g_phnset_cntx_p->is_default_calibration_set)
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
#endif /* MMI_ON_WIN32 */ 
}

#ifdef __MMI_HANDWRITING_PAD__


/*****************************************************************************
 * FUNCTION
 *  TestControlAreaPenDown
 * DESCRIPTION
 *  PenDown Handler for Test Control Area Screen
 * PARAMETERS
 *  point       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
static void TestControlAreaPenDown(mmi_pen_point_struct point)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 state;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    state = UpdateTestControlAreaScreen(
                point,
                STR_TEST_CONTROL_AREA_WELCOME_TEXT,
                TEST_CONTROL_AREA_TESTING_STATE,
                MMI_TRUE);

    Trace2(TRACE_GROUP_2, "[G] TestControlAreaPenDown - state:%d   (%d, %d) ", state, point.x, point.y);
    if (state == TEST_CONTROL_AREA_FINISH_STATE)
    {
        mmi_frm_setup_default_pen_handler();
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_DONE),
            IMG_GLOBAL_ACTIVATED,
            MMI_FALSE,
            UI_POPUP_NOTIFYDURATION_TIME,
            (U8) SUCCESS_TONE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  ExitControlAreaTestingScr
 * DESCRIPTION
 *  Exit function for Calibration Setting Screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitControlAreaTestingScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    TurnOffBacklight();
}


/*****************************************************************************
 * FUNCTION
 *  EntryTestControlAreaScr
 * DESCRIPTION
 *  Entry function for Test Control Area Screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryTestControlAreaScr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_pen_point_struct pos = {0};

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_CALIBRATION_CONTROL_AREA_TESTING, ExitControlAreaTestingScr, NULL, NULL);

    /* Show control area test screen */
    ShowTestControlAreaScreen(pos, STR_TEST_CONTROL_AREA_WELCOME_TEXT, TEST_CONTROL_AREA_WELCOME_STATE);

    TurnOnBacklight(0);

    /* 2. Register Pen Handlers 
       Because hardware can not get correct ADC value on PenUp, we use PenDown for calibration. */
    ClearInputEventHandler(MMI_DEVICE_ALL);
    mmi_pen_register_up_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_down_handler(TestControlAreaPenDown);
    mmi_pen_register_move_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_abort_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_repeat_handler(mmi_pen_dummy_hdlr);
    mmi_pen_register_long_tap_handler(mmi_pen_dummy_hdlr);

}

#endif /* __MMI_HANDWRITING_PAD__ */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetHandwritingColor
 * DESCRIPTION
 *  Get handwriting stroke color
 * PARAMETERS
 *  void
 * RETURNS
 *  color
 *****************************************************************************/
color PhnsetGetHandwritingColor(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ASSERT(g_phnset_cntx_p->pen_color < MAX_PEN_COLORS);
    return g_pen_color_list[g_phnset_cntx_p->pen_color];
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetHandwritingSpeed
 * DESCRIPTION
 *  Get handwriting speed
 * PARAMETERS
 *  void
 * RETURNS
 *  PHNSET_HANDWRITING_SPEED_ENUM
 *****************************************************************************/
PHNSET_HANDWRITING_SPEED_ENUM PhnsetGetHandwritingSpeed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_cntx_p->pen_speed)
    {
        case 0:
            return PHNSET_HANDWRITING_FAST;
        case 1:
            return PHNSET_HANDWRITING_MEDIUM;
        case 2:
            return PHNSET_HANDWRITING_SLOW;
        default:
            MMI_ASSERT(0);
            return PHNSET_HANDWRITING_MEDIUM;
    }
}

#endif /* defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__) */ 


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetWelcomeText
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Greeting Text
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetWelcomeText(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (IsShowWelcomeScr1())
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
    }
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetOwnerNum
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetOwnerNum(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PhnsetGetShowOwnerNumStatus())
    {
        g_phnset_cntx_p->curShowOwnNumStatus = 1;
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
    }
    else
    {
        g_phnset_cntx_p->curShowOwnNumStatus = 0;
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
    }
}

/* Lisen 0921-1 */
#if defined(__MMI_OPERATOR_NAME_MENU__)


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetOPN
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetOPN(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PhnsetGetShowOPNStatus())
    {
        g_phnset_cntx_p->curShowOPNStatus = 1;
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
    }
    else
    {
        g_phnset_cntx_p->curShowOPNStatus = 0;
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
    }
}
#endif /* defined(__MMI_OPERATOR_NAME_MENU__) */ 


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetShowDateTime
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Language
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetShowDateTime(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PhnsetGetShowDateTimeStatus())
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
    }
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetWallpaper
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display Character -> Wallpaper
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetWallpaper(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    p = PhnsetGetCurWallpaperName();
    if (p)
    {
        mmi_ucs2cpy((PS8) hintData[index], p);
    }
}

#ifdef __MMI_SUB_WALLPAPER__


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetSubWallpaper
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display Character -> Wallpaper
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetSubWallpaper(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 name;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    name = PhnsetGetCurSubWallpaperName();
    if (name)
    {
        mmi_ucs2cpy((PS8) hintData[index], name);
    }
}
#endif /* __MMI_SUB_WALLPAPER__ */ 
#if defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__)


/*****************************************************************************
 * FUNCTION
 *  PhnsetReadIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadIdleClockType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_PHNSET_IDLE_CLOCK_TYPE, &(g_phnset_cntx_p->curtCLKType), DS_BYTE, &error);

    if (g_phnset_cntx_p->curtCLKType > 1)
    {
        g_phnset_cntx_p->curtCLKType = 0;
        WriteValue(NVRAM_PHNSET_IDLE_CLOCK_TYPE, &(g_phnset_cntx_p->curtCLKType), DS_BYTE, &error);
    }
    wgui_set_clock_type((U8) g_phnset_cntx_p->curtCLKType);
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetIdleClockType(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_cntx_p->curtCLKType)
    {
            /* 
             * case MMI_PHNSET_IDLECLKTYPE_NONE:
             * mmi_ucs2cpy((PS8)hintData[index],(PS8)GetString(STR_GLOBAL_NONE));
             * break;            
             */
        case MMI_PHNSET_IDLECLKTYPE_DIGITAL:
            mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_ID_PHNSET_DISPCHAR_DIGITAL));
            break;
        case MMI_PHNSET_IDLECLKTYPE_ANALOG:
            mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_ID_PHNSET_DISPCHAR_ANALOG));
            break;
        default:
            MMI_ASSERT(0);
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetIdleClockTypeHiliteHandler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetIdleClockTypeHiliteHandler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curHightlightItem = (U32) index;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetIdleClockType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curtCLKType = g_phnset_cntx_p->curHightlightItem;

    WriteValue(NVRAM_PHNSET_IDLE_CLOCK_TYPE, &(g_phnset_cntx_p->curtCLKType), DS_BYTE, &error);
    wgui_set_clock_type((U8) g_phnset_cntx_p->curtCLKType);
    g_phnset_cntx_p->isCorrectSet = 1;
    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
}


/*****************************************************************************
 * FUNCTION
 *  ExitPhnsetIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitPhnsetIdleClockType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->isCorrectSet)
    {
        DeleteUptoScrID(SCR_IDLE_SCR_DISP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetIdleClockType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *pGuiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_PHNSET_IDLE_CLOCK_TYPE, ExitPhnsetIdleClockType, EntryPhnsetIdleClockType, NULL);

    g_phnset_cntx_p->isCorrectSet = 0;
    pGuiBuffer = GetCurrGuiBuffer(SCR_ID_PHNSET_IDLE_CLOCK_TYPE);

    /*
     * subMenuDataPtrs[MMI_PHNSET_IDLECLKTYPE_NONE] = (PU8)GetString( STR_GLOBAL_NONE );;
     */
    subMenuDataPtrs[MMI_PHNSET_IDLECLKTYPE_ANALOG] = (PU8) GetString(STR_ID_PHNSET_DISPCHAR_ANALOG);
    subMenuDataPtrs[MMI_PHNSET_IDLECLKTYPE_DIGITAL] = (PU8) GetString(STR_ID_PHNSET_DISPCHAR_DIGITAL);

    if (g_phnset_cntx_p->curtCLKType > 1)
    {
        PhnsetReadIdleClockType();  /* __USB_IN_NORMAL_MODE__ */
    }

    RegisterHighlightHandler(PhnsetIdleClockTypeHiliteHandler);

    ShowCategory36Screen(
        STR_ID_IDLE_CLOCK_TYPE,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MMI_PHNSET_IDLECLKTYPE_MAX,
        (U8 **) subMenuDataPtrs,
        g_phnset_cntx_p->curtCLKType,
        pGuiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(PhnsetIdleClockType, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetIdleClockType
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetIdleClockType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);

    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);

    SetLeftSoftkeyFunction(EntryPhnsetIdleClockType, KEY_EVENT_UP);
    SetKeyHandler(EntryPhnsetIdleClockType, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

#endif /* defined(__MMI_UI_TECHNO_IDLESCREEN_BAR__) */ 


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetScreenSaver
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Display Character -> Screen Saver
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetScreenSaver(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (PhnsetGetCurScrSvrStatus())
    {
        case SET_SS_STATUS_ON:
        {
            PS8 p = PhnsetGetCurScrSvrName();

            if (p)
            {
                mmi_ucs2cpy((PS8) hintData[index], p);
            }
            else
            {
                mmi_ucs2cpy((PS8) hintData[index], "");
            }
        }
            break;

        case SET_SS_STATUS_OFF:
            mmi_ucs2cpy((PS8) hintData[index], (PS8)GetString(STR_GLOBAL_OFF));
            break;

    #ifdef __MMI_LCD_PARTIAL_ON__
        case SET_SS_STATUS_POWERSAVING:
            mmi_ucs2cpy((PS8) hintData[index], (const S8*)GetString(STR_SCREENSAVER_DISPLAY_TIME));
            break;
    #endif /* __MMI_LCD_PARTIAL_ON__ */ 

        default:
            mmi_ucs2cpy((PS8) hintData[index], "");
            /* memset(hintData[index],0,MAX_SUB_MENU_HINT_SIZE); */
    }
}


/*****************************************************************************
 * FUNCTION
 *  SettingInlineCustomFunction
 * DESCRIPTION
 *  This function is to be register as the inline editor full screen editor LSK handler
 *  for Phonesetup-> Greeting Text -> Greeting Text
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void SettingInlineCustomFunction(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION("*-------[SmsSettingsGuiInterface.c] SetProfileSettingCustomFuns -------*\n");
    ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
    SetLeftSoftkeyFunction(EntryScrForInputMethodAndDone, KEY_EVENT_UP);
    SetInputMethodAndDoneCaptionIcon(MAIN_MENU_TITLE_SETTINGS_ICON);
}

#ifdef __MMI_SET_DEF_ENCODING_TYPE__


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetDefEncoding
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup-> Default Encoding Type
 *  Follow functions: EntryPhnsetLang
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetDefEncoding(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change softkey label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    SetLeftSoftkeyFunction(EntryPhnsetDefEncoding, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    if (!is_inline_menu_exist)
#endif 
    {
        SetKeyHandler(EntryPhnsetDefEncoding, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetDefEncoding
 * DESCRIPTION
 *  This function is Hint handler for Phonesetup-> Default Encoding Type
 *  Follow functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetDefEncoding(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 hintStr = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_cntx_p->EncodingType)
    {
#ifdef __MMI_CHSET_BIG5__
        case PHNSET_ENCOD_BIG5:
            hintStr = (PS8) GetString(STR_DEF_ENCODING_TYPE_BIG5);
            break;
#endif /* __MMI_CHSET_BIG5__ */
#ifdef __MMI_CHSET_GB2312__
        case PHNSET_ENCOD_GB2312:
            hintStr = (PS8) GetString(STR_DEF_ENCODING_TYPE_GB2312);
            break;
#endif /* __MMI_CHSET_GB2312__ */
        case PHNSET_ENCOD_UCS2:
            hintStr = (PS8) GetString(STR_DEF_ENCODING_TYPE_UCS2);
            break;
#ifdef __MMI_CHSET_GB18030__
        case PHNSET_ENCOD_GB18030:
            hintStr = (PS8) GetString(STR_DEF_ENCODING_TYPE_GB18030);
            break;
#endif /* __MMI_CHSET_GB18030__ */
        default:
            hintStr = (PS8) GetString(STR_DEF_ENCODING_TYPE_BIG5);
            break;
    }
    mmi_ucs2cpy((PS8) hintData[index], hintStr);

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetDefEncodingHiliteHandler
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->Default Encoding Type
 *  Follow functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetDefEncodingHiliteHandler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curHightlightItem = (U32) index;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetDefEncodingSelectHandler
 * DESCRIPTION
 *  This function is LSK handler for Phonesetup->Default Encoding Type -> X
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetDefEncodingSelectHandler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    BOOL is_suc = MMI_TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->EncodingType != g_phnset_cntx_p->curHightlightItem)
    {
    #ifdef MMI_ON_HARDWARE_P
        switch (g_phnset_cntx_p->curHightlightItem)
        {
        #ifdef __MMI_CHSET_BIG5__        
            case PHNSET_ENCOD_BIG5:
                g_chset_text_encoding = MMI_CHSET_BIG5;
                break;
        #endif /* __MMI_CHSET_BIG5__ */ 

        #ifdef __MMI_CHSET_GB2312__
            case PHNSET_ENCOD_GB2312:
                g_chset_text_encoding = MMI_CHSET_GB2312;
                break;
        #endif /* __MMI_CHSET_GB2312__ */ 

        #ifdef __MMI_CHSET_GB18030__
            case PHNSET_ENCOD_GB18030:
                g_chset_text_encoding = MMI_CHSET_GB18030;
                break;
        #endif /* __MMI_CHSET_GB18030__ */ 


            default:
                /* g_chset_text_encoding =MMI_CHSET_BASE; */
                is_suc = MMI_FALSE;
                break;
        }
    #endif /* MMI_ON_HARDWARE_P */ 

        g_phnset_cntx_p->EncodingType = (U8) (g_phnset_cntx_p->curHightlightItem);
        WriteValue(NVRAM_SETTING_DEF_ENCODING, &(g_phnset_cntx_p->curHightlightItem), DS_BYTE, &error);
    #ifdef __MMI_AUDIO_PLAYER__
        mmi_audply_encoding_type_change_callback();
    #endif
    }

    if (MMI_TRUE == is_suc)
    {
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_DONE),
            IMG_GLOBAL_ACTIVATED,
            MMI_FALSE,
            UI_POPUP_NOTIFYDURATION_TIME,
            (U8) SUCCESS_TONE);
    }
    else
    {
        DisplayPopup(
            (U8*) GetString(STR_GLOBAL_ERROR),
            IMG_GLOBAL_ERROR,
            MMI_FALSE,
            UI_POPUP_NOTIFYDURATION_TIME,
            (U8) WARNING_TONE);
    }

    DeleteScreenIfPresent(SCR_DEF_ENCODING_TYPE);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetDefEncoding
 * DESCRIPTION
 *  This function is Entry function for Phonesetup-> Default encoding type
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetDefEncoding(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nStrItemList[MAX_SUB_MENUS];    /* Stores the strings id of submenus returned */
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* U8 *HintList[MAX_SUB_MENUS]; */

    /* 1 Call Exit Handler */
    EntryNewScreen(SCR_DEF_ENCODING_TYPE, NULL, EntryPhnsetDefEncoding, NULL);

    /* 2 Get current screen to gui buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_DEF_ENCODING_TYPE);

    /* 3. Retrieve no of child of menu item to be displayed */
    nNumofItem = GetNumOfChild(MENU_SETTING_DEF_ENCODING_TYPE);

    /* 4. Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_SETTING_DEF_ENCODING_TYPE);

    /* 5. Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds(MENU_SETTING_DEF_ENCODING_TYPE, nStrItemList);

    /* 6 Set current parent id */
    SetParentHandler(MENU_SETTING_DEF_ENCODING_TYPE);

    /* 7 Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(PhnsetDefEncodingHiliteHandler);

    /* 8 Construct the Hints List */
    /* ConstructHintsList(MENU_SETTING_DEF_ENCODING_TYPE, HintList); */

    /* 9. Display Category screen */
    ShowCategory11Screen(STR_DEF_ENCODING_TYPE_TITLE,
                         MAIN_MENU_TITLE_SETTINGS_ICON,
                         STR_GLOBAL_OK, IMG_GLOBAL_OK, STR_GLOBAL_BACK, IMG_GLOBAL_BACK, nNumofItem, nStrItemList,
#if defined(__MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__)
                         g_phnset_cntx_p->curHightlightItem,
#else 
                         g_phnset_cntx_p->EncodingType,
#endif 
                         guiBuffer);

    /* 10.Register function with softkey */
    SetLeftSoftkeyFunction(PhnsetDefEncodingSelectHandler, KEY_EVENT_UP);
    SetKeyHandler(NULL, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}

#endif /* __MMI_SET_DEF_ENCODING_TYPE__ */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetDefEncodingType
 * DESCRIPTION
 *  This function is export function for applications to query the current encoding type setting
 *  Follow functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetDefEncodingType(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_chset_text_encoding; 

}

/*
 * Language Setting
 */


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetLang
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->Language
 *  Follow functions: EntryPhnsetLang
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetLang(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);

    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);

    SetLeftSoftkeyFunction(EntryPhnsetLang, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    if (!is_inline_menu_exist)
#endif 
    {
        SetKeyHandler(EntryPhnsetLang, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetLang
 * DESCRIPTION
 *  This function is Entry function for Phonesetup->IdleScreenDisplay
 *  Following functions:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetLang(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *pGuiBuffer;
    S32 totalLang;

#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    U16 hiliteItem = g_phnset_cntx_p->curHightlightItem;
#else 
    U16 hiliteItem = gCurrLangIndex;
#endif 
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_LANGUAGE_SELECTION, NULL, EntryPhnsetLang, NULL);

    totalLang = (S32) GetLanguages(&(g_phnset_cntx_p->ppLang));

#ifdef __MMI_AUTO_LANG_EN__
    {
        S16 error;
        U8 data = 0;

        ReadValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);
        if (data == 0xFF)   /* Auto Language set */
        {
            hiliteItem = 0;
        }
        else
        {
            hiliteItem += 1;
        }
    }
    subMenuDataPtrs[0] = (PU8) GetString(STR_LANGUAGESCR_AUTO);
    for (i = 0; i < totalLang; i++)
    {
        subMenuDataPtrs[i + 1] = g_phnset_cntx_p->ppLang[i];
    }
    totalLang += 1;
#else /* __MMI_AUTO_LANG_EN__ */ 
    for (i = 0; i < totalLang; i++)
    {
        subMenuDataPtrs[i] = g_phnset_cntx_p->ppLang[i];
    }
#endif /* __MMI_AUTO_LANG_EN__ */ 
    pGuiBuffer = GetCurrGuiBuffer(SCR_LANGUAGE_SELECTION);

    RegisterHighlightHandler(PhnsetLangHiliteHandler);

    ShowCategory36Screen(
        STR_MENU_LANGUAGE,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        totalLang,
        (U8 **) subMenuDataPtrs,
        hiliteItem,
        pGuiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(PhnsetLangLSKHandler, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetLangHiliteHandler
 * DESCRIPTION
 *  This function is Highlight handler for Phonesetup->Language
 *  Follow functions:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetLangHiliteHandler(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->curHightlightItem = (U32) index;

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetLangLSKHandler
 * DESCRIPTION
 *  This function is left softkey handling function
 *  for Phonesetup->Language
 *  Functionality: Save the setting menu style
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetLangLSKHandler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data;
    S16 error;
    U16 index;
    S32 LangIdx = g_phnset_cntx_p->curHightlightItem;
    BOOL isAutoLangSet = MMI_FALSE;

#if defined(NOKE_DEBUG)
    noke_dbg_printf("(LangIdx)g_phnset_cntx_p->curHightlightItem = % d \r\n",g_phnset_cntx_p->curHightlightItem);
    noke_dbg_printf("gCurrLangIndex = % d \r\n",gCurrLangIndex);
#endif	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_AUTO_LANG_EN__
	#error "Touch ..."
    if (g_phnset_cntx_p->curHightlightItem == 0)    /* Auto Language selected */
    {
        LangIdx = 0;
        isAutoLangSet = MMI_TRUE;
    }
    else
    {
        LangIdx -= 1;
    }
#endif /* __MMI_AUTO_LANG_EN__ */ 

    ReadValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);

   /************************************************************************/
    /* Robin 1129, Add auto language selection                        */
   /************************************************************************/
    /* if( (LangIdx != (S32) gCurrLangIndex) *** Different Language        */
    /*   || (data != 0xFF && isAutoLangSet == MMI_TRUE)  *** Auto Lang Set  */
    /*   || (data == 0xFF && isAutoLangSet == MMI_FALSE) *** Auto Lang UnSet */
    /*   )                                                   */
   /************************************************************************/

    if ((LangIdx != (S32) gCurrLangIndex)
        || (data != 0xFF && isAutoLangSet == MMI_TRUE) 
        || (data == 0xFF && isAutoLangSet == MMI_FALSE))
    {
	        index = GetCurrHiliteID();
#if defined(NOKE_DEBUG)
	        noke_dbg_printf("index = % d \r\n",index);
	        noke_dbg_printf("isAutoLangSet = % d \r\n",isAutoLangSet);
#endif			
        		if (isAutoLangSet == MMI_TRUE)
	        {
#if defined(NOKE_DEBUG)
		        noke_dbg_printf("isAutoLangSet == MMI_TRUE\r\n");        		
#endif
		        #ifdef __MMI_AUTO_LANG_EN__
		            /* only when __MMI_AUTO_LANG_EN__ compile option turn on, the isAutoLangSet is possible to be TRUE  */
		            U16 autoLangIdx = PhnsetGetAutoLangIdx();

		            data = 0xFF;
		            SetCurrentLanguage((S8) autoLangIdx);
		            WriteValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);
		            mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_LANGUAGESCR_AUTO));

			   /********************************************************/
		            /* Robin 0602, Remove set AT command profile functions  */
		            /* AT command will query MMI when needed                */
		            /* Send to PS for AT+CLAE                               */
			   /********************************************************/
		            SendLangChange2AT((U8) autoLangIdx);
		        #endif /* __MMI_AUTO_LANG_EN__ */ 
	        }
       		else
	        {
#if defined(NOKE_DEBUG)
	            noke_dbg_printf("isAutoLangSet != MMI_TRUE\r\n");        		
#endif
	            data = (U8) LangIdx;
	            SetCurrentLanguage((S8) data);
	            WriteValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);
	            mmi_ucs2cpy((PS8) hintData[index], (PS8) g_phnset_cntx_p->ppLang[(U8) LangIdx]);

	      /********************************************************/
	            /* Robin 0602, Remove set AT command profile functions  */
	            /* AT command will query MMI when needed                */
	            /* Send to PS for AT+CLAE                               */
	      /********************************************************/
	            SendLangChange2AT((U8) LangIdx);
	        }

	        Category52ChangeItemDescription(2, hintData[index]);
		#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
		 if (!is_inline_menu_exist)
		#endif 

    		    RefreshNwProviderName(gPLMN);

		#ifdef __MMI_DUAL_SIM_MASTER__
		    #ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
		    if (!is_inline_menu_exist)
		    #endif 	/* __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__ */
		    {
		        MTPNP_PFAL_Refresh_Card2PLMN();
		    }
		#endif	/* __MMI_DUAL_SIM_MASTER__ */

		    #ifdef __MMI_SUBLCD__
		        if (g_idle_context.IsSubLcdOnIdleScreen == 1)
		        {
		            ShowIdleAppSubLcd();
		        }
		    #endif /* __MMI_SUBLCD__ */ 
    }

#if 1
	//Huyanwei Modify It
    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    if (!is_inline_menu_exist)
#endif 
        DeleteNHistory(1);
#endif
     	

}

#ifdef __MMI_AUTO_LANG_EN__


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetAutoLangIdx
 * DESCRIPTION
 *  This function is to read language setting from nvram and set
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
U16 PhnsetGetAutoLangIdx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 lang_idx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->LP != CBS_INVALID && g_phnset_cntx_p->LP != CBS0_LANG_UNSPECIFIED)
    {
        for (lang_idx = 0; lang_idx < MMI_NUM_OF_AUTOLANG_ELEM; lang_idx++)
        {
            if (g_phnset_cntx_p->LP == auto_lang_struct[lang_idx].LanType)
            {
                if (auto_lang_struct[lang_idx].LanSSC)
                {
                    return GetLanguageIndex((S8*) auto_lang_struct[lang_idx].LanSSC);
                }
                else
                {
                    return 0;
                }
            }
        }

        if (lang_idx == MMI_NUM_OF_AUTOLANG_ELEM)   /* Not found! LP Not support */
        {
        #ifdef MMI_ON_HARDWARE_P
            return (U16) GetLanguageIndex((S8*) MMI_DEFLANGSSC_FOR_AUTO);
        #else 
            return 0;
        #endif 
        }
    }
    else
    {
    #ifdef MMI_ON_HARDWARE_P
        return (U16) GetLanguageIndex((S8*) MMI_DEFLANGSSC_FOR_AUTO);
    #else 
        return 0;
    #endif 
    }

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetPLPInd
 * DESCRIPTION
 *  Process and store LP in phonesetup context
 *  Functionality:
 * PARAMETERS
 *  LPArr       [?]             
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
#define MMI_MAX_LP 5
void PhnsetPLPInd(U8 *LPArr)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 i = 0, j = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    for (i = 0; i < MMI_MAX_LP; i++)
    {
        /* found LP from language_type/SSC mapping table --> auto_lang_struct[]  */
        for (j = 0; j < MMI_NUM_OF_AUTOLANG_ELEM; j++)
        {
            if (LPArr[i] == auto_lang_struct[j].LanType)
            {
                break;
            }
        }

        /* Find language array (gLanguageArray) using found SSC */
        if (j != MMI_NUM_OF_AUTOLANG_ELEM)
        {
            if (auto_lang_struct[j].LanSSC)
                if (GetLanguageIndex((S8*) auto_lang_struct[j].LanSSC) != 0xFFFF)
                {
                    PhnsetSetLP(LPArr[i]);
                    break;
                }
        }
    }

}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetLP
 * DESCRIPTION
 *  This function is for SIM info indication to set LP
 *  Functionality:
 * PARAMETERS
 *  LP          [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetLP(U8 LP)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->LP = LP;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetLang
 * DESCRIPTION
 *  This function is to get user set language
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetLang(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_phnset_cntx_p->UsrLangIdx;
}

#endif /* __MMI_AUTO_LANG_EN__ */ 


/* UART Setup functions */
#ifdef __GEMINI__
/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetUARTSetup
 * DESCRIPTION
 *  This function of high light UART Setup
 * PARAMETERS
 *  void            
 * RETURNS
 *  void
 *****************************************************************************/
static void HighlightPhnsetUARTSetup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Change soft key label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);
	
    SetLeftSoftkeyFunction(EntryPhnsetUARTSetup, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
	
#ifdef __MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__
    if (!is_inline_menu_exist)
#endif 
    {
        SetKeyHandler(EntryPhnsetUARTSetup, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    }
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetUARTSetup
 * DESCRIPTION
 *  This function of hint UART Setup
 * PARAMETERS
 *  void            
 * RETURNS
 *  void
 *****************************************************************************/
static void HintPhnsetUARTSetup(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 hintStr = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_phnset_cntx_p->uart_status)
    {
	case MMI_PHNSET_UART_SIM1:
		hintStr = (PS8) GetString(STRING_MTPNP_UART_SIM1);
		break;

	case MMI_PHNSET_UART_SIM2:
		hintStr = (PS8) GetString(STRING_MTPNP_UART_SIM2);
		break;

	default:
		hintStr = (PS8) GetString(STRING_MTPNP_UART_SIM1);
		break;
    }

    mmi_ucs2cpy((PS8) hintData[index], hintStr);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetUARTSetup
 * DESCRIPTION
 *  This function to Entry UART Setup
 * PARAMETERS
 *  void            
 * RETURNS
 *  void
 *****************************************************************************/
static void EntryPhnsetUARTSetup(void)
{
/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 nNumofItem;                     /* Stores no of children in the submenu */
    U16 nDispAttribute;                 /* Stores display attribue */
    U8 *guiBuffer;                      /* Buffer holding history data */
	U16 nStrItemList[2] = {STRING_MTPNP_UART_SIM1, STRING_MTPNP_UART_SIM2};
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* U8 *HintList[MAX_SUB_MENUS]; */
	
    /* 1 Call Exit Handler */
    EntryNewScreen(SCR_ID_PHNSET_UART_SETUP, NULL, EntryPhnsetUARTSetup, NULL);
	
    /* 2 Get current screen to GUI buffer  for history purposes */
    guiBuffer = GetCurrGuiBuffer(SCR_ID_PHNSET_UART_SETUP);
	
    /* 3. Retrieve no of child of menu item to be displayed */
    nNumofItem = 2; // GetNumOfChild(MENU_ID_PHNSET_UART_SETUP);
	
    /* 4. Get attribute of menu to be displayed */
    nDispAttribute = GetDispAttributeOfItem(MENU_ID_PHNSET_UART_SETUP);
	
    /* 5. Retrieve string ids in sequence of given menu item to be displayed */
    GetSequenceStringIds(MENU_ID_PHNSET_UART_SETUP, nStrItemList);
	
    /* 6 Set current parent id */
    SetParentHandler(MENU_ID_PHNSET_UART_SETUP);
	
    /* 7 Register highlight handler to be called in menu screen */
    RegisterHighlightHandler(PhnsetUARTSetupHiliteHandler);
	
    /* 9. Display Category screen */
    ShowCategory11Screen(STR_ID_PHNSET_UART_SETUP_TITLE,
		MAIN_MENU_TITLE_SETTINGS_ICON,
		STR_GLOBAL_OK, 
		IMG_GLOBAL_OK, 
		STR_GLOBAL_BACK, 
		IMG_GLOBAL_BACK, 
		nNumofItem, 
		nStrItemList,
#if defined(__MMI_PHNSET_TWO_LINE_MENUITEM_DISPLAY__)
 		g_phnset_cntx_p->curHightlightItem,
#else 
		g_phnset_cntx_p->uart_status,
#endif
		guiBuffer);
	
    /* 10.Register function with softkey */
    SetLeftSoftkeyFunction(PhnsetUARTSetupSelectHandler, KEY_EVENT_UP);
    SetKeyHandler(NULL, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetUARTSetupSelectHandler
 * DESCRIPTION
 *  This function to Entry UART Setup
 * PARAMETERS
 *  void            
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetUARTSetupSelectHandler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->uart_status != g_phnset_cntx_p->curHightlightItem)
    {
#ifdef MMI_ON_HARDWARE_P
        switch (g_phnset_cntx_p->curHightlightItem)
        {      
		case MMI_PHNSET_UART_SIM1:
			g_uart_status = MMI_PHNSET_UART_SIM1;
			break; 
			
		case MMI_PHNSET_UART_SIM2:
			g_uart_status = MMI_PHNSET_UART_SIM2;
			break; 
			
		default:
			break;
        }
#endif	/* MMI_ON_HARDWARE_P */
    }
	else	/* same mode */
	{
		DisplayPopup(
            (U8*) GetString(STR_GLOBAL_DONE),
            IMG_GLOBAL_ACTIVATED,
            MMI_FALSE,
            UI_POPUP_NOTIFYDURATION_TIME,
            (U8) SUCCESS_TONE);

		DeleteScreenIfPresent(SCR_ID_PHNSET_UART_SETUP);

		return;
	}
	
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        (PU16) GetString(STR_ID_PHNSET_UART_REBOOT),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);


    SetKeyHandler(NULL, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(PhnsetUARTSetupSelectYes, KEY_EVENT_UP);
	
    /* Register function for right soft key */
    SetKeyHandler(NULL, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(PhnsetUARTSetupSelectNo, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetUARTSetupSelectYes
 * DESCRIPTION
 *  This function to press RSK to UART
 * PARAMETERS
 *  void       
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetUARTSetupSelectYes(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 buffer[NVRAM_EF_SYS_CACHE_OCTET_SIZE];
	S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	ReadRecord(NVRAM_EF_SYS_CACHE_OCTET_LID, NVRAM_SYS_FLIGHTMODE_STATE, (void*)buffer, 
		NVRAM_EF_SYS_CACHE_OCTET_SIZE, &error);

	switch(g_uart_status)
	{
	case MMI_PHNSET_UART_SIM1:
		buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_UART_TO_SIM1;
		break;

	case MMI_PHNSET_UART_SIM2:
		buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_UART_TO_SIM2;
	    break;

	case MMI_PHNSET_UART_SIM_NONE:
		buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_DUAL_SIM_UART_SETTING_NONE;
		break;

	default:
	    break;
	}

	WriteRecord(NVRAM_EF_SYS_CACHE_OCTET_LID, NVRAM_SYS_FLIGHTMODE_STATE, (void*)buffer, 
		NVRAM_EF_SYS_CACHE_OCTET_SIZE, &error);

	g_phnset_cntx_p->uart_status = g_uart_status;

	PhnSetUARTSetupReboot();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetUARTSetupSelectNo
 * DESCRIPTION
 *  This function to press RSK to UART
 * PARAMETERS
 *  void       
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetUARTSetupSelectNo(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	DeleteScreenIfPresent(SCR_ID_PHNSET_UART_SETUP);
	GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetUARTSetupHiliteHandler
 * DESCRIPTION
 *  This function is to high light UART Setup handle
 * PARAMETERS
 *  S32 high light item index          
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnsetUARTSetupHiliteHandler(S32 index)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	g_phnset_cntx_p->curHightlightItem = (U32) index;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetUARTConfig
 * DESCRIPTION
 *  This function is to set UART config to mobile
 * PARAMETERS
 *  l4c_dual_sim_uart_setting_enum   UART config        
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetUARTConfig(l4c_dual_sim_uart_setting_enum uart_config)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	U8 buffer[NVRAM_EF_SYS_CACHE_OCTET_SIZE];
	S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadRecord(NVRAM_EF_SYS_CACHE_OCTET_LID, NVRAM_SYS_FLIGHTMODE_STATE, (void*)buffer, 
        NVRAM_EF_SYS_CACHE_OCTET_SIZE, &error);
    
    switch(uart_config)
    {
    case L4C_UART_TO_SIM1:
        {
            buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_UART_TO_SIM1;
            g_uart_status = MMI_PHNSET_UART_SIM1;
        }
        break;
        
    case L4C_UART_TO_SIM2:
        {
            buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_UART_TO_SIM2;
            g_uart_status = MMI_PHNSET_UART_SIM2;
        }

        break;
        
    case L4C_DUAL_SIM_UART_SETTING_NONE:
        {
            buffer[L4C_SETTING_DUAL_SIM_UART] = L4C_DUAL_SIM_UART_SETTING_NONE;
            g_uart_status = MMI_PHNSET_UART_SIM_NONE;
        }
        break;
        
    default:
        MMI_ASSERT(0);
        break;
    }
    
    WriteRecord(NVRAM_EF_SYS_CACHE_OCTET_LID, NVRAM_SYS_FLIGHTMODE_STATE, (void*)buffer, 
        NVRAM_EF_SYS_CACHE_OCTET_SIZE, &error);
    
	g_phnset_cntx_p->uart_status = g_uart_status;
    
    /* PhnSetUARTSetupReboot(); */
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetUARTConfig
 * DESCRIPTION
 *  This function is to get UART config
 * PARAMETERS
 *  void          
 * RETURNS
 *  void
 *****************************************************************************/
l4c_dual_sim_uart_setting_enum PhnsetGetUARTConfig(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch(g_phnset_cntx_p->uart_status)
    {
    case MMI_PHNSET_UART_SIM1:
        return L4C_UART_TO_SIM1;
        break;
        
    case MMI_PHNSET_UART_SIM2:
        return L4C_UART_TO_SIM2;
        break;
        
    case MMI_PHNSET_UART_SIM_NONE:
        return L4C_DUAL_SIM_UART_SETTING_NONE;
        break;
        
    default:
        MMI_ASSERT(0);
        return 0;
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnSetUARTSetupReboot
 * DESCRIPTION
 *  This function is to reboot mobile
 * PARAMETERS
 *  void          
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnSetUARTSetupReboot(void)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MYQUEUE Message;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	EntryPhnsetUARTSetupRebootProcessing();

	SetProtocolEventHandler(PhnSetUARTSetupRebootRsp, MSG_ID_MMI_NW_PWROFF_DETACH_RSP);
	
    /* Deattach network */
    Message.oslSrcId = MOD_MMI;
    Message.oslDestId = MOD_L4C;
    Message.oslMsgId = MSG_ID_MMI_NW_PWROFF_DETACH_REQ;
	
    Message.oslDataPtr = (oslParaType*) NULL;
    Message.oslPeerBuffPtr = NULL;
    OslMsgSendExtQueue(&Message);
}


/*****************************************************************************
 * FUNCTION
 *  PhnSetUARTSetupRebootRsp
 * DESCRIPTION
 *  This function is to reboot mobile response
 * PARAMETERS
 *  void          
 * RETURNS
 *  void
 *****************************************************************************/
static void PhnSetUARTSetupRebootRsp(void *msg)
{
	/*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
	memset(gAlmQueue, 0xff, sizeof(gAlmQueue));
	
    g_alm_frm_cntx.EnabledAlarms = 0;

	PRINT_INFORMATION_2(MMI_TRACE_G7_MISC, "[Phnset] PhnSetUARTSetupRebootRsp: Reboot\n");
    AlmATPowerReset(MMI_FALSE, 3); /* shutdown system and reboot in 3 seconds. */
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetUARTSetupRebootProcessing
 * DESCRIPTION
 *  This function is display reboot processing
 * PARAMETERS
 *  void          
 * RETURNS
 *  void
 *****************************************************************************/
static void EntryPhnsetUARTSetupRebootProcessing(void)
{
	ChangeLeftSoftkey(0, 0);
    ChangeRightSoftkey(0, 0);
	
    /* Call Exit Handler */
    EntryNewScreen(SCR_ID_PHNSET_UART_REBOOT_PROCESSING, NULL, EntryPhnsetUARTSetupRebootProcessing, NULL);
	
    ShowCategory66Screen(
        STR_ID_PHNSET_UART_SETUP_TITLE,
        0,
        0,
        0,
        0,
        0,
        (PU8) GetString(STR_ID_PHNSET_UART_SETUP_REBOOT_PROCESSING),
        IMG_GLOBAL_PROGRESS,
        NULL);
	
    /* clear all key handlers so as to restrict duplicate reqs */
    ClearInputEventHandler(MMI_DEVICE_ALL);
    ClearKeyHandler(KEY_END, KEY_EVENT_UP);
    ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);
    ClearKeyHandler(KEY_END, KEY_LONG_PRESS);
}


#endif	/* __GEMINI__ */

/*****************************************************************************
 * FUNCTION
 *  PhnsetSetLangByNvramValue
 * DESCRIPTION
 *  This function is to read language setting from nvram and set
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetSetLangByNvramValue(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U8 data = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);
    g_phnset_cntx_p->UsrLangIdx = data;

    if (data == 0xFF)
    {
    #ifdef __MMI_AUTO_LANG_EN__
        /* If read nvram before SIM LP comming, treat as unspecified language */
        /* PhonsetGetAugoLanIdx will return default language index */
        data = PhnsetGetAutoLangIdx();
    #else /* __MMI_AUTO_LANG_EN__ */ 
        data = 0;
        WriteValue(NVRAM_SETTING_LANG, &data, DS_BYTE, &error);
    #endif /* __MMI_AUTO_LANG_EN__ */ 
    }

    SetCurrentLanguage(data);   /* Func in ReadRes.c */
    return MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetReinitHomeCityIdx
 * DESCRIPTION
 *  This function is to rearrange home city global array and set home city highlight item
 *  Functionality:
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReinitHomeCityIdx(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
     /**
        * This Is Needed As Set Home City NVRAM Index Doesnt Change On Language Change
      * As The Global City Array Is Chnaged. 
      **/

     /**************************************************************/
    /*  Dont Chnage Order Of These Function Calls --Start-- Gurinder   ***** */
    PhnsetReadNvmHomeCityIdxNStoreCityName();
    PhnsetReinitHomeCity();
    /*  Dont Chnage Order Of These Function Calls --End-- Gurinder     ***** */
     /**************************************************************/
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetHomeCityPtr
 * DESCRIPTION
 *  This function is to set current homecity string ptr
 *  Functionality:
 * PARAMETERS
 *  str         [?]             
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetHomeCityPtr(U8 *str)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->CurHomeCityStrPtr = str;
}

#if (defined(__MMI_NITZ__) && !defined(__MMI_AUTOTIMEZONE_IN_DATEANDTIME__))
/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetNITZ
 * DESCRIPTION
 *  This function is highlight handler for Phonesetup-> Auto Update Date and Time
 *  Follow functions:tEntryAutoUpdateDtTime
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetNITZ(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* Set the LSK to Off when Auto Update is ON */
    if (g_phnset_cntx_p->curNITZStatus == 1)
    {
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }

    /* Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, IMG_GLOBAL_BACK);

    /* Change left soft key icon and label */
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

    /* Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetNITZ, KEY_EVENT_UP);

    /* Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetNITZ
 * DESCRIPTION
 *  This function is Left softkey handler for Phonesetup-> Auto Update Date and Time
 *  Functionality: Toggle status only
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetNITZ(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 index;
    S16 error;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    index = GetCurrHiliteID();

    /* Toggle Auto Update of Date And Time */
    if (g_phnset_cntx_p->curNITZStatus == 0)
    {
        g_phnset_cntx_p->curNITZStatus = 1;
    }
    else
    {
        g_phnset_cntx_p->curNITZStatus = 0;
    }

    /* Store the updated Value */
    //g_phnset_cntx_p->NITZDirtyFlag = TRUE;
    if (g_phnset_cntx_p->curNITZStatus)
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_OFF, 0);
    }
    else
    {
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
        Category52ChangeItemDescription(index, hintData[index]);
        ChangeLeftSoftkey(STR_GLOBAL_ON, 0);
    }
    
    WriteValue(NVRAM_SETTING_AUTOUPDATE_DT_TIME, &(g_phnset_cntx_p->curNITZStatus), DS_BYTE, &error);

    RedrawCategoryFunction();
    HighlightPhnsetNITZ();

}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetNITZ
 * DESCRIPTION
 *  This function is hint handling function
 *  for Phonesetup -> Auto Update of Date and Time
 *  Functionality:
 * PARAMETERS
 *  index       [IN]            
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetNITZ(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (PhnsetGetNITZFuncStatus())
    {
        g_phnset_cntx_p->curNITZStatus = 1; /* Robin 1115, initial globol variable */
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_ON));
    }
    else
    {
        g_phnset_cntx_p->curNITZStatus = 0; /* Robin 1115, initial globol variable */
        mmi_ucs2cpy((PS8) hintData[index], (PS8) GetString(STR_GLOBAL_OFF));
    }
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetNITZFuncStatus
 * DESCRIPTION
 *  This function is to get NITZ function on/off status
 *  Functionality: Only exist when (__MMI_NITZ__) and (!__MMI_AUTOTIMEZONE_IN_DATEANDTIME__)
 * PARAMETERS
 *  void
 *  a(?)        [IN/OUT]        
 *  b(?)        [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
MMI_BOOL PhnsetGetNITZFuncStatus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 data = 0;
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_SETTING_AUTOUPDATE_DT_TIME, &data, DS_BYTE, &error);

    if (data == 1)
    {
        return MMI_TRUE;
    }
    else if (data == 0xff)
    {
        data = RstGetNITZStatusDefault();
        WriteValue(NVRAM_SETTING_AUTOUPDATE_DT_TIME, &data, DS_BYTE, &error);
        return MMI_FALSE;
    }
    else
    {
        return MMI_FALSE;
    }
}
#endif /* (defined(__MMI_NITZ__) && !defined(__MMI_AUTOTIMEZONE_IN_DATEANDTIME__)) */ 

/*****************************************************************************
*
*  TV Out 
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_highlight_tvout
 * DESCRIPTION
 *  highlight tvout item
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_highlight_tvout(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_phnset_entry_tvout_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_tvout_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_tvout_screen
 * DESCRIPTION
 *  entry phone setup tv out screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_entry_tvout_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 item_list[32];
    U16 item_icons[32];
    U16 num_of_items;
    U8 *gui_buffer;
    U8 *popup_list[16];
    S32 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_SETTING_TVOUT, NULL, mmi_phnset_entry_tvout_screen, NULL);

    gui_buffer = GetCurrGuiBuffer(SCR_ID_SETTING_TVOUT);

    num_of_items = GetNumOfChild(MENU_ID_SETTING_TVOUT);
    GetSequenceStringIds(MENU_ID_SETTING_TVOUT, item_list);
    GetSequenceImageIds(MENU_ID_SETTING_TVOUT, item_icons);
    SetParentHandler(MENU_ID_SETTING_TVOUT);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    for (i = 0; i < num_of_items; i++)
    {
        item_icons[i] = (U16) (IMG_GLOBAL_L1 + i);
    }

    for (i = 0; i < num_of_items; i++)
    {
        popup_list[i] = NULL;
    }

    ConstructHintsList(MENU_ID_SETTING_TVOUT, popup_list);

    ShowCategory52Screen(
        STR_ID_SETTING_TVOUT,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_of_items,
        item_list,
        item_icons,
        (U8 **) popup_list,
        0,
        0,
        gui_buffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_highlight_tvout_setting
 * DESCRIPTION
 *  highlight tvout setting item
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_highlight_tvout_setting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_phnset_entry_tvout_setting_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_tvout_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_highlight_tvout_adjust
 * DESCRIPTION
 *  highlight tvout adjust item
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_highlight_tvout_adjust(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_phnset_entry_tvout_adjust_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_phnset_entry_tvout_adjust_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_set_adjust
 * DESCRIPTION
 *  set tv out style
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_set_adjust(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U16 y_gamma;
    U16 u;
    U16 v;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
    DeleteNHistory(1);

    g_phnset_cntx_p->tvout_y_gamma = g_phnset_cntx_p->tvout_tmp_y_gamma;
    g_phnset_cntx_p->tvout_u = g_phnset_cntx_p->tvout_tmp_u;
    g_phnset_cntx_p->tvout_v = g_phnset_cntx_p->tvout_tmp_v;

    /* write Y/U/V setting */
    y_gamma = g_phnset_cntx_p->tvout_y_gamma;
    u = g_phnset_cntx_p->tvout_u;
    v = g_phnset_cntx_p->tvout_v;

    WriteValue(NVRAM_SETTING_TVOUT_Y_GAMMA, &y_gamma, DS_SHORT, &error);
    WriteValue(NVRAM_SETTING_TVOUT_U, &u, DS_SHORT, &error);
    WriteValue(NVRAM_SETTING_TVOUT_V, &v, DS_SHORT, &error);

}
#endif /* __MMI_TVOUT__ */ 



/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_cancel_adjust
 * DESCRIPTION
 *  cancel tv out adjust
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_cancel_adjust(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* restore default */
    mdi_tvout_adjust_y_gamma((U16) g_phnset_cntx.tvout_y_gamma);
    mdi_tvout_adjust_u((U16) g_phnset_cntx.tvout_u);
    mdi_tvout_adjust_v((U16) g_phnset_cntx.tvout_v);

    GoBackHistory();
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_setting_set_value
 * DESCRIPTION
 *  set tv out format
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_setting_set_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->tvout_format = g_phnset_cntx_p->tvout_inline_format;
    g_phnset_cntx_p->tvout_aud_path = g_phnset_cntx_p->tvout_inline_aud_path;

    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE);
    DeleteNHistory(1);

    /* write back to NVRAM */
    WriteValue(NVRAM_SETTING_TVOUT_FORMAT, &g_phnset_cntx_p->tvout_format, DS_SHORT, &error);
    WriteValue(NVRAM_SETTING_TVOUT_AUD_PATH, &g_phnset_cntx_p->tvout_aud_path, DS_SHORT, &error);

    /* set format to driver */
    if (g_phnset_cntx_p->tvout_format == MMI_SETTING_TVOUT_FORMAT_NTSC)
    {
        mdi_tvout_set_format(MDI_TV_OUTPUT_FORMAT_NTSC);
    }
    else if (g_phnset_cntx_p->tvout_format == MMI_SETTING_TVOUT_FORMAT_PAL)
    {
        mdi_tvout_set_format(MDI_TV_OUTPUT_FORMAT_PAL);
    }
    else
    {
        MMI_ASSERT(0);
    }

    /* set audio path to driver */
    if (g_phnset_cntx_p->tvout_aud_path == MMI_SETTING_TVOUT_AUD_PATH_BOTH)
    {
        mdi_tvout_set_aud_path(MDI_TV_AUD_PATH_BOTH);
    }
    else if (g_phnset_cntx_p->tvout_aud_path == MMI_SETTING_TVOUT_AUD_PATH_TV)
    {
        mdi_tvout_set_aud_path(MDI_TV_AUD_PATH_TV);
    }
    else
    {
        MMI_ASSERT(0);
    }

}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_exit_tvout_setting_screen
 * DESCRIPTION
 *  exit phone setup tv out setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_exit_tvout_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;
    U16 input_buffer_size;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_SETTING_TVOUT_SETTING;
    h.entryFuncPtr = mmi_phnset_entry_tvout_setting_screen;
    GetCategoryHistory(h.guiBuffer);
    input_buffer_size = (U16) GetCategory57DataSize();
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, input_buffer_size);
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_setting_inline_highlight_hdlr
 * DESCRIPTION
 *  tvout settint inline hilight handler
 * PARAMETERS
 *  index       [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_setting_inline_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetCategory57LeftSoftkeyFunction(mmi_phnset_tvout_setting_set_value);
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_tvout_setting_screen
 * DESCRIPTION
 *  entry phone setup tv out setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_entry_tvout_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer;
    U8 *input_buffer;
    U16 input_buffer_size;
    S32 item_offset = 0;
    U16 list_of_icons[4];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_SETTING_TVOUT_SETTING, mmi_phnset_exit_tvout_setting_screen, NULL, NULL);

    gui_buffer = GetCurrGuiBuffer(SCR_ID_SETTING_TVOUT_SETTING);
    input_buffer = GetCurrNInputBuffer(SCR_ID_SETTING_TVOUT_SETTING, &input_buffer_size);

    /* start of Category 57 */
    InitializeCategory57Screen();

    /* Format */
    g_phnset_cntx_p->tvout_format_str_list[0] = GetString((U16) (STR_ID_SETTING_TVOUT_FORMAT_PAL));
    g_phnset_cntx_p->tvout_format_str_list[1] = GetString((U16) (STR_ID_SETTING_TVOUT_FORMAT_NTSC));
    g_phnset_cntx_p->tvout_inline_format = g_phnset_cntx_p->tvout_format;

    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString(STR_ID_SETTING_TVOUT_FORMAT));
    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemSelect(
        &wgui_inline_items[item_offset++],
        2,
        (PU8*) g_phnset_cntx_p->tvout_format_str_list,
        &g_phnset_cntx_p->tvout_inline_format);

    /* Audio Path */
    g_phnset_cntx_p->tvout_aud_path_str_list[0] = GetString((U16) (STR_ID_SETTING_TVOUT_AUD_PATH_BOTH));

    g_phnset_cntx_p->tvout_aud_path_str_list[1] = GetString((U16) (STR_ID_SETTING_TVOUT_AUD_PATH_TV));

    g_phnset_cntx_p->tvout_inline_aud_path = g_phnset_cntx_p->tvout_aud_path;

    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString(STR_ID_SETTING_TVOUT_AUD_PATH));
    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
    SetInlineItemSelect(
        &wgui_inline_items[item_offset++],
        2,
        (PU8*) g_phnset_cntx_p->tvout_aud_path_str_list,
        &g_phnset_cntx_p->tvout_inline_aud_path);

    if (input_buffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, item_offset, input_buffer);
    }

    list_of_icons[0] = IMG_GLOBAL_L1;
    list_of_icons[1] = 0;
    list_of_icons[2] = IMG_GLOBAL_L2;
    list_of_icons[3] = 0;

    RegisterHighlightHandler(mmi_phnset_tvout_setting_inline_highlight_hdlr);

    ShowCategory57Screen(
        STR_ID_SETTING_TVOUT_SETTING,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_offset,
        list_of_icons,
        wgui_inline_items,
        0,
        gui_buffer);

    /* LSK */
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetCategory57LeftSoftkeyFunction(mmi_phnset_tvout_setting_set_value);

    /* RSK */
    DisableCategory57ScreenDone();
    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);

}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_entry_tvout_adjust_screen
 * DESCRIPTION
 *  entry phone setup tv out adjust screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_entry_tvout_adjust_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *str_list[3];
    S32 l_limit[3], u_limit[3];
    S32 *curr_value[3];
    void (*cb_func[3]) (S32 value);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_SETTING_TVOUT_ADJUST, NULL, mmi_phnset_entry_tvout_adjust_screen, NULL);

    g_phnset_cntx_p->tvout_tmp_y_gamma = g_phnset_cntx_p->tvout_y_gamma;
    g_phnset_cntx_p->tvout_tmp_u = g_phnset_cntx_p->tvout_u;
    g_phnset_cntx_p->tvout_tmp_v = g_phnset_cntx_p->tvout_v;

    /* Y */
    str_list[0] = (U8*) get_string(STR_ID_SETTING_TVOUT_ADJUST_Y_GAMMA);
    l_limit[0] = MDI_TV_OUTPUT_GAMMA_1;
    u_limit[0] = MDI_TV_OUTPUT_GAMMA_5;
    curr_value[0] = (S32*) (&g_phnset_cntx_p->tvout_tmp_y_gamma);
    cb_func[0] = mmi_phnset_tvout_adjust_y_gamma_callback;

    /* U */
    str_list[1] = (U8*) get_string(STR_ID_SETTING_TVOUT_ADJUST_U);
    l_limit[1] = 0;
    u_limit[1] = 255;
    curr_value[1] = (S32*) (&g_phnset_cntx_p->tvout_tmp_u);
    cb_func[1] = mmi_phnset_tvout_adjust_u_callback;

    /* V */
    str_list[2] = (U8*) get_string(STR_ID_SETTING_TVOUT_ADJUST_V);
    l_limit[2] = 0;
    u_limit[2] = 255;
    curr_value[2] = (S32*) (&g_phnset_cntx_p->tvout_tmp_v);
    cb_func[2] = mmi_phnset_tvout_adjust_v_callback;

    ShowCategory88Screen(
        STR_ID_SETTING_TVOUT_ADJUST,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        0,
        3,
        str_list,
        l_limit,
        u_limit,
        curr_value,
        cb_func,
        NULL);

    SetRightSoftkeyFunction(mmi_phnset_tvout_cancel_adjust, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_phnset_tvout_set_adjust, KEY_EVENT_UP);

}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_adjust_y_gamma_callback
 * DESCRIPTION
 *  adjust y gamma callback
 * PARAMETERS
 *  value       [IN]        Adjusted value
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_adjust_y_gamma_callback(S32 value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mdi_tvout_adjust_y_gamma((U16) value);

    g_phnset_cntx_p->tvout_tmp_y_gamma = value;
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_adjust_u_callback
 * DESCRIPTION
 *  adjust u callback
 * PARAMETERS
 *  value       [IN]        Adjusted value
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_adjust_u_callback(S32 value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mdi_tvout_adjust_u((U16) value);

    g_phnset_cntx_p->tvout_tmp_u = value;
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_adjust_v_callback
 * DESCRIPTION
 *  adjust u callback
 * PARAMETERS
 *  value       [IN]        Adjusted value
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_adjust_v_callback(S32 value)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mdi_tvout_adjust_v((U16) value);

    g_phnset_cntx_p->tvout_tmp_v = value;
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_init_setting
 * DESCRIPTION
 *  init tvout
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_init_setting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;
    U16 y_gamma;
    U16 u;
    U16 v;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->is_tvout_init)
    {
        /* if already init, return */
        return;
    }
    
    /* load format setting */
    ReadValue(NVRAM_SETTING_TVOUT_FORMAT, &g_phnset_cntx_p->tvout_format, DS_SHORT, &error);

    /* not init */
    if (g_phnset_cntx_p->tvout_format == 0xffff)
    {
        g_phnset_cntx_p->tvout_format = MMI_SETTING_TVOUT_FORMAT_NTSC;
        WriteValue(NVRAM_SETTING_TVOUT_FORMAT, &g_phnset_cntx_p->tvout_format, DS_SHORT, &error);
    }

    /* set to mdi tvout */
    if (g_phnset_cntx_p->tvout_format == MMI_SETTING_TVOUT_FORMAT_NTSC)
    {
        mdi_tvout_set_format(MDI_TV_OUTPUT_FORMAT_NTSC);
    }
    else if (g_phnset_cntx_p->tvout_format == MMI_SETTING_TVOUT_FORMAT_PAL)
    {
        mdi_tvout_set_format(MDI_TV_OUTPUT_FORMAT_PAL);
    }
    else
    {
        MMI_ASSERT(0);
    }

    /* audio path */
    ReadValue(NVRAM_SETTING_TVOUT_AUD_PATH, &g_phnset_cntx_p->tvout_aud_path, DS_SHORT, &error);

    /* not init */
    if (g_phnset_cntx_p->tvout_aud_path == 0xffff)
    {
        g_phnset_cntx_p->tvout_aud_path = MMI_SETTING_TVOUT_AUD_PATH_TV;
        WriteValue(NVRAM_SETTING_TVOUT_AUD_PATH, &g_phnset_cntx_p->tvout_aud_path, DS_SHORT, &error);
    }

    if (g_phnset_cntx_p->tvout_aud_path == MMI_SETTING_TVOUT_AUD_PATH_BOTH)
    {
        mdi_tvout_set_aud_path(MDI_TV_AUD_PATH_BOTH);
    }
    else if (g_phnset_cntx_p->tvout_aud_path == MMI_SETTING_TVOUT_AUD_PATH_TV)
    {
        mdi_tvout_set_aud_path(MDI_TV_AUD_PATH_TV);
    }
    else
    {
        MMI_ASSERT(0);
    }

    /* load Y/U/V setting */
    ReadValue(NVRAM_SETTING_TVOUT_Y_GAMMA, &y_gamma, DS_SHORT, &error);
    ReadValue(NVRAM_SETTING_TVOUT_U, &u, DS_SHORT, &error);
    ReadValue(NVRAM_SETTING_TVOUT_V, &v, DS_SHORT, &error);

    /* not init */
    if (y_gamma == 0xffff)
    {
        g_phnset_cntx_p->tvout_y_gamma = MDI_TV_OUTPUT_GAMMA_3;

        /* recommanded value from driver */
        g_phnset_cntx_p->tvout_u = 0x77;    /* range 0-255 */
        g_phnset_cntx_p->tvout_v = 0x90;    /* range 0-255 */
    }
    else
    {
        g_phnset_cntx_p->tvout_y_gamma = y_gamma;
        g_phnset_cntx_p->tvout_u = u;   /* range 0-255 */
        g_phnset_cntx_p->tvout_v = v;   /* range 0-255 */
    }

    g_phnset_cntx_p->is_tvout_connected = FALSE;
    g_phnset_cntx_p->is_tvout_enable_sleep_in = TRUE;   /* default allow tv out to sleep in */
    g_phnset_cntx_p->is_tvout_sleep_in = FALSE;

    /* init done */
    g_phnset_cntx_p->is_tvout_init = TRUE;  
   
}
#endif /* __MMI_TVOUT__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_event_hdlr_before_pwron
 * DESCRIPTION
 *  event handler before pwron
 * PARAMETERS
 *  result  [IN]  connect result 
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
static void mmi_phnset_tvout_event_hdlr_before_pwron(MDI_RESULT result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
  

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* init setting values */
    mmi_phnset_tvout_init_setting();

    if (result == MDI_RES_TV_ENABLE)
    {
        g_phnset_cntx_p->is_tvout_connected = TRUE;
    }
    else if (result == MDI_RES_TV_DISABLE)
    {
        g_phnset_cntx_p->is_tvout_connected = FALSE;      
    }
    else
    {
        MMI_ASSERT(0);      
    }
   
}
#endif /* __MMI_TVOUT__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_early_init_tvout_before_pwron
 * DESCRIPTION
 *  init tvout before poweron indication
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_early_init_tvout_before_pwron()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
  
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mdi_tvout_early_init_before_pwoeron(mmi_phnset_tvout_event_hdlr_before_pwron);
}
#endif /* __MMI_TVOUT__ */





/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_init_tvout
 * DESCRIPTION
 *  init tvout
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_init_tvout(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* always need to init mdi to register callback/message handler */
    mdi_tvout_init(mmi_phnset_tvout_event_hdlr);
    mmi_phnset_tvout_init_setting();
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_event_hdlr
 * DESCRIPTION
 *  init tvout
 * PARAMETERS
 *  result      [IN]        Event result
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_event_hdlr(MDI_RESULT result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MDI_RESULT ret;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (result == MDI_RES_TV_ENABLE)
    {
        if (mmi_bootup_is_in_power_on_period() == MMI_FALSE)
        {
            DisplayPopup(
                (PU8) GetString(STR_ID_SETTING_TVOUT_PLUG_IN),
                IMG_ID_POPUP_TVOUT,
                1,
                ST_NOTIFYDURATION,
                AUX_TONE);
        }

        /* set adjustment */
        mdi_tvout_adjust_y_gamma((U16) g_phnset_cntx.tvout_y_gamma);
        mdi_tvout_adjust_u((U16) g_phnset_cntx.tvout_u);
        mdi_tvout_adjust_v((U16) g_phnset_cntx.tvout_v);

        /* start mode1 */
        mdi_tvout_set_mode(
            MDI_TV_MODE_LCD_SCR,
            0,  /* layer_width */
            0); /* layer_height */

        ret = mdi_tvout_start();

        if (ret < 0)
        {
            if (mmi_bootup_is_in_power_on_period() == MMI_FALSE)
            {
                DisplayPopup(
                    (PU8) GetString(STR_ID_SETTING_TVOUT_NOT_READY),
                    IMG_GLOBAL_ERROR,
                    1,
                    ST_NOTIFYDURATION,
                    WARNING_TONE);
            }

            return;
        }
        else
        {
            /* if in poweron period and playing video, need stop and start again */
            if (mmi_bootup_is_playing_power_on_animation())
            {
            #if defined(__MMI_VIDEO_PLAYER__)
                mmi_pwron_pause_video();
                mmi_pwron_resume_video();
            #endif /* defined(__MMI_VIDEO_PLAYER__) */
            }
        }

        g_phnset_cntx_p->is_tvout_connected = TRUE;

    }
    else if (result == MDI_RES_TV_DISABLE)
    {
        if (mmi_bootup_is_in_power_on_period() == MMI_FALSE)
        {
            DisplayPopup(
                (PU8) GetString(STR_ID_SETTING_TVOUT_PLUG_OUT),
                IMG_ID_POPUP_TVOUT,
                1,
                ST_NOTIFYDURATION,
                AUX_TONE);
        }

        /* if in poweron period and playing video, need stop and start again */
        if (mmi_bootup_is_playing_power_on_animation())
        {
        #if defined(__MMI_VIDEO_PLAYER__)            
            mmi_pwron_pause_video();
        #endif /* defined(__MMI_VIDEO_PLAYER__) */            
        }

        mdi_tvout_stop();

        /* if in poweron period and playing video, need stop and start again */
        if (mmi_bootup_is_playing_power_on_animation())
        {
        #if defined(__MMI_VIDEO_PLAYER__)                        
            mmi_pwron_resume_video();
        #endif /* defined(__MMI_VIDEO_PLAYER__) */                        
        }

        g_phnset_cntx_p->is_tvout_connected = FALSE;
    }
    else
    {
        MMI_ASSERT(0);
    }
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_check_pwron_start
 * DESCRIPTION
 *  check need start tvout when power on
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_check_pwron_start(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    if (g_phnset_cntx_p->is_tvout_connected && FALSE == mdi_tvout_is_enable())
    {  
        /* is connected */
        mmi_phnset_tvout_event_hdlr(MDI_RES_TV_ENABLE);   
    }
}
#endif /* __MMI_TVOUT__ */ 



/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_lcd_sleepin_handler
 * DESCRIPTION
 *  lcd sleep in handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_lcd_sleepin_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->is_tvout_connected && g_phnset_cntx_p->is_tvout_enable_sleep_in)
    {
        g_phnset_cntx_p->is_tvout_sleep_in = TRUE;
        mdi_tvout_sleep_in();
    }
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_lcd_sleepout_handler
 * DESCRIPTION
 *  lcd sleep out handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_lcd_sleepout_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_phnset_cntx_p->is_tvout_connected && g_phnset_cntx_p->is_tvout_sleep_in)
    {
        g_phnset_cntx_p->is_tvout_sleep_in = FALSE;
        mdi_tvout_sleep_out();
    }
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_enable_tv_sleep_in
 * DESCRIPTION
 *  allow tv to sleep in
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_enable_tv_sleep_in(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->is_tvout_enable_sleep_in = TRUE;
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_phnset_tvout_disable_tv_sleep_in
 * DESCRIPTION
 *  do not allow tv to sleep in
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_TVOUT__
void mmi_phnset_tvout_disable_tv_sleep_in(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->is_tvout_enable_sleep_in = FALSE;
}
#endif /* __MMI_TVOUT__ */ 


/*****************************************************************************
 * FUNCTION
 *  PhnsetGetFontSize
 * DESCRIPTION
 *  ...
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U8 PhnsetGetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_phnset_cntx_p->font_size;
}


/*****************************************************************************
 * FUNCTION
 *  PhnsetReadFontSize
 * DESCRIPTION
 *  ...
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetReadFontSize(void)   /* __USB_IN_NORMAL_MODE__ */
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ReadValue(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE, &error);
    if (g_phnset_cntx_p->font_size > LARGE)
    {
        g_phnset_cntx_p->font_size = THEME_DEFAULT;
    }

}

#ifdef __MMI_CHANGABLE_FONT__


/*****************************************************************************
 * FUNCTION
 *  PhnsetSetFontSize
 * DESCRIPTION
 *  Setting Font Size Enum
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void PhnsetSetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S16 error = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_phnset_cntx_p->font_size = (U16) GetCurrHiliteID();

    WriteValue(NVRAM_BYTE_FONT_SIZE, &(g_phnset_cntx_p->font_size), DS_BYTE, &error);
    change_font_Theme();

    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, UI_POPUP_NOTIFYDURATION_TIME, SUCCESS_TONE);
    DeleteScreenIfPresent(SCR_ID_PHNSET_FONT_SIZE);
}


/*****************************************************************************
 * FUNCTION
 *  EntryPhnsetFontSize
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryPhnsetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

#ifndef __MMI_DIALLING_FONT__
    U8 nNumofItem = 4;
    U16 nStrItemList[4] = 
    {
        STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT, STR_ID_PHNSET_FONT_SIZE_SMALL, STR_ID_PHNSET_FONT_SIZE_MEDIUM,
        STR_ID_PHNSET_FONT_SIZE_LARGE
    };
#else /* __MMI_DIALLING_FONT__ */ 
    U8 nNumofItem = 3;
    U16 nStrItemList[3] = 
    {
        STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT, STR_ID_PHNSET_FONT_SIZE_SMALL, STR_ID_PHNSET_FONT_SIZE_MEDIUM
    };
#endif /* __MMI_DIALLING_FONT__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_PHNSET_FONT_SIZE, NULL, EntryPhnsetFontSize, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_PHNSET_FONT_SIZE);
    SetParentHandler(MENU_ID_PHNSET_FONT_SIZE);
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory11Screen(
        STR_ID_PHNSET_FONT_SIZE,
        MAIN_MENU_TITLE_SETTINGS_ICON,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nNumofItem,
        nStrItemList,
        g_phnset_cntx_p->font_size,
        guiBuffer);

    SetLeftSoftkeyFunction(PhnsetSetFontSize, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(0, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    return;
}


/*****************************************************************************
 * FUNCTION
 *  HintPhnsetFontSize
 * DESCRIPTION
 *  Hint handlers for Font Size
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void HintPhnsetFontSize(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((S8*) hintData[(index)], 0, MAX_SUB_MENU_SIZE);

    switch (g_phnset_cntx_p->font_size)
    {
        case THEME_DEFAULT:
            mmi_ucs2ncpy(
                (PS8) hintData[(index)],
                GetString(STR_ID_PHNSET_FONT_SIZE_THEME_DEFAULT),
                MAX_SUBMENU_CHARACTERS);
            break;
        case SMALL:
            mmi_ucs2ncpy(
                (PS8) hintData[(index)],
                GetString(STR_ID_PHNSET_FONT_SIZE_SMALL),
                MAX_SUBMENU_CHARACTERS);
            break;
        case MEDIUM:
            mmi_ucs2ncpy(
                (PS8) hintData[(index)],
                GetString(STR_ID_PHNSET_FONT_SIZE_MEDIUM),
                MAX_SUBMENU_CHARACTERS);
            break;
        case LARGE:
            mmi_ucs2ncpy(
                (PS8) hintData[(index)],
                GetString(STR_ID_PHNSET_FONT_SIZE_LARGE),
                MAX_SUBMENU_CHARACTERS);
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  HighlightPhnsetFontSize
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HighlightPhnsetFontSize(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* 1 Change left soft key icon and label */
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);

    /* 2 Change right soft key icon and label */
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);

    /* 3 Register function for left soft key */
    SetLeftSoftkeyFunction(EntryPhnsetFontSize, KEY_EVENT_UP);

    /* 4 Register function for right soft key */
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    SetKeyHandler(EntryPhnsetFontSize, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}

#endif /* __MMI_CHANGABLE_FONT__ */ 

