/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * wgui_ems_categories.c
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for UI wrapper routines for EMS .
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
 /**
 * Copyright Notice
 * (c) 2002 - 2003, Pixtel Communications, Inc., 1489 43rd Ave. W.,
 * Vancouver, B.C. V6M 4K8 Canada. All Rights Reserved.
 *  (It is illegal to remove this copyright notice from this software or any
 *  portion of it)
 */

/**********************************************************************************
   Filename:      wgui_ems_categories.c
   Author:        manju
   Date Created:  March-22-2003
   Contains:      UI wrapper routines for EMS and category screens
**********************************************************************************/




#include "MMIDataType.h"
#include "MMI_features.h"

#include "TimerEvents.h"
#include "L4Dr.h"
#include "conversions.h"

#include "CustDataProts.h"
#include "HistoryGprot.h"
#include "CustMenuRes.h"
#include "DebugInitDef.h"
#include "GlobalDefs.h"
#include "SettingProfile.h"
#include "wgui.h"
#include "wgui_categories.h"
#include "wgui_categories_inputs.h"
#include "wgui_categories_defs.h"
#include "wgui_softkeys.h"
#include "gdi_include.h"
#include "wgui_ems.h"
#include "MessagesResourceData.h"
#include "CommonScreens.h"
#if defined(__MMI_FILE_MANAGER__)
#include "FileMgr.h"
#include "FileManagerDef.h"
#include "FileManagerGProt.h"
#endif /* defined(__MMI_FILE_MANAGER__) */ 
#include "wgui_draw_manager.h"


/*PMT IRE START*/
#ifdef __MMI_INDIC_ALG__
#include "IndicEngineGprot.h"
/*PMT IRE END*/
#endif 
#include "wgui_virtual_keyboard.h"
#if defined(__MMI_TOUCH_SCREEN__) || defined(__MMI_HANDWRITING_PAD__)
#include "EditorPenGprot.h"
#endif 

/* MTK Elvis for R2L characters */
extern BOOL r2lMMIFlag;

/* MTK end */
extern S32 MMI_timer_multitap;



extern void handle_category28_change_input_mode(void);
extern void wgui_set_EMS_inputbox_RSK(void);
extern void wgui_EMS_redraw_input_information_bar(void);
extern void gui_EMS_change_DCS(UI_EMS_input_box *b);
extern void wgui_show_input_mode_internal(
                    S32 info_bar_x,
                    S32 info_bar_y,
                    S32 info_bar_width,
                    S32 info_bar_height,
                    U8 input_mode, 
                    PU8 inputbox_information_icon);

#ifdef __MMI_MESSAGES_EMS__
extern void EMS_cancel_object_focus(void);
#endif 
/* MTK end */

/* MTK Elvis */
extern void StopTimer(U16 timerid);
/* MTK end */

/* W05.36 Fix Vietnamese Tone Input Issue */
extern void set_current_input_box_type(mmi_editor_inoutbox_enum input_box_type);

#if defined(__MMI_PREFER_INPUT_METHOD__) || defined(__MMI_PREFER_WRITING_LANG__)  || defined(__MMI_MIXED_LANG_SUPPORT__)
extern S16 MMI_prefered_input_type;
#endif /* defined(__MMI_PREFER_INPUT_METHOD__) || defined(__MMI_PREFER_WRITING_LANG__)  || defined(__MMI_MIXED_LANG_SUPPORT__) */

extern void dm_set_scr_bg_image_no_draw(U16 image_id, S8 *file_name, S32 x, S32 y, U8 opacity);        /* 092005 grayscale Calvin */

extern U8 PhnsetGetDefEncodingType(void);

/* MTK Terry for RSK Display */
void handle_category28_input(void);

#if(!UI_DISABLE_EMS_CATEGORY_SCREENS)

/* Temporary: Will be removed later */
UI_string_type temp_EMS_buffer;
EMSData *temp_EMS_data;

/* EMS input box: Low level wrappers   */

void (*EMS_inputbox_input_callback) (void);


/*****************************************************************************
 * FUNCTION
 *  register_EMS_inputbox_input_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  f       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void register_EMS_inputbox_input_callback(void (*f) (void))
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMS_inputbox_input_callback = f;
}

#if(!UI_DISABLE_EMS_INPUT_BOX)

/* 072904 Calvin moved for centralized control */
// #define ENABLE_EMS_INPUTBOX_FRAME_SKIPPING                   1
/* Calvin end */

U8 EMS_inputbox_has_changed = 0;
UI_EMS_input_box MMI_EMS_inputbox;
EMSTextFormat wgui_EMS_text_format;

extern void wgui_EMS_redraw_remaining_characters_display(void);

#if((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING))
S32 wgui_EMS_inputbox_frame_counter = 0;
#endif 


/*****************************************************************************
 * FUNCTION
 *  show_EMS_inputbox
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void show_EMS_inputbox(void)
{
#if(0)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
	PRINT_INFORMATION("\n\n");
	if(MMI_EMS_inputbox.data->CurrentPosition.Object!=NULL)
	{
		if(MMI_EMS_inputbox.data->CurrentPosition.Object->Type==EMS_TYPE_TEXT_FORMAT)
		{	PRINT_INFORMATION("O: *");
		}
		else
		{	PRINT_INFORMATION("O: %d",MMI_EMS_inputbox.data->CurrentPosition.Object->data.picture.pdu[0]);
		}
	}
	PRINT_INFORMATION(" TL: %d, TO: %d, T: %c",MMI_EMS_inputbox.data->textLength,MMI_EMS_inputbox.data->CurrentPosition.OffsetToText,MMI_EMS_inputbox.data->textBuffer[MMI_EMS_inputbox.data->CurrentPosition.OffsetToText+1]);
#endif /* (0) */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_set_EMS_input_box_current_theme(&MMI_EMS_inputbox);

    gui_show_EMS_input_box(&MMI_EMS_inputbox);
#if(UI_DOUBLE_BUFFER_SUPPORT)
    gui_BLT_double_buffer(
        MMI_EMS_inputbox.x,
        MMI_EMS_inputbox.y,
        MMI_EMS_inputbox.x + MMI_EMS_inputbox.width - 1,
        MMI_EMS_inputbox.y + MMI_EMS_inputbox.height - 1);
#endif /* (UI_DOUBLE_BUFFER_SUPPORT) */ 
}

#if((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING))


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_inputbox_end_frame
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_inputbox_end_frame(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (wgui_EMS_inputbox_frame_counter >= 1)
    {
        S32 BLT_y2, y2;

    #if(UI_DOUBLE_BUFFER_SUPPORT)
        gui_lock_double_buffer();
    #endif 
        gui_show_EMS_input_box(&MMI_EMS_inputbox);
        if (EMS_inputbox_has_changed)
        {
            wgui_EMS_redraw_remaining_characters_display();
            EMS_inputbox_has_changed = 0;
        }
    #if(UI_DOUBLE_BUFFER_SUPPORT)
        gui_unlock_double_buffer();
        BLT_y2 = MMI_EMS_inputbox.y + MMI_EMS_inputbox.height;
        y2 = MMI_multitap_y + MMI_multitap_height + 1;
        if (BLT_y2 < y2)
        {
            BLT_y2 = y2;
        }
        gui_BLT_double_buffer(
            MMI_EMS_inputbox.x,
            MMI_EMS_inputbox.y,
            MMI_EMS_inputbox.x + MMI_EMS_inputbox.width - 1,
            BLT_y2);
    #endif /* (UI_DOUBLE_BUFFER_SUPPORT) */ 
        wgui_EMS_inputbox_frame_counter = 0;
        gui_start_timer(UI_FRAME_SKIP_TIMEOUT, wgui_EMS_inputbox_end_frame);
    }
}

#endif /* ((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING)) */ 

#if(EMS_INPUTBOX_DEBUG)

#define _DEBUG_PRINT(x) _debug_print x

extern void DisplayToDebugwindow(S8 *nPrintableStr);


/*****************************************************************************
 * FUNCTION
 *  _debug_print
 * DESCRIPTION
 *  
 * PARAMETERS
 *  fmt     [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void _debug_print(S8 *fmt, ...)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 display_string[2048];
    va_list args;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    va_start(args, fmt);
    vsprintf(display_string, fmt, args);
    va_end(args);
    DisplayToDebugwindow(display_string);
}


/*****************************************************************************
 * FUNCTION
 *  _DUMP_EMS_TEXT_FORMAT_OBJECT
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x       [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void _DUMP_EMS_TEXT_FORMAT_OBJECT(EMSTextFormat *x)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (x != NULL)
    {
        _DEBUG_PRINT(("L=%03d ", x->textLength));
        _DEBUG_PRINT(("AL="));
        switch (x->Alignment)
        {
            case EMS_ALIGN_LEFT:
                _DEBUG_PRINT(("L"));
                break;
            case EMS_ALIGN_RIGHT:
                _DEBUG_PRINT(("R"));
                break;
            case EMS_ALIGN_CENTER:
                _DEBUG_PRINT(("C"));
                break;
            case EMS_ALIGN_LANG_DEP:
                _DEBUG_PRINT(("D"));
                break;
        }
        _DEBUG_PRINT((" SZ="));
        switch (x->FontSize)
        {
            case EMS_FONTSIZE_NORMAL:
                _DEBUG_PRINT(("N"));
                break;
            case EMS_FONTSIZE_LARGE:
                _DEBUG_PRINT(("L"));
                break;
            case EMS_FONTSIZE_SMALL:
                _DEBUG_PRINT(("S"));
                break;
        }
        _DEBUG_PRINT((" ST="));
        if (x->isBold)
        {
            _DEBUG_PRINT(("B"));
        }
        if (x->isItalic)
        {
            _DEBUG_PRINT(("I"));
        }
        if (x->isUnderline)
        {
            _DEBUG_PRINT(("U"));
        }
        if (x->isStrikethrough)
        {
            _DEBUG_PRINT(("S"));
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  _DUMP_EMS_OBJECT
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x       [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void _DUMP_EMS_OBJECT(EMSObject *x)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (x == NULL)
    {
        _DEBUG_PRINT(("NULL"));
    }
    else
    {
        _DEBUG_PRINT(("%8X OFF=%03d ", x, x->OffsetToText));
        switch (x->Type)
        {
            case EMS_TYPE_TEXT_FORMAT:
                _DEBUG_PRINT(("TXT FMT "));
                _DUMP_EMS_TEXT_FORMAT_OBJECT(&x->data->text_format);
                break;
            case EMS_TYPE_PREDEF_SND:
                _DEBUG_PRINT(("PRE SND %d", x->PredefNo));
                break;
            case EMS_TYPE_USERDEF_SND:
                _DEBUG_PRINT(("USR SND"));
                break;
            case EMS_TYPE_PREDEF_ANM:
                _DEBUG_PRINT(("PRE ANM %d", x->PredefNo));
                break;
            case EMS_TYPE_USERDEF_ANM:
                _DEBUG_PRINT(("USR ANM"));
                break;
            case EMS_TYPE_PIC:
                _DEBUG_PRINT(("EMS PIC"));
                break;
        }
    }
}

#else /* (EMS_INPUTBOX_DEBUG) */ 

#define _DEBUG_PRINT(x)


/*****************************************************************************
 * FUNCTION
 *  _DUMP_EMS_OBJECT
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x       [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void _DUMP_EMS_OBJECT(EMSObject *x)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(x);
}

#endif /* (EMS_INPUTBOX_DEBUG) */ 

extern U16 GetExitScrnID(void);

#include "IdleAppDef.h"


/*****************************************************************************
 * FUNCTION
 *  redraw_EMS_inputbox
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void redraw_EMS_inputbox(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((SCR_POPUP_SCREEN != GetExitScrnID()) && (POPUP_SCREENID != GetExitScrnID()))
    {

    #if(EMS_INPUTBOX_DEBUG)
        S32 i = 0;
        UI_character_type c = '-';
        EMSObject *object = MMI_EMS_inputbox.data->listHead;
        EMSPosition mapped_position;

        EMS_map_position(MMI_EMS_inputbox.data, &MMI_EMS_inputbox.data->CurrentPosition, &mapped_position);
        if ((MMI_EMS_inputbox.data->textBuffer != NULL) && (MMI_EMS_inputbox.data->textLength > 0) &&
            (MMI_EMS_inputbox.data->CurrentPosition.OffsetToText < MMI_EMS_inputbox.data->textLength))
        {
            c = MMI_EMS_inputbox.data->textBuffer[MMI_EMS_inputbox.data->CurrentPosition.OffsetToText];
        }
        if ((c == 0x0A) || (c == 0x0D))
        {
            c = '.';
        }
        _DEBUG_PRINT(("\n\nCurrent position: %c OFF=%03d, Object=", c,
                      MMI_EMS_inputbox.data->CurrentPosition.OffsetToText));
        _DUMP_EMS_OBJECT(MMI_EMS_inputbox.data->CurrentPosition.Object);
        _DEBUG_PRINT(("\nMapped position:  %c OFF=%03d, Object=", c, mapped_position.OffsetToText,
                      mapped_position.Object));
        _DUMP_EMS_OBJECT(mapped_position.Object);
        _DEBUG_PRINT(("\nInputbox text format: "));
        _DUMP_EMS_TEXT_FORMAT_OBJECT(&MMI_EMS_inputbox.text_format);
        _DEBUG_PRINT(("\nWGUI text format:     "));
        _DUMP_EMS_TEXT_FORMAT_OBJECT(&wgui_EMS_text_format);
        _DEBUG_PRINT(("\nCurrent text format:  "));
        _DUMP_EMS_OBJECT(MMI_EMS_inputbox.data->CurrentTextFormatObj);
        while (object != NULL)
        {
            _DEBUG_PRINT(("\nO%d=", i));
            _DUMP_EMS_OBJECT(object);
            object = object->next;
            i++;
        }
        for (i = 0; i < MMI_EMS_inputbox.n_lines; i++)
        {
            _DEBUG_PRINT(("\nL%d OFF=%03d, Count=%02d, x=%02d, Object=", i,
                          MMI_EMS_inputbox.line_positions[i].OffsetToText, MMI_EMS_inputbox.line_object_counts[i],
                          MMI_EMS_inputbox.line_x_positions[i]));
            _DUMP_EMS_OBJECT(MMI_EMS_inputbox.line_positions[i].Object);
        }
        _DEBUG_PRINT(("\n"));
    #endif /* (EMS_INPUTBOX_DEBUG) */ 
    #if(0)
	PRINT_INFORMATION("\n\n");
	if(MMI_EMS_inputbox.data->CurrentPosition.Object!=NULL)
	{
		if(MMI_EMS_inputbox.data->CurrentPosition.Object->Type==EMS_TYPE_TEXT_FORMAT)
		{	PRINT_INFORMATION("O: *");
		}
		else
		{	PRINT_INFORMATION("O: %d",MMI_EMS_inputbox.data->CurrentPosition.Object->data.picture.pdu[0]);
		}
	}
	PRINT_INFORMATION(" TL: %d, TO: %d, T: %c",MMI_EMS_inputbox.data->textLength,MMI_EMS_inputbox.data->CurrentPosition.OffsetToText,MMI_EMS_inputbox.data->textBuffer[MMI_EMS_inputbox.data->CurrentPosition.OffsetToText+1]);
    #endif /* (0) */ 

    #if((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING))
        if (wgui_EMS_inputbox_frame_counter > 0)
        {
            wgui_EMS_inputbox_frame_counter++;
        }
        else
        {
            wgui_EMS_inputbox_frame_counter = 1;
            gui_start_timer(UI_FRAME_START_TIMEOUT, wgui_EMS_inputbox_end_frame);
        }
    #else /* ((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING)) */ 

        gui_show_EMS_input_box(&MMI_EMS_inputbox);
        /* MTK Terry fix EMS remaining characters display unsync bug firefly#278 */
        if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
        {
            wgui_EMS_redraw_remaining_characters_display();
            /* EMS_inputbox_has_changed=0; */
        }
    #if(UI_DOUBLE_BUFFER_SUPPORT)
        gui_BLT_double_buffer(
            MMI_EMS_inputbox.x,
            MMI_EMS_inputbox.y,
            MMI_EMS_inputbox.x + MMI_EMS_inputbox.width - 1,
            MMI_EMS_inputbox.y + MMI_EMS_inputbox.height - 1);
    #endif /* (UI_DOUBLE_BUFFER_SUPPORT) */ 

    #endif /* ((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING)) */ 
    }
}


/*****************************************************************************
 * FUNCTION
 *  show_EMS_inputbox_no_draw
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void show_EMS_inputbox_no_draw(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_EMS_inputbox.flags |= (UI_EMS_INPUT_BOX_DISABLE_DRAW);
    gui_show_EMS_input_box(&MMI_EMS_inputbox);
    MMI_EMS_inputbox.flags &= ~(UI_EMS_INPUT_BOX_DISABLE_DRAW);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_previous
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_previous(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* W05.34 Fix Multitap in arrow keys */
    if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
    {
        disable_active_multitap();
    }
    gui_EMS_input_box_previous(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_next
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_next(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* W05.34 Fix Multitap in arrow keys */
    if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
    {
        disable_active_multitap();
    }
    gui_EMS_input_box_next(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}

#ifdef __MMI_MESSAGES_EMS__


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_previous_object
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_previous_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_view_previous_object(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_next_object
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_next_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_view_next_object(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}
#endif /* __MMI_MESSAGES_EMS__ */ 


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_previous_line
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_previous_line(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* W05.34 Fix Multitap in arrow keys */
    if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
    {
        disable_active_multitap();
    }
    gui_EMS_input_box_previous_line(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_next_line
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_next_line(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* W05.34 Fix Multitap in arrow keys */
    if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
    {
        disable_active_multitap();
    }
    gui_EMS_input_box_next_line(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
}

UI_character_type EMS_GSM_extended_lookup[] = { '[', ']', '{', '}', '~', '\\', '^', '|', 0xA2,  /* Euro character is mapped to 0xA2 */
};


/*****************************************************************************
 * FUNCTION
 *  EMS_GSM_extended_map
 * DESCRIPTION
 *  
 * PARAMETERS
 *  c       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U8 EMS_GSM_extended_map(UI_character_type c)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i, n;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (c & 0xff00)
    {
        return (0);
    }
    n = sizeof(EMS_GSM_extended_lookup) / sizeof(UI_character_type);
    for (i = 0; i < n; i++)
    {
        if (c == EMS_GSM_extended_lookup[i])
        {
            return (1);
        }
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_direct_input
 * DESCRIPTION
 *  
 * PARAMETERS
 *  c       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_direct_input(UI_character_type c)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (UI_TEST_LF_CHARACTER(c))
    {
        gui_EMS_input_box_insert_new_line(&MMI_EMS_inputbox);
    }
    else
    {
    #if(!EMS_USE_GSM_EXTENDED)
        if (MMI_EMS_inputbox.UCS2_count == 0)
        {
            if (EMS_GSM_extended_map(c))
            {
                if (EMS_get_remaining_length(MMI_EMS_inputbox.data) < 2)
				{
					UI_editor_play_tone_cannot_insert();
					return; // Can't insert the GSM extended character due to the space is not enough
				}
                gui_EMS_input_box_insert_character(&MMI_EMS_inputbox, 0x1b);
            }
        }
    #endif /* (!EMS_USE_GSM_EXTENDED) */ 
        gui_EMS_input_box_insert_character(&MMI_EMS_inputbox, c);
    }
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_direct_input_no_LF_check
 * DESCRIPTION
 *  
 * PARAMETERS
 *  c       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_direct_input_no_LF_check(UI_character_type c)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_insert_character(&MMI_EMS_inputbox, c);
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_backspace
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_backspace(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_backspace(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_delete_all
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_delete_all(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_delete_all(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_toggle_insert_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_toggle_insert_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_toggle_insert_mode(&MMI_EMS_inputbox);
    redraw_EMS_inputbox();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_delete
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_delete(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_delete(&MMI_EMS_inputbox);
    wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_new_line
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_insert_new_line(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_insert_new_line(&MMI_EMS_inputbox);
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_alphanumeric_keyboard_input_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  keyc        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_alphanumeric_keyboard_input_handler(S32 keyc)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (keyc == 0xc0)
    {
        EMS_inputbox_direct_input_no_LF_check((UI_character_type) '\n');
    }
    else if (keyc == 0xbb)
    {
        EMS_inputbox_direct_input((UI_character_type) 0x0d);
    }
    else if (keyc == 0x08)
    {
        EMS_inputbox_backspace();
    }
    else if (keyc == 0x1b)
    {
        EMS_inputbox_delete_all();
    }
    else if (keyc == 0x0d)
    {
        EMS_inputbox_direct_input((UI_character_type) '\n');
    }
    else if (keyc == 0xbd)
    {
        EMS_inputbox_direct_input((UI_character_type) 0x1b);
    }
    else if (keyc > 0x1f)
    {
        EMS_inputbox_direct_input((UI_character_type) keyc);
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_key_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  vkey_code       [IN]        
 *  key_state       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_key_handler(S32 vkey_code, S32 key_state)
{
#if(MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (key_state)
    {
        switch (vkey_code)
        {
            case 37:
        #if(ENABLE_EMS_TEST_WORD_HIGHLIGHT)
                MMI_EMS_inputbox.flags &= ~UI_EMS_INPUT_BOX_WORD_HIGHLIGHT;
        #endif 
                EMS_inputbox_previous();
                break;
            case 38:
        #if(ENABLE_EMS_TEST_WORD_HIGHLIGHT)
                gui_EMS_input_box_highlight_cursor_start(&MMI_EMS_inputbox);
                show_EMS_inputbox();
        #else /* (ENABLE_EMS_TEST_WORD_HIGHLIGHT) */ 
                EMS_inputbox_previous_line();
        #endif /* (ENABLE_EMS_TEST_WORD_HIGHLIGHT) */ 
                break;
            case 39:
        #if(ENABLE_EMS_TEST_WORD_HIGHLIGHT)
                MMI_EMS_inputbox.flags &= ~UI_EMS_INPUT_BOX_WORD_HIGHLIGHT;
        #endif 
                EMS_inputbox_next();
                break;
            case 40:
        #if(ENABLE_EMS_TEST_WORD_HIGHLIGHT)
                gui_EMS_input_box_highlight_cursor_end(&MMI_EMS_inputbox);
                show_EMS_inputbox();
        #else /* (ENABLE_EMS_TEST_WORD_HIGHLIGHT) */ 
                EMS_inputbox_next_line();
        #endif /* (ENABLE_EMS_TEST_WORD_HIGHLIGHT) */ 
                break;
            case 36:    /* home */
                break;
            case 35:    /* end */
                break;
            case 33:    /* page up */
                break;
            case 34:    /* page down */
                break;
            case 45:
                EMS_inputbox_toggle_insert_mode();
                break;
            case 46:
                EMS_inputbox_delete();
                break;
        }
    }
#else /* (MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32) */ 
    UI_UNUSED_PARAMETER(vkey_code);
    UI_UNUSED_PARAMETER(key_state);
#endif /* (MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32) */ 
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_viewer_key_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  vkey_code       [IN]        
 *  key_state       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_viewer_key_handler(S32 vkey_code, S32 key_state)
{
#if(MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (key_state)
    {
        switch (vkey_code)
        {
            case 37:
        #ifdef __MMI_MESSAGES_EMS__
                EMS_inputbox_previous_object();
        #else 
                EMS_inputbox_previous();
        #endif 

                break;
            case 38:
                EMS_inputbox_previous_line();
                break;

            case 39:
        #ifdef __MMI_MESSAGES_EMS__
                EMS_inputbox_next_object();
        #else 
                EMS_inputbox_next();
        #endif 
                break;
            case 40:
                EMS_inputbox_next_line();
                break;
            case 36:    /* home */
                break;
            case 35:    /* end */
                break;
            case 33:    /* page up */
                break;
            case 34:    /* page down */
                break;
            case 45:    /* insert */
                break;
            case 46:    /* delete */
                break;
        }
    }
#else /* (MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32) */ 
    UI_UNUSED_PARAMETER(vkey_code);
    UI_UNUSED_PARAMETER(key_state);
#endif /* (MMI_BUILD_TYPE == BUILD_TYPE_X86WIN32) */ 
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_multitap_input
 * DESCRIPTION
 *  
 * PARAMETERS
 *  c       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_multitap_input(UI_character_type c)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_insert_multitap_character(&MMI_EMS_inputbox, c);
    redraw_EMS_inputbox();
    EMS_inputbox_input_callback();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_multitap_input_complete
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_multitap_input_complete(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_EMS_input_box_confirm_multitap_character(&MMI_EMS_inputbox);
    redraw_EMS_inputbox();
}


#if defined(__MMI_MULTITAP_ARABIC__)

/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_arabic_numeric_keyboard_input_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  keyc        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_arabic_numeric_keyboard_input_handler(S32 keyc)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (keyc >= '0' && keyc <= '9')
    {
        EMS_inputbox_direct_input((UI_character_type)(keyc + 0x0630)); /* Arabic numeric is from 0x0660 to 0x0669 */
    }
    else if (keyc == 0x08)
    {
        EMS_inputbox_backspace();
    }
    else if (keyc == 0x1b)
    {
        EMS_inputbox_delete_all();
    }
}
#endif

/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_numeric_keyboard_input_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  keyc        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_numeric_keyboard_input_handler(S32 keyc)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (keyc >= '0' && keyc <= '9')
    {
        EMS_inputbox_direct_input((U8) keyc);
    }
    else if (keyc == 0x08)
    {
        EMS_inputbox_backspace();
    }
    else if (keyc == 0x1b)
    {
        EMS_inputbox_delete_all();
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_handle_key_down
 * DESCRIPTION
 *  
 * PARAMETERS
 *  k       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_handle_key_down(MMI_key_code_type k)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_MULTITAP_ARABIC__)
    if (MMI_current_input_mode == INPUT_MODE_ARABIC_NUMERIC ||MMI_current_input_mode == INPUT_MODE_MMI_ARABIC_NUMERIC )
        EMS_inputbox_direct_input((UI_character_type) (0x0660 + k));
    else
#endif
    EMS_inputbox_direct_input((UI_character_type) ('0' + k));
}


/*****************************************************************************
 * FUNCTION
 *  register_EMS_inputbox_keys
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void register_EMS_inputbox_keys(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(EMS_inputbox_previous, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_previous_line, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next_line, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    /* SetKeyHandler(EMS_inputbox_backspace,KEY_CLEAR,KEY_EVENT_DOWN); */
    register_keyboard_key_handler(EMS_inputbox_key_handler);
}


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_inputbox_handle_symbol_picker_star_key
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_inputbox_handle_symbol_picker_star_key(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    disable_active_multitap();
    EntrySymbolPickerScreen();
}


/* MTK Elvis modify for Thai */
#if !defined(__MMI_MULTITAP_FOR_STAR_AND_POUND__)
#else /* !defined(__MMI_MULTITAP_FOR_STAR_AND_POUND__) */ 
extern FuncPtr currKeyFuncPtrs[MAX_KEYS][MAX_KEY_TYPE];
#endif /* !defined(__MMI_MULTITAP_FOR_STAR_AND_POUND__) */ 


/*****************************************************************************
 * FUNCTION
 *  register_EMS_multitap_function
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void register_EMS_multitap_function(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* W06.09 Touch Screen With Keypad V1 */
#if defined(__MMI_FULL_SCREEN_EDITOR__) || defined(__MMI_TOUCH_SCREEN__)
    register_multitap_no_draw_key_handlers();
#else 
    register_multitap_key_handlers();
#endif 
    register_keyboard_input_handler(EMS_inputbox_alphanumeric_keyboard_input_handler);
    set_multitap_functions(EMS_inputbox_multitap_input, EMS_inputbox_multitap_input_complete);
    wgui_set_EMS_inputbox_RSK();
    register_EMS_inputbox_keys();
#if defined(__MMI_MULTITAP_FOR_STAR_AND_POUND__)
    SetKeyHandler(wgui_EMS_inputbox_handle_symbol_picker_star_key, KEY_STAR, KEY_LONG_PRESS);
#else
    SetKeyHandler(wgui_EMS_inputbox_handle_symbol_picker_star_key, KEY_STAR, KEY_EVENT_DOWN);
#endif

    if (MMI_EXIT_WITH_MULTITAP_STATE)
    {    
        MMI_timer_multitap = MMI_active_multitap;
        /* x 3 is a experimental value */
#if defined(__MMI_FULL_SCREEN_EDITOR__)
        gui_start_timer(MMI_MULTITAP_TIMEOUT * 3  , disable_active_multitap_no_draw);
#else
        gui_start_timer(MMI_MULTITAP_TIMEOUT * 3  , disable_active_multitap);
#endif

        MMI_EMS_inputbox.flags |= UI_EMS_INPUT_BOX_STATE_MULTITAP;
    }
    MMI_EXIT_WITH_MULTITAP_STATE = MMI_FALSE;
    
}





/*****************************************************************************
 * FUNCTION
 *  register_EMS_inputbox_viewer_keys
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void register_EMS_inputbox_viewer_keys(void)
{
#ifdef __MMI_MESSAGES_EMS__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetKeyHandler(EMS_inputbox_previous_object, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next_object, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#else /* __MMI_MESSAGES_EMS__ */ 
    SetKeyHandler(EMS_inputbox_previous, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#endif /* __MMI_MESSAGES_EMS__ */ 
    SetKeyHandler(EMS_inputbox_previous_line, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next_line, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_previous_line, KEY_VOL_UP, KEY_EVENT_DOWN);
    SetKeyHandler(EMS_inputbox_next_line, KEY_VOL_DOWN, KEY_EVENT_DOWN);
    register_keyboard_key_handler(EMS_inputbox_viewer_key_handler);
}


/*****************************************************************************
 * FUNCTION
 *  reset_EMS_inputbox
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void reset_EMS_inputbox(void)
{
#if(UI_BLINKING_CURSOR_SUPPORT)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    //gui_cancel_timer(UI_inputbox_blink_cursor);
    //MTK Elvis
    StopTimer(BLINKING_CURSOR);
    /* MTK end */

#endif /* (UI_BLINKING_CURSOR_SUPPORT) */ 
#ifdef __MMI_MESSAGES_EMS__
    EMS_cancel_object_focus();
#endif 
    reset_multitaps();
    clear_keyboard_key_handler();
    clear_keyboard_input_handler();
    clear_multitap_key_handlers();
    ClearKeyHandler(KEY_CLEAR, KEY_EVENT_DOWN);
    ClearKeyHandler(KEY_CLEAR, KEY_EVENT_UP);
    ClearKeyHandler(KEY_CLEAR, KEY_EVENT_LONG_PRESS);
#if((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING))
    gui_cancel_timer(wgui_EMS_inputbox_end_frame);
    wgui_EMS_inputbox_frame_counter = 0;
#endif /* ((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING)) */ 
    EMS_inputbox_input_callback = UI_dummy_function;
}


/*****************************************************************************
 * FUNCTION
 *  test_EMS_inputbox_change_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
U8 test_EMS_inputbox_change_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* MTK Elvis */
    if (MMI_EMS_inputbox.UCS2_count == 0)
    {
        if (EMSSetDCS(MMI_EMS_inputbox.data, SMSAL_UCS2_DCS) == EMS_OK &&
            EMS_get_remaining_length(MMI_EMS_inputbox.data) >= 2)
        {
            EMSSetDCS(MMI_EMS_inputbox.data, SMSAL_DEFAULT_DCS);
            return 1;
        }
        else
        {
            EMSSetDCS(MMI_EMS_inputbox.data, SMSAL_DEFAULT_DCS);
            return 0;
        }
    }
    else
    {
        return 1;
    }
    /* MTK end */
}

/* Temporary data: for testing         */
#ifdef __MMI_MESSAGES_EMS__

const U8 EMS_sample_melody_object_PDU_1[] = 
{
#if(0)
	EMS_PREDEFINED_MELODY, 0x69, 0x00,
	'B','E','G','I','N',':','I','M','E','L','O','D','Y','\n',
	'V','E','R','S','I','O','N',':','1','.','2','\n',
	'F','O','R','M','A','T',':','C','L','A','S','S','1','.','0','\n',
	'M','E','L','O','D','Y',':','*','4','#','f','2','*','4','a','3','.','*','4','#','f','3','*','4','#','f','4','*','4','#','a','3','*','4','#','f','3','*','4','e','3','*','4','#','f','2','*','5','c','3','\n',
	'E','N','D',':','I','M','E','L','O','D','Y','\n',
#else /* (0) */ 
    EMS_PREDEFINED_MELODY, 0x74, 0x00,
    'B', 'E', 'G', 'I', 'N', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
    'V', 'E', 'R', 'S', 'I', 'O', 'N', ':', '1', '.', '2', '\n',
    'F', 'O', 'R', 'M', 'A', 'T', ':', 'C', 'L', 'A', 'S', 'S', '1', '.', '0', '\n',
    'B', 'E', 'A', 'T', ':', '1', '2', '0', '\n',
    'C', 'O', 'M', 'P', 'O', 'S', 'E', 'R', ':', 'M', 'T', 'K', '(', '2', ')', '\n',
    'M', 'E', 'L', 'O', 'D', 'Y', ':', 'c', '2', 'd', '2', 'e', '2', 'f', '2', 'g', '2', 'a', '2', 'b', '2', '\n',
    'E', 'N', 'D', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
#endif /* (0) */ 
};

const U8 EMS_sample_melody_object_PDU_2[] = {EMS_PREDEFINED_MELODY, 0x6c, 0x00,
    'B', 'E', 'G', 'I', 'N', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
    'V', 'E', 'R', 'S', 'I', 'O', 'N', ':', '1', '.', '2', '\n',
    'F', 'O', 'R', 'M', 'A', 'T', ':', 'C', 'L', 'A', 'S', 'S', '1', '.', '0', '\n',
    'M', 'E', 'L', 'O', 'D', 'Y', ':', '*', '5', 'f', '0', '*', '5', '#', 'g', '2', '*', '5', 'g', '3', '*', '5', '#',
        'd', '0', '*', '5', '#', 'g', '2', '*', '5', 'g', '3', '*', '5', 'c', '0', '*', '5', '#', 'g', '2', '*', '5',
        'g', '3', '*', '4', '#', 'g', '0', '\n',
    'E', 'N', 'D', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
};

const U8 EMS_sample_picture_object_PDU_1[] = {EMS_USERDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x07, 0xE0, 0x08, 0x10, 0x30, 0x0C, 0x20, 0x04, 0x4E, 0x72, 0x9A, 0x59, 0x86, 0x61, 0x80, 0x01,
    0x80, 0x01, 0x90, 0x09, 0x88, 0x11, 0x47, 0xE2, 0x23, 0xC4, 0x30, 0x0C, 0x08, 0x10, 0x07, 0xE0,
};

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_2[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x00, 0x00, 0x00, 0x00, 0xFF, 0xFF, 0xC0, 0x03, 0xA0, 0x05, 0x90, 0x09, 0x88, 0x11, 0x8C, 0x31,
    0x93, 0xC9, 0xA0, 0x05, 0xC0, 0x03, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_2[] = {EMS_PREDEFINED_MELODY, 0x6a, 0x00,
    'B', 'E', 'G', 'I', 'N', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
    'V', 'E', 'R', 'S', 'I', 'O', 'N', ':', '1', '.', '2', '\n',
    'F', 'O', 'R', 'M', 'A', 'T', ':', 'C', 'L', 'A', 'S', 'S', '1', '.', '0', '\n',
    'M', 'E', 'L', 'O', 'D', 'Y', ':', '*', '4', '#', 'f', '2', '*', '4', 'a', '3', '.', '*', '4', '#', 'f', '3', '*',
        '4', '#', 'f', '4', '*', '4', '#', 'a', '3', '*', '4', '#', 'f', '3', '*', '4', 'e', '3', '*', '4', '#', 'f',
        '2', '*', '5', 'c', '3', '\n',
    'E', 'N', 'D', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_3[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x01, 0x80, 0x03, 0xC0, 0x03, 0xC0, 0x07, 0xE0, 0x0F, 0xF0, 0x1F, 0xF8, 0x3F, 0xFC, 0x3F, 0xFC,
    0x7F, 0xFE, 0x7F, 0xFE, 0x7F, 0xFE, 0x3D, 0xBC, 0x19, 0x98, 0x01, 0x80, 0x01, 0x80, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_3[] = {EMS_PREDEFINED_ANIMATION, 0x01,
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_4[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x07, 0xE0, 0x08, 0x10, 0x30, 0x0C, 0x20, 0x04, 0x5C, 0x3A, 0x86, 0x61, 0x86, 0x61, 0x80, 0x01,
    0x80, 0x01, 0x81, 0xC1, 0x82, 0x21, 0x44, 0x12, 0x20, 0x04, 0x30, 0x0C, 0x08, 0x10, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_4[] = {EMS_PREDEFINED_MELODY, 0x6c, 0x00,
    'B', 'E', 'G', 'I', 'N', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
    'V', 'E', 'R', 'S', 'I', 'O', 'N', ':', '1', '.', '2', '\n',
    'F', 'O', 'R', 'M', 'A', 'T', ':', 'C', 'L', 'A', 'S', 'S', '1', '.', '0', '\n',
    'M', 'E', 'L', 'O', 'D', 'Y', ':', '*', '5', 'f', '0', '*', '5', '#', 'g', '2', '*', '5', 'g', '3', '*', '5', '#',
        'd', '0', '*', '5', '#', 'g', '2', '*', '5', 'g', '3', '*', '5', 'c', '0', '*', '5', '#', 'g', '2', '*', '5',
        'g', '3', '*', '4', '#', 'g', '0', '\n',
    'E', 'N', 'D', ':', 'I', 'M', 'E', 'L', 'O', 'D', 'Y', '\n',
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_5[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x18, 0x00, 0x18, 0x00, 0x48, 0x00,
    0x05, 0x80, 0x00, 0x10, 0x60, 0x00, 0x42, 0x1D, 0xC0, 0x80, 0x06, 0x30, 0x00, 0x29, 0x8C, 0x98,
    0x02, 0xA2, 0x9E, 0x00, 0xB5, 0x9F, 0x82, 0x77, 0x1F, 0xE1, 0x5B, 0x9F, 0xF9, 0x75, 0x9F, 0xF9,
    0x5B, 0x1F, 0xF9, 0x75, 0x9F, 0xF9, 0x5B, 0x9F, 0xF9, 0x77, 0x1F, 0xF9, 0x5B, 0xC7, 0xF9, 0x75,
    0xA1, 0xF9, 0xBA, 0x38, 0x78, 0xDC, 0x0E, 0x1A, 0xB8, 0x03, 0x81, 0x70, 0x00, 0xF1, 0x50, 0x00,
    0x3D, 0x70, 0x00, 0x0E, 0xE0, 0x00, 0x03, 0x80,
};

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_6[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x07, 0xE0, 0x08, 0x10, 0x30, 0x0C, 0x26, 0x64, 0x48, 0x12, 0x90, 0x09, 0x86, 0x61, 0x86, 0x61,
    0x80, 0x01, 0x83, 0xC1, 0x87, 0xE1, 0x47, 0xE2, 0x23, 0xC4, 0x30, 0x0C, 0x08, 0x10, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_6[] = {EMS_PREDEFINED_SOUND, 0x01,
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_7[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x07, 0xE0, 0x08, 0x10, 0x30, 0x0C, 0x2C, 0x64, 0x52, 0x92, 0x96, 0xB1, 0x8C, 0x61, 0x80, 0x01,
    0xBF, 0xFD, 0xA9, 0x25, 0x99, 0x29, 0x59, 0x2A, 0x29, 0x34, 0x37, 0xEC, 0x08, 0x10, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_7[] = {EMS_PREDEFINED_ANIMATION, 0x02,
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_8[] = {0x01, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x03, 0xC0, 0x07, 0xE0, 0x07, 0xE0, 0x07, 0xE0, 0x03, 0xC0, 0x01, 0x80, 0x19, 0x98, 0x3D, 0xBC,
    0x7F, 0xFE, 0x7F, 0xFE, 0x7F, 0xFE, 0x3D, 0xBC, 0x19, 0x98, 0x01, 0x80, 0x01, 0x80, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_8[] = {EMS_USERDEFINED_ANIMATION, 0x01, 0x08, 0x00, 0x08, 0x00, 0x20, 0x00,
    0xFF, 0x81, 0x81, 0x81, 0xF1, 0xD1, 0xF1, 0xFF,

    0xFF, 0x81, 0x81, 0x81, 0x8F, 0x8B, 0x8F, 0xFF,

    0xFF, 0x8F, 0x8B, 0x8F, 0x81, 0x81, 0x81, 0xFF,

    0xFF, 0xF1, 0xD1, 0xF1, 0x81, 0x81, 0x81, 0xFF,
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

#if(!ENABLE_EMS_TEST_OBJECTS)

const U8 EMS_sample_picture_object_PDU_9[] = {0x01, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x07, 0xE0, 0x08, 0x10, 0x30, 0x0C, 0x20, 0x04, 0x79, 0xCE, 0xBF, 0xF9, 0xB9, 0xC1, 0x80, 0x01,
    0x80, 0x01, 0x9F, 0x01, 0x9F, 0x81, 0x4F, 0xC2, 0x27, 0xC4, 0x30, 0x0C, 0x08, 0x10, 0x07, 0xE0,
};

#else /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_9[] = {EMS_USERDEFINED_ANIMATION, 0x01, 0x10, 0x00, 0x10, 0x00, 0x80, 0x00,
    0x0F, 0xF8, 0x0F, 0xF8, 0x04, 0x10, 0x04, 0x10, 0x04, 0x10, 0x04, 0x10, 0x02, 0x20, 0x01, 0x40,
    0x01, 0x40, 0x02, 0x20, 0x04, 0x10, 0x04, 0x10, 0x04, 0x10, 0x04, 0x10, 0x0F, 0xF8, 0x0F, 0xF8,

    0x06, 0x00, 0x0E, 0x00, 0x1F, 0x00, 0x38, 0x80, 0x70, 0x40, 0xE0, 0x40, 0x60, 0x40, 0x10, 0x40,
    0x0F, 0x3C, 0x00, 0x82, 0x00, 0x81, 0x00, 0x83, 0x00, 0x87, 0x00, 0x4E, 0x00, 0x3C, 0x00, 0x38,

    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x03, 0xFC, 0x3F, 0xC2, 0x43, 0xC1, 0x83, 0xC0, 0x03,
    0xC1, 0x83, 0xC2, 0x43, 0xFC, 0x3F, 0xC0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,

    0x00, 0x38, 0x00, 0x3C, 0x00, 0x4E, 0x00, 0x87, 0x00, 0x83, 0x00, 0x81, 0x00, 0x82, 0x0F, 0x3C,
    0x10, 0x40, 0x60, 0x40, 0xE0, 0x40, 0x70, 0x40, 0x38, 0x80, 0x1F, 0x00, 0x0E, 0x00, 0x06, 0x00,
};

#endif /* (!ENABLE_EMS_TEST_OBJECTS) */ 

const U8 EMS_sample_picture_object_PDU_10[] = {EMS_PREDEFINED_PICTURE, 0x01, 0x20, 0x00, 0x20, 0x00, 0x80, 0x00,
    0x00, 0xFE, 0x00, 0x00, 0x07, 0xFF, 0x80, 0x00, 0x3F, 0xFF, 0x70, 0x00, 0x7F, 0xFF, 0x8E, 0x00,
    0x47, 0xFF, 0xC1, 0xC0, 0x40, 0xFF, 0xE0, 0x38, 0x40, 0x1F, 0xF0, 0x06, 0x40, 0x03, 0xF8, 0x02,
    0x40, 0x00, 0x7C, 0x0E, 0x40, 0x00, 0x0E, 0x3E, 0x40, 0x00, 0x00, 0xFE, 0x20, 0x78, 0x03, 0xFC,
    0x22, 0x1D, 0x03, 0xFC, 0x27, 0x0F, 0x03, 0xFC, 0x2F, 0x87, 0x03, 0xFC, 0x23, 0xCF, 0x07, 0xF8,
    0x23, 0x03, 0x07, 0xF8, 0x13, 0x00, 0x07, 0xF8, 0x11, 0x00, 0x07, 0xF8, 0x11, 0x08, 0x8F, 0xF0,
    0x10, 0x88, 0x8F, 0xF0, 0x10, 0x59, 0x8F, 0xF0, 0x08, 0x3F, 0x8F, 0xE0, 0x08, 0x1F, 0x1F, 0xE0,
    0x08, 0x0C, 0x1F, 0xE0, 0x04, 0x02, 0x1F, 0xE0, 0x03, 0x00, 0x1F, 0xC0, 0x00, 0xC0, 0x1F, 0xC0,
    0x00, 0x30, 0x3F, 0xC0, 0x00, 0x0C, 0x3F, 0x00, 0x00, 0x03, 0x3C, 0x00, 0x00, 0x00, 0xF0, 0x00,
};

const U8 EMS_sample_picture_object_PDU_11[] = {0x01, 0x01, 0x10, 0x00, 0x10, 0x00, 0x20, 0x00,
    0x00, 0x00, 0x1F, 0xF8, 0x20, 0x06, 0x26, 0x66, 0x23, 0xC6, 0x21, 0x86, 0x23, 0xC6, 0x26, 0x66,
    0x20, 0x06, 0x20, 0x06, 0x2A, 0xAE, 0x20, 0x06, 0x35, 0x56, 0x2A, 0xAE, 0x3F, 0xFE, 0x1F, 0xFC,
};

const U8 EMS_sample_animation_object_PDU_11[] = {EMS_USERDEFINED_ANIMATION, 0x01, 0x08, 0x00, 0x08, 0x00, 0x20, 0x00,
    0xFF, 0x81, 0x81, 0x81, 0xF1, 0xD1, 0xF1, 0xFF,

    0xFF, 0x81, 0x81, 0x81, 0x8F, 0x8B, 0x8F, 0xFF,

    0xFF, 0x8F, 0x8B, 0x8F, 0x81, 0x81, 0x81, 0xFF,

    0xFF, 0xF1, 0xD1, 0xF1, 0x81, 0x81, 0x81, 0xFF,
};

#define MAX_EMS_PREDEFINED_PICTURES    10

#if(ENABLE_EMS_TEST_OBJECTS)

/* Temporary: Needs to populated with actual picture data   */
U8 *EMS_predefined_pictures[MAX_EMS_PREDEFINED_PICTURES] = { (U8 *) EMS_sample_picture_object_PDU_1,
    (U8 *) EMS_sample_picture_object_PDU_2,
    (U8 *) EMS_sample_picture_object_PDU_3,
    (U8 *) EMS_sample_picture_object_PDU_4,
    (U8 *) EMS_sample_picture_object_PDU_5,
    (U8 *) EMS_sample_picture_object_PDU_6,
    (U8 *) EMS_sample_picture_object_PDU_7,
    (U8 *) EMS_sample_picture_object_PDU_8,
    (U8 *) EMS_sample_picture_object_PDU_9,
    (U8 *) EMS_sample_picture_object_PDU_10,
};

#else /* (ENABLE_EMS_TEST_OBJECTS) */ 

/* This gets populated at run time with picture data     */
U8 *EMS_predefined_pictures[MAX_EMS_PREDEFINED_PICTURES] = { (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
    (U8 *) EMS_sample_picture_object_PDU_11,
};

#endif /* (ENABLE_EMS_TEST_OBJECTS) */ 

U16 EMS_predefined_images[MAX_EMS_PREDEFINED_PICTURES] = {IMG_EMS01_PIC,
    IMG_EMS02_PIC,
    IMG_EMS03_PIC,
    IMG_EMS04_PIC,
    IMG_EMS05_PIC,
    IMG_EMS06_PIC,
    IMG_EMS07_PIC,
    IMG_EMS08_PIC,
    IMG_EMS09_PIC,
    IMG_EMS010_PIC
};

#define MAX_EMS_PREDEFINED_ANIMATIONS  15

U16 EMS_predefined_animations[MAX_EMS_PREDEFINED_ANIMATIONS] = {EMS_BI_ANIMATION_0_ID,
    EMS_BI_ANIMATION_1_ID,
    EMS_BI_ANIMATION_2_ID,
    EMS_BI_ANIMATION_3_ID,
    EMS_BI_ANIMATION_4_ID,
    EMS_BI_ANIMATION_5_ID,
    EMS_BI_ANIMATION_6_ID,
    EMS_BI_ANIMATION_7_ID,
    EMS_BI_ANIMATION_8_ID,
    EMS_BI_ANIMATION_9_ID,
    EMS_BI_ANIMATION_10_ID,
    EMS_BI_ANIMATION_11_ID,
    EMS_BI_ANIMATION_12_ID,
    EMS_BI_ANIMATION_13_ID,
    EMS_BI_ANIMATION_14_ID,
};

#define MAX_EMS_PREDEFINED_SOUNDS      10

/* Temporary: Needs to be populated with the actual sound IDs  */
U16 EMS_predefined_sounds[MAX_EMS_PREDEFINED_SOUNDS] = 
{
    EMS_CHIMES_HIGH,
    EMS_CHIMES_LOW,
    EMS_DING,
    EMS_TADA,
    EMS_NOTIFY,
    EMS_DRUM,
    EMS_CLAPS,
    EMS_FANFAR,
    EMS_CHORE_HGH,
    EMS_CHORE_LOW,
};

#define MAX_EMS_PREDEFINED_MELODIES    10

/* Temporary: Needs to be populated with the actual melody data   */
U8 *EMS_predefined_melodies[MAX_EMS_PREDEFINED_MELODIES] = 
{
    (U8 *) EMS_sample_melody_object_PDU_1,
    (U8 *) EMS_sample_melody_object_PDU_2,
    (U8 *) EMS_sample_melody_object_PDU_1,
    (U8 *) EMS_sample_melody_object_PDU_2,
    (U8 *) EMS_sample_melody_object_PDU_1,
    (U8 *) EMS_sample_melody_object_PDU_2,
    (U8 *) EMS_sample_melody_object_PDU_1,
    (U8 *) EMS_sample_melody_object_PDU_2,
    (U8 *) EMS_sample_melody_object_PDU_1,
    (U8 *) EMS_sample_melody_object_PDU_2,
};

/* data used for EMS_USERDEFINED_PICTURE, EMS_USERDEFINED_ANIMATION, EMS_USER_DEFINED_MELODY
   index used for EMS_PREDEFINED_PICTURE, EMS_PREDEFINED_MELODY.
   If index==-1, data is used for EMS_PREDEFINED_PICTURE, EMS_PREDEFINED_MELODY. */


/*****************************************************************************
 * FUNCTION
 *  EMS_load_object
 * DESCRIPTION
 *  
 * PARAMETERS
 *  type        [IN]        
 *  data        [?]         
 *  index       [IN]        
 *  object      [?]         
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_load_object(U32 type, U8 *data, S32 index, EMSObjData *object)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 ID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (type & 0xff)
    {
        case EMS_PREDEFINED_PICTURE:
        {
            if ((index >= MAX_EMS_PREDEFINED_PICTURES))
            {
                return (EMS_INVALID_OBJECT);
            }
            if (index >= 0)
            {
                data = EMS_predefined_pictures[index];
            }
            if (data == NULL)
            {
                return (EMS_NULL_POINTER);
            }
            ID = data[0];
            if (ID == EMS_PREDEFINED_PICTURE)
            {
                object->picture.bitsPerPixel = data[1];
                object->picture.attribute = data[2];
                object->picture.hDim = data[3] | (data[4] << 8);
                object->picture.vDim = data[5] | (data[6] << 8);
                object->picture.pdu_length = data[7] | (data[8] << 8);
                data += 9;
                object->picture.pdu = data;
            #ifdef __EMS_REL5__
                if ((object->picture.hDim == 0) || (object->picture.vDim == 0)
                    || (object->picture.pdu_length == 0) || (object->picture.attribute == 1))
            #else /* __EMS_REL5__ */ 
                if ((object->picture.hDim == 0) || (object->picture.vDim == 0)
                    || (object->picture.pdu_length == 0) || (object->picture.pdu_length > EMS_MAX_IMELODY_SIZE))
            #endif /* __EMS_REL5__ */ 
                    return (EMS_INVALID_OBJECT);
            }
            else
            {
                return (EMS_INVALID_OBJECT);
            }
        }
            break;

        case EMS_USERDEFINED_PICTURE:
        {
            if (data == NULL)
            {
                return (EMS_NULL_POINTER);
            }
            ID = data[0];
            if (ID == EMS_USERDEFINED_PICTURE)
            {
                object->picture.bitsPerPixel = data[1];
                object->picture.attribute = data[2];
                object->picture.hDim = data[3] | (data[4] << 8);
                object->picture.vDim = data[5] | (data[6] << 8);
                object->picture.pdu_length = data[7] | (data[8] << 8);
                data += 9;
                object->picture.pdu = data;
            #ifdef __EMS_REL5__
                if ((object->picture.hDim == 0) || (object->picture.vDim == 0)
                    || (object->picture.pdu_length == 0) || (object->picture.attribute == 1))
            #else /* __EMS_REL5__ */ 
                if ((object->picture.hDim == 0) || (object->picture.vDim == 0)
                    || (object->picture.pdu_length == 0) || (object->picture.pdu_length > EMS_MAX_IMELODY_SIZE))
            #endif /* __EMS_REL5__ */ 
                    return (EMS_INVALID_OBJECT);
            }
            else
            {
                return (EMS_INVALID_OBJECT);
            }
        }
            break;

        case EMS_USERDEFINED_ANIMATION:
        {
            if (data == NULL)
            {
                return (EMS_NULL_POINTER);
            }
            ID = data[0];
            if (ID == EMS_USERDEFINED_ANIMATION)
            {
                object->animation.bitsPerPixel = data[1];
                object->animation.attribute = data[2];
                object->animation.cFrame = data[3];
                object->animation.cRepeat = data[4];
                object->animation.Duration = data[5];
                object->animation.hDim = data[6] | (data[7] << 8);
                object->animation.vDim = data[8] | (data[9] << 8);
                object->animation.pdu_length = data[10] | (data[11] << 8);
                data += 12;
                object->animation.pdu = data;
            #ifdef __EMS_REL5__
                if ((object->animation.hDim == 0) || (object->animation.vDim == 0)
                    || (object->animation.pdu_length == 0)
                    || (object->animation.attribute == 1) || (object->animation.cFrame == 0))
            #else /* __EMS_REL5__ */ 
                if ((object->animation.hDim == 0) || (object->animation.vDim == 0)
                    || (object->animation.pdu_length == 0) || (object->animation.pdu_length > EMS_MAX_IMELODY_SIZE))
            #endif /* __EMS_REL5__ */ 
                    return (EMS_INVALID_OBJECT);
            }
            else
            {
                return (EMS_INVALID_OBJECT);
            }
        }
            break;
            /* MTK Joy added for customization, 1014 */
    #if defined(__MMI_IMELODY_SUPPORT__)
        case EMS_PREDEFINED_MELODY:
        {
            if ((index >= MAX_EMS_PREDEFINED_MELODIES))
            {
                return (EMS_INVALID_OBJECT);
            }
            if (index >= 0)
            {
                data = EMS_predefined_melodies[index];
            }
            if (data == NULL)
            {
                return (EMS_NULL_POINTER);
            }
            ID = data[0];
            if (ID == EMS_PREDEFINED_MELODY)
            {
                object->sound.attribute = data[1];
                object->sound.pdu_length = data[2] | (data[3] << 8);
                data += 4;
                object->sound.pdu = data;
            #ifdef __EMS_REL5__
                if ((object->sound.pdu_length == 0) || (object->sound.attribute == 1))
            #else 
                if ((object->sound.pdu_length == 0) || (object->sound.pdu_length > EMS_MAX_IMELODY_SIZE))
            #endif 
                    return (EMS_INVALID_OBJECT);
            }
            else
            {
                return (EMS_INVALID_OBJECT);
            }
        }
            break;

        case EMS_USERDEFINED_MELODY:
        {
            if (data == NULL)
            {
                return (EMS_NULL_POINTER);
            }
            ID = data[0];
            if (ID == EMS_USERDEFINED_MELODY)
            {
                object->sound.attribute = data[1];
                object->sound.pdu_length = data[2] | (data[3] << 8);
                data += 4;
                object->sound.pdu = data;
            #ifdef __EMS_REL5__
                if ((object->sound.pdu_length == 0) || (object->sound.attribute == 1))
            #else 
                if ((object->sound.pdu_length == 0) || (object->sound.pdu_length > EMS_MAX_IMELODY_SIZE))
            #endif 
                    return (EMS_INVALID_OBJECT);
            }
            else
            {
                return (EMS_INVALID_OBJECT);
            }
        }
            break;
    #endif /* defined(__MMI_IMELODY_SUPPORT__) */ 
            /* MTK end */
    }
    return (EMS_OK);
}

#if(ENABLE_EMS_TEST_DEMO || ENABLE_EMS_TEST_OBJECTS)    /* test_block  */

#define MAX_EMS_TEST_OBJECTS  10

U8 EMS_test_object_count = 0;
U8 *EMS_test_objects[MAX_EMS_TEST_OBJECTS] = { (U8 *) EMS_sample_picture_object_PDU_1,
    (U8 *) EMS_sample_picture_object_PDU_2,
    (U8 *) EMS_sample_picture_object_PDU_3,
    (U8 *) EMS_sample_picture_object_PDU_4,
    (U8 *) EMS_sample_picture_object_PDU_5,
    (U8 *) EMS_sample_picture_object_PDU_6,
    (U8 *) EMS_sample_picture_object_PDU_7,
    (U8 *) EMS_sample_picture_object_PDU_8,
    (U8 *) EMS_sample_picture_object_PDU_9,
    (U8 *) EMS_sample_picture_object_PDU_10,
};

#endif /* (ENABLE_EMS_TEST_DEMO || ENABLE_EMS_TEST_OBJECTS) */ 

#if(ENABLE_EMS_TEST_DEMO)       /* test_block  */


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_object
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_insert_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS ret;
    U8 *data;
    U8 ID;

    S32 index = EMS_test_object_count++;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (EMS_test_object_count > 9)
    {
        EMS_test_object_count = 0;
    }
    data = EMS_test_objects[index];
    ID = data[0];
    switch (ID)
    {
        case EMS_PREDEFINED_PICTURE:
        case EMS_USERDEFINED_PICTURE:
            ret = EMS_load_object(EMS_PREDEFINED_PICTURE, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PIC, &object, 0);
            }
            break;

        case EMS_USERDEFINED_ANIMATION:
            ret = EMS_load_object(EMS_USERDEFINED_ANIMATION, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_ANM, &object, 0);
            }
            break;

        case EMS_PREDEFINED_ANIMATION:
            ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_ANM, NULL, data[1]);
            break;

        case EMS_PREDEFINED_SOUND:
            ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_SND, NULL, data[1]);
            break;

        case EMS_PREDEFINED_MELODY:
            ret = EMS_load_object(EMS_PREDEFINED_MELODY, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_SND, &object, 0);
            }
            break;
    }
    /* show_EMS_inputbox(); */
}

#endif /* (ENABLE_EMS_TEST_DEMO) */ 

#if(ENABLE_EMS_TEST_OBJECTS)


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_picture
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_picture(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS ret;
    U8 *data;
    U8 ID;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (index < 0)
    {
        index = 0;
    }
    if (index > (MAX_EMS_TEST_OBJECTS - 1))
    {
        index = MAX_EMS_TEST_OBJECTS - 1;
    }
    data = EMS_test_objects[index];
    ID = data[0];
    switch (ID)
    {
        case EMS_PREDEFINED_PICTURE:
        case EMS_USERDEFINED_PICTURE:
            ret = EMS_load_object(EMS_PREDEFINED_PICTURE, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PIC, &object, 0);
            }
            break;

        case EMS_USERDEFINED_ANIMATION:
            ret = EMS_load_object(EMS_USERDEFINED_ANIMATION, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_ANM, &object, 0);
            }
            break;

        case EMS_PREDEFINED_ANIMATION:
            ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_ANM, NULL, data[1]);
            break;

        case EMS_PREDEFINED_SOUND:
            ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_SND, NULL, data[1]);
            break;

        case EMS_PREDEFINED_MELODY:
            ret = EMS_load_object(EMS_PREDEFINED_MELODY, data, index, &object);
            if (ret == EMS_OK)
            {
                ret = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_SND, &object, 0);
            }
            break;
    }
    return (ret);
}

#else /* (ENABLE_EMS_TEST_OBJECTS) */ 


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_picture
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_picture(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    U8 *data = NULL;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_PICTURE, data, index, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        r = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PIC, &object, 0);
    }
    return (r);
}

#endif /* (ENABLE_EMS_TEST_OBJECTS) */ 


/*****************************************************************************
 * FUNCTION
 *  EMS_get_object_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  type        [IN]        
 *  objdata     [?]         
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_object_size(U8 type, EMSObjData *objdata)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (EMSGetObjectSize(type, objdata));
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_object_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  type        [IN]        
 *  objdata     [?]         
 *  allowed     [?]         
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_object_size(U8 type, EMSObjData *objdata, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    kal_bool flag;
    S32 size = EMSGetObjectSizeWithCheck(type, objdata, &flag);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (flag == KAL_TRUE)
    {
        *allowed = 1;
    }
    else
    {
        *allowed = 0;
    }
    return (size);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_load_predefined_picture
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 *  data        [?]         
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_load_predefined_picture(S32 index, U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index >= 0) && (index < MAX_EMS_PREDEFINED_PICTURES))
    {
        EMS_predefined_pictures[index] = data;
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_picture_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_picture_size(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    U8 *data = NULL;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_PICTURE, data, index, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_PIC, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_picture_data_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_picture_data_size(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_PICTURE, data, -1, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_PIC, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_predefined_picture_data_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 *  allowed     [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_predefined_picture_data_size(U8 *data, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_PICTURE, data, -1, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_check_object_size(EMS_TYPE_PIC, &object, allowed));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_userdefined_picture_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_userdefined_picture_size(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_PICTURE, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_PIC, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_userdefined_picture_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 *  allowed     [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_userdefined_picture_size(U8 *data, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_PICTURE, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_check_object_size(EMS_TYPE_PIC, &object, allowed));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_userdefined_picture
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_userdefined_picture(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_PICTURE, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        r = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PIC, &object, 0);
    }
    return (r);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_animation_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_animation_size(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index < 0) || (index >= MAX_EMS_PREDEFINED_ANIMATIONS))
    {
        return (0);
    }
    return (EMS_get_object_size(EMS_TYPE_PREDEF_ANM, &object));
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_animation
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_animation(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index < 0) || (index >= MAX_EMS_PREDEFINED_ANIMATIONS))
    {
        return (EMS_INVALID_OBJECT);
    }
    return (gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_ANM, NULL, (U8) index));
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_userdefined_animation_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_userdefined_animation_size(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_ANIMATION, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_USERDEF_ANM, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_userdefined_animation_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 *  allowed     [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_userdefined_animation_size(U8 *data, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_ANIMATION, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_check_object_size(EMS_TYPE_USERDEF_ANM, &object, allowed));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_userdefined_animation
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_userdefined_animation(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_ANIMATION, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        r = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_ANM, &object, 0);
    }
    return (r);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_sound_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_sound_size(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index < 0) || (index >= MAX_EMS_PREDEFINED_SOUNDS))
    {
        return (0);
    }
    return (EMS_get_object_size(EMS_TYPE_PREDEF_SND, &object));
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_sound
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_sound(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index < 0) || (index >= MAX_EMS_PREDEFINED_SOUNDS))
    {
        return (EMS_INVALID_OBJECT);
    }
    return (gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_PREDEF_SND, NULL, (U8) index));
}

/* MTK Joy added for customization, 1014 */
#if defined(__MMI_IMELODY_SUPPORT__)


/*****************************************************************************
 * FUNCTION
 *  EMS_load_predefined_melody
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 *  data        [?]         
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_load_predefined_melody(S32 index, U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((index >= 0) && (index < MAX_EMS_PREDEFINED_MELODIES))
    {
        EMS_predefined_melodies[index] = data;
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_melody_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_melody_size(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    U8 *data = NULL;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_MELODY, data, index, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_USERDEF_SND, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_predefined_melody_data_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_predefined_melody_data_size(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_MELODY, data, -1, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_USERDEF_SND, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_predefined_melody_data_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 *  allowed     [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_predefined_melody_data_size(U8 *data, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_MELODY, data, -1, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_check_object_size(EMS_TYPE_USERDEF_SND, &object, allowed));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_melody
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_melody(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    U8 *data = NULL;
    EMSTATUS r = EMS_load_object(EMS_PREDEFINED_MELODY, data, index, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        r = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_SND, &object, 0);
    }
    return (r);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_get_userdefined_melody_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_get_userdefined_melody_size(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_MELODY, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_get_object_size(EMS_TYPE_USERDEF_SND, &object));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_check_userdefined_melody_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 *  allowed     [?]     
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_check_userdefined_melody_size(U8 *data, U8 *allowed)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_MELODY, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        return (EMS_check_object_size(EMS_TYPE_USERDEF_SND, &object, allowed));
    }
    return (0);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_userdefined_melody
 * DESCRIPTION
 *  
 * PARAMETERS
 *  data        [?]     
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_userdefined_melody(U8 *data)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;
    EMSTATUS r = EMS_load_object(EMS_USERDEFINED_MELODY, data, 0, &object);

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r == EMS_OK)
    {
        r = gui_EMS_inputbox_add_object(&MMI_EMS_inputbox, EMS_TYPE_USERDEF_SND, &object, 0);
    }
    return (r);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_userdefined_melody_attach_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  src         [?]     
 *  dst         [?]     
 *  size        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_userdefined_melody_attach_header(U8 *src, U8 *dst, S32 *size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_memcpy(dst + 4, src, *size);
    dst[0] = EMS_USERDEFINED_MELODY;
    dst[1] = 0;
    dst[2] = (U8) ((*size) & 0xff);
    dst[3] = (U8) ((*size) >> 8);
    *size = *size + 4;
}


/*****************************************************************************
 * FUNCTION
 *  EMS_userdefined_melody_detach_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  src         [?]     
 *  dst         [?]     
 *  size        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_userdefined_melody_detach_header(U8 *src, U8 *dst, S32 *size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *size = *size - 4;
    gui_memcpy(dst, src + 4, *size);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_predefined_melody_attach_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  src         [?]     
 *  dst         [?]     
 *  size        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_predefined_melody_attach_header(U8 *src, U8 *dst, S32 *size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_memcpy(dst + 4, src, *size);
    dst[0] = EMS_PREDEFINED_MELODY;
    dst[1] = 0;
    dst[2] = (U8) ((*size) & 0xff);
    dst[3] = (U8) ((*size) >> 8);
    *size = *size + 4;
}


/*****************************************************************************
 * FUNCTION
 *  EMS_predefined_melody_detach_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  src         [?]     
 *  dst         [?]     
 *  size        [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_predefined_melody_detach_header(U8 *src, U8 *dst, S32 *size)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    *size = *size - 4;
    gui_memcpy(dst, src + 4, *size);
}

#endif /* defined(__MMI_IMELODY_SUPPORT__) */ 
/* MTK end */


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_set_text_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  s       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_set_text_size(EMSFONTSIZE s)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_EMS_text_format.FontSize = s;
    /* AddString(MMI_EMS_inputbox.data,NULL,0,&wgui_EMS_text_format); */
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_get_text_size
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
EMSFONTSIZE EMS_inputbox_get_text_size(void)
{
#ifdef __MMI_DIALLING_FONT__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (wgui_EMS_text_format.FontSize == EMS_FONTSIZE_LARGE)
    {
        return (EMS_FONTSIZE_NORMAL);
    }
    else
    {
        return (wgui_EMS_text_format.FontSize);
    }
#else /* __MMI_DIALLING_FONT__ */ 
    return (wgui_EMS_text_format.FontSize);
#endif /* __MMI_DIALLING_FONT__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_set_text_style
 * DESCRIPTION
 *  
 * PARAMETERS
 *  isBold              [IN]        
 *  isItalic            [IN]        
 *  isUnderline         [IN]        
 *  isStrikethrough     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_set_text_style(U8 isBold, U8 isItalic, U8 isUnderline, U8 isStrikethrough)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (isBold)
    {
        wgui_EMS_text_format.isBold = KAL_TRUE;
    }
    else
    {
        wgui_EMS_text_format.isBold = KAL_FALSE;
    }
    if (isItalic)
    {
        wgui_EMS_text_format.isItalic = KAL_TRUE;
    }
    else
    {
        wgui_EMS_text_format.isItalic = KAL_FALSE;
    }
    if (isUnderline)
    {
        wgui_EMS_text_format.isUnderline = KAL_TRUE;
    }
    else
    {
        wgui_EMS_text_format.isUnderline = KAL_FALSE;
    }
    if (isStrikethrough)
    {
        wgui_EMS_text_format.isStrikethrough = KAL_TRUE;
    }
    else
    {
        wgui_EMS_text_format.isStrikethrough = KAL_FALSE;
    }
    /* AddString(MMI_EMS_inputbox.data,NULL,0,&wgui_EMS_text_format); */
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_get_text_style
 * DESCRIPTION
 *  
 * PARAMETERS
 *  isBold              [?]     
 *  isItalic            [?]     
 *  isUnderline         [?]     
 *  isStrikethrough     [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_inputbox_get_text_style(U8 *isBold, U8 *isItalic, U8 *isUnderline, U8 *isStrikethrough)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (wgui_EMS_text_format.isBold == KAL_TRUE)
    {
        *isBold = 1;
    }
    else
    {
        *isBold = 0;
    }
    if (wgui_EMS_text_format.isItalic == KAL_TRUE)
    {
        *isItalic = 1;
    }
    else
    {
        *isItalic = 0;
    }
    if (wgui_EMS_text_format.isUnderline == KAL_TRUE)
    {
        *isUnderline = 1;
    }
    else
    {
        *isUnderline = 0;
    }
    if (wgui_EMS_text_format.isStrikethrough == KAL_TRUE)
    {
        *isStrikethrough = 1;
    }
    else
    {
        *isStrikethrough = 0;
    }
}
#endif /* __MMI_MESSAGES_EMS__ */ /* endif __MMI_MESSAGES_EMS__ */
U8 EMS_inputbox_alignment_added_flag = 0;
EMSALIGNMENT EMS_inputbox_alignment = EMS_ALIGN_LANG_DEP;

#ifdef __MMI_MESSAGES_EMS__


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_set_text_alignment
 * DESCRIPTION
 *  
 * PARAMETERS
 *  a       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_set_text_alignment(EMSALIGNMENT a)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSTATUS emsObjectStatus;
    EMSTextFormat saved_wgui_EMS_text_format = wgui_EMS_text_format;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* Old code: Used for testing purpose. Leave commented   */
    //      ResetTextFormat(&wgui_EMS_text_format);
    //      wgui_EMS_text_format.Alignment=a;
    /* Old code: ends */
    saved_wgui_EMS_text_format.Alignment = a;
    emsObjectStatus = gui_EMS_input_box_insert_text_alignment(&MMI_EMS_inputbox, &saved_wgui_EMS_text_format);
    /* Old code: Used for testing purpose. Leave commented   */
    //      AddString(MMI_EMS_inputbox.data,NULL,0,&wgui_EMS_text_format);
    //      wgui_EMS_text_format=saved_wgui_EMS_text_format;
    /* Old code: ends */
    if (emsObjectStatus != EMS_OK)
    {
        return emsObjectStatus;
    }
    if (MMI_EMS_inputbox.data->CurrentTextFormatObj != NULL)
    {
        wgui_EMS_text_format.Alignment = MMI_EMS_inputbox.data->CurrentTextFormatObj->data->text_format.Alignment;
    }
    /* HACK: Set a flag to indicate that text alignment has been added   */
    EMS_inputbox_alignment_added_flag = 1;
    EMS_inputbox_alignment = a;
    return emsObjectStatus;
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_get_text_alignment
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
EMSALIGNMENT EMS_inputbox_get_text_alignment(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (wgui_EMS_text_format.Alignment);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_create_new_paragraph
 * DESCRIPTION
 *  
 * PARAMETERS
 *  a       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_create_new_paragraph(EMSALIGNMENT a)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSTATUS emsObjectStatus;

#if(0)
	wgui_EMS_text_format.Alignment=a;
	MMI_EMS_inputbox.text_format.Alignment=a;
	EMS_inputbox_insert_new_line();
#else /* (0) */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_EMS_text_format.Alignment = a;
    emsObjectStatus = gui_EMS_input_box_insert_new_paragraph(&MMI_EMS_inputbox, &wgui_EMS_text_format);
    /* AddString(MMI_EMS_inputbox.data,NULL,0,&wgui_EMS_text_format); */
    if (emsObjectStatus != EMS_OK)
    {
        wgui_EMS_text_format = MMI_EMS_inputbox.text_format;
    }
    EMS_inputbox_input_callback();
    return emsObjectStatus;
#endif /* (0) */ 
}

#if(0)

byte EMS_bold=1;

void EMS_inputbox_insert_text_format(void)
{	EMSObjData	object;

	ResetTextFormat(&object.text_format);
	object.text_format.bgColor=EMS_BLACK;
	object.text_format.fgColor=EMS_BLACK;
	object.text_format.Alignment=EMS_ALIGN_LEFT;
	if(EMS_bold) object.text_format.FontSize=EMS_FONTSIZE_SMALL;
	else object.text_format.FontSize=EMS_FONTSIZE_NORMAL;
	object.text_format.isBold=0;
	object.text_format.isItalic=0;
	object.text_format.isUnderline=0;
	object.text_format.isStrikethrough=0;
	object.text_format.textLength=1;
	pixtel_toggle(EMS_bold);
	AddString(MMI_EMS_inputbox.data,NULL,0,&object.text_format);
}

#endif /* (0) */ 

extern PU8 EMS_editor_sound_icon;
extern PU8 EMS_editor_melody_icon;


/*****************************************************************************
 * FUNCTION
 *  initialize_EMS_objects
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void initialize_EMS_objects(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMS_editor_sound_icon = get_image(EMS_EDITOR_SOUND_OBJECT_ID);
    EMS_editor_melody_icon = get_image(EMS_EDITOR_MELODY_OBJECT_ID);
}


/*****************************************************************************
 * FUNCTION
 *  close_EMS_objects
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void close_EMS_objects(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
}

/* EMS category screens: Application menus   */

#define EMS_APPLICATION_MENUS_BASE                    (DEMO_APP_BASE+400)
#define EMS_APPLICATION_MENUS_SCREEN_ID_BASE          (EMS_APPLICATION_MENUS_BASE+0)
#define EMS_MAIN_MENU_SCREEN_ID                       (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+1)
#define EMS_OBJECTS_MENU_SCREEN_ID                    (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+2)
#define EMS_TEXT_FORMATTING_MENU_SCREEN_ID               (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+3)
#define EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID         (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+4)
#define EMS_TEXT_SIZE_SELECTION_MENU_SCREEN_ID           (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+5)
#define EMS_TEXT_STYLE_SELECTION_MENU_SCREEN_ID          (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+6)
#define EMS_TEXT_NEW_PARAGRAPH_ALIGNMENT_MENU_SCREEN_ID     (EMS_APPLICATION_MENUS_SCREEN_ID_BASE+7)

#define MAX_EMS_MAIN_MENU_ITEMS  5

#if(EMS_USE_INTERNAL_MENU)

#ifdef __UCS2_ENCODING

U8 *EMS_main_menu_items[] = { (U8 *) "A\0d\0d\0 \0s\0y\0m\0b\0o\0l\0\0",
    (U8 *) "I\0n\0s\0e\0r\0t\0 \0o\0b\0j\0e\0c\0t\0\0",
    (U8 *) "F\0o\0r\0m\0a\0t\0 \0t\0e\0x\0t\0\0",
    (U8 *) "I\0n\0p\0u\0t\0 \0m\0e\0t\0h\0o\0d\0\0",
    (U8 *) "H\0e\0l\0p\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_main_menu_items[] = { (U8 *) "Add symbol",
    (U8 *) "Insert object",
    (U8 *) "Formart text",
    (U8 *) "Input method",
    (U8 *) "Help",
};

#endif /* __UCS2_ENCODING */ 


/*****************************************************************************
 * FUNCTION
 *  HandleEMSMainMenuLSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSMainMenuLSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (GetHighlightedItem())
    {
        case 0:
            break;
        case 1: /* Temporary: For testing  */
            EMS_inputbox_insert_object();
            GoBackHistory();
            /* EntryEMSObjectsMenu(); */
            break;
        case 2:
            GotoEMSTextFormattingMenu();
            break;
        case 3:
            break;
        case 4:
            break;
    }
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSMainMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSMainMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_MAIN_MENU_SCREEN_ID);
    ShowCategory6Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_MAIN_MENU_ITEMS,
        EMS_main_menu_items,
        0,
        guiBuffer);
    SetLeftSoftkeyFunction(HandleEMSMainMenuLSK, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_MAIN_MENU_SCREEN_ID, ExitEMSMainMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSMainMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSMainMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_MAIN_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSMainMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define MAX_EMS_OBJECTS_MENU_ITEMS  4

#ifdef __UCS2_ENCODING

U8 *EMS_objects_menu_items[] = { (U8 *) "P\0i\0c\0t\0u\0r\0e\0\0",
    (U8 *) "A\0n\0i\0m\0a\0t\0i\0o\0n\0\0",
    (U8 *) "S\0o\0u\0n\0d\0\0",
    (U8 *) "M\0e\0l\0o\0d\0y\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_objects_menu_items[] = { (U8 *) "Picture",
    (U8 *) "Animation",
    (U8 *) "Sound",
    (U8 *) "Melody",
};

#endif /* __UCS2_ENCODING */ 


/*****************************************************************************
 * FUNCTION
 *  EntryEMSObjectsMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSObjectsMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_OBJECTS_MENU_SCREEN_ID);
    ShowCategory6Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_OBJECTS_MENU_ITEMS,
        EMS_objects_menu_items,
        0,
        guiBuffer);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_OBJECTS_MENU_SCREEN_ID, ExitEMSObjectsMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSObjectsMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSObjectsMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_OBJECTS_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSObjectsMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define MAX_EMS_TEXT_FORMATTING_MENU_ITEMS   4

#ifdef __UCS2_ENCODING

U8 *EMS_text_formatting_menu_items[] = { (U8 *) "T\0e\0x\0t\0 \0s\0i\0z\0e\0\0",
    (U8 *) "T\0e\0x\0t\0 \0s\0t\0y\0l\0e\0\0",
    (U8 *) "A\0l\0i\0g\0n\0m\0e\0n\0t\0\0",
    (U8 *) "N\0e\0w\0 \0p\0a\0r\0a\0g\0r\0a\0p\0h\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_text_formatting_menu_items[] = { (U8 *) "Text size",
    (U8 *) "Text style",
    (U8 *) "Alignment",
    (U8 *) "New paragraph",
};

#endif /* __UCS2_ENCODING */ 


/*****************************************************************************
 * FUNCTION
 *  HandleEMSTextFormattingMenuLSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSTextFormattingMenuLSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (GetHighlightedItem())
    {
        case 0:
            EntryEMSTextSizeSelectionMenu();
            break;
        case 1:
            EntryEMSTextStyleSelectionMenu();
            break;
        case 2:
            EntryEMSTextAlignmentSelectionMenu();
            break;
        case 3:
            EntryEMSNewParagraphAlignmentMenu();
            break;
    }
}

/* 0: false, 1: true */
U8 EMSTextFormattingMenu_bold = 0;
U8 EMSTextFormattingMenu_italic = 0;
U8 EMSTextFormattingMenu_underline = 0;
U8 EMSTextFormattingMenu_strikethrough = 0;

/* 1: left, 2: right, 3: center, 0: automatic   */
U8 EMSTextFormattingMenu_alignment = 0;

/* 0: small, 1: medium, 2: large */
U8 EMSTextFormattingMenu_font_size = 1;


/*****************************************************************************
 * FUNCTION
 *  LoadEMSTextFormattingMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void LoadEMSTextFormattingMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSTextFormat *o;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((MMI_EMS_inputbox.data == NULL) || (MMI_EMS_inputbox.data->CurrentTextFormatObj == NULL))
    {
        EMSTextFormattingMenu_bold = 0;
        EMSTextFormattingMenu_italic = 0;
        EMSTextFormattingMenu_strikethrough = 0;
        EMSTextFormattingMenu_underline = 0;
        EMSTextFormattingMenu_alignment = 0;
        EMSTextFormattingMenu_font_size = 1;
    }
    else
    {
        o = &MMI_EMS_inputbox.data->CurrentTextFormatObj->data->text_format;
        if (o->isBold)
        {
            EMSTextFormattingMenu_bold = 1;
        }
        else
        {
            EMSTextFormattingMenu_bold = 0;
        }
        if (o->isItalic)
        {
            EMSTextFormattingMenu_italic = 1;
        }
        else
        {
            EMSTextFormattingMenu_italic = 0;
        }
        if (o->isStrikethrough)
        {
            EMSTextFormattingMenu_strikethrough = 1;
        }
        else
        {
            EMSTextFormattingMenu_strikethrough = 0;
        }
        if (o->isUnderline)
        {
            EMSTextFormattingMenu_underline = 1;
        }
        else
        {
            EMSTextFormattingMenu_underline = 0;
        }

        switch (o->Alignment)
        {
            case EMS_ALIGN_LEFT:
                EMSTextFormattingMenu_alignment = 1;
                break;
            case EMS_ALIGN_RIGHT:
                EMSTextFormattingMenu_alignment = 2;
                break;
            case EMS_ALIGN_CENTER:
                EMSTextFormattingMenu_alignment = 3;
                break;
            case EMS_ALIGN_LANG_DEP:
                EMSTextFormattingMenu_alignment = 0;
                break;
        }
        switch (o->FontSize)
        {
            case EMS_FONTSIZE_NORMAL:
                EMSTextFormattingMenu_font_size = 1;
                break;
            case EMS_FONTSIZE_LARGE:
                EMSTextFormattingMenu_font_size = 2;
                break;
            case EMS_FONTSIZE_SMALL:
                EMSTextFormattingMenu_font_size = 0;
                break;
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  StoreEMSTextFormattingMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void StoreEMSTextFormattingMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EMSObjData object;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ResetTextFormat(&object.text_format);
    object.text_format.bgColor = EMS_BLACK;
    object.text_format.fgColor = EMS_BLACK;
    switch (EMSTextFormattingMenu_alignment)
    {
        case 0:
            object.text_format.Alignment = EMS_ALIGN_LEFT;
            break;
        case 1:
            object.text_format.Alignment = EMS_ALIGN_LEFT;
            break;
        case 2:
            object.text_format.Alignment = EMS_ALIGN_RIGHT;
            break;
        case 3:
            object.text_format.Alignment = EMS_ALIGN_CENTER;
            break;
    }
    switch (EMSTextFormattingMenu_font_size)
    {
        case 0:
            object.text_format.FontSize = EMS_FONTSIZE_SMALL;
            break;
        case 1:
            object.text_format.FontSize = EMS_FONTSIZE_NORMAL;
            break;
        case 2:
            object.text_format.FontSize = EMS_FONTSIZE_LARGE;
            break;
    }
    if (EMSTextFormattingMenu_bold)
    {
        object.text_format.isBold = 1;
    }
    else
    {
        object.text_format.isBold = 0;
    }
    if (EMSTextFormattingMenu_italic)
    {
        object.text_format.isItalic = 1;
    }
    else
    {
        object.text_format.isItalic = 0;
    }
    if (EMSTextFormattingMenu_underline)
    {
        object.text_format.isUnderline = 1;
    }
    else
    {
        object.text_format.isUnderline = 0;
    }
    if (EMSTextFormattingMenu_strikethrough)
    {
        object.text_format.isStrikethrough = 1;
    }
    else
    {
        object.text_format.isStrikethrough = 0;
    }
    object.text_format.textLength = 1;
    wgui_EMS_text_format = object.text_format;
}


/*****************************************************************************
 * FUNCTION
 *  HandleEMSTextFormattingMenuRSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSTextFormattingMenuRSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StoreEMSTextFormattingMenu();
    GoBackHistory();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  GotoEMSTextFormattingMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void GotoEMSTextFormattingMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    LoadEMSTextFormattingMenu();
    EntryEMSTextFormattingMenu();
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSTextFormattingMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSTextFormattingMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEXT_FORMATTING_MENU_SCREEN_ID);
    ShowCategory6Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_TEXT_FORMATTING_MENU_ITEMS,
        EMS_text_formatting_menu_items,
        0,
        guiBuffer);
    SetLeftSoftkeyFunction(HandleEMSTextFormattingMenuLSK, KEY_EVENT_UP);
    SetRightSoftkeyFunction(HandleEMSTextFormattingMenuRSK, KEY_EVENT_UP);
    SetExitHandler(EMS_TEXT_FORMATTING_MENU_SCREEN_ID, ExitEMSTextFormattingMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSTextFormattingMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSTextFormattingMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEXT_FORMATTING_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSTextFormattingMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define MAX_EMS_TEXT_SIZE_MENU_ITEMS   3

#ifdef __UCS2_ENCODING

U8 *EMS_text_size_menu_items[] = { (U8 *) "S\0m\0a\0l\0l\0\0",
    (U8 *) "M\0e\0d\0i\0u\0m\0\0",
    (U8 *) "L\0a\0r\0g\0e\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_text_size_menu_items[] = { (U8 *) "Small",
    (U8 *) "Medium",
    (U8 *) "Large",
};

#endif /* __UCS2_ENCODING */ 


/*****************************************************************************
 * FUNCTION
 *  HandleEMSTextSizeSelectionMenuLSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSTextSizeSelectionMenuLSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMSTextFormattingMenu_font_size = (U8) GetHighlightedItem();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSTextSizeSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSTextSizeSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U16 h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEXT_SIZE_SELECTION_MENU_SCREEN_ID);
    h = EMSTextFormattingMenu_font_size;
    ShowCategory36Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_TEXT_SIZE_MENU_ITEMS,
        EMS_text_size_menu_items,
        h,
        guiBuffer);
    SetLeftSoftkeyFunction(HandleEMSTextSizeSelectionMenuLSK, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_TEXT_SIZE_SELECTION_MENU_SCREEN_ID, ExitEMSTextSizeSelectionMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSTextSizeSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSTextSizeSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEXT_SIZE_SELECTION_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSTextSizeSelectionMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define MAX_EMS_TEXT_STYLE_MENU_ITEMS  4

#ifdef __UCS2_ENCODING

U8 *EMS_text_style_menu_items[] = { (U8 *) "B\0o\0l\0d\0\0",
    (U8 *) "I\0t\0a\0l\0i\0c\0\0",
    (U8 *) "U\0n\0d\0e\0r\0l\0i\0n\0e\0\0",
    (U8 *) "S\0t\0r\0i\0k\0e\0t\0h\0r\0o\0u\0g\0h\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_text_style_menu_items[] = { (U8 *) "Bold",
    (U8 *) "Italic",
    (U8 *) "Underline",
    (U8 *) "Strikethrough",
};

#endif /* __UCS2_ENCODING */ 

U8 EMS_text_style_menu_states[] = {0, 0, 0, 0,
};


/*****************************************************************************
 * FUNCTION
 *  HandleEMSTextStyleSelectionMenuRSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSTextStyleSelectionMenuRSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (EMS_text_style_menu_states[0])
    {
        EMSTextFormattingMenu_bold = 1;
    }
    else
    {
        EMSTextFormattingMenu_bold = 0;
    }
    if (EMS_text_style_menu_states[1])
    {
        EMSTextFormattingMenu_italic = 1;
    }
    else
    {
        EMSTextFormattingMenu_italic = 0;
    }
    if (EMS_text_style_menu_states[2])
    {
        EMSTextFormattingMenu_underline = 1;
    }
    else
    {
        EMSTextFormattingMenu_underline = 0;
    }
    if (EMS_text_style_menu_states[3])
    {
        EMSTextFormattingMenu_strikethrough = 1;
    }
    else
    {
        EMSTextFormattingMenu_strikethrough = 0;
    }
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSTextStyleSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSTextStyleSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEXT_STYLE_SELECTION_MENU_SCREEN_ID);

    if (EMSTextFormattingMenu_bold)
    {
        EMS_text_style_menu_states[0] = 1;
    }
    else
    {
        EMS_text_style_menu_states[0] = 0;
    }
    if (EMSTextFormattingMenu_italic)
    {
        EMS_text_style_menu_states[1] = 1;
    }
    else
    {
        EMS_text_style_menu_states[1] = 0;
    }
    if (EMSTextFormattingMenu_underline)
    {
        EMS_text_style_menu_states[2] = 1;
    }
    else
    {
        EMS_text_style_menu_states[2] = 0;
    }
    if (EMSTextFormattingMenu_strikethrough)
    {
        EMS_text_style_menu_states[3] = 1;
    }
    else
    {
        EMS_text_style_menu_states[3] = 0;
    }

    ShowCategory12Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_TEXT_STYLE_MENU_ITEMS,
        EMS_text_style_menu_items,
        EMS_text_style_menu_states,
        0,
        guiBuffer);
    SetRightSoftkeyFunction(HandleEMSTextStyleSelectionMenuRSK, KEY_EVENT_UP);
    SetExitHandler(EMS_TEXT_STYLE_SELECTION_MENU_SCREEN_ID, ExitEMSTextStyleSelectionMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSTextStyleSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSTextStyleSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEXT_STYLE_SELECTION_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSTextStyleSelectionMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define MAX_EMS_TEXT_ALIGNMENT_MENU_ITEMS 4

#ifdef __UCS2_ENCODING

U8 *EMS_text_alignment_menu_items[] = { (U8 *) "A\0u\0t\0o\0m\0a\0t\0i\0c\0\0",
    (U8 *) "L\0e\0f\0t\0\0",
    (U8 *) "R\0i\0g\0h\0t\0\0",
    (U8 *) "C\0e\0n\0t\0e\0r\0\0",
};

#else /* __UCS2_ENCODING */ 

U8 *EMS_text_alignment_menu_items[] = { (U8 *) "Automatic",
    (U8 *) "Left",
    (U8 *) "Right",
    (U8 *) "Center",
};

#endif /* __UCS2_ENCODING */ 


/*****************************************************************************
 * FUNCTION
 *  HandleEMSTextAlignmentSelectionMenuLSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSTextAlignmentSelectionMenuLSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMSTextFormattingMenu_alignment = (U8) GetHighlightedItem();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSTextAlignmentSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSTextAlignmentSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U16 h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID);
    h = EMSTextFormattingMenu_alignment;
    ShowCategory36Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_TEXT_ALIGNMENT_MENU_ITEMS,
        EMS_text_alignment_menu_items,
        h,
        guiBuffer);
    SetLeftSoftkeyFunction(HandleEMSTextAlignmentSelectionMenuLSK, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID, ExitEMSTextAlignmentSelectionMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSTextAlignmentSelectionMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSTextAlignmentSelectionMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSTextAlignmentSelectionMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}


/*****************************************************************************
 * FUNCTION
 *  HandleEMSNewParagraphAlignmentMenuLSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void HandleEMSNewParagraphAlignmentMenuLSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMSTextFormattingMenu_alignment = (U8) GetHighlightedItem();
    GoBackHistory();
    StoreEMSTextFormattingMenu();
    EMS_inputbox_insert_new_line();
    GoBackHistory();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EntryEMSNewParagraphAlignmentMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSNewParagraphAlignmentMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U16 h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID);
    h = EMSTextFormattingMenu_alignment;
    ShowCategory36Screen(
        0,
        0,
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        MAX_EMS_TEXT_ALIGNMENT_MENU_ITEMS,
        EMS_text_alignment_menu_items,
        h,
        guiBuffer);
    SetLeftSoftkeyFunction(HandleEMSNewParagraphAlignmentMenuLSK, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID, ExitEMSTextAlignmentSelectionMenu);
}


/*****************************************************************************
 * FUNCTION
 *  ExitEMSNewParagraphAlignmentMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitEMSNewParagraphAlignmentMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEXT_ALIGNMENT_SELECTION_MENU_SCREEN_ID;
    h.entryFuncPtr = EntryEMSTextAlignmentSelectionMenu;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}
#endif /* (EMS_USE_INTERNAL_MENU) */ /* __MMI_MESSAGES_EMS__ */
#endif /* __MMI_MESSAGES_EMS__ */ /* UI_DISABLE_EMS_INPUT_BOX */

/* EMS input box history related functions   */



extern U8 history_valid(U16 history_ID, U16 category_screen_ID);


/*****************************************************************************
 * FUNCTION
 *  get_EMS_inputbox_category_history
 * DESCRIPTION
 *  
 * PARAMETERS
 *  history_ID          [IN]        
 *  history_buffer      [?]         
 *  input_type          [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void get_EMS_inputbox_category_history(U16 history_ID, U8 *history_buffer, S16 input_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (history_buffer != NULL)
    {
        U16 hID = (U16) (history_ID | 0x8000);
        EMS_inputbox_category_history *h = (EMS_inputbox_category_history*) history_buffer;

        h->history_ID = hID;
        h->cursor_ax = (S16) MMI_EMS_inputbox.cursor_ax;
        h->cursor_ay = (S16) MMI_EMS_inputbox.cursor_ay;
        h->cursor_line_height = (S16) MMI_EMS_inputbox.cursor_line_height;
        h->display_y = (S16) MMI_EMS_inputbox.display_y;
        h->input_type = (S16) input_type;
        h->UCS2_count = (S16) MMI_EMS_inputbox.UCS2_count;
        if (MMI_EMS_inputbox.data != NULL 
            && (MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
        {
            h->text_offset = (S16) MMI_EMS_inputbox.data->CurrentPosition.OffsetToText;
        }
    #if defined(__MMI_TOUCH_SCREEN__)
        //W05.32 Virtual Keyboard History Issue
        //W05.41 Do not Strore Virtual Keyboard into History when View Mode
        if (!(MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
        {
            if (GUI_VIRTUAL_KEYBOARD_MAX_LANG == mmi_pen_editor_history_vk_lang_type())
            {
                h->vk_lang_type = MMI_virtual_keyboard.lang_type;
            }
            else
            {
                h->vk_lang_type = mmi_pen_editor_history_vk_lang_type();
            }
        }
        else
        {
            h->vk_lang_type = GUI_VIRTUAL_KEYBOARD_EMPTY_TRAY;
        }
    #endif /* defined(__MMI_TOUCH_SCREEN__) */ 
    }
}


/*****************************************************************************
 * FUNCTION
 *  set_EMS_inputbox_category_history
 * DESCRIPTION
 *  
 * PARAMETERS
 *  history_ID          [IN]        
 *  history_buffer      [?]         
 *  input_type          [?]         
 * RETURNS
 *  
 *****************************************************************************/
U8 set_EMS_inputbox_category_history(U16 history_ID, U8 *history_buffer, S16 *input_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    
    MMI_EXIT_WITH_MULTITAP_STATE = MMI_FALSE;

    if (history_buffer != NULL)
    {
        EMS_inputbox_category_history *h = (EMS_inputbox_category_history*) history_buffer;

        if (history_valid(h->history_ID, history_ID))
        {
            MMI_EMS_inputbox.cursor_ax = h->cursor_ax;
            MMI_EMS_inputbox.cursor_ay = h->cursor_ay;
            MMI_EMS_inputbox.cursor_line_height = h->cursor_line_height;
            MMI_EMS_inputbox.display_y = h->display_y;
            MMI_EMS_inputbox.UCS2_count = h->UCS2_count;
            if (MMI_EMS_inputbox.data != NULL && 
                (MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE))
            {
                MMI_EMS_inputbox.data->CurrentPosition.OffsetToText = h->text_offset;
            }
            *input_type = h->input_type;
        #if defined(__MMI_TOUCH_DIAL_SCREEN__)
            /* W05.32 Virtual Keyboard History Issue */
            wgui_setup_virtual_keyboard(h->vk_lang_type);
        #endif /* defined(__MMI_TOUCH_DIAL_SCREEN__) */ 
            return (1);
        }
    }
    return (0);
}

#endif /* (!UI_DISABLE_EMS_INPUT_BOX) */ /* UI_DISABLE_EMS_CATEGORY_SCREENS  */

extern void set_MMI_current_input_type(void);

S32 wgui_EMS_inputbox_information_bar_x;
S32 wgui_EMS_inputbox_information_bar_y;
S32 wgui_EMS_inputbox_information_bar_width;
S32 wgui_EMS_inputbox_information_bar_height;
U8 wgui_EMS_inputbox_information_flag = 0;
PU8 wgui_EMS_inputbox_information_icon = NULL;


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_setup_input_information
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x           [IN]        
 *  y           [IN]        
 *  width       [IN]        
 *  height      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_setup_input_information(S32 x, S32 y, S32 width, S32 height)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_EMS_inputbox_information_bar_x = x;
    wgui_EMS_inputbox_information_bar_y = y;
    wgui_EMS_inputbox_information_bar_width = width;
    wgui_EMS_inputbox_information_bar_height = height;
}


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_input_information_background
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x1      [IN]        
 *  y1      [IN]        
 *  x2      [IN]        
 *  y2      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_input_information_background(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /* Now reads color from the theme structure  */
    color c = *current_MMI_theme->information_bar_color;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_reset_clip();
    /* W05.39 Set Information Bar Background as GDI_COLOR_TRANSPARENT when wgui_is_wallpaper_on_bottom */
    if (wgui_is_wallpaper_on_bottom() == MMI_TRUE)
    {
        gdi_draw_solid_rect(x1, y1, x2, y2, GDI_COLOR_TRANSPARENT);     /* 061705 Calvin added */
    }
    else
    {
        gui_fill_rectangle(x1, y1, x2, y2, c);
    }
}


/*PMT IRE START*/
//REMOVED
/*PMT IRE END*/
#if defined(__MMI_TOUCH_SCREEN__)
extern UI_filled_area information_bar_BG_filler;
#endif 



#if defined(__MMI_TOUCH_SCREEN__)
extern S32 wgui_information_bar_input_mode_display_width;
extern S32 wgui_information_bar_input_mode_display_height;
#endif




/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_show_input_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_show_input_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    color c = *current_MMI_theme->input_method_text_color;

#if !defined(__MMI_TOUCH_SCREEN__)
    stFontAttribute *f = &MMI_small_font;
#else /* !defined(__MMI_TOUCH_SCREEN__) */ 
    stFontAttribute *f = &MMI_medium_font;
    S32 rect_height;
#endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
    S32 x;
    UI_string_type inputmode_string = (UI_string_type) "";
    S32 width, height;


/*PMT IRE START*/
//REMOVED
/*PMT IRE END*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_TOUCH_SCREEN__)
    wgui_information_bar_input_mode_display_width = 0;
    wgui_information_bar_input_mode_display_height = 0;
#endif   
    switch (MMI_current_input_mode)
    {
        case INPUT_MODE_MULTITAP_UPPERCASE_ABC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ABC_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_ABC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_abc_STRING_ID);
            break;

    #if defined (__MMI_MULTITAP_THAI__)
        case INPUT_MODE_MULTITAP_THAI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_thai_STRING_ID);
            break;
    #endif /* defined (__MMI_MULTITAP_THAI__) */ 
    #if defined(__MMI_MULTITAP_SPANISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SPANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SPANISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_SPANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_spanish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_SPANISH__) */ 
    #if defined(__MMI_MULTITAP_DANISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_DANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_DANISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_DANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_danish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_DANISH__) */ 
    #if defined(__MMI_MULTITAP_POLISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_POLISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_POLISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_POLISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_polish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_POLISH__) */ 
    #if defined(__MMI_MULTITAP_FRENCH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_FRENCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_FRENCH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_FRENCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_french_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_FRENCH__) */ 
    #if defined(__MMI_MULTITAP_GERMAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_GERMAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_GERMAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_GERMAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_german_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_GERMAN__) */ 
    #if defined(__MMI_MULTITAP_ITALIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_ITALIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ITALIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_ITALIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_italian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_ITALIAN__) */ 
    #if defined(__MMI_MULTITAP_RUSSIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_RUSSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_RUSSIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_RUSSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_russian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_RUSSIAN__) */ 
    #if defined(__MMI_MULTITAP_BULGARIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_BULGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_BULGARIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_BULGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_bulgarian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_BULGARIAN__) */ 
    #if defined(__MMI_MULTITAP_UKRAINIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_UKRAINIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_UKRAINIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_UKRAINIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_L_UKRAINIAN_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_UKRAINIAN__) */ 
    #if defined(__MMI_MULTITAP_TURKISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_TURKISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TURKISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_TURKISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_turkish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_TURKISH__) */ 
    #if defined(__MMI_MULTITAP_PORTUGUESE__)
        case INPUT_MODE_MULTITAP_UPPERCASE_PORTUGUESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PORTUGUESE_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_PORTUGUESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_portuguese_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_PORTUGUESE__) */ 
    #if defined(__MMI_MULTITAP_HINDI__) 
        case INPUT_MODE_MULTITAP_HINDI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HINDI_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_HINDI__) */ 

    #if defined(__MMI_MULTITAP_MARATHI__)
        case INPUT_MODE_MULTITAP_MARATHI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_MARATHI_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_MARATHI__) */ 
	#if defined (__MMI_MULTITAP_TAMIL__)
        case INPUT_MODE_MULTITAP_TAMIL:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TAMIL_STRING_ID);
            break;
    #endif /* #if defined (__MMI_MULTITAP_TAMIL__) */ 
    #if defined(__MMI_MULTITAP_BENGALI__) 
        case INPUT_MODE_MULTITAP_BENGALI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_BENGALI_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_BENGALI__) */ 

	#if defined (__MMI_MULTITAP_PUNJABI__)
        case INPUT_MODE_MULTITAP_PUNJABI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PUNJABI_STRING_ID);
            break;
    #endif
   #if defined (__MMI_MULTITAP_TELUGU__)
        case INPUT_MODE_MULTITAP_TELUGU:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TELUGU_STRING_ID);
            break;
    #endif
    #if defined(__MMI_MULTITAP_INDONESIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_INDONESIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_INDONESIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_INDONESIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_indonesian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_INDONESIAN__) */ 
    #if defined(__MMI_MULTITAP_CZECH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_CZECH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_CZECH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_CZECH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_czech_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_CZECH__) */ 
    #if defined(__MMI_MULTITAP_MALAY__)
        case INPUT_MODE_MULTITAP_UPPERCASE_MALAY:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_MALAY_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_MALAY:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_malay_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_MALAY__) */ 
    #if defined(__MMI_MULTITAP_VIETNAMESE__)
        case INPUT_MODE_MULTITAP_UPPERCASE_VIETNAMESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_VIETNAMESE_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_VIETNAMESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_vietnamese_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_VIETNAMESE__) */ 
    #if defined(__MMI_MULTITAP_FINNISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_FINNISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_FINNISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_FINNISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_finnish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_FINNISH__) */ 
    #if defined(__MMI_MULTITAP_HUNGARIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_HUNGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HUNGARIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_HUNGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_hungarian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_HUNGARIAN__) */ 
    #if defined(__MMI_MULTITAP_HEBREW__)
        case INPUT_MODE_MULTITAP_HEBREW:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HEBREW_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_HEBREW__) */ 
    #if defined(__MMI_MULTITAP_SLOVAK__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SLOVAK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SLOVAK_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_SLOVAK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_slovak_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_SLOVAK__) */ 
    #if defined(__MMI_MULTITAP_DUTCH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_DUTCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_DUTCH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_DUTCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_dutch_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_DUTCH__) */ 
    #if defined(__MMI_MULTITAP_ARABIC__)
        case INPUT_MODE_MULTITAP_ARABIC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ARABIC_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_ARABIC__) */ 
    #if defined(__MMI_MULTITAP_ARABIC__)
        case INPUT_MODE_ARABIC_NUMERIC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ARABIC_NUMERIC_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_ARABIC__) */ 
    #if defined(__MMI_MULTITAP_PERSIAN__)
        case INPUT_MODE_MULTITAP_PERSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PERSIAN_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_PERSIAN__) */ 
    #if defined(__MMI_MULTITAP_URDU__)
        case INPUT_MODE_MULTITAP_URDU:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_URDU_STRING_ID);
            break;
    #endif 
    #if defined(__MMI_MULTITAP_NORWEGIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_NORWEGIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_NORWEGIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_NORWEGIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_norwegian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_NORWEGIAN__) */ 
    #if defined(__MMI_MULTITAP_SWEDISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SWEDISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SWEDISH_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_SWEDISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_swedish_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_SWEDISH__) */ 
    #if defined(__MMI_MULTITAP_CROATIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_CROATIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_CROATIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_CROATIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_croatian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_CROATIAN__) */ 
    #if defined(__MMI_MULTITAP_ROMANIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_ROMANIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ROMANIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_ROMANIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_romanian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_ROMANIAN__) */ 
    #if defined(__MMI_MULTITAP_SLOVENIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SLOVENIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SLOVENIAN_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_SLOVENIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_slovenian_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_SLOVENIAN__) */ 
    #if defined(__MMI_MULTITAP_GREEK__)
        case INPUT_MODE_MULTITAP_UPPERCASE_GREEK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_GREEK_STRING_ID);
            break;
        case INPUT_MODE_MULTITAP_LOWERCASE_GREEK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_greek_STRING_ID);
            break;
    #endif /* defined(__MMI_MULTITAP_GREEK__) */ 
        case INPUT_MODE_123:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_123_STRING_ID);
            break;
        case INPUT_MODE_SMART_UPPERCASE_ABC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ABC_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_ABC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_abc_STRING_ID);
            break;
    #if defined(__MMI_SMART_FIRST_UPPERCASE_ABC__)
        case INPUT_MODE_SMART_FIRST_UPPERCASE_ABC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_Abc_STRING_ID);
            break;
    #endif
    #if defined (__MMI_MULTITAP_THAI__)
        case INPUT_MODE_SMART_THAI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_thai_STRING_ID);
            break;
     #endif

        case INPUT_MODE_SMART_HEBREW:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HEBREW_STRING_ID);
            break;
        case INPUT_MODE_SMART_ARABIC:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ARABIC_STRING_ID);
            break;
        case INPUT_MODE_SMART_PERSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PERSIAN_STRING_ID);
            break;
        #if defined(__MMI_T9_HINDI__) || defined(__MMI_ZI_HINDI__) 
        case INPUT_MODE_SMART_HINDI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HINDI_STRING_ID);
            break;
	#endif
    #if defined(__MMI_ZI_BENGALI__) 
        case INPUT_MODE_SMART_BENGALI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_BENGALI_STRING_ID);
            break;
	#endif

    #if defined(__MMI_ZI_MARATHI__) 
        case INPUT_MODE_SMART_MARATHI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_MARATHI_STRING_ID);
            break;
	#endif

    #if defined(__MMI_ZI_PUNJABI__) 
        case INPUT_MODE_SMART_PUNJABI:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PUNJABI_STRING_ID);
            break;
	#endif

    #if defined(__MMI_ZI_TAMIL__) 
        case INPUT_MODE_SMART_TAMIL:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TAMIL_STRING_ID);
            break;
	#endif

    #if defined(__MMI_ZI_TELUGU__) 
        case INPUT_MODE_SMART_TELUGU:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TELUGU_STRING_ID);
            break;
	#endif

    #if defined(__MMI_ZI_URDU__) 
        case INPUT_MODE_SMART_URDU:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_URDU_STRING_ID);
            break;
	#endif
    #if defined(__MMI_T9_SPANISH__) || defined(__MMI_ZI_EU_SPANISH__) || defined(__MMI_ZI_SA_SPANISH__) ||defined(__MMI_CSTAR_SPANISH__)
        case INPUT_MODE_SMART_UPPERCASE_SPANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SPANISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_SPANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_spanish_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_SPANISH__) || defined(__MMI_ZI_EU_SPANISH__) || defined(__MMI_ZI_SA_SPANISH__) */ 
    #if defined(__MMI_T9_DANISH__) || defined(__MMI_ZI_DANISH__) ||defined(__MMI_CSTAR_DANISH__)
        case INPUT_MODE_SMART_UPPERCASE_DANISH: /* Danish-Vikas */
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_DANISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_DANISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_danish_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_DANISH__) || defined(__MMI_ZI_DANISH__) */ 
    #if defined(__MMI_T9_POLISH__) || defined(__MMI_ZI_POLISH__) ||defined(__MMI_CSTAR_POLISH__)
        case INPUT_MODE_SMART_UPPERCASE_POLISH: /* Polish-Vikas */
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_POLISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_POLISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_polish_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_POLISH__) || defined(__MMI_ZI_POLISH__) */ 
    #if defined(__MMI_T9_FRENCH__) || defined(__MMI_ZI_CA_FRENCH__) || defined(__MMI_ZI_EU_FRENCH__) ||defined(__MMI_CSTAR_FRENCH__)
        case INPUT_MODE_SMART_UPPERCASE_FRENCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_FRENCH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_FRENCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_french_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_FRENCH__) || defined(__MMI_ZI_CA_FRENCH__) || defined(__MMI_ZI_EU_FRENCH__) */ 
    #if defined(__MMI_T9_GERMAN__) || defined(__MMI_ZI_GERMAN__) ||defined(__MMI_CSTAR_GERMAN__)
        case INPUT_MODE_SMART_UPPERCASE_GERMAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_GERMAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_GERMAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_german_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_GERMAN__) || defined(__MMI_ZI_GERMAN__) */ 
    #if defined(__MMI_T9_ITALIAN__) || defined(__MMI_ZI_ITALIAN__) ||defined(__MMI_CSTAR_ITALIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ITALIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ITALIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_ITALIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_italian_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_ITALIAN__) || defined(__MMI_ZI_ITALIAN__) */ 
    #if defined (__MMI_T9_RUSSIAN__) || defined(__MMI_ZI_RUSSIAN__) || defined(__MMI_ZI_RECOMMENDED_SIZE_RUSSIAN__) ||defined(__MMI_CSTAR_RUSSIAN__)
        case INPUT_MODE_SMART_UPPERCASE_RUSSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_RUSSIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_RUSSIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_russian_STRING_ID);
            break;
    #endif /* defined (__MMI_T9_RUSSIAN__) || defined(__MMI_ZI_RUSSIAN__) || defined(__MMI_ZI_RECOMMENDED_SIZE_RUSSIAN__) */ 
    #if defined (__MMI_T9_BULGARIAN__) || defined(__MMI_ZI_BULGARIAN__) ||defined(__MMI_CSTAR_BULGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_BULGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_BULGARIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_BULGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_bulgarian_STRING_ID);
            break;
    #endif /* defined (__MMI_T9_BULGARIAN__) || defined(__MMI_ZI_BULGARIAN__) */ 
    #if defined (__MMI_T9_UKRAINIAN__) || defined(__MMI_ZI_UKRAINIAN__) ||defined(__MMI_CSTAR_UKRAINIAN__)
        case INPUT_MODE_SMART_UPPERCASE_UKRAINIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_UKRAINIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_UKRAINIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_L_UKRAINIAN_STRING_ID);
            break;
    #endif /* defined (__MMI_T9_UKRAINIAN__) || defined(__MMI_ZI_UKRAINIAN__) */ 
    #if defined(__MMI_ZI_TURKISH__) || defined(__MMI_T9_TURKISH__) ||defined(__MMI_CSTAR_TURKISH__)
        case INPUT_MODE_SMART_UPPERCASE_TURKISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_TURKISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_TURKISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_turkish_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_TURKISH__) || defined(__MMI_T9_TURKISH__) */ 
    #if defined(__MMI_T9_PORTUGUESE__) || defined(__MMI_ZI_EU_PORTUGUESE__) || defined(__MMI_ZI_SA_PORTUGUESE__) || defined(__MMI_ZI_BZ_PORTUGUESE__) ||defined(__MMI_CSTAR_PORTUGUESE__)
        case INPUT_MODE_SMART_UPPERCASE_PORTUGUESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_PORTUGUESE_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_PORTUGUESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_portuguese_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_PORTUGUESE__) || defined(__MMI_ZI_EU_PORTUGUESE__) || defined(__MMI_ZI_SA_PORTUGUESE__) || defined(__MMI_ZI_BZ_PORTUGUESE__) */ 
    #if defined(__MMI_ZI_INDONESIAN__) || defined(__MMI_T9_INDONESIAN__) ||defined(__MMI_CSTAR_INDONESIAN__)
        case INPUT_MODE_SMART_UPPERCASE_INDONESIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_INDONESIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_INDONESIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_indonesian_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_INDONESIAN__) || defined(__MMI_T9_INDONESIAN__) */ 
    #if defined(__MMI_ZI_MALAY__) || defined(__MMI_T9_MALAY__) ||defined(__MMI_CSTAR_MALAY__)
        case INPUT_MODE_SMART_UPPERCASE_MALAY:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_MALAY_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_MALAY:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_malay_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_MALAY__) || defined(__MMI_T9_MALAY__) */ 

    #if defined(__MMI_ZI_VIETNAMESE__) || defined(__MMI_T9_VIETNAMESE__) ||defined(__MMI_CSTAR_VIETNAMESE__)
        case INPUT_MODE_SMART_UPPERCASE_VIETNAMESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_VIETNAMESE_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_VIETNAMESE:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_vietnamese_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_VIETNAMESE__) || defined(__MMI_T9_VIETNAMESE__) */ 
    #if defined(__MMI_ZI_CZECH__) || defined(__MMI_T9_CZECH__) ||defined(__MMI_CSTAR_CZECH__)
        case INPUT_MODE_SMART_UPPERCASE_CZECH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_CZECH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_CZECH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_czech_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_CZECH__) || defined(__MMI_T9_CZECH__) */ 
    #if defined(__MMI_T9_FINNISH__) || defined(__MMI_ZI_FINNISH__) ||defined(__MMI_CSTAR_FINNISH__)
        case INPUT_MODE_SMART_UPPERCASE_FINNISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_FINNISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_FINNISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_finnish_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_FINNISH__) || defined(__MMI_ZI_FINNISH__) */ 
    #if defined(__MMI_ZI_HUNGARIAN__) || defined(__MMI_T9_HUNGARIAN__) ||defined(__MMI_CSTAR_HUNGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_HUNGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_HUNGARIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_HUNGARIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_hungarian_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_HUNGARIAN__) || defined(__MMI_T9_HUNGARIAN__) */ 
    #if defined(__MMI_T9_SLOVAK__) || defined(__MMI_ZI_SLOVAK__) ||defined(__MMI_CSTAR_SLOVAK__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVAK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SLOVAK_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_SLOVAK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_slovak_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_SLOVAK__) || defined(__MMI_ZI_SLOVAK__) */ 
    #if defined(__MMI_ZI_DUTCH__) || defined(__MMI_T9_DUTCH__) ||defined(__MMI_CSTAR_DUTCH__)
        case INPUT_MODE_SMART_UPPERCASE_DUTCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_DUTCH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_DUTCH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_dutch_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_DUTCH__) || defined(__MMI_T9_DUTCH__) */ 
    #if defined(__MMI_T9_NORWEGIAN__) || defined(__MMI_ZI_NORWEGIAN__) ||defined(__MMI_CSTAR_NORWEGIAN__)
        case INPUT_MODE_SMART_UPPERCASE_NORWEGIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_NORWEGIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_NORWEGIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_norwegian_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_NORWEGIAN__) || defined(__MMI_ZI_NORWEGIAN__) */ 
    #if defined(__MMI_T9_SWEDISH__) || defined(__MMI_ZI_SWEDISH__) ||defined(__MMI_CSTAR_SWEDISH__)
        case INPUT_MODE_SMART_UPPERCASE_SWEDISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SWEDISH_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_SWEDISH:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_swedish_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_SWEDISH__) || defined(__MMI_ZI_SWEDISH__) */ 
    #if defined(__MMI_T9_CROATIAN__) || defined(__MMI_ZI_CROATIAN__) ||defined(__MMI_CSTAR_CROATIAN__)
        case INPUT_MODE_SMART_UPPERCASE_CROATIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_CROATIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_CROATIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_croatian_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_CROATIAN__) || defined(__MMI_ZI_CROATIAN__) */ 
    #if defined(__MMI_ZI_ROMANIAN__) || defined(__MMI_T9_ROMANIAN__) ||defined(__MMI_CSTAR_ROMANIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ROMANIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_ROMANIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_ROMANIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_romanian_STRING_ID);
            break;
    #endif /* defined(__MMI_ZI_ROMANIAN__) || defined(__MMI_T9_ROMANIAN__) */ 
    #if defined(__MMI_T9_SLOVENIAN__) || defined(__MMI_ZI_SLOVENIAN__) ||defined(__MMI_CSTAR_SLOVENIAN__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVENIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_SLOVENIAN_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_SLOVENIAN:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_slovenian_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_SLOVENIAN__) || defined(__MMI_ZI_SLOVENIAN__) */ 
    #if defined(__MMI_T9_GREEK__) || defined(__MMI_ZI_GREEK__) ||defined(__MMI_CSTAR_GREEK__)
        case INPUT_MODE_SMART_UPPERCASE_GREEK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_GREEK_STRING_ID);
            break;
        case INPUT_MODE_SMART_LOWERCASE_GREEK:
            inputmode_string = (UI_string_type) get_string(WGUI_CATEGORY_greek_STRING_ID);
            break;
    #endif /* defined(__MMI_T9_GREEK__) || defined(__MMI_ZI_GREEK__) */ 
    }

    gui_set_font(f);
    gui_set_text_color(c);
    gui_reset_text_clip();
    x = 1;
#if defined(__MMI_T9__) || defined(__MMI_ITAP__) || defined(__MMI_KA__) || defined(__MMI_CSTAR__)
    if (wgui_EMS_inputbox_information_icon == NULL)
    {
        /* MTK Elvis for R2L characters */
        if (!r2lMMIFlag)
        {
            x = 2;
        }
        else
        {
            x = UI_device_width - 2;
        }
        /* MTK end */
    }
    else
    {
        /* MTK Elvis for R2L characters */
        gui_measure_image(wgui_EMS_inputbox_information_icon, &width, &height);
        if (!r2lMMIFlag)
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + 1,
                wgui_EMS_inputbox_information_icon,
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                wgui_EMS_inputbox_information_icon,
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = width + 2;
        }
        else
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + 1,
                wgui_EMS_inputbox_information_icon,
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                wgui_EMS_inputbox_information_icon,
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = UI_device_width - 2 - width;
        }
        /* MTK end */

    }
#elif defined(__MMI_ZI__)
    if (wgui_EMS_inputbox_information_icon == NULL)
    {
        /* MTK Elvis for R2L characters */
        if (!r2lMMIFlag)
        {
            x = 2;
        }
        else
        {
            x = UI_device_width - 2;
        }
        /* MTK end */
    }
    else
    {

        /* MTK Elvis for R2L characters */
        gui_measure_image(get_image(WGUI_INPUT_INFORMATION_ICON1), &width, &height);
        if (!r2lMMIFlag)
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + 1,
                get_image(WGUI_INPUT_INFORMATION_ICON1),
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                get_image(WGUI_INPUT_INFORMATION_ICON1),
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = width + 2;

        }
        else
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + 1,
                get_image(WGUI_INPUT_INFORMATION_ICON1),
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                get_image(WGUI_INPUT_INFORMATION_ICON1),
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = UI_device_width - 2 - width;

        }
        /* MTK end */

    }
#else 
    if (wgui_EMS_inputbox_information_icon == NULL)
    {
        /* MTK Elvis for R2L characters */
        if (!r2lMMIFlag)
        {
            x = 2;
        }
        else
        {
            x = UI_device_width - 2;
        }
        /* MTK end */
    }
    else
    {
        /* MTK Elvis for R2L characters */
        gui_measure_image(wgui_EMS_inputbox_information_icon, &width, &height);
        if (!r2lMMIFlag)
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + 1,
                wgui_EMS_inputbox_information_icon,
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                x,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                wgui_EMS_inputbox_information_icon,
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = width + 2;

        }
        else
        {
        #if !defined(__MMI_TOUCH_SCREEN__)
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + 1,
                wgui_EMS_inputbox_information_icon,
                0);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_show_transparent_image(
                UI_device_width - 1 - width,
                wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                wgui_EMS_inputbox_information_icon,
                0);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            x = UI_device_width - 2 - width;

        }
        /* MTK end */

    }
#endif 
#if defined(__MMI_TOUCH_SCREEN__)
    /*  3 is from display icon shift position by adjusting x value
     *  4 is draw rectangle width in touch screen case
     *  
     */
    wgui_information_bar_input_mode_display_width = width + 7;
    wgui_information_bar_input_mode_display_height = height;
    gui_measure_string(inputmode_string, &width, &height);
    #ifdef __MMI_T9__
    /*  T9 chinese input mode uses icon instead of inputmode_string and
     *  no need to adjust x value ,so previous +7 ,now -7
     */
    if(width == 0) 
    {
        wgui_information_bar_input_mode_display_width -= 7;
    }
    #endif
    rect_height = gui_get_character_height();
    wgui_information_bar_input_mode_display_width += width;
    if(rect_height > wgui_information_bar_input_mode_display_height)
    {
        wgui_information_bar_input_mode_display_height = rect_height;
    } 
#endif /* defined(__MMI_TOUCH_SCREEN__) */ 

    switch (MMI_current_input_mode)
    {
        case INPUT_MODE_MULTITAP_UPPERCASE_ABC:
        case INPUT_MODE_MULTITAP_LOWERCASE_ABC:
    #if defined(__MMI_MULTITAP_THAI__)
        case INPUT_MODE_MULTITAP_THAI:
    #endif 
    #if defined(__MMI_MULTITAP_SPANISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SPANISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_SPANISH:
    #endif /* defined(__MMI_MULTITAP_SPANISH__) */ 
    #if defined(__MMI_MULTITAP_DANISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_DANISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_DANISH:
    #endif /* defined(__MMI_MULTITAP_DANISH__) */ 
    #if defined(__MMI_MULTITAP_POLISH__)    /* Polish-Vikas */
        case INPUT_MODE_MULTITAP_UPPERCASE_POLISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_POLISH:
    #endif /* defined(__MMI_MULTITAP_POLISH__) */ 
    #if defined(__MMI_MULTITAP_FRENCH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_FRENCH:
        case INPUT_MODE_MULTITAP_LOWERCASE_FRENCH:
    #endif /* defined(__MMI_MULTITAP_FRENCH__) */ 
    #if defined(__MMI_MULTITAP_GERMAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_GERMAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_GERMAN:
    #endif /* defined(__MMI_MULTITAP_GERMAN__) */ 
    #if defined(__MMI_MULTITAP_ITALIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_ITALIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_ITALIAN:
    #endif /* defined(__MMI_MULTITAP_ITALIAN__) */ 
    #if defined(__MMI_MULTITAP_RUSSIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_RUSSIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_RUSSIAN:
    #endif /* defined(__MMI_MULTITAP_RUSSIAN__) */ 
    #if defined(__MMI_MULTITAP_BULGARIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_BULGARIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_BULGARIAN:
    #endif /* defined(__MMI_MULTITAP_BULGARIAN__) */ 
    #if defined(__MMI_MULTITAP_UKRAINIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_UKRAINIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_UKRAINIAN:
    #endif /* defined(__MMI_MULTITAP_UKRAINIAN__) */ 
    #if defined(__MMI_MULTITAP_TURKISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_TURKISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_TURKISH:
    #endif /* defined(__MMI_MULTITAP_TURKISH__) */ 
    #if defined(__MMI_MULTITAP_PORTUGUESE__)
        case INPUT_MODE_MULTITAP_UPPERCASE_PORTUGUESE:
        case INPUT_MODE_MULTITAP_LOWERCASE_PORTUGUESE:
    #endif /* defined(__MMI_MULTITAP_PORTUGUESE__) */ 
    #if defined(__MMI_MULTITAP_HINDI__)
        case INPUT_MODE_MULTITAP_HINDI:
    #endif 

    #if defined(__MMI_MULTITAP_MARATHI__)
        case INPUT_MODE_MULTITAP_MARATHI:
    #endif 
	#if defined (__MMI_MULTITAP_TAMIL__) 
        case INPUT_MODE_MULTITAP_TAMIL:
    #endif 
    #if defined(__MMI_MULTITAP_BENGALI__)
        case INPUT_MODE_MULTITAP_BENGALI:
    #endif 

	#if defined (__MMI_MULTITAP_PUNJABI__) 
        case INPUT_MODE_MULTITAP_PUNJABI:
    #endif
    #if defined (__MMI_MULTITAP_TELUGU__) 
        case INPUT_MODE_MULTITAP_TELUGU:
    #endif
    #if defined(__MMI_MULTITAP_INDONESIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_INDONESIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_INDONESIAN:
    #endif /* defined(__MMI_MULTITAP_INDONESIAN__) */ 
    #if defined(__MMI_MULTITAP_CZECH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_CZECH:
        case INPUT_MODE_MULTITAP_LOWERCASE_CZECH:
    #endif /* defined(__MMI_MULTITAP_CZECH__) */ 
    #if defined(__MMI_MULTITAP_MALAY__)
        case INPUT_MODE_MULTITAP_UPPERCASE_MALAY:
        case INPUT_MODE_MULTITAP_LOWERCASE_MALAY:
    #endif /* defined(__MMI_MULTITAP_MALAY__) */ 
    #if defined(__MMI_MULTITAP_VIETNAMESE__)
        case INPUT_MODE_MULTITAP_UPPERCASE_VIETNAMESE:
        case INPUT_MODE_MULTITAP_LOWERCASE_VIETNAMESE:
    #endif /* defined(__MMI_MULTITAP_VIETNAMESE__) */ 
    #if defined(__MMI_MULTITAP_FINNISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_FINNISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_FINNISH:
    #endif /* defined(__MMI_MULTITAP_FINNISH__) */ 
    #if defined(__MMI_MULTITAP_HUNGARIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_HUNGARIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_HUNGARIAN:
    #endif /* defined(__MMI_MULTITAP_HUNGARIAN__) */ 
    #if defined(__MMI_MULTITAP_HEBREW__)
        case INPUT_MODE_MULTITAP_HEBREW:
    #endif 
    #if defined(__MMI_MULTITAP_SLOVAK__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SLOVAK:
        case INPUT_MODE_MULTITAP_LOWERCASE_SLOVAK:
    #endif /* defined(__MMI_MULTITAP_SLOVAK__) */ 
    #if defined(__MMI_MULTITAP_DUTCH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_DUTCH:
        case INPUT_MODE_MULTITAP_LOWERCASE_DUTCH:
    #endif /* defined(__MMI_MULTITAP_DUTCH__) */ 
    #if defined(__MMI_MULTITAP_NORWEGIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_NORWEGIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_NORWEGIAN:
    #endif /* defined(__MMI_MULTITAP_NORWEGIAN__) */ 
    #if defined(__MMI_MULTITAP_ARABIC__)
        case INPUT_MODE_MULTITAP_ARABIC:
    #endif 
    #if defined(__MMI_MULTITAP_ARABIC__)
        case INPUT_MODE_ARABIC_NUMERIC:
    #endif 
    #if defined(__MMI_MULTITAP_PERSIAN__)
        case INPUT_MODE_MULTITAP_PERSIAN:
    #endif 
    #if defined(__MMI_MULTITAP_URDU__)
        case INPUT_MODE_MULTITAP_URDU:
    #endif 
    #if defined(__MMI_MULTITAP_SWEDISH__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SWEDISH:
        case INPUT_MODE_MULTITAP_LOWERCASE_SWEDISH:
    #endif /* defined(__MMI_MULTITAP_SWEDISH__) */ 
    #if defined(__MMI_MULTITAP_CROATIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_CROATIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_CROATIAN:
    #endif /* defined(__MMI_MULTITAP_CROATIAN__) */ 
    #if defined(__MMI_MULTITAP_ROMANIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_ROMANIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_ROMANIAN:
    #endif /* defined(__MMI_MULTITAP_ROMANIAN__) */ 
    #if defined(__MMI_MULTITAP_SLOVENIAN__)
        case INPUT_MODE_MULTITAP_UPPERCASE_SLOVENIAN:
        case INPUT_MODE_MULTITAP_LOWERCASE_SLOVENIAN:
    #endif /* defined(__MMI_MULTITAP_SLOVENIAN__) */ 
    #if defined(__MMI_MULTITAP_GREEK__)
        case INPUT_MODE_MULTITAP_UPPERCASE_GREEK:
        case INPUT_MODE_MULTITAP_LOWERCASE_GREEK:
    #endif /* defined(__MMI_MULTITAP_GREEK__) */ 
        case INPUT_MODE_123:
        #if !defined(__MMI_TOUCH_SCREEN__)
                gui_move_text_cursor(wgui_EMS_inputbox_information_bar_x + x, wgui_EMS_inputbox_information_bar_y + 3);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
            {
                gui_draw_filled_area(
                    wgui_EMS_inputbox_information_bar_x + x + 2,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - rect_height) / 2 - 1,
                    wgui_EMS_inputbox_information_bar_x + x + 4 + width,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height + rect_height) / 2,
                    &information_bar_BG_filler);
                gui_move_text_cursor(
                    wgui_EMS_inputbox_information_bar_x + x + 3,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2);
            }
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_print_text(inputmode_string);
            break;
        #if defined (__MMI_T9__) || defined (__MMI_CSTAR__) || defined(__MMI_ITAP__) || defined(__MMI_KA__)
        case INPUT_MODE_SMART_UPPERCASE_ABC:
        case INPUT_MODE_SMART_LOWERCASE_ABC:
    #if defined(__MMI_SMART_FIRST_UPPERCASE_ABC__)
        case INPUT_MODE_SMART_FIRST_UPPERCASE_ABC:
    #endif
        #if defined(__MMI_T9_SPANISH__) || defined(__MMI_CSTAR_SPANISH__)
        case INPUT_MODE_SMART_UPPERCASE_SPANISH:
        case INPUT_MODE_SMART_LOWERCASE_SPANISH:
        #endif /* defined(__MMI_T9_SPANISH__) || defined(__MMI_CSTAR_SPANISH__) */ 
        #if defined(__MMI_T9_DANISH__) || defined(__MMI_CSTAR_DANISH__)
        case INPUT_MODE_SMART_UPPERCASE_DANISH:
        case INPUT_MODE_SMART_LOWERCASE_DANISH:
        #endif /* defined(__MMI_T9_DANISH__) || defined(__MMI_CSTAR_DANISH__) */ 
        #if defined(__MMI_T9_POLISH__) || defined(__MMI_CSTAR_POLISH__)
        case INPUT_MODE_SMART_UPPERCASE_POLISH:
        case INPUT_MODE_SMART_LOWERCASE_POLISH:
        #endif /* defined(__MMI_T9_POLISH__) || defined(__MMI_CSTAR_POLISH__) */ 
            /* PMT CZ_PO_TU END 20050812 */
        #if defined(__MMI_T9_FRENCH__) || defined(__MMI_CSTAR_FRENCH__)
        case INPUT_MODE_SMART_UPPERCASE_FRENCH:
        case INPUT_MODE_SMART_LOWERCASE_FRENCH:
        #endif /* defined(__MMI_T9_FRENCH__) || defined(__MMI_CSTAR_FRENCH__) */ 
        #if defined(__MMI_T9_GERMAN__) || defined(__MMI_CSTAR_GERMAN__)
        case INPUT_MODE_SMART_UPPERCASE_GERMAN:
        case INPUT_MODE_SMART_LOWERCASE_GERMAN:
        #endif /* defined(__MMI_T9_GERMAN__) || defined(__MMI_CSTAR_GERMAN__) */ 
        #if defined(__MMI_T9_ITALIAN__) || defined(__MMI_CSTAR_ITALIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ITALIAN:
        case INPUT_MODE_SMART_LOWERCASE_ITALIAN:
        #endif /* defined(__MMI_T9_ITALIAN__) || defined(__MMI_CSTAR_ITALIAN__) */ 
        #if defined(__MMI_T9_VIETNAMESE__) || defined(__MMI_CSTAR_VIETNAMESE__)
        case INPUT_MODE_SMART_UPPERCASE_VIETNAMESE:
        case INPUT_MODE_SMART_LOWERCASE_VIETNAMESE:
        #endif /* defined(__MMI_T9_VIETNAMESE__) || defined(__MMI_CSTAR_VIETNAMESE__) */ 
        #if defined(__MMI_T9_TURKISH__) || defined(__MMI_CSTAR_TURKISH__)
        case INPUT_MODE_SMART_UPPERCASE_TURKISH:
        case INPUT_MODE_SMART_LOWERCASE_TURKISH:
        #endif /* defined(__MMI_T9_TURKISH__) || defined(__MMI_CSTAR_TURKISH__) */ 
        #if defined(__MMI_T9_INDONESIAN__) || defined(__MMI_CSTAR_INDONESIAN__)
        case INPUT_MODE_SMART_UPPERCASE_INDONESIAN:
        case INPUT_MODE_SMART_LOWERCASE_INDONESIAN:
        #endif /* defined(__MMI_T9_INDONESIAN__) || defined(__MMI_CSTAR_INDONESIAN__) */ 
        #if defined(__MMI_T9_CZECH__) || defined(__MMI_CSTAR_CZECH__)
        case INPUT_MODE_SMART_UPPERCASE_CZECH:
        case INPUT_MODE_SMART_LOWERCASE_CZECH:
        #endif /* defined(__MMI_T9_CZECH__) || defined(__MMI_CSTAR_CZECH__) */ 
        #if defined(__MMI_T9_THAI__) || defined(__MMI_CSTAR_THAI__)
        case INPUT_MODE_SMART_THAI:
        #endif 
        #if defined(__MMI_T9_RUSSIAN__) || defined(__MMI_CSTAR_RUSSIAN__)
        case INPUT_MODE_SMART_UPPERCASE_RUSSIAN:
        case INPUT_MODE_SMART_LOWERCASE_RUSSIAN:
        #endif /* defined(__MMI_T9_RUSSIAN__) || defined(__MMI_CSTAR_RUSSIAN__) */ 
        #if defined(__MMI_T9_BULGARIAN__) || defined(__MMI_CSTAR_BULGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_BULGARIAN:
        case INPUT_MODE_SMART_LOWERCASE_BULGARIAN:
        #endif /* defined(__MMI_T9_BULGARIAN__) || defined(__MMI_CSTAR_BULGARIAN__) */ 
        #if defined(__MMI_T9_PORTUGUESE__) || defined(__MMI_CSTAR_PORTUGUESE__)
        case INPUT_MODE_SMART_UPPERCASE_PORTUGUESE:
        case INPUT_MODE_SMART_LOWERCASE_PORTUGUESE:
        #endif /* defined(__MMI_T9_PORTUGUESE__) || defined(__MMI_CSTAR_PORTUGUESE__) */ 
        #if defined(__MMI_T9_FINNISH__) || defined(__MMI_CSTAR_FINNISH__)
        case INPUT_MODE_SMART_UPPERCASE_FINNISH:
        case INPUT_MODE_SMART_LOWERCASE_FINNISH:
        #endif /* defined(__MMI_T9_FINNISH__) || defined(__MMI_CSTAR_FINNISH__) */ 
        #if defined(__MMI_T9_HUNGARIAN__) || defined(__MMI_CSTAR_HUNGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_HUNGARIAN:
        case INPUT_MODE_SMART_LOWERCASE_HUNGARIAN:
        #endif /* defined(__MMI_T9_HUNGARIAN__) || defined(__MMI_CSTAR_HUNGARIAN__) */ 
        #if defined(__MMI_T9_ARABIC__) || defined(__MMI_CSTAR_ARABIC__)
        case INPUT_MODE_SMART_ARABIC:
        #endif 
        #if defined(__MMI_T9_HINDI__) || defined(__MMI_CSTAR_HINDI__)
        case INPUT_MODE_SMART_HINDI:
        #endif 
        #if defined(__MMI_T9_NORWEGIAN__) || defined(__MMI_CSTAR_NORWEGIAN__)
        case INPUT_MODE_SMART_UPPERCASE_NORWEGIAN:
        case INPUT_MODE_SMART_LOWERCASE_NORWEGIAN:
        #endif /* defined(__MMI_T9_NORWEGIAN__) || defined(__MMI_CSTAR_NORWEGIAN__) */ 
        #if defined(__MMI_T9_DUTCH__) || defined(__MMI_CSTAR_DUTCH__)
        case INPUT_MODE_SMART_UPPERCASE_DUTCH:
        case INPUT_MODE_SMART_LOWERCASE_DUTCH:
        #endif /* defined(__MMI_T9_DUTCH__) || defined(__MMI_CSTAR_DUTCH__) */ 
        #if defined(__MMI_T9_SLOVENIAN__) || defined(__MMI_CSTAR_SLOVENIAN__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVENIAN:
        case INPUT_MODE_SMART_LOWERCASE_SLOVENIAN:
        #endif /* defined(__MMI_T9_SLOVENIAN__) || defined(__MMI_CSTAR_SLOVENIAN__) */ 
        #if defined(__MMI_T9_SWEDISH__) || defined(__MMI_CSTAR_SWEDISH__)
        case INPUT_MODE_SMART_UPPERCASE_SWEDISH:
        case INPUT_MODE_SMART_LOWERCASE_SWEDISH:
        #endif /* defined(__MMI_T9_SWEDISH__) || defined(__MMI_CSTAR_SWEDISH__) */ 
        #if defined(__MMI_T9_GREEK__) || defined(__MMI_CSTAR_GREEK__)
        case INPUT_MODE_SMART_UPPERCASE_GREEK:
        case INPUT_MODE_SMART_LOWERCASE_GREEK:
        #endif /* defined(__MMI_T9_GREEK__) || defined(__MMI_CSTAR_GREEK__) */ 
        #if defined(__MMI_T9_HEBREW__) || defined(__MMI_CSTAR_HEBREW__)
        case INPUT_MODE_SMART_HEBREW:
        #endif 
        #if defined(__MMI_T9_MALAY__) || defined(__MMI_CSTAR_MALAY__)
        case INPUT_MODE_SMART_UPPERCASE_MALAY:
        case INPUT_MODE_SMART_LOWERCASE_MALAY:
        #endif /* defined(__MMI_T9_MALAY__) || defined(__MMI_CSTAR_MALAY__) */ 
        #if defined(__MMI_T9_CROATIAN__) || defined(__MMI_CSTAR_CROATIAN__)
        case INPUT_MODE_SMART_UPPERCASE_CROATIAN:
        case INPUT_MODE_SMART_LOWERCASE_CROATIAN:
        #endif /* defined(__MMI_T9_CROATIAN__) || defined(__MMI_CSTAR_CROATIAN__) */ 
        #if defined(__MMI_T9_SLOVAK__) || defined(__MMI_CSTAR_SLOVAK__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVAK:
        case INPUT_MODE_SMART_LOWERCASE_SLOVAK:
        #endif /* defined(__MMI_T9_SLOVAK__) || defined(__MMI_CSTAR_SLOVAK__) */ 
        #if defined(__MMI_T9_ROMANIAN__) || defined(__MMI_CSTAR_ROMANIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ROMANIAN:
        case INPUT_MODE_SMART_LOWERCASE_ROMANIAN:
        #endif /* defined(__MMI_T9_ROMANIAN__) || defined(__MMI_CSTAR_ROMANIAN__) */ 
        #if !defined(__MMI_TOUCH_SCREEN__)
                gui_move_text_cursor(wgui_EMS_inputbox_information_bar_x + x, wgui_EMS_inputbox_information_bar_y + 3);
        #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                gui_move_text_cursor(
                    wgui_EMS_inputbox_information_bar_x + x,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2);
        #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
            gui_print_text(inputmode_string);
            break;

     #elif defined(__MMI_CSTAR__)
                case INPUT_MODE_SMART_UPPERCASE_ABC:
                case INPUT_MODE_SMART_LOWERCASE_ABC:
    #if defined(__MMI_SMART_FIRST_UPPERCASE_ABC__)
                case INPUT_MODE_SMART_FIRST_UPPERCASE_ABC:
    #endif
    #if defined(__MMI_CSTAR_SPANISH__)
                case INPUT_MODE_SMART_UPPERCASE_SPANISH:
                case INPUT_MODE_SMART_LOWERCASE_SPANISH:
    #endif /* defined(__MMI_CSTAR_SPANISH__) */ 
    #if defined(__MMI_CSTAR_DANISH__)
                case INPUT_MODE_SMART_UPPERCASE_DANISH:
                case INPUT_MODE_SMART_LOWERCASE_DANISH:
    #endif /* defined(__MMI_CSTAR_DANISH__) */ 
    #if defined(__MMI_CSTAR_POLISH__)
                case INPUT_MODE_SMART_UPPERCASE_POLISH:
                case INPUT_MODE_SMART_LOWERCASE_POLISH:
    #endif /* defined(__MMI_CSTAR_POLISH__) */ 
    #if defined(__MMI_CSTAR_FRENCH__)
                case INPUT_MODE_SMART_UPPERCASE_FRENCH:
                case INPUT_MODE_SMART_LOWERCASE_FRENCH:
    #endif /* defined(__MMI_CSTAR_FRENCH__) */ 
    #if defined(__MMI_CSTAR_GERMAN__)
                case INPUT_MODE_SMART_UPPERCASE_GERMAN:
                case INPUT_MODE_SMART_LOWERCASE_GERMAN:
    #endif /* defined(__MMI_CSTAR_GERMAN__) */ 
    #if defined(__MMI_CSTAR_ITALIAN__)
                case INPUT_MODE_SMART_UPPERCASE_ITALIAN:
                case INPUT_MODE_SMART_LOWERCASE_ITALIAN:
    #endif /* defined(__MMI_CSTAR_ITALIAN__) */ 
    #if defined(__MMI_CSTAR_VIETNAMESE__)
                case INPUT_MODE_SMART_UPPERCASE_VIETNAMESE:
                case INPUT_MODE_SMART_LOWERCASE_VIETNAMESE:
    #endif /* defined(__MMI_CSTAR_VIETNAMESE__) */ 
    #if defined(__MMI_CSTAR_TURKISH__)
                case INPUT_MODE_SMART_UPPERCASE_TURKISH:
                case INPUT_MODE_SMART_LOWERCASE_TURKISH:
    #endif /* defined(__MMI_CSTAR_TURKISH__) */ 
    #if defined(__MMI_CSTAR_INDONESIAN__)
                case INPUT_MODE_SMART_UPPERCASE_INDONESIAN:
                case INPUT_MODE_SMART_LOWERCASE_INDONESIAN:
    #endif /* defined(__MMI_CSTAR_INDONESIAN__) */ 
    #if defined(__MMI_CSTAR_CZECH__)
                case INPUT_MODE_SMART_UPPERCASE_CZECH:
                case INPUT_MODE_SMART_LOWERCASE_CZECH:
    #endif /* defined(__MMI_CSTAR_CZECH__) */ 
    #if defined(__MMI_CSTAR_THAI__)
                case INPUT_MODE_SMART_THAI:
    #endif 
    #if defined(__MMI_CSTAR_RUSSIAN__)
                case INPUT_MODE_SMART_UPPERCASE_RUSSIAN:
                case INPUT_MODE_SMART_LOWERCASE_RUSSIAN:
    #endif /* defined(__MMI_CSTAR_RUSSIAN__) */ 
    #if defined(__MMI_CSTAR_BULGARIAN__)
                case INPUT_MODE_SMART_UPPERCASE_BULGARIAN:
                case INPUT_MODE_SMART_LOWERCASE_BULGARIAN:
    #endif /* defined(__MMI_CSTAR_BULGARIAN__) */ 
    #if defined(__MMI_CSTAR_PORTUGUESE__)
                case INPUT_MODE_SMART_UPPERCASE_PORTUGUESE:
                case INPUT_MODE_SMART_LOWERCASE_PORTUGUESE:
    #endif /* defined(__MMI_CSTAR_PORTUGUESE__) */ 
    #if defined(__MMI_CSTAR_FINNISH__)
                case INPUT_MODE_SMART_UPPERCASE_FINNISH:
                case INPUT_MODE_SMART_LOWERCASE_FINNISH:
    #endif /* defined(__MMI_CSTAR_FINNISH__) */ 
    #if defined(__MMI_CSTAR_HUNGARIAN__)
                case INPUT_MODE_SMART_UPPERCASE_HUNGARIAN:
                case INPUT_MODE_SMART_LOWERCASE_HUNGARIAN:
    #endif /* defined(__MMI_CSTAR_HUNGARIAN__) */ 
    #if defined(__MMI_CSTAR_ARABIC__)
                case INPUT_MODE_SMART_ARABIC:
    #endif 
    #if defined(__MMI_CSTAR_HINDI__)
                case INPUT_MODE_SMART_HINDI:
    #endif 
    #if defined(__MMI_CSTAR_NORWEGIAN__)
                case INPUT_MODE_SMART_UPPERCASE_NORWEGIAN:
                case INPUT_MODE_SMART_LOWERCASE_NORWEGIAN:
    #endif /* defined(__MMI_CSTAR_NORWEGIAN__) */ 
    #if defined(__MMI_CSTAR_DUTCH__)
                case INPUT_MODE_SMART_UPPERCASE_DUTCH:
                case INPUT_MODE_SMART_LOWERCASE_DUTCH:
    #endif /* defined(__MMI_CSTAR_DUTCH__) */ 
    #if defined(__MMI_CSTAR_SLOVENIAN__)
                case INPUT_MODE_SMART_UPPERCASE_SLOVENIAN:
                case INPUT_MODE_SMART_LOWERCASE_SLOVENIAN:
    #endif /* defined(__MMI_CSTAR_SLOVENIAN__) */ 
    #if defined(__MMI_CSTAR_SWEDISH__)
                case INPUT_MODE_SMART_UPPERCASE_SWEDISH:
                case INPUT_MODE_SMART_LOWERCASE_SWEDISH:
    #endif /* defined(__MMI_CSTAR_SWEDISH__) */ 
    #if defined(__MMI_CSTAR_GREEK__)
                case INPUT_MODE_SMART_UPPERCASE_GREEK:
                case INPUT_MODE_SMART_LOWERCASE_GREEK:
    #endif /* defined(__MMI_CSTAR_GREEK__) */ 
    #if defined(__MMI_CSTAR_HEBREW__)
                case INPUT_MODE_SMART_HEBREW:
    #endif 
    #if defined(__MMI_CSTAR_MALAY__)
                case INPUT_MODE_SMART_UPPERCASE_MALAY:
                case INPUT_MODE_SMART_LOWERCASE_MALAY:
    #endif /* defined(__MMI_CSTAR_MALAY__) */ 
    #if defined(__MMI_CSTAR_CROATIAN__)
                case INPUT_MODE_SMART_UPPERCASE_CROATIAN:
                case INPUT_MODE_SMART_LOWERCASE_CROATIAN:
    #endif /* defined(__MMI_CSTAR_CROATIAN__) */ 
    #if defined(__MMI_CSTAR_SLOVAK__)
                case INPUT_MODE_SMART_UPPERCASE_SLOVAK:
                case INPUT_MODE_SMART_LOWERCASE_SLOVAK:
    #endif /* defined(__MMI_CSTAR_SLOVAK__) */ 
    #if defined(__MMI_CSTAR_ROMANIAN__)
                case INPUT_MODE_SMART_UPPERCASE_ROMANIAN:
                case INPUT_MODE_SMART_LOWERCASE_ROMANIAN:
    #endif /* defined(__MMI_CSTAR_ROMANIAN__) */ 
    #if !defined(__MMI_TOUCH_SCREEN__)
                        gui_move_text_cursor(wgui_EMS_inputbox_information_bar_x + x, wgui_EMS_inputbox_information_bar_y + 3);
    #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                        gui_move_text_cursor(
                            wgui_EMS_inputbox_information_bar_x + x,
                            wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2);
    #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_print_text(inputmode_string);
                    break;

        #elif defined(__MMI_ZI__)
        case INPUT_MODE_SMART_UPPERCASE_ABC:
        case INPUT_MODE_SMART_LOWERCASE_ABC:
    #if defined(__MMI_SMART_FIRST_UPPERCASE_ABC__)
        case INPUT_MODE_SMART_FIRST_UPPERCASE_ABC:
    #endif
        #if defined(__MMI_ZI_EU_SPANISH__) || defined(__MMI_ZI_SA_SPANISH__)
        case INPUT_MODE_SMART_UPPERCASE_SPANISH:
        case INPUT_MODE_SMART_LOWERCASE_SPANISH:
        #endif /* defined(__MMI_ZI_EU_SPANISH__) || defined(__MMI_ZI_SA_SPANISH__) */ 
        #if defined(__MMI_ZI_DANISH__)
        case INPUT_MODE_SMART_UPPERCASE_DANISH:
        case INPUT_MODE_SMART_LOWERCASE_DANISH:
        #endif /* defined(__MMI_ZI_DANISH__) */ 
        #if defined(__MMI_ZI_POLISH__)
        case INPUT_MODE_SMART_UPPERCASE_POLISH:
        case INPUT_MODE_SMART_LOWERCASE_POLISH:
        #endif /* defined(__MMI_ZI_POLISH__) */ 
        #if defined(__MMI_ZI_NORWEGIAN__)
        case INPUT_MODE_SMART_UPPERCASE_NORWEGIAN:
        case INPUT_MODE_SMART_LOWERCASE_NORWEGIAN:
        #endif /* defined(__MMI_ZI_NORWEGIAN__) */ 
        #if defined(__MMI_ZI_CA_FRENCH__) || defined(__MMI_ZI_EU_FRENCH__)
        case INPUT_MODE_SMART_UPPERCASE_FRENCH:
        case INPUT_MODE_SMART_LOWERCASE_FRENCH:
        #endif /* defined(__MMI_ZI_CA_FRENCH__) || defined(__MMI_ZI_EU_FRENCH__) */ 
        #if defined(__MMI_ZI_GERMAN__)
        case INPUT_MODE_SMART_UPPERCASE_GERMAN:
        case INPUT_MODE_SMART_LOWERCASE_GERMAN:
        #endif /* defined(__MMI_ZI_GERMAN__) */ 
        #if defined(__MMI_ZI_ITALIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ITALIAN:
        case INPUT_MODE_SMART_LOWERCASE_ITALIAN:
        #endif /* defined(__MMI_ZI_ITALIAN__) */ 
        #if defined(__MMI_ZI_RUSSIAN__) || defined(__MMI_ZI_RECOMMENDED_SIZE_RUSSIAN__)
        case INPUT_MODE_SMART_UPPERCASE_RUSSIAN:
        case INPUT_MODE_SMART_LOWERCASE_RUSSIAN:
        #endif /* defined(__MMI_ZI_RUSSIAN__) || defined(__MMI_ZI_RECOMMENDED_SIZE_RUSSIAN__) */ 
        #if defined(__MMI_ZI_BULGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_BULGARIAN:
        case INPUT_MODE_SMART_LOWERCASE_BULGARIAN:
        #endif /* defined(__MMI_ZI_BULGARIAN__) */ 
        #if defined(__MMI_ZI_UKRAINIAN__)
        case INPUT_MODE_SMART_UPPERCASE_UKRAINIAN:
        case INPUT_MODE_SMART_LOWERCASE_UKRAINIAN:
        #endif /* defined(__MMI_ZI_UKRAINIAN__) */ 
        #if defined(__MMI_ZI_TURKISH__)
        case INPUT_MODE_SMART_UPPERCASE_TURKISH:
        case INPUT_MODE_SMART_LOWERCASE_TURKISH:
        #endif /* defined(__MMI_ZI_TURKISH__) */ 
        #if defined(__MMI_ZI_EU_PORTUGUESE__) || defined(__MMI_ZI_SA_PORTUGUESE__) || defined(__MMI_ZI_BZ_PORTUGUESE__)
        case INPUT_MODE_SMART_UPPERCASE_PORTUGUESE:
        case INPUT_MODE_SMART_LOWERCASE_PORTUGUESE:
        #endif /* defined(__MMI_ZI_EU_PORTUGUESE__) || defined(__MMI_ZI_SA_PORTUGUESE__) || defined(__MMI_ZI_BZ_PORTUGUESE__) */ 
        #if defined(__MMI_ZI_INDONESIAN__)
        case INPUT_MODE_SMART_UPPERCASE_INDONESIAN:
        case INPUT_MODE_SMART_LOWERCASE_INDONESIAN:
        #endif /* defined(__MMI_ZI_INDONESIAN__) */ 
        #if defined(__MMI_ZI_CZECH__)
        case INPUT_MODE_SMART_UPPERCASE_CZECH:
        case INPUT_MODE_SMART_LOWERCASE_CZECH:
        #endif /* defined(__MMI_ZI_CZECH__) */ 
        #if defined(__MMI_ZI_MALAY__)
        case INPUT_MODE_SMART_UPPERCASE_MALAY:
        case INPUT_MODE_SMART_LOWERCASE_MALAY:
        #endif /* defined(__MMI_ZI_MALAY__) */ 
        #if defined(__MMI_ZI_VIETNAMESE__)
        case INPUT_MODE_SMART_UPPERCASE_VIETNAMESE:
        case INPUT_MODE_SMART_LOWERCASE_VIETNAMESE:
        #endif /* defined(__MMI_ZI_VIETNAMESE__) */ 
        #if defined(__MMI_ZI_SLOVAK__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVAK:
        case INPUT_MODE_SMART_LOWERCASE_SLOVAK:
        #endif /* defined(__MMI_ZI_SLOVAK__) */ 
        #if defined(__MMI_ZI_DUTCH__)
        case INPUT_MODE_SMART_UPPERCASE_DUTCH:
        case INPUT_MODE_SMART_LOWERCASE_DUTCH:
        #endif /* defined(__MMI_ZI_DUTCH__) */ 
        #if defined(__MMI_ZI_SWEDISH__)
        case INPUT_MODE_SMART_UPPERCASE_SWEDISH:
        case INPUT_MODE_SMART_LOWERCASE_SWEDISH:
        #endif /* defined(__MMI_ZI_SWEDISH__) */ 
        #if defined(__MMI_ZI_CROATIAN__)
        case INPUT_MODE_SMART_UPPERCASE_CROATIAN:
        case INPUT_MODE_SMART_LOWERCASE_CROATIAN:
        #endif /* defined(__MMI_ZI_CROATIAN__) */ 
        #if defined(__MMI_ZI_ROMANIAN__)
        case INPUT_MODE_SMART_UPPERCASE_ROMANIAN:
        case INPUT_MODE_SMART_LOWERCASE_ROMANIAN:
        #endif /* defined(__MMI_ZI_ROMANIAN__) */ 
        #if defined(__MMI_ZI_SLOVENIAN__)
        case INPUT_MODE_SMART_UPPERCASE_SLOVENIAN:
        case INPUT_MODE_SMART_LOWERCASE_SLOVENIAN:
        #endif /* defined(__MMI_ZI_SLOVENIAN__) */ 
        #if defined(__MMI_ZI_GREEK__)
        case INPUT_MODE_SMART_UPPERCASE_GREEK:
        case INPUT_MODE_SMART_LOWERCASE_GREEK:
        #endif /* defined(__MMI_ZI_GREEK__) */ 
        #if defined(__MMI_ZI_FINNISH__)
        case INPUT_MODE_SMART_UPPERCASE_FINNISH:
        case INPUT_MODE_SMART_LOWERCASE_FINNISH:
        #endif /* defined(__MMI_ZI_FINNISH__) */ 
        #if defined(__MMI_ZI_HUNGARIAN__)
        case INPUT_MODE_SMART_UPPERCASE_HUNGARIAN:
        case INPUT_MODE_SMART_LOWERCASE_HUNGARIAN:
        #endif /* defined(__MMI_ZI_HUNGARIAN__) */ 
        case INPUT_MODE_SMART_THAI:
        case INPUT_MODE_SMART_ARABIC:
        case INPUT_MODE_SMART_PERSIAN:
    #if defined(__MMI_ZI_HINDI__)
        case INPUT_MODE_SMART_HINDI:
    #endif
    #if defined(__MMI_ZI_BENGALI__)
        case INPUT_MODE_SMART_BENGALI:
    #endif

    #if defined(__MMI_ZI_MARATHI__)
        case INPUT_MODE_SMART_MARATHI:
    #endif

    #if defined(__MMI_ZI_PUNJABI__)
        case INPUT_MODE_SMART_PUNJABI:
    #endif

    #if defined(__MMI_ZI_TAMIL__)
        case INPUT_MODE_SMART_TAMIL:
    #endif

    #if defined(__MMI_ZI_TELUGU__)
        case INPUT_MODE_SMART_TELUGU:
    #endif

    #if defined(__MMI_ZI_URDU__)
        case INPUT_MODE_SMART_URDU:
    #endif
        case INPUT_MODE_SMART_HEBREW:
            if (wgui_EMS_inputbox_information_icon == NULL)
            {
                /* MTK Elvis for R2L characters */
                if (!r2lMMIFlag)
                {
                    x += width + 2;
                }
                else
                {
                    x -= (width + 2);
                }
                /* MTK end */
            }
            else
            {

                /* MTK Elvis for R2L characters */
                gui_measure_image(wgui_EMS_inputbox_information_icon, &width, &height);
                if (!r2lMMIFlag)
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_show_transparent_image(
                        x,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x += width + 2;
                }
                else
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_show_transparent_image(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x -= (width + 2);
                }
                /* MTK end */

            }
            {
                gui_move_text_cursor(wgui_EMS_inputbox_information_bar_x + x, wgui_EMS_inputbox_information_bar_y + 3);
            }
            gui_print_text(inputmode_string);
            break;
        case INPUT_MODE_TR_MULTITAP_BOPOMO:
        case INPUT_MODE_SM_MULTITAP_PINYIN:
        case INPUT_MODE_SM_STROKE:
        case INPUT_MODE_TR_STROKE:
            if (wgui_EMS_inputbox_information_icon == NULL)
            {
                /* MTK Elvis for R2L characters */
                if (!r2lMMIFlag)
                {
                    x += width + 2;
                }
                else
                {
                    x -= (width + 2);
                }
                /* MTK end */
            }
            else
            {
                /* MTK Elvis for R2L characters */
                gui_measure_image(wgui_EMS_inputbox_information_icon, &width, &height);
            #if defined(__MMI_TOUCH_SCREEN__)
                wgui_information_bar_input_mode_display_width += width;
            #endif                  
                if (!r2lMMIFlag)
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_draw_filled_area(
                        x,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - rect_height) / 2 - 1,
                        x + 4 + width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height + rect_height) / 2,
                        &information_bar_BG_filler);
                    gui_show_transparent_image(
                        x + 2,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2 + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x += width + 2;
                }
                else
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_draw_filled_area(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - rect_height) / 2 - 1,
                        x + 4 + width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height + rect_height) / 2,
                        &information_bar_BG_filler);
                    gui_show_transparent_image(
                        x - width + 2,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2 + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x -= (width + 2);
                }
                /* MTK end */

            }
            break;
        case INPUT_MODE_TR_BOPOMO:
        case INPUT_MODE_SM_PINYIN:
            gui_measure_image(get_image(WGUI_ZI_EZITEXT_LOGO), &width, &height);
        #if defined(__MMI_TOUCH_SCREEN__)
            wgui_information_bar_input_mode_display_width += width;
        #endif               
            /* MTK Elvis for R2L characters */
            if (!r2lMMIFlag)
            {
            #if !defined(__MMI_TOUCH_SCREEN__)
                gui_show_transparent_image(
                    x,
                    wgui_EMS_inputbox_information_bar_y + 1,
                    get_image(WGUI_ZI_EZITEXT_LOGO),
                    0);
            #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                gui_show_transparent_image(
                    x,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                    get_image(WGUI_ZI_EZITEXT_LOGO),
                    0);
            #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                x += width + 2;
            }
            else
            {
            #if !defined(__MMI_TOUCH_SCREEN__)
                gui_show_transparent_image(
                    x - width,
                    wgui_EMS_inputbox_information_bar_y + 1,
                    get_image(WGUI_ZI_EZITEXT_LOGO),
                    0);
            #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                gui_show_transparent_image(
                    x - width,
                    wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2,
                    get_image(WGUI_ZI_EZITEXT_LOGO),
                    0);
            #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                x -= (width + 2);
            }
            /* MTK end */

            if (wgui_EMS_inputbox_information_icon == NULL)
            {
                /* MTK Elvis for R2L characters */
                if (!r2lMMIFlag)
                {
                    x += width + 2;
                }
                else
                {
                    x -= (width + 2);
                }
                /* MTK end */
            }
            else
            {
                /* MTK Elvis for R2L characters */
                gui_measure_image(wgui_EMS_inputbox_information_icon, &width, &height);
            #if defined(__MMI_TOUCH_SCREEN__)
                wgui_information_bar_input_mode_display_width += width;
            #endif    
                if (!r2lMMIFlag)
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_draw_filled_area(
                        x,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - rect_height) / 2 - 1,
                        x + 4 + width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height + rect_height) / 2,
                        &information_bar_BG_filler);
                    gui_show_transparent_image(
                        x,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2 + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x += width + 2;
                }
                else
                {
                #if !defined(__MMI_TOUCH_SCREEN__)
                    gui_show_transparent_image(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #else /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    gui_draw_filled_area(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - rect_height) / 2 - 1,
                        x + 4 + width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height + rect_height) / 2,
                        &information_bar_BG_filler);
                    gui_show_transparent_image(
                        x - width,
                        wgui_EMS_inputbox_information_bar_y + (wgui_inputbox_information_bar_height - height) / 2 + 1,
                        wgui_EMS_inputbox_information_icon,
                        0);
                #endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
                    x -= (width + 2);
                }
                /* MTK end */

            }
            break;
        #endif 
    }

}

/* MTK end */


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_redraw_remaining_characters_display
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_redraw_remaining_characters_display(void)
{
#ifndef __MMI_HIDE_EMS_REMAINING_CHAR__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    color c;

    /* MTK Elvis for R2L characters */
    S32 x1;
    S32 x2;
    S32 y1 = wgui_EMS_inputbox_information_bar_y;
    S32 y2 = wgui_EMS_inputbox_information_bar_y + wgui_EMS_inputbox_information_bar_height - 1;

    /* MTK end */
#if !defined(__MMI_TOUCH_SCREEN__)
    stFontAttribute *f = &MMI_small_font;
    S32 w, n, max_n;
#else /* !defined(__MMI_TOUCH_SCREEN__) */ 
    stFontAttribute *f = &MMI_medium_font;
    S32 w, h, n, max_n;
#endif /* !defined(__MMI_TOUCH_SCREEN__) */ 
    UI_character_type str[32];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* MTK Elvis for R2L characters */
    if (!r2lMMIFlag)
    {
        x1 = wgui_EMS_inputbox_information_bar_x + (wgui_EMS_inputbox_information_bar_width >> 1);
        x2 = wgui_EMS_inputbox_information_bar_x + wgui_EMS_inputbox_information_bar_width - 1;

    }
    else
    {
        x1 = wgui_EMS_inputbox_information_bar_x;
        x2 = wgui_EMS_inputbox_information_bar_x + (wgui_EMS_inputbox_information_bar_width / 2) - 1;

    }
    /* MTK end */

#if(UI_DOUBLE_BUFFER_SUPPORT)
    gui_lock_double_buffer();
#endif 
#if(UI_DISABLE_EMS_INPUT_BOX)
#ifdef __UCS2_ENCODING
    n = (MMI_multiline_inputbox.text_length >> 1) - 1;
    if (MMI_multiline_inputbox.UCS2_count > 0)
    {
        max_n = 268;
    }
    else
    {
        max_n = 612;
    }
#endif /* __UCS2_ENCODING */ 
#ifdef __ASCII
    n = MMI_multiline_inputbox.text_length - 1;
    if (MMI_multiline_inputbox.UCS2_count > 0)
    {
        max_n = 268;
    }
    else
    {
        max_n = 612;
    }
#endif /* __ASCII */ 
#else /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    /* reassign MMI_EMS_inputbox.available_length because it might be one byte difference per segment for EMS 5.1 */
    gui_EMS_change_DCS(&MMI_EMS_inputbox);

/* Mude Lin(MBJ06016) Add For SMS Remaining Count Display In EMS Editor*/
#ifdef __MMI_MESSAGES_EMS_REMAINING_COUNTER__
    n = EMS_get_last_segment_remaining_char(&MMI_EMS_inputbox);
    max_n = EMS_get_required_segment(&MMI_EMS_inputbox);
#else /*__MMI_MESSAGES_EMS_REMAINING_COUNTER__*/
/*End Mude Lin(MBJ06016) Add*/
    n = MMI_EMS_inputbox.available_length - EMS_get_remaining_length(MMI_EMS_inputbox.data);
    if (MMI_EMS_inputbox.UCS2_count > 0)
    {
        n = MMI_EMS_inputbox.available_length - (EMS_get_remaining_length(MMI_EMS_inputbox.data) >> 1);
    }
    else if (MMI_EMS_inputbox.GSM_ext_count > 0)
    {
        n = MMI_EMS_inputbox.available_length - EMS_get_remaining_length(MMI_EMS_inputbox.data);
    }
    max_n = MMI_EMS_inputbox.available_length;
#endif /*__MMI_MESSAGES_EMS_REMAINING_COUNTER__*/
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    wgui_EMS_input_information_background(x1, y1, x2, y2);
    gui_reset_text_clip();
    gui_sprintf(str, "%d/%d", n, max_n);
    c = *current_MMI_theme->remaining_length_text_color;
    gui_set_font(f);
    gui_set_text_color(c);
    gui_set_text_clip(0, 0, UI_device_width - 1, UI_device_height - 1);
#if !defined(__MMI_TOUCH_SCREEN__)
    w = gui_get_string_width(str);
#else 
    gui_measure_string(str, &w, &h);
#endif 

    /* MTK Elvis for R2L characters */
    if (!r2lMMIFlag)
#if !defined(__MMI_TOUCH_SCREEN__)
        gui_move_text_cursor(x2 - 2 - w, y1 + 2);
#else 
        gui_move_text_cursor(x2 - 2 - w, y1 + (wgui_inputbox_information_bar_height - h) / 2);
#endif 
    else
#if !defined(__MMI_TOUCH_SCREEN__)
        gui_move_text_cursor(x1 + 2 + w, y1 + 2);
#else 
        gui_move_text_cursor(x1 + 2 + w, y1 + (wgui_inputbox_information_bar_height - h) / 2);
#endif 
    /* MTK end */
    gui_print_text(str);
#if(UI_DOUBLE_BUFFER_SUPPORT)
    gui_unlock_double_buffer();
    gui_BLT_double_buffer(x1, y1, x2, y2);
#endif /* (UI_DOUBLE_BUFFER_SUPPORT) */ 
#endif /* __MMI_HIDE_EMS_REMAINING_CHAR__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_redraw_input_information_bar
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_redraw_input_information_bar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x1 = wgui_EMS_inputbox_information_bar_x;
    S32 y1 = wgui_EMS_inputbox_information_bar_y;
    S32 x2 = wgui_EMS_inputbox_information_bar_x + wgui_EMS_inputbox_information_bar_width - 1;
    S32 y2 = wgui_EMS_inputbox_information_bar_y + wgui_EMS_inputbox_information_bar_height - 1;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_lock_double_buffer();
    wgui_EMS_input_information_background(x1, y1, x2, y2);
    wgui_show_input_mode_internal(wgui_EMS_inputbox_information_bar_x, 
                                                        wgui_EMS_inputbox_information_bar_y,
                                                        wgui_EMS_inputbox_information_bar_width, 
                                                        wgui_EMS_inputbox_information_bar_height, 
                                                        MMI_current_input_mode, 
                                                        wgui_EMS_inputbox_information_icon);
    wgui_EMS_redraw_remaining_characters_display();
    gui_unlock_double_buffer();
    gui_BLT_double_buffer(x1, y1, x2, y2);
}


extern S16 MMI_current_input_type;



#if(EMS_USE_STUB_MENU)


/*****************************************************************************
 * FUNCTION
 *  EntryEMSEditOptionsMenu
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EntryEMSEditOptionsMenu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
}

#endif /* (EMS_USE_STUB_MENU) */ 







/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_inputbox_insert_symbol
 * DESCRIPTION
 *  
 * PARAMETERS
 *  symbol      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_inputbox_insert_symbol(UI_character_type symbol)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(!UI_DISABLE_EMS_INPUT_BOX)
    EMS_inputbox_direct_input(symbol);
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  temp_ems_insert_character
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void temp_ems_insert_character(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_character_type symbol = 0xabc;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(!UI_DISABLE_EMS_INPUT_BOX)
    EMS_inputbox_direct_input(symbol);
#endif 
}

#if(UI_DISABLE_EMS_INPUT_BOX)


/*****************************************************************************
 * FUNCTION
 *  EMS_inputbox_insert_predefined_picture
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
EMSTATUS EMS_inputbox_insert_predefined_picture(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    UI_UNUSED_PARAMETER(index);
    return (0);
}

#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 



/*****************************************************************************
 * FUNCTION
 *  AppendEMSString
 * DESCRIPTION
 *  
 * PARAMETERS
 *  input_type          [IN]        
 *  data                [?]         
 *  s                   [?]         
 *  dcs                 [IN]        
 *  history_buffer      [?]         
 * RETURNS
 *  
 *****************************************************************************/
U8 AppendEMSString(S16 input_type, EMSData *data, U8 *s, U8 dcs, U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 l, box_height;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    l = gui_strlen((UI_string_type) s);
    box_height = MMI_content_height - MMI_multitap_height - 10;
    gui_create_EMS_input_box(&MMI_EMS_inputbox, 0, (MMI_title_y + MMI_title_height) + 12, UI_device_width, box_height);
    gui_set_EMS_input_box_data(&MMI_EMS_inputbox, data);
    EMSSetDCS(MMI_EMS_inputbox.data, dcs);

    if (AddString(MMI_EMS_inputbox.data, s, (U16) l, NULL) == EMS_OK)
    {
        return 1;
    }
    else
    {
        return 0;
    }
}


/*****************************************************************************
 * FUNCTION
 *  move_EMS_inputbox
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x       [IN]        
 *  y       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void move_EMS_inputbox(S32 x, S32 y)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_move_EMS_input_box(&MMI_EMS_inputbox, x, y);
}


/*****************************************************************************
 * FUNCTION
 *  resize_EMS_inputbox
 * DESCRIPTION
 *  
 * PARAMETERS
 *  width       [IN]        
 *  height      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void resize_EMS_inputbox(S32 width, S32 height)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_resize_EMS_input_box(&MMI_EMS_inputbox, width, height);
}



extern U8 category28_RSK_label_clear;

/*****************************************************************************
 * FUNCTION
 *  wgui_set_EMS_inputbox_RSK
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_set_EMS_inputbox_RSK(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    category28_RSK_label_clear = 0;
#if defined(__MMI_WITH_C_KEY__)
    SetKeyHandler(handle_category28_right_softkey_down, KEY_CLEAR, KEY_EVENT_DOWN);
    SetKeyHandler(handle_category28_right_softkey_long_press, KEY_CLEAR, KEY_LONG_PRESS);
    set_right_softkey_function(handle_category28_right_softkey_up, KEY_EVENT_UP);
#else /* defined(__MMI_WITH_C_KEY__) */ 
    set_right_softkey_function(handle_category28_right_softkey_down, KEY_EVENT_DOWN);
    set_right_softkey_function(handle_category28_right_softkey_long_press, KEY_LONG_PRESS);
#endif /* defined(__MMI_WITH_C_KEY__) */ 
    register_EMS_inputbox_input_callback(handle_category28_input);
    handle_category28_input();
    if (gui_EMS_inputbox_empty(&MMI_EMS_inputbox))
    {
    #if defined(__MMI_WITH_C_KEY__)
        SetKeyHandler(handle_category28_right_softkey_up, KEY_CLEAR, KEY_EVENT_UP);
    #else 
        set_right_softkey_function(handle_category28_right_softkey_up, KEY_EVENT_UP);
    #endif 
    }

}


#if(ENABLE_EMS_TEST_DEMO)
/* Removed by Leo useless code..... */


/*****************************************************************************
 * FUNCTION
 *  RedrawCategory29Screen
 * DESCRIPTION
 *  Redraws the MT EMS/SMS screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void RedrawCategory29Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_lock_frame_buffer();

    clear_screen();
    show_title_status_icon();
    draw_title();
    show_softkey_background();
    show_left_softkey();
    show_right_softkey();
#if(UI_DISABLE_EMS_INPUT_BOX)
    show_multiline_inputbox();
#else 
    show_EMS_inputbox();
#endif 
    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  ShowCategory29Screen
 * DESCRIPTION
 *  Displays the MT EMS/SMS screen
 * PARAMETERS
 *  title                   [IN]        Title for the screen
 *  title_icon              [IN]        Icon shown with the title
 *  left_softkey            [IN]        Left softkey label
 *  left_softkey_icon       [IN]        Icon for the left softkey
 *  right_softkey           [IN]        Right softkey label
 *  right_softkey_icon      [IN]        Icon for the right softkey
 *  data                    [IN]        EMSData (Pre-allocated and initialized)
 *  history_buffer          [IN]        History buffer
 * RETURNS
 *  void
 *****************************************************************************/
void ShowCategory29Screen(
        U16 title,
        U16 title_icon,
        U16 left_softkey,
        U16 left_softkey_icon,
        U16 right_softkey,
        U16 right_softkey_icon,
        EMSData *data,
        U8 *history_buffer)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    dm_data_struct dm_data;
    S16 input_type = 0;

#if(UI_DISABLE_EMS_INPUT_BOX)
    S32 length;
    S32 i, j, h, fh;

    UI_UNUSED_PARAMETER(history_buffer);
#else /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    U8 h;
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EMS_inputbox_has_changed = 0;
#ifdef __MMI_MESSAGES_EMS__
    initialize_EMS_objects();
#endif 
    MMI_menu_shortcut_number = -1;
    change_left_softkey(left_softkey, left_softkey_icon);
    change_right_softkey(right_softkey, right_softkey_icon);
    SetupCategoryKeyHandlers();

    MMI_title_string = (UI_string_type) get_string(title);
    MMI_title_icon = (PU8) get_image(title_icon);

#if(UI_DISABLE_EMS_INPUT_BOX)
    length = (data->textBufferSize >> 1);
    if (length == 0)
    {
        UI_string_type s = (UI_string_type) "EMS Data not initialized";
        S32 l = gui_strlen((UI_string_type) s);

        temp_EMS_buffer = (UI_string_type) gui_malloc(l * sizeof(UI_character_type));
        gui_strcpy((UI_string_type) temp_EMS_buffer, (UI_string_type) s);
        length = l + 1;
        i = l;
    }
    else
    {
        temp_EMS_buffer = (UI_string_type) gui_malloc(length * sizeof(UI_character_type));
        i = j = 0;
        while (j < data->textLength)
        {
            if ((data->textBuffer[j] == '\0') && (data->textBuffer[j + 1] == '\0'))
            {
                temp_EMS_buffer[i] = '\0';
                break;
            }
            else
            {
                temp_EMS_buffer[i] = data->textBuffer[j + 1];
            }
            i++;
            j += 2;
        }
    }
    temp_EMS_data = data;
    create_multiline_inputbox_set_buffer(temp_EMS_buffer, length, i, 0);
    register_multiline_inputbox_keys();
    register_hide_multitap(category5_hide_multitap);
    move_multiline_inputbox(0, (MMI_title_y + MMI_title_height) + 2);
    h = MMI_content_height - MMI_multitap_height - 8;
    gui_set_font(MMI_multiline_inputbox.text_font);
    fh = gui_get_character_height();
    h = ((h / fh) * fh) + 8;
    resize_multiline_inputbox(MMI_multiline_inputbox.width, h);
    set_multiline_inputbox_mask(0);
#else /* (UI_DISABLE_EMS_INPUT_BOX) */ 
#if((UI_ENABLE_FRAME_SKIPPING) && (ENABLE_EMS_INPUTBOX_FRAME_SKIPPING))
    wgui_EMS_inputbox_frame_counter = 0;
#endif 
    h = set_EMS_inputbox_category_history(MMI_CATEGORY29_ID, history_buffer, (S16*) & input_type);
    gui_create_EMS_input_box(
        &MMI_EMS_inputbox,
        0,
        (MMI_title_y + MMI_title_height),
        MMI_content_width,
        MMI_content_height + 2);
    MMI_EMS_inputbox.flags |= UI_EMS_INPUT_BOX_VIEW_MODE;
    if (!h)
    {
        gui_set_EMS_input_box_data(&MMI_EMS_inputbox, data);
        ResetCurrentPosition(MMI_EMS_inputbox.data);
    }
    register_EMS_inputbox_viewer_keys();
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    ExitCategoryFunction = ExitCategory29Screen;
    dm_setup_category_functions(dm_redraw_category_screen, GetCategory29History, GetCategory29HistorySize);
    dm_data.s32ScrId = (S32) GetActiveScreenId();
    dm_data.s32CatId = MMI_CATEGORY29_ID;
    dm_data.s32flags = DM_CLEAR_SCREEN_BACKGROUND;
    dm_setup_data(&dm_data);
    dm_redraw_category_screen();
}


/*****************************************************************************
 * FUNCTION
 *  CloseCategory29Screen
 * DESCRIPTION
 *  Releases data used by the MT EMS/SMS screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void CloseCategory29Screen(void)
{
#if(UI_DISABLE_EMS_INPUT_BOX)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 length;
    S32 i, j;
    U8 *buffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    length = MMI_multiline_inputbox.text_length;
    buffer = (U8*) gui_malloc((length << 1) + 2);
    i = j = 0;
    ResetCurrentPosition(temp_EMS_data);
    while (i < length)
    {
        buffer[j++] = 0;
        buffer[j++] = (U8) temp_EMS_buffer[i++];
    }
    buffer[j++] = 0;
    buffer[j++] = '\0';
    AddString(temp_EMS_data, buffer, (U16) length, NULL);
    gui_free(buffer);
    gui_free(temp_EMS_buffer);
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 
}


/*****************************************************************************
 * FUNCTION
 *  ExitCategory29Screen
 * DESCRIPTION
 *  Exits the MT EMS/SMS screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void ExitCategory29Screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(!UI_DISABLE_EMS_INPUT_BOX)
    reset_EMS_inputbox();
#endif 
#ifdef __MMI_MESSAGES_EMS__
    close_EMS_objects();
#endif 
    ExitCategoryFunction = MMI_dummy_function;
    RedrawCategoryFunction = MMI_dummy_function;
    GetCategoryHistory = dummy_get_history;
    GetCategoryHistorySize = dummy_get_history_size;
}


/*****************************************************************************
 * FUNCTION
 *  GetCategory29HistorySize
 * DESCRIPTION
 *  Gets the history buffer size for the MT EMS/SMS screen
 * PARAMETERS
 *  void
 * RETURNS
 *  size in U8s of the history buffer
 *****************************************************************************/
S32 GetCategory29HistorySize(void)
{
#if(UI_DISABLE_EMS_INPUT_BOX)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (0);
#else /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    return (sizeof(EMS_inputbox_category_history));
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 

}


/*****************************************************************************
 * FUNCTION
 *  GetCategory29History
 * DESCRIPTION
 *  Gets the history buffer for the MT EMS/SMS screen
 * PARAMETERS
 *  history_buffer      [IN]        Is the buffer into which the history data is stored (pre-allocated)
 * RETURNS
 *  pointer to the history buffer
 *****************************************************************************/
U8 *GetCategory29History(U8 *history_buffer)
{
#if(UI_DISABLE_EMS_INPUT_BOX)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (history_buffer);
#else /* (UI_DISABLE_EMS_INPUT_BOX) */ 
    get_EMS_inputbox_category_history(MMI_CATEGORY28_ID, history_buffer, MMI_current_input_type);
    return (history_buffer);
#endif /* (UI_DISABLE_EMS_INPUT_BOX) */ 
}
#endif /* (ENABLE_EMS_TEST_DEMO) */ 

/* If EMS_VIEWER_HEADER_HEIGHT_AUTO is 1, then EMS_VIEWER_HEADER_HEIGHT defines
   the maximum possible height for the header. Otherwise, it defines the fixed
   height of the header */

#define EMS_VIEWER_HEADER_HEIGHT          48
#define EMS_VIEWER_HEADER_HEIGHT_AUTO        1

/* If 1, uses multiline input box to display the header (word wrapping, no truncation),
   else uses normal text output (no word wrapping, truncation for lines longer than screen width)     */

#define EMS_VIEWER_HEADER_MULTILINE_INPUTBOX 0

UI_filled_area EMS_viewer_header_background_filler = {UI_FILLED_AREA_TYPE_COLOR,
    UI_NULL_IMAGE,
    NULL,
    {180, 220, 220, 100},
    {0, 0, 0, 0},
    {0, 0, 0, 0},
    {0, 0, 0, 0},
    0
};

#if(EMS_VIEWER_HEADER_MULTILINE_INPUTBOX)

multi_line_input_box EMS_viewer_header_inputbox;

UI_multi_line_input_box_theme EMS_viewer_header_theme = { &EMS_viewer_header_background_filler,
    &EMS_viewer_header_background_filler,
    &EMS_viewer_header_background_filler,
    {0, 0, 0, 100},
    {0, 0, 0, 100},
    {128, 128, 128, 100},
    {0, 0, 0, 100},
    {255, 255, 255, 100},
    {51, 88, 171, 100},
    {255, 0, 0, 100},
    &MMI_default_font,
    1,
    0,
    '*',
    1
};

/* EMS header implementation using multi-line input box  */


/*****************************************************************************
 * FUNCTION
 *  create_EMS_viewer_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  message     [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void create_EMS_viewer_header(U8 *message)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 l, ll;

#if(EMS_VIEWER_HEADER_HEIGHT_AUTO)
    S32 fh, n_lines, h;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    l = gui_strlen((UI_string_type) message);
    ll = (l + 1) * ENCODING_LENGTH;
    gui_create_multi_line_input_box_set_buffer(
        &EMS_viewer_header_inputbox,
        0,
        0,
        MMI_EMS_inputbox.width - MMI_EMS_inputbox.vbar.width,
        EMS_VIEWER_HEADER_HEIGHT,
        (UI_string_type) message,
        ll,
        ll,
        0);
    gui_set_multi_line_input_box_theme(&EMS_viewer_header_inputbox, &EMS_viewer_header_theme);
    EMS_viewer_header_inputbox.flags |=
        (UI_MULTI_LINE_INPUT_BOX_USE_PRESET_CLIPPING | UI_MULTI_LINE_INPUT_BOX_DISABLE_SCROLLBAR |
         UI_MULTI_LINE_INPUT_BOX_DISABLE_CURSOR_DRAW);
#if(EMS_VIEWER_HEADER_HEIGHT_AUTO)
    gui_set_font(EMS_viewer_header_inputbox.text_font);
    fh = gui_get_character_height();
    EMS_viewer_header_inputbox.flags |= UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
    gui_show_multi_line_input_box(&EMS_viewer_header_inputbox);
    EMS_viewer_header_inputbox.flags &= ~UI_MULTI_LINE_INPUT_BOX_DISABLE_DRAW;
    n_lines = EMS_viewer_header_inputbox.n_lines;
    if (n_lines > 3)
    {
        n_lines = 3;
    }
    h = n_lines * fh + 6;
    if (h > EMS_VIEWER_HEADER_HEIGHT)
    {
        h = EMS_VIEWER_HEADER_HEIGHT;
    }
    gui_resize_multi_line_input_box(&EMS_viewer_header_inputbox, EMS_viewer_header_inputbox.width, h);
#endif /* (EMS_VIEWER_HEADER_HEIGHT_AUTO) */ 
}


/*****************************************************************************
 * FUNCTION
 *  EMS_viewer_show_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x1      [IN]        
 *  y1      [IN]        
 *  x2      [IN]        
 *  y2      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_viewer_show_header(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 ex1, ey1, ex2, ey2;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ex1 = MMI_EMS_inputbox.x + 1;
    ex2 = ex1 + MMI_EMS_inputbox.width - 2;
    ey1 = MMI_EMS_inputbox.y + 1;
    ey2 = ey1 + MMI_EMS_inputbox.height - 2;
    gui_set_text_clip(ex1, ey1, ex2, ey2);
    gui_set_clip(ex1, ey1, ex2, ey2);
    gui_move_multi_line_input_box(&EMS_viewer_header_inputbox, x1, y1);
    gui_show_multi_line_input_box(&EMS_viewer_header_inputbox);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_viewer_measure_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_viewer_measure_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (EMS_viewer_header_inputbox.height);
}

#else /* (EMS_VIEWER_HEADER_MULTILINE_INPUTBOX) */ 

/* EMS header implementation using normal text output          */
/* Requires message to contain line breaks where ever necessary   */

#define EMS_VIEWER_HEADER_MAX_LINES          4
#define EMS_VIEWER_HEADER_MAX_LINE_LENGTH    32*ENCODING_LENGTH

U8 EMS_header_text_strings[EMS_VIEWER_HEADER_MAX_LINES][EMS_VIEWER_HEADER_MAX_LINE_LENGTH];
S32 EMS_header_text_string_heights[EMS_VIEWER_HEADER_MAX_LINES];
S32 EMS_header_height = 0;
S32 EMS_header_n_lines = 0;

#if(0)

/*	Assumes the following format:
	<line1>\n
	<line2>\n
	....
	Long lines are truncated by ...	*/

void create_EMS_viewer_header(U8* message)
{	byte				done=0;
	byte				inner_done;
	S32					i,j;
	UI_buffer_type		text=message;
	UI_buffer_type		out_text;
	S32					sw,sh;
	UI_character_type	c;

	pixtel_UI_set_font(&MMI_default_font);
	EMS_header_n_lines=0;
	EMS_header_height=0;
	i=0;
	while(!done)
	{	if(EMS_header_n_lines>=EMS_VIEWER_HEADER_MAX_LINES) break;
		inner_done=0;
		j=0;
		out_text=(UI_buffer_type)EMS_header_text_strings[EMS_header_n_lines];
		EMS_header_text_strings[EMS_header_n_lines][0]='\0';
		EMS_header_text_strings[EMS_header_n_lines][1]=0;
		while(!inner_done)
		{	if(j>=(EMS_VIEWER_HEADER_MAX_LINE_LENGTH-ENCODING_LENGTH)) break;
			UI_STRING_GET_NEXT_CHARACTER(text,c);
			if(UI_STRING_LINE_BREAK_CHARACTER(c))
			{	inner_done=1;
				break;
			}
			if(UI_STRING_END_OF_STRING_CHARACTER(c))
			{	inner_done=1;
				done=1;
				break;
			}
			UI_STRING_INSERT_CHARACTER(out_text,c);
			j+=ENCODING_LENGTH;
		}
		UI_STRING_INSERT_CHARACTER(out_text,'\0');
		while(!inner_done)
		{	UI_STRING_GET_NEXT_CHARACTER(text,c);
			if(UI_STRING_LINE_BREAK_CHARACTER(c))
			{	inner_done=1;
				break;
			}
			if(UI_STRING_END_OF_STRING_CHARACTER(c))
			{	inner_done=1;
				done=1;
				break;
			}
		}
		pixtel_UI_measure_string((UI_string_type)EMS_header_text_strings[EMS_header_n_lines],&sw,&sh);
		sh+=1;
		EMS_header_text_string_heights[EMS_header_n_lines]=sh;
		EMS_header_height+=sh;
		EMS_header_n_lines++;
	}
	if(EMS_header_height>0) EMS_header_height+=2;
}

#else /* (0) */ 

/* Returns true when end of string is reached   */
/* loads \n delimited strings             */


/*****************************************************************************
 * FUNCTION
 *  load_EMS_viewer_header_string
 * DESCRIPTION
 *  
 * PARAMETERS
 *  src                 [IN]        
 *  dst                 [IN]        
 *  max_dst_length      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U8 load_EMS_viewer_header_string(U8 **src, U8 **dst, S32 max_dst_length)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    UI_buffer_type text = *src;
    UI_buffer_type out_text = *dst;
    U8 inner_done = 0;
    S32 j = 0;
    U8 done = 0;
    UI_character_type c;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    while (!inner_done)
    {
        if (j >= (max_dst_length - ENCODING_LENGTH))
        {
            break;
        }
        UI_STRING_GET_NEXT_CHARACTER(text, c);
        if (UI_STRING_LINE_BREAK_CHARACTER(c))
        {
            inner_done = 1;
            break;
        }
        if (UI_STRING_END_OF_STRING_CHARACTER(c))
        {
            inner_done = 1;
            done = 1;
            break;
        }
        UI_STRING_INSERT_CHARACTER(out_text, c);
        j += ENCODING_LENGTH;
    }
    UI_STRING_INSERT_CHARACTER(out_text, '\0');
    while (!inner_done)
    {
        UI_STRING_GET_NEXT_CHARACTER(text, c);
        if (UI_STRING_LINE_BREAK_CHARACTER(c))
        {
            inner_done = 1;
            break;
        }
        if (UI_STRING_END_OF_STRING_CHARACTER(c))
        {
            inner_done = 1;
            done = 1;
            break;
        }
    }
    *src = text;
    *dst = out_text;
    return (done);
}

#define UI_EMS_HEADER_NUMBER_OF_BREAK_CHARACTERS      (1)

UI_character_type EMS_header_break_characters[] = { ' '
};

#define UI_EMS_HEADER_BREAK_CHARACTER(c,flag)                                                   \
{  S32 _ii_;                                                                                    \
   flag=0;                                                                                      \
   for(_ii_=0;_ii_<UI_EMS_HEADER_NUMBER_OF_BREAK_CHARACTERS;_ii_++)                             \
   {  if((UI_character_type)c==(UI_character_type)EMS_header_break_characters[_ii_])            \
      {  flag=1;                                                                                \
         break;                                                                                 \
      }                                                                                         \
   }                                                                                            \
}

/* Assumes the following format:
   From:\n
   Name/number\n
   Date\n
   Time\n
   Attempts to combine first two lines */


/*****************************************************************************
 * FUNCTION
 *  create_EMS_viewer_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  message     [?]     
 * RETURNS
 *  void
 *****************************************************************************/
void create_EMS_viewer_header(U8 *message)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 done = 0;
    U8 inner_done;
    S32 j;
    UI_buffer_type text = message;
    UI_buffer_type out_text;
    S32 sw, sh, break_count;
    UI_character_type c;
    S32 l1_w, l1_h, l2_w, l2_h;
    U8 temp_string[EMS_VIEWER_HEADER_MAX_LINE_LENGTH];

    /* U8             space_string[]={' ',0,'\0',0};   */
    /* U8             blank_string[]={'\0',0};      */
    S32 character_width, character_height;
    S32 box_width = (MMI_EMS_inputbox.width - MMI_EMS_inputbox.vbar.width - 2);
    UI_buffer_type temp_text1, temp_text2;
    U8 break_flag;
    U16 from_len = 0;
    U16 name_number_len = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gui_set_font(&MMI_default_font);
    EMS_header_n_lines = 0;
    EMS_header_height = 0;
    out_text = (UI_buffer_type) EMS_header_text_strings[EMS_header_n_lines];
    /* "From:"  */
    done = load_EMS_viewer_header_string(&text, &out_text, EMS_VIEWER_HEADER_MAX_LINE_LENGTH);
    gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &l1_w, &l1_h);
    l1_h++;
    EMS_header_height += l1_h;
    EMS_header_text_string_heights[EMS_header_n_lines] = l1_h;
    from_len = mmi_ucs2strlen((S8*) EMS_header_text_strings[EMS_header_n_lines]);
    /* "Name/number"  */
    if (!done)
    {
        out_text = (UI_buffer_type) temp_string;
        done = load_EMS_viewer_header_string(&text, &out_text, EMS_VIEWER_HEADER_MAX_LINE_LENGTH);
        gui_measure_string((UI_string_type) temp_string, &l2_w, &l2_h);
        name_number_len = mmi_ucs2strlen((S8*) temp_string);
        if (((l1_w + l2_w) < box_width) &&
            ((from_len + name_number_len) < EMS_VIEWER_HEADER_MAX_LINE_LENGTH / ENCODING_LENGTH))
        {
            gui_strcat((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], (UI_string_type) temp_string);
            gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &sw, &sh);
            sh++;
            EMS_header_height -= l1_h;
            EMS_header_height += sh;
            EMS_header_text_string_heights[EMS_header_n_lines] = sh;
            EMS_header_n_lines++;
        }
        else if ((l2_w <= box_width) && (name_number_len < EMS_VIEWER_HEADER_MAX_LINE_LENGTH / ENCODING_LENGTH))
        {
            EMS_header_n_lines++;
            gui_strcpy((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], (UI_string_type) temp_string);
            gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &sw, &sh);
            sh++;
            EMS_header_height += sh;
            EMS_header_text_string_heights[EMS_header_n_lines] = sh;
            EMS_header_n_lines++;
        }
        else    /* break "Name/number" into two lines  */
        {
            out_text = (UI_buffer_type) temp_string;
            break_count = 0;
            inner_done = 0;
            sw = l1_w;
            j = 0;
            while (!inner_done)
            {
                UI_STRING_GET_NEXT_CHARACTER(out_text, c);
                if (UI_STRING_END_OF_STRING_CHARACTER(c))
                {
                    break_count = j;
                    inner_done = 1;
                    done = 1;
                    break;
                }
                UI_EMS_HEADER_BREAK_CHARACTER(c, break_flag);
                if (break_flag)
                {
                    break_count = j + 1;
                }
                gui_measure_character(c, &character_width, &character_height);
                character_width += 1;
                if ((sw + character_width) > box_width)
                {
                    inner_done = 1;
                    break;
                }
                sw += character_width;
                j++;
            }
            if (break_count == 0)
            {
                break_count = j;
            }
            temp_text1 = (UI_buffer_type) EMS_header_text_strings[EMS_header_n_lines + 1];
            temp_text2 = (UI_buffer_type) temp_string;
            for (j = 0; j < break_count; j++)
            {
                UI_STRING_GET_NEXT_CHARACTER(temp_text2, c);
                UI_STRING_INSERT_CHARACTER(temp_text1, c);
            }
            UI_STRING_INSERT_CHARACTER(temp_text1, '\0');
            gui_strcat(
                (UI_string_type) EMS_header_text_strings[EMS_header_n_lines],
                (UI_string_type) EMS_header_text_strings[EMS_header_n_lines + 1]);
            inner_done = 0;
            temp_text1 = (UI_buffer_type) EMS_header_text_strings[EMS_header_n_lines + 1];
            while (!inner_done)
            {
                UI_STRING_GET_NEXT_CHARACTER(temp_text2, c);
                if (UI_STRING_END_OF_STRING_CHARACTER(c))
                {
                    inner_done = 1;
                    break;
                }
                if (UI_STRING_LINE_BREAK_CHARACTER(c))
                {
                    inner_done = 1;
                    break;
                }
                UI_STRING_INSERT_CHARACTER(temp_text1, c);
            }
            UI_STRING_INSERT_CHARACTER(temp_text1, '\0');
            gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &sw, &sh);
            sh++;
            EMS_header_text_string_heights[EMS_header_n_lines] = sh;
            EMS_header_height -= l1_h;
            EMS_header_height += sh;
            gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines + 1], &sw, &sh);
            sh++;
            EMS_header_text_string_heights[EMS_header_n_lines + 1] = sh;
            EMS_header_height += sh;
            EMS_header_n_lines += 2;
        }
    }
    else
    {
        EMS_header_n_lines++;
    }
    if (!done)
    {
        out_text = (UI_buffer_type) EMS_header_text_strings[EMS_header_n_lines];
        done = load_EMS_viewer_header_string(&text, &out_text, EMS_VIEWER_HEADER_MAX_LINE_LENGTH);
        gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &sw, &sh);
        sh++;
        EMS_header_height += sh;
        EMS_header_text_string_heights[EMS_header_n_lines] = sh;
        EMS_header_n_lines++;
    }
    if (!done)
    {
        out_text = (UI_buffer_type) EMS_header_text_strings[EMS_header_n_lines];
        done = load_EMS_viewer_header_string(&text, &out_text, EMS_VIEWER_HEADER_MAX_LINE_LENGTH);
        gui_measure_string((UI_string_type) EMS_header_text_strings[EMS_header_n_lines], &sw, &sh);
        sh++;
        EMS_header_height += sh;
        EMS_header_text_string_heights[EMS_header_n_lines] = sh;
        EMS_header_n_lines++;
    }
    if (EMS_header_height > 0)
    {
        EMS_header_height += 2;
    }
}

#endif /* (0) */ 


/*****************************************************************************
 * FUNCTION
 *  EMS_viewer_show_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  x1      [IN]        
 *  y1      [IN]        
 *  x2      [IN]        
 *  y2      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_viewer_show_header(S32 x1, S32 y1, S32 x2, S32 y2)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 ex1, ey1, ex2, ey2, x, y, xwidth, i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (EMS_header_height <= 0)
    {
        return;
    }
    ex1 = x1 + 1;
    ex2 = x2 - 1;
    ey1 = MMI_EMS_inputbox.y + 1;
    ey2 = ey1 + MMI_EMS_inputbox.height - 2;
    gui_set_text_clip(ex1, ey1, ex2, ey2);
    gui_set_clip(ex1, ey1, ex2, ey2);
    gui_set_font(&MMI_default_font);
    gui_set_text_color(*current_MMI_theme->UI_black_color);
    gui_draw_filled_area(ex1, y1, ex2, y2, &EMS_viewer_header_background_filler);
    /* MTK Elvis for R2L characters */
    if (r2lMMIFlag)
    {
        x = ex2 - 1;
    }
    else
    {
        x = ex1 + 1;
    }
    /* MTK end */
    y = y1 + 3;
    xwidth = (ex2 - ex1 - 3);
    gui_move_text_cursor(x, y);
    for (i = 0; i < EMS_header_n_lines; i++)
    {
        gui_print_truncated_text(x, y, xwidth, (UI_string_type) EMS_header_text_strings[i]);
        y += EMS_header_text_string_heights[i];
    }
}


/*****************************************************************************
 * FUNCTION
 *  EMS_viewer_measure_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
S32 EMS_viewer_measure_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (EMS_header_height);
}

#endif /* (EMS_VIEWER_HEADER_MULTILINE_INPUTBOX) */ 




#if(ENABLE_EMS_TEST_DEMO)

#define EMS_TEST_DEMO_SCREEN_ID           (MAIN_MENU_BASE+80)
#define EMS_OBJECT_LIST_TEST_SCREEN_ID    (MAIN_MENU_BASE+81)

EMSData EMS_demo_EMS_data;
S32 EMS_demo_object_index;
S32 EMS_demo_n_objects;

void EMS_demo_exit_category28(void);
void EMS_demo_exit_category29(void);
void EMS_demo_exit_object_list(void);
void EMS_demo_enter_object_list(void);
void EMS_demo_exit_object_list2(void);
void EMS_demo_enter_object_list2(void);


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_close_category28
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_close_category28(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory28Screen();
    GoBackHistory();
}

#define EMS_GSM_ASCII_TEST    0
#define EMS_OBJECT_VIEWER_TEST   0


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_category28
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_category28(void)
{
#if(EMS_GSM_ASCII_TEST)
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 s[2] = {0, 0};
    S32 i;
#endif /* (EMS_GSM_ASCII_TEST) */ 

    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEST_DEMO_SCREEN_ID);
    if (guiBuffer == NULL)
    {
        InitializeEMSData(&EMS_demo_EMS_data, SMSAL_DEFAULT_DCS);
    }
#if(EMS_GSM_ASCII_TEST)
    for (i = 0; i < 128; i++)
    {
        s[0] = (U8) i;
        AddString(&EMS_demo_EMS_data, s, 1, NULL);
    }
    ResetCurrentPosition(&EMS_demo_EMS_data);
    EMS_ConvertGSM7BitDefaultEncodingToAscii(&EMS_demo_EMS_data);
    EMS_ConvertAsciiEncodingToGSM7BitDefault(&EMS_demo_EMS_data);
    EMS_ConvertGSM7BitDefaultEncodingToAscii(&EMS_demo_EMS_data);
#endif /* (EMS_GSM_ASCII_TEST) */ 

    ShowCategory28Screen(0, 0, STR_GLOBAL_OK, 0, STR_GLOBAL_BACK, 0, &EMS_demo_EMS_data, guiBuffer);
    SetCategory28RightSoftkeyFunction(EMS_demo_close_category28, KEY_EVENT_UP);
    //      SetKeyHandler(EntryInputMethodScreen,KEY_STAR,KEY_EVENT_UP);
    //      RegisterInputMethodScreenCloseFunction(GoBackHistory);
    SetExitHandler(EMS_TEST_DEMO_SCREEN_ID, EMS_demo_exit_category28);
#if(EMS_OBJECT_VIEWER_TEST)
    SetLeftSoftkeyFunction(EMS_demo_enter_object_list2, KEY_EVENT_UP);
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_exit_category28
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_exit_category28(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEST_DEMO_SCREEN_ID;
    h.entryFuncPtr = EMS_demo_category28;
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#define EMS_DEMO_HIDE_PREDEFINED_OBJECTS  1

EMSObject *EMS_demo_object_list;


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_enter_object_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_enter_object_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_OBJECT_LIST_TEST_SCREEN_ID);
    EMS_demo_object_index = 0;
    EMS_demo_n_objects = 0;
#if(EMS_DEMO_HIDE_PREDEFINED_OBJECTS)
    CreateCategory143ObjectList(&EMS_demo_EMS_data, &EMS_demo_object_list);
#else 
    EMS_demo_object_list = EMS_demo_EMS_data.listHead;
#endif 
    ShowCategory143Screen(
        0,
        0,
        0,
        0,
        STR_GLOBAL_BACK,
        0,
        EMS_demo_object_list,
        &EMS_demo_n_objects,
        &EMS_demo_object_index,
        guiBuffer);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_OBJECT_LIST_TEST_SCREEN_ID, EMS_demo_exit_object_list);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_exit_object_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_exit_object_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if(EMS_DEMO_HIDE_PREDEFINED_OBJECTS)
    FreeCategory143ObjectList(&EMS_demo_object_list);
#endif 
    h.scrnID = EMS_OBJECT_LIST_TEST_SCREEN_ID;
    h.entryFuncPtr = EMS_demo_enter_object_list;
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

U16 EMS_demo_object_list2[] = {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, };
U8 *EMS_demo_object_list3[10];


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_object_list2_loader
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U8 *EMS_demo_object_list2_loader(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (EMS_predefined_pictures[index]);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_enter_object_list2
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_enter_object_list2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_OBJECT_LIST_TEST_SCREEN_ID);
    EMS_demo_object_index = 0;
    EMS_demo_n_objects = 10;

    RegisterCategory144ObjectLoader(EMS_demo_object_list2_loader);
    ShowCategory144Screen(
        0,
        0,
        STR_GLOBAL_OK,
        0,
        STR_GLOBAL_BACK,
        0,
        /* EMS_PREDEFINED_PICTURE */ 0,
        EMS_demo_n_objects,
        NULL,
        EMS_demo_object_list2,
        EMS_demo_object_list3,
        &EMS_demo_object_index,
        guiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetExitHandler(EMS_OBJECT_LIST_TEST_SCREEN_ID, EMS_demo_exit_object_list2);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_exit_object_list2
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_exit_object_list2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_OBJECT_LIST_TEST_SCREEN_ID;
    h.entryFuncPtr = EMS_demo_enter_object_list2;
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

/* Cat29 Demo Entry and Exit functions */

S8 EMS_demo_test_string[] = 
{
    'S', 0, 'a', 0, 'm', 0, 'p', 0, 'l', 0, 'e', 0, ' ', 0, 'S', 0, 'M', 0, 'S', 0, ' ', 0, 't', 0, 'e', 0, 's', 0, 't',
        0, ' ', 0, 'm', 0, 'e', 0, 's', 0, 's', 0, 'a', 0, 'g', 0, 'e', 0, '.', 0, ' ', 0, '1', 0, '2', 0, '3', 0, '4',
        0, ' ', 0, '5', 0, '6', 0, '7', 0, '8', 0, ' ', 0, '9', 0, '0', 0, '1', 0, '2', 0, ' ', 0, 'A', 0, 'B', 0, 'C',
        0, 'D', 0, ' ', 0, 'e', 0, 'f', 0, 'g', 0, 'h', 0, ' ', 0, 'I', 0, 'J', 0, 'K', 0, 'L', 0, ' ', 0, 'm', 0, 'n',
        0, 'o', 0, 'p', 0, ' ', 0, 'Q', 0, 'R', 0, 'S', 0, 'T', 0, ' ', 0, 'u', 0, 'v', 0, 'w', 0, 'x', 0, ' ', 0, 'Y',
        0, 'Z', 0, '\0', 0
};


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_close_category29
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_close_category29(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory29Screen();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_category29
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_category29(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEST_DEMO_SCREEN_ID);
    InitializeEMSData(&EMS_demo_EMS_data, SMSAL_DEFAULT_DCS);
    AddString(&EMS_demo_EMS_data, (U8*) EMS_demo_test_string, sizeof(EMS_demo_test_string) / 2, NULL);
    ShowCategory29Screen(0, 0, 0, 0, STR_GLOBAL_BACK, 0, &EMS_demo_EMS_data, guiBuffer);
    SetRightSoftkeyFunction(EMS_demo_close_category29, KEY_EVENT_UP);
    SetExitHandler(EMS_TEST_DEMO_SCREEN_ID, EMS_demo_exit_category29);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_exit_category29
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_exit_category29(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEST_DEMO_SCREEN_ID;
    h.entryFuncPtr = EMS_demo_category29;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

S8 EMS_demo_header_string[] =
    { 'S', 0, 'a', 0, 'm', 0, 'p', 0, 'l', 0, 'e', 0, ' ', 0, 'h', 0, 'e', 0, 'a', 0, 'd', 0, 'e', 0, 'r', 0, '\n', 0,
'm', 0, 'e', 0, 's', 0, 's', 0, 'a', 0, 'g', 0, 'e', 0, ' ', 0, 's', 0, 't', 0, 'r', 0, 'i', 0, 'n', 0, 'g', 0, '\n', 0, '1', 0, '2', 0,
'3', 0, '4', 0, '5', 0, '6', 0, '\0', 0
};

S8 EMS_demo_header_ASCII_string[] = "From: \nABCDE FGHIJKLMNOP\n03/04/2003\n08:24:35\n";

U8 EMS_demo_header_temp_string[1024];

void EMS_demo_exit_category39(void);


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_close_category39
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_close_category39(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory39Screen();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_category39
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_category39(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecuteCurrExitHandler();
    guiBuffer = GetCurrGuiBuffer(EMS_TEST_DEMO_SCREEN_ID);
    InitializeEMSData(&EMS_demo_EMS_data, SMSAL_DEFAULT_DCS);
    AddString(&EMS_demo_EMS_data, (U8*) EMS_demo_test_string, sizeof(EMS_demo_test_string) / 2, NULL);
    mmi_asc_to_ucs2(EMS_demo_header_temp_string, EMS_demo_header_ASCII_string);
    ShowCategory39Screen(0, 0, 0, 0, STR_GLOBAL_BACK, 0, &EMS_demo_EMS_data, EMS_demo_header_temp_string, guiBuffer);
    SetRightSoftkeyFunction(EMS_demo_close_category39, KEY_EVENT_UP);
    SetExitHandler(EMS_TEST_DEMO_SCREEN_ID, EMS_demo_exit_category39);
}


/*****************************************************************************
 * FUNCTION
 *  EMS_demo_exit_category39
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void EMS_demo_exit_category39(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    h.scrnID = EMS_TEST_DEMO_SCREEN_ID;
    h.entryFuncPtr = EMS_demo_category39;
    h.inputBuffer[0] = '\0';
    GetCategoryHistory(h.guiBuffer);
    AddHistory(h);
}

#endif /* (ENABLE_EMS_TEST_DEMO) */ 

#endif /* (!UI_DISABLE_EMS_CATEGORY_SCREENS) */ 


/*****************************************************************************
 * FUNCTION
 *  is_EMS_inputbox_in_view_mode
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_BOOL is_EMS_inputbox_in_view_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (MMI_EMS_inputbox.flags & UI_EMS_INPUT_BOX_VIEW_MODE)
    {
        return MMI_TRUE;
    }
    else
    {
        return MMI_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  wgui_EMS_set_text_format
 * DESCRIPTION
 *  
 * PARAMETERS
 *  text_format     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void wgui_EMS_set_text_format(EMSTextFormat text_format)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    wgui_EMS_text_format = text_format;
}

