/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 * JMMSViewUI.C
 *
 * Project:
 * --------
 *   MAUI
 *
 * Description:
 * ------------
 *   This file is intends for ¡K.
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
/*  Include: MMI header file */
#include "MMI_include.h"
#if (defined (JATAAYU_SUPPORT) && defined(MMS_SUPPORT))

#include "CommonScreens.h"
#include "SettingProfile.h"
#include "MessagesResourceData.h"
#include "JMMSView.h"
#include "JMMSExdcl.h"
#include "JMMSResDef.h"
#include "JMMSCoreAPI.h"
#include "JMMSCompose.h"
#include "JMMSMainMMS.h"
#include "JBrowserResDef.h"
/* ... Add More MMI header */
#include "jdi_MMSErr.h"
#include "jcerror.h"
#include "MainMenuDef.h"

#include "FileManagerDef.h"
#include "FileMgr.h"
/* MAUI_00019204 Start */
#include "Fmt_struct.h" /* sanjeev added for aync progress screen for copy operation. */
/* MAUI_00019204 End */

#if defined(__MMI_AUDIO_PLAYER__)
#include "mdi_datatype.h"       /* dependent headers for AudioPlayerProt.h" */
#include "AudioPlayerProt.h"
#endif /* defined(__MMI_AUDIO_PLAYER__) */ 

#include "jdd_ui_datatypes.h"   /* Added By Shantanu - 20060810 */
#include "jdd_ui_window.h"
#include "jdd_fileapi.h"
#include "WPSSProtos.h"
#include "JMMSDRMHandler.h"
#include "JMMSProtocols.h"
#ifdef __MMI_VIDEO_PLAYER__
#include "jdd_videoapi.h"
#endif 
#ifdef __MMI_TOUCH_SCREEN__
#include "jdd_ui_pen_support.h"
#endif 
#include "JMMSMainMMS.h"
#include "JMMSWriteMMS.h"
#include "JMMSJSRHandler.h"


#ifdef __MMI_UNIFIED_MESSAGE__
#include "JMMSUMHandling.h"
#include "JMMSInbox.h"
#include "JMMSOutBox.h"
#include "JMMSDrafts.h"
#include "JMMSSent.h"
#include "JMMSTemplates.h"
#include "JMMSStoreHandling.h"
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

#include "CallManagementGprot.h"
#include "gpioInc.h"
/* MAUI_00019327 Start */
#include "ViewEventUtils.h"
#include "ProfileGprots.h"
#include "jdd_ui_utils.h"
#include "jdd_mmiapi.h"
#include "gpioInc.h"
#include "FileManagerGProt.h"
/* MAUI_00019327 End */
#ifdef __MMI_UNIFIED_COMPOSER__
#include "JMMSUCInterfaceProt.h"
#include "UnifiedComposerResDef.h"
#endif /* __MMI_UNIFIED_COMPOSER__ */ 

/*  Include: PS header file */
/* ... Add More PS header */

/***************************************************************************** 
* Define
*****************************************************************************/

/***************************************************************************** 
* Typedef 
*****************************************************************************/

/***************************************************************************** 
* Local Variable
*****************************************************************************/

/***************************************************************************** 
* Local Function
*****************************************************************************/

/***************************************************************************** 
* Global Variable
*****************************************************************************/

/***************************************************************************** 
* Global Function
*****************************************************************************/
extern void mmi_jdd_refresh_block_on_for_replay(void);
extern kal_wchar *mime_get_extension(kal_wchar *file_path);


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_init
 * DESCRIPTION
 *  Initialization function of MMS view/preview.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_UNIFIED_COMPOSER__
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_REPLAY_MMS, mmi_jmms_highlight_preview_replay);
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_PREVIOUS_SLIDE, mmi_jmms_highlight_preview_prev_slide);
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_NEXT_SLIDE, mmi_jmms_highlight_preview_next_slide);
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_SLIDE_LIST, mmi_jmms_highlight_preview_slide_list);
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_AUDIO, mmi_jmms_highlight_preview_play_audio);
    SetHiliteHandler(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_VIDEO, mmi_jmms_highlight_preview_play_video);
    SetHiliteHandler(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS, mmi_jmms_highlight_save_video_object);
    SetHiliteHandler(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS, mmi_jmms_highlight_save_audio_object);
    SetHiliteHandler(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS, mmi_jmms_highlight_save_image_object);
    SetHiliteHandler(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS, mmi_jmms_highlight_view_attachments);
#ifndef __MMI_UNIFIED_MESSAGE__
    SetHiliteHandler(MENU_ID_JMMS_VIEW_OPTIONS_REPLAY_MMS, mmi_jmms_highlight_view_replay);
    SetHiliteHandler(MENU_ID_JMMS_VIEW_OPTIONS_GOTO, mmi_jmms_highlight_view_goto);
    SetHiliteHandler(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_PREVIOUS_SLIDE, mmi_jmms_highlight_goto_prev_slide);
    SetHiliteHandler(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_NEXT_SLIDE, mmi_jmms_highlight_goto_next_slide);
    SetHiliteHandler(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_SLIDE_LIST, mmi_jmms_highlight_goto_slide_list);
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
}

#ifndef __MMI_UNIFIED_COMPOSER__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_replay
 * DESCRIPTION
 *  highlight fn for menu option preview-Replay MMS
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_replay(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_play_mms, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_prev_slide
 * DESCRIPTION
 *  highlight fn for menu option preview previous slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_prev_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_prev_slide, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_next_slide
 * DESCRIPTION
 *  highlight fn for menu option preview next_p slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_next_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_next_slide, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_slide_list
 * DESCRIPTION
 *  highlight fn for menu option preview slide list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_slide_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_goto_slide_list, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __MMI_UNIFIED_COMPOSER__ */


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_play_audio
 * DESCRIPTION
 *  highlight fn for menu option preview- play audio
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_play_audio(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_view_play_audio, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_preview_play_video
 * DESCRIPTION
 *  highlight fn for menu option preview:play video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_preview_play_video(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_view_play_video, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_view_attachments
 * DESCRIPTION
 *  highlight fn for menu option to view attachemnts
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_view_attachments(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->view_context->view_parent_menu_id = MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS;

    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_view_attachment, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    /* MAUI_00018463 Start */
    SetKeyHandler(mmi_jmms_view_attachment, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* MAUI_00018463 End */

}

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_view_replay
 * DESCRIPTION
 *  highlight fn for menu option replay mms
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_view_replay(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_play_mms, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_preview_play_mms, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_preview_play_mms, KEY_WAP, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_view_goto
 * DESCRIPTION
 *  highlight fn for menu option goto slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_view_goto(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_goto_options, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_entry_goto_options, KEY_WAP, KEY_EVENT_DOWN);
    /* MAUI_00018463 Start */
    SetKeyHandler(mmi_jmms_entry_goto_options, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* MAUI_00018463 End */
}

#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_save_video_object
 * DESCRIPTION
 *  highlight fn for menu option to save video
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_save_video_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->view_context->view_parent_menu_id = MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS;

    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_save_media_as, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_save_image_object
 * DESCRIPTION
 *  highlight fn for menu option to save image
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_save_image_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->view_context->view_parent_menu_id = MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS;
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_save_media_as, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_save_audio_object
 * DESCRIPTION
 *  highlight fn for menu option to save audio
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_save_audio_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->view_context->view_parent_menu_id = MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS;

    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_save_media_as, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

#ifndef __MMI_UNIFIED_COMPOSER__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_goto_prev_slide
 * DESCRIPTION
 *  highlight fn for menu option goto->prev slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_goto_prev_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_prev_slide, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_goto_next_slide
 * DESCRIPTION
 *  highlight fn for menu option goto->nest slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_goto_next_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_preview_next_slide, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_goto_slide_list
 * DESCRIPTION
 *  highlight fn for menu option goto->slide list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_goto_slide_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, 0);
    ChangeRightSoftkey(STR_GLOBAL_BACK, 0);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_jmms_entry_goto_slide_list, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    /* MAUI_00018463 Start */
    SetKeyHandler(mmi_jmms_entry_goto_slide_list, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    /* MAUI_00018463 End */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_goto_slide_list
 * DESCRIPTION
 *  entry fn for menu option goto->slide list
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_goto_slide_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer_p;
    U8 count;
    S8 local_string_ascii[20];
    S8 local_string_ucs2[40];
    U8 num_slides;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_VIEW_GOTO_SLIDE_LIST, NULL, mmi_jmms_entry_goto_slide_list, NULL);
    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_VIEW_GOTO_SLIDE_LIST);

    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &num_slides);

    RegisterHighlightHandler(mmi_jmms_view_goto_slide_list_highlight_hdlr);

    for (count = 0; count < num_slides; count++)
    {
        memset(local_string_ascii, 0, 20);
        memset(local_string_ucs2, 0, 40);
        memset((S8*) subMenuDataPtrs[count], 0, (MAX_SUBMENU_CHARACTERS + 1) * ENCODING_LENGTH);
        sprintf(local_string_ascii, "%d", count + 1);

        mmi_ucs2ncpy((S8*) subMenuDataPtrs[count], GetString(STR_ID_JMMS_SLIDE), MAX_SUBMENU_CHARACTERS - 2);   /* 2 is subtracted to accomodate slide number */
        mmi_asc_to_ucs2((S8*) local_string_ucs2, (S8*) local_string_ascii);
        mmi_ucs2cat((S8*) subMenuDataPtrs[count], (S8*) local_string_ucs2);
    }

    ShowCategory6Screen(
        STR_ID_JMMS_SLIDE_LIST,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        (S32) num_slides,
        (U8 **) subMenuDataPtrs,
        NULL,
        0,
        gui_buffer_p);

    if ((IsScreenPresent(SCR_ID_JMMS_PREVIEW_OPTIONS) == TRUE) || (IsScreenPresent(SCR_ID_JMMS_VIEW_OPTIONS) == TRUE))
    {
        SetLeftSoftkeyFunction(mmi_jmms_preview_selected_slide, KEY_EVENT_UP);
    }
    else
    {
        SetLeftSoftkeyFunction(mmi_jmms_edit_content_goto_slide, KEY_EVENT_UP);
    }

    /* SetKeyHandler(EntryDwnlImageOption,KEY_RIGHT_ARROW,KEY_EVENT_DOWN); */
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_preview_options
 * DESCRIPTION
 *  Entry function when user press preview options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_preview_options(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 str_item_list[MAX_SUB_MENUS];   /* Stores the strings id of submenus returned */
    U16 num_item;                       /* Stores no of children in the submenu */
    U16 disp_Attribute;                 /* Stores display attribue */
    U8 *gui_buffer_p;                   /* Buffer holding history data */
    U16 parent_id;
    U8 page_count;
    U8 curr_page;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);

    EntryNewScreen(SCR_ID_JMMS_PREVIEW_OPTIONS, NULL, mmi_jmms_entry_preview_options, NULL);

    parent_id = MENU_ID_JMMS_PREVIEW_OPTIONS;

    SetParentHandler(parent_id);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_PREVIEW_OPTIONS);

    disp_Attribute = GetDispAttributeOfItem(parent_id);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    if (curr_page > 1)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PREVIOUS_SLIDE);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PREVIOUS_SLIDE);
    }

    if (page_count > curr_page)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_NEXT_SLIDE);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_NEXT_SLIDE);
    }

    if (page_count > 1)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_SLIDE_LIST);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_SLIDE_LIST);
    }

    if (g_jmms_context->view_context->view_audio_id == 0)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_AUDIO);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_AUDIO);
    }

    if (g_jmms_context->view_context->view_video_id == 0)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_VIDEO);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_PREVIEW_OPTIONS_PLAY_VIDEO);
    }

    num_item = GetNumOfChild_Ext(parent_id);

    GetSequenceStringIds_Ext(parent_id, str_item_list);

    ShowCategory52Screen(
        STR_GLOBAL_OPTIONS,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_item,
        str_item_list,
        (PU16) gIndexIconsImageList,
        NULL,
        0,
        0,
        gui_buffer_p);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}
#endif /* __MMI_UNIFIED_COMPOSER__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_goto_slide_list_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for slide list screen
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_goto_slide_list_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->curr_scr_hilite_index = index;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_save_object
 * DESCRIPTION
 *  Entry function when user press view goto options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_save_object(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 str_item_list[MAX_SUB_MENUS];   /* Stores the strings id of submenus returned */
    U16 num_item;                       /* Stores no of children in the submenu */
    U16 disp_Attribute;                 /* Stores display attribue */
    U8 *gui_buffer_p;                   /* Buffer holding history data */
    U16 parent_id;
    U8 media_count;
    JMMS_COMP_ERRCODE ret_code;
    MEDIA_INFO *media_info_p;
    U8 curr_page = 0;
    MEDIA_INFO *image_info_p;

    //U8 page_count;
    //U8 num_attchments;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    image_info_p = mmi_jmms_jdi_get_image_data(curr_page);

    EntryNewScreen(SCR_ID_JMMS_SAVE_OBJECT, NULL, mmi_jmms_entry_save_object, NULL);

    parent_id = MENU_ID_JMMS_INBOX_OPTIONS_SAVE_OBJECTS;

    SetParentHandler(parent_id);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_SAVE_OBJECT);

    disp_Attribute = GetDispAttributeOfItem(parent_id);

    if (g_jmms_context->view_context->view_audio_id == 0)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS);
    }

    if (g_jmms_context->view_context->view_video_id == 0)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS);
    }

    if (image_info_p == NULL)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS);
    }

    mmi_jmms_jdi_get_media_count(g_jmms_context->msg_handle, 0, &media_count, E_TRUE);

    if (media_count == 0)
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS);
    }
    else
    {
        ret_code = mmi_jmms_compose_get_media_list(0, &media_info_p, &media_count, E_TRUE);
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS);
    }

    num_item = GetNumOfChild_Ext(parent_id);

    GetSequenceStringIds_Ext(parent_id, str_item_list);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory52Screen(
        STR_ID_JMMS_OPTIONS_SAVE_OBJECTS,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_item,
        str_item_list,
        (PU16) gIndexIconsImageList,
        NULL,
        0,
        0,
        gui_buffer_p);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_jdi_get_image_data
 * DESCRIPTION
 *  get image data from msg handle.
 * PARAMETERS
 *  page_index      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
MEDIA_INFO *mmi_jmms_jdi_get_image_data(U8 page_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_UINT8 media_count, count;
    JC_RETCODE ret_code;
    MEDIA_INFO *media_info_list_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_get_media_list(g_jmms_context->msg_handle, page_index, &media_info_list_p, &media_count, E_FALSE);
    if (ret_code == JC_OK)
    {
        for (count = 0; count < media_count; count++)
        {
            if (media_info_list_p->eMediaType == E_MEDIA_IMAGE)
            {
                return media_info_list_p;
            }
            else
            {
                media_info_list_p = media_info_list_p->pNext;
            }
        }
    }
    return NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_view_options
 * DESCRIPTION
 *  Entry function when user press view options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifndef __MMI_UNIFIED_MESSAGE__
void mmi_jmms_entry_view_options(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 str_item_list[MAX_SUB_MENUS];   /* Stores the strings id of submenus returned */
    U16 num_item;                       /* Stores no of children in the submenu */
    U16 disp_Attribute;                 /* Stores display attribue */
    U8 *gui_buffer_p;                   /* Buffer holding history data */
    U16 parent_id;
    U8 page_count;
    U8 num_attchments;
    U8 curr_page = 0;
    MEDIA_INFO *image_info_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_VIEW_OPTIONS, NULL, mmi_jmms_entry_view_options, NULL);

    parent_id = MENU_ID_JMMS_VIEW_OPTIONS;

    SetParentHandler(parent_id);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_VIEW_OPTIONS);

    disp_Attribute = GetDispAttributeOfItem(parent_id);

    mmi_jmms_jdi_get_media_count(g_jmms_context->msg_handle, 0, &num_attchments, E_TRUE);

    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    image_info_p = mmi_jmms_jdi_get_image_data(curr_page);

    if (num_attchments || g_jmms_context->view_context->view_audio_id || g_jmms_context->view_context->view_video_id
        || image_info_p != NULL)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_INBOX_OPTIONS_SAVE_OBJECTS);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_INBOX_OPTIONS_SAVE_OBJECTS);
    }

    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);

    if (page_count > 1)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO);
    }

    num_item = GetNumOfChild_Ext(parent_id);

    GetSequenceStringIds_Ext(parent_id, str_item_list);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory52Screen(
        STR_GLOBAL_OPTIONS,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_item,
        str_item_list,
        (PU16) gIndexIconsImageList,
        NULL,
        0,
        0,
        gui_buffer_p);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_goto_options
 * DESCRIPTION
 *  Entry function when user press view goto options
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_goto_options(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 str_item_list[MAX_SUB_MENUS];   /* Stores the strings id of submenus returned */
    U16 num_item;                       /* Stores no of children in the submenu */
    U16 disp_Attribute;                 /* Stores display attribue */
    U8 *gui_buffer_p;                   /* Buffer holding history data */
    U16 parent_id;
    U8 page_count;
    U8 curr_page;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);

    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);

    EntryNewScreen(SCR_ID_JMMS_VIEW_GOTO, NULL, mmi_jmms_entry_goto_options, NULL);

    parent_id = MENU_ID_JMMS_VIEW_OPTIONS_GOTO;

    SetParentHandler(parent_id);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_VIEW_GOTO);

    disp_Attribute = GetDispAttributeOfItem(parent_id);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    if (curr_page > 1)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_PREVIOUS_SLIDE);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_PREVIOUS_SLIDE);
    }

    if (page_count > curr_page)
    {
        mmi_frm_unhide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_NEXT_SLIDE);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_JMMS_VIEW_OPTIONS_GOTO_NEXT_SLIDE);
    }

    num_item = GetNumOfChild_Ext(parent_id);

    GetSequenceStringIds_Ext(parent_id, str_item_list);

    ShowCategory52Screen(
        STR_ID_JMMS_SLIDE_LIST,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_item,
        str_item_list,
        (PU16) gIndexIconsImageList,
        NULL,
        0,
        0,
        gui_buffer_p);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}

#else /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_back_from_option_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_back_from_option_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (IsScreenPresent(SCR_ID_JMMS_PREVIEW) == MMI_FALSE)
    {
        mmi_jmms_deinit_mms_context(g_jmms_context);
    }
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_show_blank_mms_option_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_show_blank_mms_option_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_jmms_context->store_context->current_folder_name)
    {
        case E_JMMS_INBOX:
            mmi_jmms_pre_entry_inbox_options_scren();
            break;
        case E_JMMS_OUTBOX:
            mmi_jmms_entry_outbox_options_scren();
            break;
        case E_JMMS_SENT:
            mmi_jmms_entry_sent_options_scren();
            break;
        case E_JMMS_DRAFTS:
            mmi_jmms_entry_drafts_options_scren();
            break;
        case E_JMMS_TEMPLATES:
            SetLeftSoftkeyFunction(mmi_jmms_entry_templates_view_options_scren, KEY_EVENT_UP);
            break;
        default:
            break;
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_set_view_left_softkey
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_set_view_left_softkey(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_jmms_context->store_context->current_folder_name)
    {
        case E_JMMS_INBOX:
            SetLeftSoftkeyFunction(mmi_jmms_pre_entry_inbox_options_scren, KEY_EVENT_UP);
            break;
        case E_JMMS_OUTBOX:
            SetLeftSoftkeyFunction(mmi_jmms_entry_outbox_options_scren, KEY_EVENT_UP);
            break;
        case E_JMMS_SENT:
            SetLeftSoftkeyFunction(mmi_jmms_entry_sent_options_scren, KEY_EVENT_UP);
            break;
        case E_JMMS_DRAFTS:
            SetLeftSoftkeyFunction(mmi_jmms_entry_drafts_options_scren, KEY_EVENT_UP);
            break;
        case E_JMMS_TEMPLATES:
            SetLeftSoftkeyFunction(mmi_jmms_entry_templates_view_options_scren, KEY_EVENT_UP);
            break;
        default:
            SetLeftSoftkeyFunction(NULL, KEY_EVENT_UP);
            break;
    }
}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_entry_mms_view
 * DESCRIPTION
 *  pre Entry function for mms View
 * PARAMETERS
 *  content     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
JC_RETCODE mmi_jmms_pre_entry_mms_view(CONTENT_DATA *content)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    JC_RETCODE ret_code = JC_OK;

    U8 config_arg = JMMS_CONFIG_VIEW;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->view_context == NULL)
    {
        g_jmms_context->view_context =
            (mmi_jmms_view_context_struct*) jdd_MemAlloc(sizeof(mmi_jmms_view_context_struct), 1);
        if (g_jmms_context->view_context == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
    }

    g_jmms_context->view_context->view_config_arg = JMMS_CONFIG_VIEW;

    if (g_jmms_context->msg_handle != NULL)
    {
        ret_code = mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
    }

    if (ret_code == JC_OK)
    {
        g_jmms_context->msg_handle = NULL;
        ret_code = mmi_jmms_jdi_msg_init(&g_jmms_context->msg_handle, (void*)config_arg);
    }

    if (ret_code == JC_ERR_MEMORY_ALLOCATION)
    {
        goto ERROR_HANDLE;
    }

    g_jmms_context->view_context->curr_view_state = PRESENTATION_START_STATE;

    g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;
#ifdef __DRM_SUPPORT__
    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_IND,
                (void*)mmi_jmms_drm_indication_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_UPDATE_RIGHTS,
                (void*)mmi_jmms_drm_rights_update_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_INFO_LIST,
                (void*)mmi_jmms_drm_info_list_ind_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_CANCEL,
                (void*)mmi_jmms_drm_cancel_parse_handler);
#endif /* __DRM_SUPPORT__ */ 

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_ERROR_IND,
                (void*)mmi_jmms_error_ind_cb);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_REPLY_CHARGING,
                (void*)mmi_jmms_reply_charging_ind_cb);

    if (g_jmms_context->parse_content_p != NULL)
    {
        jdd_MemFree(g_jmms_context->parse_content_p);
    }
    g_jmms_context->parse_content_p = (CONTENT_DATA*) jdd_MemAlloc(sizeof(CONTENT_DATA), 1);

    memcpy(g_jmms_context->parse_content_p, content, sizeof(CONTENT_DATA));

    mmi_jmms_view_show_progressing_screen();
    ret_code = mmi_jmms_jdi_msg_view(g_jmms_context->msg_handle, g_jmms_context->parse_content_p);

    if (ret_code == JC_ERR_MMS_PARSE_PENDING)
    {
        mmi_jmms_parse_continue_start_timer(
            g_jmms_context->msg_handle,
            mmi_jmms_pre_entry_mms_view_async_callback,
            mmi_jmms_only_abort_view_progress);
        return ret_code;
    }
    mmi_jmms_pre_entry_mms_view_async_callback(ret_code);
    return ret_code;

  ERROR_HANDLE:

    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }

        mmi_jmms_view_handle_error(ret_code);
    }
    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_entry_mms_view_async_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_pre_entry_mms_view_async_callback(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_pre_entry_mms_view_async_callback");

    if (ret_code != JC_OK)
    {
        if (GetActiveScreenId() == SCR_ID_JMMS_PARSING_PROGRESS)
        {
            mmi_jmms_view_handle_error(ret_code);
        }
        goto ERROR_HANDLE;
    }

    /* g_jmms_context->view_context->jdd_view_window_id = 0; */

    if (ret_code == JC_OK)
    {
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_ATTACHMENT_MISC_IND,
                    (void*)mmi_jmms_attachment_misc_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_AUDIO_VIDEO_UNKNOWN_IND,
                    (void*)mmi_jmms_audio_video_unknown_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_FOCUS_CHANGED_IND,
                    (void*)mmi_jmms_focus_change_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_PAGE_PRESENTATION_IND,
                    (void*)mmi_jmms_page_presentation_ind_cb);
        if (ret_code == JC_OK)
        {
            if (mmi_jmms_is_rc_info_present() == E_TRUE)
            {
                U8 *temp_rc_str = subMenuData[0];

                mmi_ucs2cpy((S8*) temp_rc_str, (S8*) GetString(STR_ID_JMMS_VIEW_REPLY_CHARGING));

                if (g_jmms_context->rc_info->eRCType == E_REPLY_CHARGING_ACCEPTED_TEXT_ONLY)
                {
                    mmi_ucs2cat((S8*) temp_rc_str, (S8*) GetString(STR_ID_JMMS_VIEW_RC_TEXT_ONLY));
                }

                if (g_jmms_context->rc_info->uiRCSize > 0)
                {
                    S8 temp1[15], temp2[30];

                    sprintf(temp1, "%d bytes", g_jmms_context->rc_info->uiRCSize);
                    mmi_asc_to_ucs2(temp2, temp1);
                    mmi_ucs2cat((S8*) temp_rc_str, (S8*) GetString(STR_ID_JMMS_VIEW_RC_SIZE));
                    mmi_ucs2cat((S8*) temp_rc_str, temp2);

                }

                if (g_jmms_context->rc_info->uiRCTime > 0)
                {
                    S8 temp1[15], temp2[30];
                    U32 temp_rc_time = g_jmms_context->rc_info->uiRCTime;

                    mmi_ucs2cat((S8*) temp_rc_str, (S8*) GetString(STR_ID_JMMS_VIEW_RC_TIME));

                    if (temp_rc_time > 3600)
                    {
                        U32 temp_time_hr = g_jmms_context->rc_info->uiRCTime / 3600;

                        sprintf(temp1, "%d hr", temp_time_hr);
                        mmi_asc_to_ucs2(temp2, temp1);
                        mmi_ucs2cat((S8*) temp_rc_str, temp2);

                        temp_rc_time = g_jmms_context->rc_info->uiRCTime - temp_time_hr * 3600;

                    }
                    else if (temp_rc_time > 60)
                    {
                        U32 temp_time_min = g_jmms_context->rc_info->uiRCTime / 60;

                        sprintf(temp1, " %d min", temp_time_min);
                        mmi_asc_to_ucs2(temp2, temp1);
                        mmi_ucs2cat((S8*) temp_rc_str, temp2);
                    }

                }

                DisplayPopupCallBack(
                    (PU8) temp_rc_str,
                    IMG_GLOBAL_WARNING,
                    1,
                    JMMS_POPUP_TIME,
                    WARNING_TONE,
                    mmi_jmms_pre_checks_mms_view);

            }
            else
            {
                mmi_jmms_pre_checks_mms_view();
            }

        }
    }

    if (ret_code != JC_OK)
    {
        mmi_jmms_view_handle_error(ret_code);
    }

  ERROR_HANDLE:
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            g_jmms_context->parse_content_p->pFileName = NULL;
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }
    }
    DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
    DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
    DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_PROGRESS);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_checks_mms_view
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_pre_checks_mms_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_UINT8 page_count;
    U8 media_count;

#ifdef LARGE_MMS_HANDLING
    JC_BOOLEAN result = E_FALSE;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    if (page_count > 0)
    {
        g_jmms_context->view_context->slide_time_elapsed = 0;
    #ifdef LARGE_MMS_HANDLING
        mmi_jmms_is_text_limit_exceed(g_jmms_context->msg_handle, &result);
        if (result)
        {
            history hist;

            reset_small_screen();
            memset(&hist, 0, sizeof(history));
            hist.scrnID = SCR_ID_JMMS_PREVIEW;
            hist.entryFuncPtr = mmi_jmms_entry_mms_preview;
            AddHistory(hist);
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_LARGE_TEXT_MMS),
                IMG_GLOBAL_WARNING,
                1,
                JMMS_POPUP_TIME,
                WARNING_TONE);
        }
        else
    #endif /* LARGE_MMS_HANDLING */ 
        {
            mmi_jmms_entry_mms_preview();
        }
    }
    else
    {
        mmi_jmms_jdi_get_media_count(g_jmms_context->msg_handle, 0, &media_count, E_TRUE);
        if (media_count == 0)
        {
        #ifdef __MMI_UNIFIED_MESSAGE__
            DisplayPopupCallBack(
                (PU8) GetString(STR_ID_JMMS_BLANK_MMS),
                IMG_GLOBAL_WARNING,
                1,
                JMMS_POPUP_TIME,
                WARNING_TONE,
                mmi_jmms_show_blank_mms_option_screen);

        #else /* __MMI_UNIFIED_MESSAGE__ */ 
            DisplayPopup((PU8) GetString(STR_ID_JMMS_BLANK_MMS), IMG_GLOBAL_WARNING, 1, JMMS_POPUP_TIME, WARNING_TONE);
            mmi_jmms_deinit_mms_context(g_jmms_context);
        #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        }
        else
        {
            DisplayPopupCallBack((PU8) GetString(STR_ID_JMMS_NO_SLIDE_ONLY_ATTAHMENT),
                                 IMG_GLOBAL_WARNING, 1, JMMS_POPUP_TIME, WARNING_TONE,
        #ifndef __MMI_UNIFIED_MESSAGE__
                                 mmi_jmms_view_attachment); /* sachin */
        #else 
                                 mmi_jmms_show_blank_mms_option_screen);
        #endif 
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_restore_view_callbacks
 * DESCRIPTION
 *  Restores the view callbacks if forward fails
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __MMI_UNIFIED_MESSAGE__
void mmi_jmms_restore_view_callbacks(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE err_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __DRM_SUPPORT__
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_IND,
                (void*)mmi_jmms_drm_indication_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_UPDATE_RIGHTS,
                (void*)mmi_jmms_drm_rights_update_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_INFO_LIST,
                (void*)mmi_jmms_drm_info_list_ind_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_CANCEL,
                (void*)mmi_jmms_drm_cancel_parse_handler);

#endif /* __DRM_SUPPORT__ */ 
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_ATTACHMENT_MISC_IND,
                (void*)mmi_jmms_attachment_misc_ind_cb);
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_AUDIO_VIDEO_UNKNOWN_IND,
                (void*)mmi_jmms_audio_video_unknown_ind_cb);
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_FOCUS_CHANGED_IND,
                (void*)mmi_jmms_focus_change_ind_cb);
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_PAGE_PRESENTATION_IND,
                (void*)mmi_jmms_page_presentation_ind_cb);
}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_entry_mms_preview
 * DESCRIPTION
 *  pre Entry function for mms preview
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_pre_entry_mms_preview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE err_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_deinitview(g_jmms_context->msg_handle);
    if (g_jmms_context->view_context == NULL)
    {
        g_jmms_context->view_context =
            (mmi_jmms_view_context_struct*) jdd_MemAlloc(sizeof(mmi_jmms_view_context_struct), 1);
        if (g_jmms_context->view_context == NULL)
        {
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            return;
        }
    }

    g_jmms_context->view_context->curr_view_state = PRESENTATION_START_STATE;

    g_jmms_context->view_context->curr_sliding_bar_status = 0;  /* To display sliding bar as blank */

    g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;

#ifdef __DRM_SUPPORT__
    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_IND,
                (void*)mmi_jmms_drm_indication_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_UPDATE_RIGHTS,
                (void*)mmi_jmms_drm_rights_update_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_INFO_LIST,
                (void*)mmi_jmms_drm_info_list_ind_handler);

    err_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_CANCEL,
                (void*)mmi_jmms_drm_cancel_parse_handler);

#endif /* __DRM_SUPPORT__ */ 

    err_code = mmi_jmms_jdi_msg_view(g_jmms_context->msg_handle, NULL);

    /* g_jmms_context->view_context->jdd_view_window_id = 0; */

    g_jmms_context->view_context->view_config_arg = JMMS_CONFIG_PREVIEW;

    if (err_code == JC_OK)
    {
        err_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_ATTACHMENT_MISC_IND,
                    (void*)mmi_jmms_attachment_misc_ind_cb);
        err_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_AUDIO_VIDEO_UNKNOWN_IND,
                    (void*)mmi_jmms_audio_video_unknown_ind_cb);
        err_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_FOCUS_CHANGED_IND,
                    (void*)mmi_jmms_focus_change_ind_cb);
        err_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_PAGE_PRESENTATION_IND,
                    (void*)mmi_jmms_page_presentation_ind_cb);
        if (err_code == JC_OK)
        {
            g_jmms_context->view_context->slide_time_elapsed = 0;
            mmi_jmms_entry_mms_preview();
        }
    }

    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_start_mms_preview
 * DESCRIPTION
 *  Fn to start MMS preview
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_start_mms_preview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_START_VIEW start_display;
    DeviceCharacteristics dev_ch = {0};
    JC_RETCODE err_code;
    JC_WINDOW_PROPERTIES window_properties = {0, };
    JC_UINT32 window_id;
    JC_RECT window_rect;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    window_properties.eWindowStyle = E_MAIN_WINDOW;
    window_properties.pszCaptionValue = NULL;
    window_properties.srcTaskInfo.iAppID = E_TASK_MMS_UI;

    err_code = jdd_MMIGetDeviceCharacteristics(&dev_ch);

    window_rect.iLeft = dev_ch.uiWindowX;
    window_rect.iTop = dev_ch.uiWindowY;
    window_rect.uiWidth = dev_ch.uiActualWidth;
    window_rect.uiHeight = dev_ch.uiActualHeight;

    if (g_jmms_context->view_context->jdd_view_window_id != 0)
    {
        err_code = jdd_MMIDestroyWindow(g_jmms_context->view_context->jdd_view_window_id);
        g_jmms_context->view_context->jdd_view_window_id = 0;
    }

    jdd_MMICreateWindow(&window_properties, &window_rect, &window_id);

    jdd_MMIBeginDisplay(window_id); /* vikas */
    jdd_MMIShowWindow(window_id, E_TRUE);

    g_jmms_context->view_context->jdd_view_window_id = window_id;

    start_display.uiWindowID = window_id;
    start_display.bViewPageOnly = E_FALSE;
    start_display.ucPageIndex = 0;

    // Deepali: When values are changed for start_display, please change them in mmi_jmms_set_region_list also.
    // Here they want view rect as complete including scrollbar.
    start_display.Rect.iLeft = 0;
    start_display.Rect.iTop = 0;

    start_display.Rect.uiHeight = dev_ch.uiRenderingHeight + dev_ch.uiScrollBarWidth;
    start_display.Rect.uiWidth = dev_ch.uiRenderingWidth + dev_ch.uiScrollBarWidth;

    start_display.eViewMode = E_PORTRAIT_MODE;

    g_jmms_context->view_context->view_navigate_state = NAVIGATION_PLAYING_STATE;

    if (err_code == JC_OK)
    {
        g_jmms_context->view_context->slide_time_elapsed = 0;
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_START, &start_display);
    }
    jdd_MMIEndDisplay(window_id, E_TRUE);

    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_draw_sliding_bar
 * DESCRIPTION
 *  Fn to draw sliding bar
 * PARAMETERS
 *  sliding_bar_fill_state      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_draw_sliding_bar(U8 sliding_bar_fill_state)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (sliding_bar_fill_state == 0)
    {
    #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
        DrawCat276SlidingBar(0, g_jmms_context->view_context->curr_view_page_duration);
    #else 
        DrawCat276SlidingBar(0);
    #endif 
    }
    else
    {
    #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
        DrawCat276SlidingBar(100, 0);
    #else 
        DrawCat276SlidingBar(100);
    #endif 
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_update_sliding_bar
 * DESCRIPTION
 *  Fn to update sliding bar
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_update_sliding_bar(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 percentage = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    if (g_jmms_context->view_context->curr_view_state != PRESENTATION_STOP_STATE)
    {
        StartNonAlignTimer(JMMS_VIEW_PREVIEW_TIMER, JMMS_VIEW_SLIDING_BAR_UPDATE_TIME, mmi_jmms_update_sliding_bar);
    }

    if (g_jmms_context->view_context->slide_time_elapsed < g_jmms_context->view_context->curr_view_page_duration)
    {
        g_jmms_context->view_context->slide_time_elapsed += 1000;
        percentage =
            (U8) ((g_jmms_context->view_context->slide_time_elapsed * 100) /
                  g_jmms_context->view_context->curr_view_page_duration);
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
        #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
            DrawCat276SlidingBar(
                percentage,
                (g_jmms_context->view_context->curr_view_page_duration - g_jmms_context->view_context->slide_time_elapsed));
        #else /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
            DrawCat276SlidingBar(percentage);
        #endif /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
        }
    }
    else
    {
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
        #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
            DrawCat276SlidingBar(100, 0);
        #else 
            DrawCat276SlidingBar(100);
        #endif 
        }
    }

    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_update_sliding_bar, percentage = %d", percentage);

#ifdef __MMI_VIDEO_PLAYER__
    if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
    {
        mmi_jdd_update_video_sliding_bar();
    }
#endif /* __MMI_VIDEO_PLAYER__ */ 
}

/* Needed in Inline video MMS. For updating the progress bar & button bar. */


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_is_current_slide_play_time_duration_show_complete_slide
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  JC_BOOLEAN
 *****************************************************************************/
JC_BOOLEAN mmi_jmms_is_current_slide_play_time_duration_show_complete_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->view_context->curr_page_view_state == PAGE_END_STATE)   /* g_jmms_context->view_context->curr_view_page_duration == 0 || g_jmms_context->view_context->slide_time_elapsed < g_jmms_context->view_context->curr_view_page_duration) */
    {
        return E_TRUE;
    }
    else
    {
        return E_FALSE;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_slide_time_elapsed_complete
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
JC_BOOLEAN mmi_jmms_slide_time_elapsed_complete(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_mms_preview
 * DESCRIPTION
 *  Fn to enter MMS preview screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_mms_preview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *gui_buffer_p;
    S8 *title_p;
    S8 title_temp_buffer[20];
    U8 page_count;
    U8 curr_page = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);

    EntryNewScreen(SCR_ID_JMMS_PREVIEW, mmi_jmms_exit_mms_preview_screen, mmi_jmms_entry_mms_preview, NULL);
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
#ifdef __MMI_UNIFIED_MESSAGE__
    DeleteScreenIfPresent(SCR_ID_JMMS_PREVIEW);
    if (g_jmms_context->view_context == NULL)
    {
        g_jmms_context->view_context =
            (mmi_jmms_view_context_struct*) jdd_MemAlloc(sizeof(mmi_jmms_view_context_struct), 1);
        if (g_jmms_context->view_context == NULL)
        {
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            return;
        }
    }

#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    g_jmms_context->view_context->is_curr_view_screen = SCR_ID_JMMS_PREVIEW;
    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_PREVIEW);

    title_p = (S8*) subMenuData;
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    if (curr_page == 0)
    {
        curr_page = 1;
    }
    sprintf((S8*) title_temp_buffer, "%d/%d", curr_page, page_count);
    mmi_asc_to_ucs2((S8*) title_p, (S8*) title_temp_buffer);
    gui_lock_double_buffer();
    if (gdi_layer_is_multi_layer_enable() == MMI_FALSE)
    {
        gdi_layer_multi_layer_enable();
    }
    TurnOnBacklight(GPIO_BACKLIGHT_PERMANENT);
#ifdef __MMI_TOUCH_SCREEN__
    wgui_set_touch_title_bar_buttons();                 /* enable the display of title_p bar buttons */
    register_touch_button_handlers(
        NULL,
        mmi_jmms_preview_prev_slide_left_arrow,
        NULL,
        mmi_jmms_preview_next_slide_right_arrow);
    ShowCategory276Screen((U8*) title_p, 0, 0, 0, 0, 0, gui_buffer_p);
#else /* __MMI_TOUCH_SCREEN__ */ 
#ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
    ShowCategory276Screen((U8*) title_p, 0, 0, 0, 0, 0, gui_buffer_p);
#else 
    ShowCategory276Screen((U8*) title_p, GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID), 0, 0, 0, 0, gui_buffer_p);
#endif 
#endif /* __MMI_TOUCH_SCREEN__ */ 
#ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
    DrawCat276ButtonBarArrow(curr_page, page_count);    /* sanjeev latest changes */
#endif 
    mmi_jmms_draw_sliding_bar(g_jmms_context->view_context->curr_sliding_bar_status);

    if (g_jmms_context->view_context->jdd_view_window_id != 0)
    {
        jdd_MMIShowWindow(g_jmms_context->view_context->jdd_view_window_id, E_TRUE);
    }
    gui_unlock_double_buffer();
    switch (g_jmms_context->view_context->curr_view_state)
    {
        case PRESENTATION_START_STATE:
            mmi_jmms_start_mms_preview();
            break;
        case PRESENTATION_STOP_STATE:
            mmi_jmms_stop_preview();
            break;
        case PRESENTATION_PLAYING_STATE:
            break;
    }
    SetKeyHandler(mmi_jmms_preview_scroll_slide_down, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_preview_scroll_slide_up, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_preview_prev_slide_left_arrow, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_preview_next_slide_right_arrow, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mmi_jmms_preview_end, KEY_END, KEY_EVENT_DOWN);
    }
#ifdef __MMI_TOUCH_SCREEN__
    mmi_jdd_ui_register_pen_handler();
#endif 

}

#ifdef __MMI_TOUCH_SCREEN__

/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_handle_stylus_scroll
 * DESCRIPTION
 *  
 * PARAMETERS
 *  i_pos       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef MMS_HORIZONTAL_SCROLLBAR_ENABLE
void mmi_jmms_handle_stylus_scroll(JC_UINT32 i_pos, EScrollBarType eScrollType)
#else 
void mmi_jmms_handle_stylus_scroll(JC_UINT32 i_pos)
#endif 
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
#ifdef MMS_HORIZONTAL_SCROLLBAR_ENABLE
    jdi_MMSHandleStylusScroll(g_jmms_context->msg_handle, i_pos, eScrollType);
#else 
    jdi_MMSHandleStylusScroll(g_jmms_context->msg_handle, i_pos);
#endif 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_handle_set_stylus_focus
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ui_x        [IN]        
 *  ui_y        [IN]        
 *  event       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_handle_set_stylus_focus(JC_UINT32 ui_x, JC_UINT32 ui_y, EStylusEvent event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_STYLUS event_stylus;
    JC_RETCODE err_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    event_stylus.CurPos.uiX = ui_x;
    event_stylus.CurPos.uiY = ui_y;
    event_stylus.event_type = event;
    err_code = jdi_MMSTouchScreenSETFocus(g_jmms_context->msg_handle, E_VIEW_STYLUS, &event_stylus);
    if (err_code != JC_OK)
    {
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}
#endif /* __MMI_TOUCH_SCREEN__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_end
 * DESCRIPTION
 *  Fn to exit MMS preview screen when user press END key.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_end(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE err_code;
    gdi_handle base_layer_handle = GDI_LAYER_EMPTY_HANDLE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_VIEW_PREVIEW_TIMER);
    if (gdi_layer_is_multi_layer_enable() == MMI_TRUE)
    {
        gdi_layer_get_base_handle(&base_layer_handle);
        gdi_layer_set_blt_layer(base_layer_handle, 0, 0, 0);
        gui_free_multilayer_screen();
    }
    gui_lock_double_buffer();
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_CLOSE, NULL);

    if (err_code == JC_OK)
    {
        err_code = jdd_MMIDestroyWindow(g_jmms_context->view_context->jdd_view_window_id);
        g_jmms_context->view_context->jdd_view_window_id = 0;
    }
    gui_unlock_double_buffer();
    DisplayIdleScreen();

    if (g_jmms_context->view_context != NULL)
    {
        jdd_MemFree(g_jmms_context->view_context);
        g_jmms_context->view_context = NULL;

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_exit_mms_preview_screen
 * DESCRIPTION
 *  Fn to exit MMS preview screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_exit_mms_preview_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->view_context != NULL && g_jmms_context->view_context->jdd_view_window_id != 0)
    {
        jdd_MMIShowWindow(g_jmms_context->view_context->jdd_view_window_id, E_FALSE);
        g_jmms_context->view_context->is_curr_view_screen = 0;

        if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_PLAYING_STATE)
        {
            g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;
            g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;

            mmi_jmms_stop_preview();
        }
        if (gdi_layer_is_multi_layer_enable() == MMI_TRUE)
        {
            gui_free_multilayer_screen();
        }
    }
    /* in case of end key g_jmms_context->view_context->jdd_view_window_id is NULL 
       causing issue MAUI_00434269 this else is to fix the issue */
    else
    {
        TurnOffBacklight();
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_stop_preview_rsk
 * DESCRIPTION
 *  Fn to stop MMS preview
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_stop_preview_rsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;
    mmi_jmms_stop_preview();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_stop_preview
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_stop_preview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_STOP stop_display;
    JC_RETCODE err_code = JC_OK;
    JC_UINT32 uiWindowID = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    TurnOffBacklight();
    StopTimer(JMMS_VIEW_PREVIEW_TIMER);
    stop_display.bStopAudioVideo = E_FALSE;
    g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
    g_jmms_context->view_context->curr_sliding_bar_status = 1;  /* To display sliding bar as Full */
    g_jmms_context->view_context->slide_time_elapsed = g_jmms_context->view_context->curr_view_page_duration;
    uiWindowID = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    jdd_MMIBeginDisplay(uiWindowID);
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_STOP, &stop_display);
    ChangeRightSoftkey(STR_ID_JMMS_VIEW_EXIT, 0);
#ifdef __MMI_UNIFIED_COMPOSER__
    if (g_jmms_context->view_context->view_config_arg == JMMS_CONFIG_PREVIEW)
    {
        ChangeLeftSoftkey(STR_ID_JMMS_PLAY, IMG_GLOBAL_OPTIONS);
    }
    else
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
    {
        ChangeLeftSoftkey(STR_GLOBAL_OPTIONS, IMG_GLOBAL_OPTIONS);
    }

#ifdef __MMI_VIDEO_PLAYER__
    if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
    {
        SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
        SetLeftSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
    }
#endif /* __MMI_VIDEO_PLAYER__ */ 
    SetRightSoftkeyFunction(mmi_jmms_exit_preview, KEY_EVENT_UP);

    if (g_jmms_context->view_context->view_config_arg == JMMS_CONFIG_PREVIEW)
    {
    #ifdef __MMI_UNIFIED_COMPOSER__
        SetLeftSoftkeyFunction(mmi_jmms_view_mms, KEY_EVENT_UP);
    #else 
        SetLeftSoftkeyFunction(mmi_jmms_entry_preview_options, KEY_EVENT_UP);
    #endif 
    }
    else
    {
    #ifdef __MMI_UNIFIED_MESSAGE__
        mmi_jmms_set_view_left_softkey();

    #else /* __MMI_UNIFIED_MESSAGE__ */ 
        SetLeftSoftkeyFunction(mmi_jmms_entry_view_options, KEY_EVENT_UP);
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 

    }
    jdd_MMIEndDisplay(uiWindowID, E_TRUE);
    mmi_jmms_update_sliding_bar();

    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_exit_preview
 * DESCRIPTION
 *  Fn to exit MMS preview
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_exit_preview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE err_code;
    gdi_handle base_layer_handle = GDI_LAYER_EMPTY_HANDLE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_VIEW_PREVIEW_TIMER);
    if (gdi_layer_is_multi_layer_enable() == MMI_TRUE)
    {
        gdi_layer_get_base_handle(&base_layer_handle);
        gdi_layer_set_blt_layer(base_layer_handle, 0, 0, 0);
        gui_free_multilayer_screen();
    }
    gui_lock_double_buffer();
    jdd_MMIShowWindow(g_jmms_context->view_context->jdd_view_window_id, E_FALSE);
    g_jmms_context->view_context->is_curr_view_screen = 0;
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_CLOSE, NULL);
    if (err_code == JC_OK)
    {
        err_code = jdd_MMIDestroyWindow(g_jmms_context->view_context->jdd_view_window_id);
        g_jmms_context->view_context->jdd_view_window_id = 0;
    }
    gui_unlock_double_buffer();
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        DeleteUptoScrID(SCR_ID_JMMS_EDIT_CONTENT_OPTIONS);
    }
    else if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
    {
        DeleteUptoScrID(SCR_ID_JMMS_EDIT_CONTENT_OPTIONS);
    }
    else
    {
        GoBackHistory();
    }
    if (g_jmms_context->view_context->view_config_arg == JMMS_CONFIG_VIEW)
    {
        mmi_jmms_deinit_mms_context(g_jmms_context);
    }
    if (g_jmms_context->view_context != NULL)
    {
        jdd_MemFree(g_jmms_context->view_context);
        g_jmms_context->view_context = NULL;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_play_mms
 * DESCRIPTION
 *  Fn to start MMS preview from curretn slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_play_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_PLAY play_mms;
    JC_RETCODE err_code;
    U8 curr_page, page_count;
    EVENT_SET_ACTIVE_SLIDE next_slide;
    S8 *title_p;
    S8 title_temp_buffer[20];
    U32 duration;
    JC_UINT32 uiWindowID = 0;
    S32 change_page = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    uiWindowID = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    jdd_MMIBeginDisplay(uiWindowID);
    if (page_count > 1 && curr_page != 1)
    {
        change_page = 1;
        curr_page = 1;
    }
    mmi_jdd_refresh_block_on_for_replay();
    mmi_jmms_jdi_get_page_timer(g_jmms_context->msg_handle, (JC_UINT8) (curr_page), &duration);
    if (duration > 0)
    {
        play_mms.bPlayAudioVideo = E_FALSE;
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 0;      /* To display sliding bar as blank */
        g_jmms_context->view_context->view_navigate_state = NAVIGATION_PLAYING_STATE;
        g_jmms_context->view_context->slide_time_elapsed = 0;
        GoBackHistory();
        ChangeLeftSoftkey(0, 0);
        ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
        SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
    }
    else
    {
        g_jmms_context->view_context->view_video_id = 0;
        g_jmms_context->view_context->view_audio_id = 0;
        g_jmms_context->view_context->focus_object_type = 0;    /* sachin */
        mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->view_navigate_state = NAVIGATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        play_mms.bPlayAudioVideo = E_FALSE;
        g_jmms_context->view_context->slide_time_elapsed = g_jmms_context->view_context->curr_view_page_duration;
        GoBackHistory();
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
            StopTimer(JMMS_VIEW_PREVIEW_TIMER);
            ChangeLeftSoftkey(0, 0);
        #ifdef __MMI_VIDEO_PLAYER__
            if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
            {
                SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
            }
        #endif /* __MMI_VIDEO_PLAYER__ */ 
            ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
            SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
            title_p = (S8*) subMenuData;
            sprintf((S8*) title_temp_buffer, "%d/%d", (curr_page), page_count);
            mmi_asc_to_ucs2((S8*) title_p, (S8*) title_temp_buffer);
            DrawCat276Title((U8*) title_p);
        #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
            DrawCat276ButtonBarArrow(curr_page, page_count);
            DrawCat276SlidingBar(100, 0);
        #else /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
            DrawCat276SlidingBar(100);
        #endif /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
        }
    }
    if (change_page)
    {
        next_slide.ucPageIndex = 1;
        next_slide.bPlayPresentation = E_FALSE;
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &next_slide);
    }
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_PLAY, &play_mms);
    jdd_MMIEndDisplay(uiWindowID, E_TRUE);
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_next_slide_right_arrow
 * DESCRIPTION
 *  Fn to view next_p slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_next_slide_right_arrow(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE next_slide;

    /* U32 page_duration; */
    JC_RETCODE err_code;
    U8 page_count;

    U8 curr_page;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    if (page_count > curr_page)
    {

        next_slide.ucPageIndex = curr_page + 1;
        if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE)
        {
            g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
            g_jmms_context->view_context->curr_sliding_bar_status = 1;  /* To display sliding bar as Full */
            next_slide.bPlayPresentation = E_FALSE;
        }
        else
        {
            g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
            g_jmms_context->view_context->curr_sliding_bar_status = 0;  /* To display sliding bar as blank */
            next_slide.bPlayPresentation = E_TRUE;
            g_jmms_context->view_context->slide_time_elapsed = 0;
            ChangeLeftSoftkey(0, 0);
        #ifdef __MMI_VIDEO_PLAYER__
            if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
            {
                SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
            }
        #endif /* __MMI_VIDEO_PLAYER__ */ 
            ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
            SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
        }
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &next_slide);
        if (err_code != JC_OK)
        {
            mmi_jmms_view_handle_error(err_code);
            if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
            {
                mmi_jmms_exit_preview();
            }
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_prev_slide_left_arrow
 * DESCRIPTION
 *  Fn to view previous slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_prev_slide_left_arrow(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE prev_slide;
    JC_RETCODE err_code;
    U8 curr_page;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    if (curr_page > 1)
    {
        prev_slide.ucPageIndex = curr_page - 1;
        if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE)
        {
            g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
            g_jmms_context->view_context->curr_sliding_bar_status = 1;  /* To display sliding bar as Full */
            prev_slide.bPlayPresentation = E_FALSE;
        }
        else
        {
            g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
            g_jmms_context->view_context->curr_sliding_bar_status = 0;  /* To display sliding bar as blank */
            prev_slide.bPlayPresentation = E_TRUE;
            g_jmms_context->view_context->slide_time_elapsed = 0;
            ChangeLeftSoftkey(0, 0);
        #ifdef __MMI_VIDEO_PLAYER__
            if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
            {
                SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
            }
        #endif /* __MMI_VIDEO_PLAYER__ */ 
            ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
            SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
        }
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &prev_slide);
        if (err_code != JC_OK)
        {
            mmi_jmms_view_handle_error(err_code);
            if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
            {
                mmi_jmms_exit_preview();
            }
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_next_slide
 * DESCRIPTION
 *  Fn to view next_p slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_next_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE next_slide;
    JC_RETCODE err_code;
    U8 curr_page;
    JC_UINT32 ui_window_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ui_window_id = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    next_slide.ucPageIndex = curr_page + 1;
    jdd_MMIBeginDisplay(ui_window_id);
    if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE)
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        next_slide.bPlayPresentation = E_FALSE;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &next_slide);
    }
    else
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 0;      /* To display sliding bar as blank */
        next_slide.bPlayPresentation = E_TRUE;
        g_jmms_context->view_context->slide_time_elapsed = 0;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &next_slide);
        ChangeLeftSoftkey(0, 0);
    #ifdef __MMI_VIDEO_PLAYER__
        if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
        {
            SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
        }
    #endif /* __MMI_VIDEO_PLAYER__ */ 
        ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
        SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
    }
    jdd_MMIEndDisplay(ui_window_id, E_TRUE);
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_prev_slide
 * DESCRIPTION
 *  Fn to view previous slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_prev_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE prev_slide;
    JC_RETCODE err_code;
    U8 curr_page;
    JC_UINT32 ui_window_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ui_window_id = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    prev_slide.ucPageIndex = curr_page - 1;
    jdd_MMIBeginDisplay(ui_window_id);
    if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE)
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        prev_slide.bPlayPresentation = E_FALSE;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &prev_slide);
    }
    else
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 0;      /* To display sliding bar as blank */
        prev_slide.bPlayPresentation = E_TRUE;
        g_jmms_context->view_context->slide_time_elapsed = 0;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &prev_slide);
        ChangeLeftSoftkey(0, 0);
    #ifdef __MMI_VIDEO_PLAYER__
        if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
        {
            SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
        }
    #endif /* __MMI_VIDEO_PLAYER__ */ 
        ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
        SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
    }
    jdd_MMIEndDisplay(ui_window_id, E_TRUE);
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_selected_slide
 * DESCRIPTION
 *  Fn to show selected slide
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_selected_slide(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE selected_slide;
    JC_RETCODE err_code;
    JC_UINT32 ui_window_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ui_window_id = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    selected_slide.ucPageIndex = g_jmms_context->curr_scr_hilite_index + 1;
    jdd_MMIBeginDisplay(ui_window_id);
    if (g_jmms_context->view_context->view_navigate_state == NAVIGATION_STOP_STATE)
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        selected_slide.bPlayPresentation = E_FALSE;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &selected_slide);
    }
    else
    {
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 0;      /* To display sliding bar as blank */
        selected_slide.bPlayPresentation = E_TRUE;
        g_jmms_context->view_context->slide_time_elapsed = 0;
        GoBackToHistory(SCR_ID_JMMS_PREVIEW);
        err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &selected_slide);
        ChangeLeftSoftkey(0, 0);
    #ifdef __MMI_VIDEO_PLAYER__
        if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
        {
            SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
        }
    #endif /* __MMI_VIDEO_PLAYER__ */ 
        ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
        SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
    }
    jdd_MMIEndDisplay(ui_window_id, E_TRUE);
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_scroll_slide_up
 * DESCRIPTION
 *  Fn to scroll slide in up direction
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_scroll_slide_up(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SCROLL event_scroll;
    JC_RETCODE err_code;
    DeviceCharacteristics device_ch;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    jdd_MMIGetDeviceCharacteristics(&device_ch);
    event_scroll.bScrollMedia = E_FALSE;
    event_scroll.bScrollPage = E_FALSE;
    event_scroll.eDirection = E_DIRECTION_UP;
    event_scroll.uiScrollOffset = 10;
    jdd_MMSScrollKeyHdlr();
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SCROLL, &event_scroll);

    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_preview_scroll_slide_down
 * DESCRIPTION
 *  Fn to scroll slide in down direction
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_preview_scroll_slide_down(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SCROLL event_scroll;
    JC_RETCODE err_code;
    DeviceCharacteristics device_ch;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    jdd_MMIGetDeviceCharacteristics(&device_ch);
    event_scroll.bScrollMedia = E_FALSE;
    event_scroll.bScrollPage = E_FALSE;
    event_scroll.eDirection = E_DIRECTION_DOWN;
    event_scroll.uiScrollOffset = 10;
    jdd_MMSScrollKeyHdlr();
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SCROLL, &event_scroll);

    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_attachment_misc_ind_cb
 * DESCRIPTION
 *  Callback fn to handle attachments
 * PARAMETERS
 *  msg_handle                  [IN]        
 *  callback_arg_p              [IN]        
 *  attachment_misc_info_p      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
JC_RETCODE mmi_jmms_attachment_misc_ind_cb(
            MSG_HANDLE msg_handle,
            void *callback_arg_p,
            ATTACHMENT_MISC_IND *attachment_misc_info_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *config_arg;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_attachment_misc_ind_cb");
    config_arg = (U8*) callback_arg_p;
    if (config_arg != NULL && *config_arg == (U8) JMMS_CONFIG_VIEW)
    {
        g_jmms_context->num_attachments = 1;
    }
    return JC_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_audio_video_unknown_ind_cb
 * DESCRIPTION
 *  Callback fn to handle if current page containd audio/video or inknown object.
 * PARAMETERS
 *  msg_handle              [IN]        
 *  callback_arg_p          [IN]        
 *  audio_video_info_p      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
JC_RETCODE mmi_jmms_audio_video_unknown_ind_cb(
            MSG_HANDLE msg_handle,
            void *callback_arg_p,
            AUDIO_VIDEO_UNKNOWN_IND *audio_video_info_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_audio_video_unknown_ind_cb");
    if (audio_video_info_p->eContent == E_CONTENT_VIDEO)
    {
        g_jmms_context->view_context->view_video_id = audio_video_info_p->uiMediaID;
    }
    else if (audio_video_info_p->eContent == E_CONTENT_AUDIO)
    {
        g_jmms_context->view_context->view_audio_id = audio_video_info_p->uiMediaID;
    }
    return JC_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_focus_change_ind_cb
 * DESCRIPTION
 *  callback fn to handle focus change
 * PARAMETERS
 *  msg_handle                  [IN]        
 *  callback_arg_p              [IN]        
 *  focussed_object_type        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
JC_RETCODE mmi_jmms_focus_change_ind_cb(
            MSG_HANDLE msg_handle,
            void *callback_arg_p,
            FOCUSED_OBJECT focussed_object_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_focus_change_ind_cb");
    g_jmms_context->view_context->focus_object_type = focussed_object_type;
    return JC_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_page_presentation_ind_cb
 * DESCRIPTION
 *  Callback fn to handle page presentation state.
 * PARAMETERS
 *  msg_handle                      [IN]        
 *  callback_arg_p                  [IN]        
 *  page_presentation_info_p        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
JC_RETCODE mmi_jmms_page_presentation_ind_cb(
            MSG_HANDLE msg_handle,
            void *callback_arg_p,
            PAGE_PRESENTATION_IND *page_presentation_info_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 page_count;
    S8 *title_p;
    S8 title_temp_buffer[20];
    U8 curr_page;
    gdi_handle base_layer_handle = GDI_LAYER_EMPTY_HANDLE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s, state= %d", "mmi_jmms_page_presentation_ind_cb",
                         page_presentation_info_p->eState);
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    g_jmms_context->view_context->curr_view_page_duration = page_presentation_info_p->uiPageDur;
    if (page_presentation_info_p->eState == E_STATE_PAGE_START)
    {
        gdi_layer_get_base_handle(&base_layer_handle);
        gdi_layer_set_blt_layer(base_layer_handle, 0, 0, 0);
        g_jmms_context->view_context->curr_page_view_state = PAGE_START_STATE;
    }
    if (page_presentation_info_p->eState == E_STATE_PAGE_START &&
        (g_jmms_context->view_context->curr_view_page_duration != 0 ||
         g_jmms_context->view_context->curr_view_state == PRESENTATION_STOP_STATE))
    {
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "Page Start with duration:%d",
                             g_jmms_context->view_context->curr_view_page_duration);
        g_jmms_context->view_context->view_video_id = 0;
        g_jmms_context->view_context->view_audio_id = 0;
        g_jmms_context->view_context->focus_object_type = 0;    /* sachin */
        mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
            if (g_jmms_context->view_context->curr_view_state != PRESENTATION_STOP_STATE)
            {
                g_jmms_context->view_context->slide_time_elapsed = 0;
                ChangeLeftSoftkey(0, 0);
            #ifdef __MMI_VIDEO_PLAYER__
                if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
                {
                    SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
                }
            #endif /* __MMI_VIDEO_PLAYER__ */ 
                ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
                SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
                g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
                g_jmms_context->view_context->curr_sliding_bar_status = 0;      /* To display sliding bar as blank */

            }
            else
            {
                g_jmms_context->view_context->curr_page_view_state = PAGE_END_STATE;
            }
            title_p = (S8*) subMenuData;
            sprintf((S8*) title_temp_buffer, "%d/%d", (curr_page), page_count);
            mmi_asc_to_ucs2((S8*) title_p, (S8*) title_temp_buffer);
            gui_lock_double_buffer();
            DrawCat276Title((U8*) title_p);
        #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
            DrawCat276ButtonBarArrow(curr_page, page_count);
        #endif 
            if (g_jmms_context->view_context->curr_view_state == PRESENTATION_PLAYING_STATE)
            {
                mmi_jmms_draw_sliding_bar((U8) 0);
                StartNonAlignTimer(
                    JMMS_VIEW_PREVIEW_TIMER,
                    JMMS_VIEW_SLIDING_BAR_UPDATE_TIME,
                    mmi_jmms_update_sliding_bar);
            #ifdef __MMI_VIDEO_PLAYER__
                mmi_jdd_update_video_sliding_bar();
            #endif 
            }
            else
            {
                mmi_jmms_draw_sliding_bar((U8) 100);
            }
            gui_unlock_double_buffer();
            gui_BLT_double_buffer(0, 0, UI_device_width - 1, UI_device_height - 1);
        }
    }
    else if (page_presentation_info_p->eState == E_STATE_PRESENTATION_END)
    {
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "Page PRESENTATION END");
        g_jmms_context->view_context->curr_view_state = PRESENTATION_STOP_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;
        g_jmms_context->view_context->curr_page_view_state = PAGE_END_STATE;
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
            mmi_jmms_stop_preview();
        }
    }
    else if (page_presentation_info_p->eState == E_STATE_PAGE_START &&
             g_jmms_context->view_context->curr_view_page_duration == 0)
    {
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "Page PRESENTATION start with page duaration 0");
        g_jmms_context->view_context->view_video_id = 0;
        g_jmms_context->view_context->view_audio_id = 0;
        g_jmms_context->view_context->focus_object_type = 0;    /* sachin */
        mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
        g_jmms_context->view_context->slide_time_elapsed = g_jmms_context->view_context->curr_view_page_duration;
        g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
        g_jmms_context->view_context->curr_sliding_bar_status = 1;      /* To display sliding bar as Full */
        if (g_jmms_context->view_context->is_curr_view_screen == SCR_ID_JMMS_PREVIEW)
        {
            StopTimer(JMMS_VIEW_PREVIEW_TIMER);
            ChangeLeftSoftkey(0, 0);
        #ifdef __MMI_VIDEO_PLAYER__
            if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
            {
                SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
            }
        #endif /* __MMI_VIDEO_PLAYER__ */ 
            ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
            SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
            title_p = (S8*) subMenuData;
            sprintf((S8*) title_temp_buffer, "%d/%d", (curr_page), page_count);
            mmi_asc_to_ucs2((S8*) title_p, (S8*) title_temp_buffer);
            gui_lock_double_buffer();
            DrawCat276Title((U8*) title_p);
        #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
            DrawCat276ButtonBarArrow(curr_page, page_count);
            DrawCat276SlidingBar(100, 0);
        #else /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
            DrawCat276SlidingBar(100);
        #endif /* __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__ */ 
            gui_unlock_double_buffer();
            gui_BLT_double_buffer(0, 0, UI_device_width - 1, UI_device_height - 1);
        }
    }
    else if (page_presentation_info_p->eState == E_STATE_PAGE_END)
    {
        StopTimer(JMMS_VIEW_PREVIEW_TIMER);
        g_jmms_context->view_context->curr_page_view_state = PAGE_END_STATE;
    #ifdef __MMI_JATAAYU_MMS_ADVANCED_VIEW_SCREEN__
        DrawCat276SlidingBar(100, 0);
    #else 
        DrawCat276SlidingBar(100);
    #endif 
    }
    return JC_OK;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_handle_error
 * DESCRIPTION
 *  error handling fn.
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_handle_error(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (ret_code)
    {
        case JC_OK:
            break;
        case JC_ERR_MSG_INVALID_HANDLE:
            g_jmms_context->view_context->curr_view_state = PRESENTATION_ERR_STATE;
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MESSAGE_HANDLE),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MEMORY_ALLOCATION:
            g_jmms_context->view_context->curr_view_state = PRESENTATION_ERR_STATE;
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            break;
        case JC_ERR_NULL_POINTER:
            g_jmms_context->view_context->curr_view_state = PRESENTATION_ERR_STATE;
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_POINTER),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_VIEW_CORRUPTED_CONTENT:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_CORRUPTED_CONTENT),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
        case JC_ERR_UNKNOWN:
            break;
        default:
            g_jmms_context->view_context->curr_view_state = PRESENTATION_ERR_STATE;
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_play_audio
 * DESCRIPTION
 *  play audio fn.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_play_audio(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MEDIA_INFO *audio_media_info_p;
    U8 curr_page = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    audio_media_info_p = mmi_jmms_jdi_get_audio_data(curr_page);
    if (audio_media_info_p != NULL)
    {
        mmi_audply_single_play((UI_string_type) audio_media_info_p->pMimeInfo->ContentData.pFileName, NULL);
    }
    else
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_video_play_finish_callback
 * DESCRIPTION
 *  play video fn.
 * PARAMETERS
 *  result      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
////PMT VIKAS START 20060322
//     Function specially for jmms_view_ui.c for stop video after view
void mmi_jmms_video_play_finish_callback(S32 result)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_play_video
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_play_video(void)
{
#ifdef __MMI_VIDEO_PLAYER__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MEDIA_INFO *video_media_info_p;
    U8 *gui_buffer_p;
    U8 curr_page = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    video_media_info_p = mmi_jmms_jdi_get_video_data(curr_page);
    if (video_media_info_p != NULL)
    {
        MMI_ALERT_TYPE alert_type;
        BOOL is_play_audio = TRUE;

        alert_type = GetMtCallAlertTypeEnum();
        if ((alert_type == MMI_VIBRATION_AND_RING || alert_type == MMI_VIBRATION_THEN_RING || alert_type == MMI_RING) &&
            (!isInCall() || (isInCall() && GetWapCallPresent())))
        {
            is_play_audio = TRUE;
        }
        else
        {
            is_play_audio = FALSE;
        }
        gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_VIDEO_PLAY);

        /* ExecuteCurrExitHandler(); */
        EntryNewScreen(SCR_ID_JMMS_VIDEO_PLAY, NULL, mmi_jmms_view_play_video, NULL);

    #if defined(__MMI_DRAW_MANAGER__)
        ShowCategory225Screen(
            STR_ID_JMMS_PLAY_VIDEO,
            0,                      /* title_str */
            0,                      /* lsk_str */
            0,                      /* lsk_icon */
            STR_GLOBAL_BACK,        /* rsk_str */
            IMG_GLOBAL_BACK,        /* rsk_icon */
            0,                      /* video_id */
            (PS8) video_media_info_p->pMimeInfo->ContentData.pFileName,       /* video_filename */
            1,                      /* repeat_count */
            TRUE,                   /* is_visual_update */
            is_play_audio,          /* is_play_audio */
            TRUE,                   /* is_lcd_no_sleep */
            GDI_COLOR_BLACK,        /* bg_color */
            mmi_jmms_video_play_finish_callback,
            gui_buffer_p);
    #else /* defined(__MMI_DRAW_MANAGER__) */ 
        ShowCategory225Screen(
            STR_ID_JMMS_PLAY_VIDEO, /* title_str */
            0,                      /* title_icon */
            0,                      /* lsk_str */
            0,                      /* lsk_icon */
            STR_GLOBAL_BACK,        /* rsk_str */
            IMG_GLOBAL_BACK,        /* rsk_icon */
            0,                      /* video_id */
            (PS8) video_media_info_p->pMimeInfo->ContentData.pFileName,       /* video_filename */
            1,                      /* repeat_count */
            TRUE,                   /* is_visual_update */
            is_play_audio,          /* is_play_audio */
            TRUE,                   /* is_lcd_no_sleep */
            GDI_COLOR_BLACK,        /* bg_color */
            mmi_jmms_video_play_finish_callback,
            gui_buffer_p);
    #endif /* defined(__MMI_DRAW_MANAGER__) */ 

        SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

    }
    else
    {
        DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
    }
#endif /* __MMI_VIDEO_PLAYER__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_jdi_get_audio_data
 * DESCRIPTION
 *  get audio data from msg handle.
 * PARAMETERS
 *  page_index      [IN]        
 * RETURNS
 *  MEDIA_INFO
 *****************************************************************************/
MEDIA_INFO *mmi_jmms_jdi_get_audio_data(U8 page_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_UINT8 media_count, count;
    JC_RETCODE ret_code;
    MEDIA_INFO *media_info_list_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_get_media_list(g_jmms_context->msg_handle, page_index, &media_info_list_p, &media_count, E_FALSE);
    if (ret_code == JC_OK)
    {
        for (count = 0; count < media_count; count++)
        {
            if (media_info_list_p->eMediaType == E_MEDIA_AUDIO)
            {
                return media_info_list_p;
            }
            else
            {
                media_info_list_p = media_info_list_p->pNext;
            }
        }
    }
    return NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_jdi_get_video_data
 * DESCRIPTION
 *  get video data from msg handle.
 * PARAMETERS
 *  page_index      [IN]        
 * RETURNS
 *  MEDIA_INFO
 *****************************************************************************/
MEDIA_INFO *mmi_jmms_jdi_get_video_data(U8 page_index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_UINT8 media_count, count;
    JC_RETCODE ret_code;
    MEDIA_INFO *media_info_list_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_get_media_list(g_jmms_context->msg_handle, page_index, &media_info_list_p, &media_count, E_FALSE);
    if (ret_code == JC_OK)
    {
        for (count = 0; count < media_count; count++)
        {
            if (media_info_list_p->eMediaType == E_MEDIA_VIDEO)
            {
                return media_info_list_p;
            }
            else
            {
                media_info_list_p = media_info_list_p->pNext;
            }
        }
    }
    return NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_attachment
 * DESCRIPTION
 *  view attachment.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_attachment(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JMMS_COMP_ERRCODE ret_code;
    MEDIA_INFO *media_info_p;
    U8 media_count;
    JC_UINT8 page_count;

    U8 *gui_buffer_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_VIEW_ATTACHMENT, NULL, mmi_jmms_view_attachment, NULL);
    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_VIEW_ATTACHMENT);

    RegisterHighlightHandler(mmi_jmms_view_attachment_highlight_hdlr);

    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    mmi_jmms_jdi_get_media_count(g_jmms_context->msg_handle, 0, &media_count, E_TRUE);

    ret_code = mmi_jmms_compose_get_media_list(0, &media_info_p, &media_count, E_TRUE);

    if (ret_code == JMMS_COMP_OK)
    {
        g_jmms_context->view_context->view_parent_menu_id = MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS;

        ShowCategory184Screen(
            STR_ID_JMMS_ATTACHMENT,
            GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
            STR_GLOBAL_OK,
            IMG_GLOBAL_OK,
            STR_GLOBAL_BACK,
            IMG_GLOBAL_BACK,
            (S32) media_count,
            mmi_jmms_get_attachment_data,
            0,
            0,
            gui_buffer_p);

        SetLeftSoftkeyFunction(mmi_jmms_entry_save_media_as, KEY_EVENT_UP);
        if (page_count > 0)
        {
            SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
            SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
        }
        else
        {
            SetRightSoftkeyFunction(Go_Back_from_attachemnt_Only_scr, KEY_EVENT_UP);
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  Go_Back_from_attachemnt_Only_scr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void Go_Back_from_attachemnt_Only_scr(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifndef __MMI_UNIFIED_MESSAGE__
    mmi_jmms_deinit_mms_context(g_jmms_context);
#endif 
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_attachment_highlight_hdlr
 * DESCRIPTION
 *  view attachment highlight handler.
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_attachment_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->curr_scr_hilite_index = index;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_save_media_as
 * DESCRIPTION
 *  FM fn to save media
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_save_media_as(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /* ACTIVE_MEDIA_INFO activeMediaInfo; */
    MEDIA_INFO *media_info_p;
    U8 curr_page = 0;

    JC_BOOLEAN result = E_FALSE;
    JC_RETCODE ret_code = JC_OK;
    MEDIA_MIME_INFO *mime_info_p = NULL;
    JDD_FSHANDLE fs_handle = NULL;
    FS_HANDLE file_handle;
    JC_CHAR *filename = NULL;
    S8 *temp_filename = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
    if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS)
    {
        media_info_p = mmi_jmms_jdi_get_audio_data(curr_page);
    }
    else if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS)
    {
        media_info_p = mmi_jmms_jdi_get_image_data(curr_page);
    }
    else if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS)
    {
        media_info_p = mmi_jmms_jdi_get_video_data(curr_page);
        mime_info_p = media_info_p->pMimeInfo;
    }
    else if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS)
    {
        JC_RETCODE err_code = JMMS_COMP_OK;
        JC_UINT8 media_count, count;

        err_code = mmi_jmms_compose_get_media_list(0, &media_info_p, &media_count, E_TRUE);
        if (err_code == JMMS_COMP_OK)
        {
            for (count = 0; count < media_count; count++)
            {
                if (count == g_jmms_context->curr_scr_hilite_index)
                {
                    break;
                }
                media_info_p = media_info_p->pNext;
            }
        }
        else
        {
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 0, JMMS_POPUP_TIME, ERROR_TONE);
        }
    }

    if (media_info_p != NULL)
    {
        mime_info_p = media_info_p->pMimeInfo;

        if ((ret_code = jdd_FSInitialize(&fs_handle)) == JC_OK)
        {

            S8 *temp_str = NULL;

            if (g_jmms_context->filename != NULL)
            {
                jdd_MemFree(g_jmms_context->filename);
                g_jmms_context->filename = NULL;
            }

            /* For checking whether the media object name is valid or not. */
            file_handle = FS_GetAttributes(mime_info_p->MimeHeaders.pObjectName);

            if (file_handle == FS_INVALID_FILENAME)
            {
                JC_CHAR *extn = NULL;

                result = jdd_FSGetDownloadFileName(&g_jmms_context->filename);
                if (E_FALSE == result && g_jmms_context->filename == NULL)
                {
                    ret_code = JC_ERR_MEMORY_ALLOCATION;
                    goto END;
                }
                else if (E_FALSE == result)
                {
                    ret_code = JC_ERR_UNKNOWN;
                    goto END;
                }

                /* get the extension */
                extn = jc_wstrrchr(mime_info_p->MimeHeaders.pObjectName, L'.');
                if (extn != NULL)
                {
                    temp_filename = jdd_MemAlloc(
                                        (mmi_ucs2strlen((S8*) g_jmms_context->filename) + mmi_ucs2strlen((S8*) extn) + 1) * ENCODING_LENGTH,
                                        1);
                    if (temp_filename == NULL)
                    {
                        ret_code = JC_ERR_MEMORY_ALLOCATION;
                        goto END;
                    }
                    mmi_ucs2cpy((S8*) temp_filename, (S8*) g_jmms_context->filename);
                    mmi_ucs2cat((S8*) temp_filename, (S8*) extn);

                    /* For checking if the @temp\000x.extn filename is valid or not. */
                    file_handle = FS_GetAttributes((JC_CHAR*) temp_filename);
                    if (file_handle != FS_INVALID_FILENAME)
                    {
                        if (g_jmms_context->filename != NULL)
                        {
                            jdd_MemFree(g_jmms_context->filename);
                            g_jmms_context->filename = NULL;
                        }

                        g_jmms_context->filename = jdi_UtilsTcsDup((const JC_CHAR*)temp_filename);
                        if (g_jmms_context->filename == NULL)
                        {
                            ret_code = JC_ERR_MEMORY_ALLOCATION;
                            goto END;
                        }
                    }
                }
            }
            else
            {
                /* valid name. Now make the filepath as @temp\objectname.xxx */
                result = jdd_FSGetDownloadFileName(&filename);
                if (E_FALSE == result && filename == NULL)
                {
                    ret_code = JC_ERR_MEMORY_ALLOCATION;
                    goto END;
                }
                else if (E_FALSE == result)
                {
                    ret_code = JC_ERR_UNKNOWN;
                    goto END;
                }

                temp_filename = jdd_MemAlloc((mmi_ucs2strlen((S8*) filename) + 1), 1);
                if (temp_filename == NULL)
                {
                    ret_code = JC_ERR_MEMORY_ALLOCATION;
                    goto END;
                }

                mmi_ucs2_to_asc(temp_filename, (S8*) filename);
                temp_str = jc_strrchr(temp_filename, '\\');
                *(temp_str + 1) = '\0';
                g_jmms_context->filename = jdd_MemAlloc(
                                            (jc_strlen(temp_filename) + mmi_ucs2strlen((S8*) (mime_info_p->MimeHeaders.pObjectName)) + 1) * ENCODING_LENGTH,
                                            1);
                if (g_jmms_context->filename == NULL)
                {
                    ret_code = JC_ERR_MEMORY_ALLOCATION;
                    goto END;
                }

                mmi_asc_to_ucs2((S8*) (g_jmms_context->filename), (S8*) temp_filename);
                mmi_ucs2cat((S8*) (g_jmms_context->filename), (S8*) (mime_info_p->MimeHeaders.pObjectName));
            }

            if (g_jmms_context->content_fname != NULL)
            {
                jdd_MemFree(g_jmms_context->content_fname);
                g_jmms_context->content_fname = NULL;
            }
            g_jmms_context->content_fname =
                (JC_CHAR*) jdd_FSFileNameTranslate(fs_handle, (JC_CHAR*) mime_info_p->ContentData.pFileName);

            if (g_jmms_context->content_fname == NULL)
            {
                ret_code = JC_ERR_MEMORY_ALLOCATION;
                goto END;
            }

            mmi_fmgr_send_copy_req(
                FMGR_ACTION_COPY,
                (PU8) g_jmms_context->content_fname,
                (PU8) g_jmms_context->filename,
                (PsFuncPtr) mmi_jmms_fmgr_mms_copy_rsp);

            g_jmms_context->progress_screen_in_history = 1;
            mmi_jmms_saving_progress_screen();
            /* sanjeev, handle this part inside the response handler. */
        }
        else
        {
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 0, JMMS_POPUP_TIME, ERROR_TONE);
        }
        /* added this part of code in response handler function of copy operation. */
    }
    /* handle this part of code in response handler function. */

  END:
    if (fs_handle != NULL)
    {
        jdd_FSDeinitialize(fs_handle);
    }
    if (filename != NULL)
    {
        jdd_MemFree(filename);
    }
    if (temp_filename != NULL)
    {
        jdd_MemFree(temp_filename);
    }
    if (ret_code != JC_OK)
    {
        if (ret_code == JC_ERR_MEMORY_ALLOCATION)
        {
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        }
        else if (ret_code == JC_ERR_UNKNOWN)
        {
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        }
        if (g_jmms_context->filename != NULL)
        {
            jdd_MemFree(g_jmms_context->filename);
            g_jmms_context->filename = NULL;
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_fmgr_mms_copy_rsp
 * DESCRIPTION
 *  Response function when save process complete.
 * PARAMETERS
 *  info_p      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_fmgr_mms_copy_rsp(void *info_p)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    mmi_fmt_copy_rsp_strcut *msg_p;

    MEDIA_INFO *media_info_p;
    U8 curr_page = 0;
    JC_RETCODE i_ret;
    MEDIA_MIME_INFO *mime_info_p = NULL;
    JC_MIME_INFO mime_info_dl_p;
    S8 *tmp_url = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msg_p = (mmi_fmt_copy_rsp_strcut*) info_p;
    g_jmms_context->progress_screen_in_history = 0;
    if (GetActiveScreenId() != SCR_ID_JMMS_SAVING_PROGRESS)
    {
        if (msg_p->result >= 0)
        {
            FS_Delete((U16*) g_jmms_context->filename);
        }
        if (g_jmms_context->content_fname != NULL)
        {
            jdd_MemFree(g_jmms_context->content_fname);
            g_jmms_context->content_fname = NULL;
        }
        if (g_jmms_context->filename != NULL)
        {
            jdd_MemFree(g_jmms_context->filename);
            g_jmms_context->filename = NULL;
        }
        DeleteScreenIfPresent(SCR_ID_JMMS_SAVING_PROGRESS);
        return;
    }
    if (msg_p->result >= 0)
    {
        mmi_jmms_jdi_get_current_page_index(g_jmms_context->msg_handle, &curr_page);
        if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_AUDIO_AS)
        {
            media_info_p = mmi_jmms_jdi_get_audio_data(curr_page);
        }
        else if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_IMAGE_AS)
        {
            media_info_p = mmi_jmms_jdi_get_image_data(curr_page);
        }
        else if (g_jmms_context->view_context->view_parent_menu_id == MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_VIDEO_AS)
        {
            media_info_p = mmi_jmms_jdi_get_video_data(curr_page);
            mime_info_p = media_info_p->pMimeInfo;
        }
        else if (g_jmms_context->view_context->view_parent_menu_id ==
                 MENU_ID_JMMS_SAVE_OBJECT_OPTIONS_SAVE_ATTACHMENT_AS)
        {
            JC_RETCODE ret_code = JMMS_COMP_OK;
            JC_UINT8 media_count, count;

            ret_code = mmi_jmms_compose_get_media_list(0, &media_info_p, &media_count, E_TRUE);
            if (ret_code == JMMS_COMP_OK)
            {
                for (count = 0; count < media_count; count++)
                {
                    if (count == g_jmms_context->curr_scr_hilite_index)
                    {
                        break;
                    }
                    media_info_p = media_info_p->pNext;
                }
            }
            else
            {
                DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 0, JMMS_POPUP_TIME, ERROR_TONE);
            }
        }

        mime_info_p = media_info_p->pMimeInfo;

        tmp_url = (S8*) jdd_MemAlloc((strlen((S8*) "mms://") + 1) * ENCODING_LENGTH, 1);
        if (tmp_url != NULL)
        {
            mmi_asc_to_ucs2((S8*) tmp_url, (S8*) ("mms://"));
        }

        if (tmp_url == NULL)
        {
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            if (g_jmms_context->content_fname != NULL)
            {
                jdd_MemFree(g_jmms_context->content_fname);
                g_jmms_context->content_fname = NULL;
            }
            FS_Delete((U16*) g_jmms_context->filename);
            if (g_jmms_context->filename != NULL)
            {
                jdd_MemFree(g_jmms_context->filename);
                g_jmms_context->filename = NULL;
            }
            return; /* sanjeev, added here to leave if tmp_url is null. */
        }
        memset((void*)&mime_info_dl_p, 0, sizeof(JC_MIME_INFO));
        mime_info_dl_p.psContentType = mime_info_p->MimeHeaders.pContentType;
        mime_info_dl_p.psUrl = (JC_CHAR*) tmp_url;  /* NULL; */
        mime_info_dl_p.iBufferLen = mime_info_p->ContentData.uiTotalSize;
        mime_info_dl_p.psFileName = g_jmms_context->filename;
        i_ret = jdd_MimeHandler(&mime_info_dl_p);
        if (i_ret != JC_OK)
        {
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 0, JMMS_POPUP_TIME, ERROR_TONE);
        }
        if (tmp_url != NULL)
        {
            jdd_MemFree(tmp_url);
            tmp_url = NULL;
        }
        if (g_jmms_context->content_fname != NULL)
        {
            jdd_MemFree(g_jmms_context->content_fname);
            g_jmms_context->content_fname = NULL;
        }
    }
    else
    {
        FS_Delete((U16*) g_jmms_context->filename);
        if (g_jmms_context->filename != NULL)
        {
            jdd_MemFree(g_jmms_context->filename);
            g_jmms_context->filename = NULL;
        }
        if (g_jmms_context->content_fname != NULL)
        {
            jdd_MemFree(g_jmms_context->content_fname);
            g_jmms_context->content_fname = NULL;
        }
        DisplayPopup(
            (PU8) GetString((U16) GetFileSystemErrorString(msg_p->result)),
            IMG_GLOBAL_ERROR,
            0,
            JMMS_POPUP_TIME,
            ERROR_TONE);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_exit_saving_progress_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_exit_saving_progress_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->progress_screen_in_history)
    {
        history hist;

        memset(&hist, 0, sizeof(history));
        hist.scrnID = SCR_ID_JMMS_SAVING_PROGRESS;
        hist.entryFuncPtr = mmi_jmms_saving_progress_screen;
        AddHistory(hist);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_saving_progress_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_saving_progress_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /* U32 len = 0;  // compiler warning removal. */

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_saving_progress_screen");
    /*  MAUI_00226650, Stop attachment screen while saving complete, 
       and did entry function NULL in EntryNewScreen API to stop adding this screen in history */
    EntryNewScreen(SCR_ID_JMMS_SAVING_PROGRESS, mmi_jmms_exit_saving_progress_screen, NULL, NULL);

    ShowCategory154Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        0,
        0,
        (PU8) GetString(STR_ID_JMMS_PLEASE_WAIT),
        NULL,
        IMG_ID_JMMS_PROGRESS_FULL,
        NULL);

    ClearAllKeyHandler();
}

/* Right Now View is blocking fn, No event will be handled during this fn call. So currently no spl handling is done.
   Functionality will be changed after non blocking implmentation */


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_show_progressing_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_show_progressing_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_PARSING_PROGRESS, NULL, mmi_jmms_view_show_progressing_screen, NULL);

    ShowCategory154Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        STR_GLOBAL_CANCEL,
        0,
        (PU8) GetString(STR_ID_JMMS_PARSING_MMS),
        NULL,
        IMG_ID_JMMS_PROGRESS_FULL,
        NULL);

    SetRightSoftkeyFunction(mmi_jmms_abort_view_progress, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_only_abort_view_progress
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_only_abort_view_progress(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_abort_view_progress");

    mmi_jmms_parse_continue_stop_timer();
    if (g_jmms_context->view_context != NULL)
    {
        jdd_MemFree(g_jmms_context->view_context);
        g_jmms_context->view_context = NULL;

    }
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_abort_view_progress
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_abort_view_progress(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_only_abort_view_progress();
    if (g_jmms_context->msg_handle != NULL)
    {
        mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
        g_jmms_context->msg_handle = NULL;
    }
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_deinit_view
 * DESCRIPTION
 *  Fn to exit MMS preview screen when user press END key.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_deinit_view(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_deinit_view");

    if (g_jmms_context->view_context != NULL)
    {
        StopTimer(JMMS_VIEW_PREVIEW_TIMER);
        mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_CLOSE, NULL);

        if (g_jmms_context->view_context->jdd_view_window_id != 0)
        {
            PRINT_INFORMATION_2(MMI_TRACE_INFO, "Destroying View window");
            jdd_MMIDestroyWindow(g_jmms_context->view_context->jdd_view_window_id);
            g_jmms_context->view_context->jdd_view_window_id = 0;
        }

        if (g_jmms_context->view_context != NULL)
        {
            jdd_MemFree(g_jmms_context->view_context);
            g_jmms_context->view_context = NULL;
        }
    }

}

#ifdef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_entry_view
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_pre_entry_view()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 media_count;
    U8 msg_index = 0;
    JC_UINT8 page_count;
    MMI_BOOL is_msg_read = MMI_TRUE;
    mmi_jmms_folder_msgs_list_struct *node_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    node_p = g_jmms_context->store_context->messages_list;

    while (node_p != NULL)
    {
        if (node_p->msg_index == g_jmms_context->curr_scr_hilited_index)
        {
            break;
        }
        node_p = node_p->next_p;
    }
    if (node_p == NULL)
    {
        return;
    }
    /* /set the msg status as read if first time read */
    msg_index = g_jmms_context->store_context->num_msg_in_curr_folder - g_jmms_context->curr_scr_hilited_index;
    msg_index = msg_index - 1;
    is_msg_read = mmi_jmms_is_msg_read(msg_index);

    if (g_jmms_context->store_context->current_folder_name == E_JMMS_INBOX)
    {
        if ((is_msg_read == MMI_FALSE) && node_p->msg_type != E_MSG_NOTIFICATION &&
            node_p->msg_type != E_MSG_JAVA_MESSAGE)
        {
            mmi_jmms_set_msg_as_read(msg_index);
        }
    }

    if (node_p->msg_type == E_MSG_DELIVERY_REPORT || node_p->msg_type == E_MSG_READ_REPORT ||
        node_p->msg_type == E_MSG_NOTIFICATION || node_p->msg_type == E_MSG_JAVA_MESSAGE)
    {
        mmi_jmms_show_mms_properties(node_p->msg_type, MMI_JMMS_INBOX);
        return;
    }

    mmi_jmms_jdi_get_total_pages(g_jmms_context->msg_handle, &page_count);
    if (page_count > 0)
    {
        mmi_jmms_view_mms();
    }
    else
    {
        mmi_jmms_jdi_get_media_count(g_jmms_context->msg_handle, 0, &media_count, E_TRUE);
        if (media_count == 0)
        {
            DisplayPopupCallBack(
                (PU8) GetString(STR_ID_JMMS_BLANK_MMS),
                IMG_GLOBAL_WARNING,
                1,
                JMMS_POPUP_TIME,
                WARNING_TONE,
                mmi_jmms_show_blank_mms_option_screen);
        }
        else
        {
            DisplayPopupCallBack((PU8) GetString(STR_ID_JMMS_NO_SLIDE_ONLY_ATTAHMENT), IMG_GLOBAL_WARNING, 1, JMMS_POPUP_TIME, WARNING_TONE, mmi_jmms_show_blank_mms_option_screen);    /* sachin */
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_view_mms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_view_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    EVENT_SET_ACTIVE_SLIDE first_slide;
    JC_RETCODE err_code;
    U8 curr_page = 0;
    JC_UINT32 ui_window_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_jmms_entry_mms_preview(); */
    ui_window_id = mmi_jdd_ui_get_appWindowID(E_TASK_MMS_UI);
    jdd_MMIBeginDisplay(ui_window_id);
#ifdef __MMI_UNIFIED_COMPOSER__
    if (g_jmms_context->view_context->view_config_arg == JMMS_CONFIG_PREVIEW)
    {
        EntryNewScreen(POPUP_SCREENID, NULL, NULL, NULL);
    }
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
    first_slide.ucPageIndex = curr_page + 1;
    g_jmms_context->view_context->view_navigate_state = NAVIGATION_PLAYING_STATE;
    g_jmms_context->view_context->curr_view_state = PRESENTATION_PLAYING_STATE;
    g_jmms_context->view_context->curr_sliding_bar_status = 0;
    first_slide.bPlayPresentation = E_TRUE;
    g_jmms_context->view_context->is_curr_view_screen = SCR_ID_JMMS_PREVIEW;
    g_jmms_context->view_context->slide_time_elapsed = 0;
    GoBackToHistory(SCR_ID_JMMS_PREVIEW);
    err_code = mmi_jmms_jdi_view_event(g_jmms_context->msg_handle, E_VIEW_SET_ACTIVE_SLIDE, &first_slide);
    ChangeLeftSoftkey(0, 0);
#ifdef __MMI_VIDEO_PLAYER__
    if (mmi_jdd_mms_is_in_videoapp() == E_TRUE)
    {
        SetRightSoftkeyFunction(mmi_jdd_update_video_sliding_bar, KEY_EVENT_DOWN);
    }
#endif /* __MMI_VIDEO_PLAYER__ */ 
    ChangeRightSoftkey(STR_ID_JMMS_VIEW_STOP, 0);
    SetRightSoftkeyFunction(mmi_jmms_stop_preview_rsk, KEY_EVENT_UP);
    jdd_MMIEndDisplay(ui_window_id, E_TRUE);
    if (err_code != JC_OK)
    {
        mmi_jmms_view_handle_error(err_code);
        if (g_jmms_context->view_context->curr_view_state == PRESENTATION_ERR_STATE)
        {
            mmi_jmms_exit_preview();
        }
    }
}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_get_to_large_image_string
 * DESCRIPTION
 *  return the string
 * PARAMETERS
 *  void
 * RETURNS
 *  JC_CHAR *
 *****************************************************************************/
JC_CHAR *mmi_jmms_get_to_large_image_string(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return (JC_CHAR*) GetString(STR_ID_JMMS_MEDIA_RESOLUTION_EXCEEDED);
}

#ifdef __MMI_UNIFIED_COMPOSER__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_uc_pre_entry_mms_view_async_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_uc_pre_entry_mms_view_async_callback(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "mmi_jmms_uc_pre_entry_mms_view_async_callback");

    if (ret_code != JC_OK)
    {
        goto ERROR_HANDLE;
    }

    if (ret_code == JC_OK)
    {
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_ATTACHMENT_MISC_IND,
                    (void*)mmi_jmms_attachment_misc_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_AUDIO_VIDEO_UNKNOWN_IND,
                    (void*)mmi_jmms_audio_video_unknown_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_FOCUS_CHANGED_IND,
                    (void*)mmi_jmms_focus_change_ind_cb);
        ret_code = mmi_jmms_jdi_msg_register_callback(
                    g_jmms_context->msg_handle,
                    E_CB_PAGE_PRESENTATION_IND,
                    (void*)mmi_jmms_page_presentation_ind_cb);
        if (ret_code == JC_OK)
        {
            if ((GetActiveScreenId() != SCR_ID_UC_PROCESSING && IsScreenPresent(SCR_ID_UC_PROCESSING) == MMI_TRUE))
            {
                mmi_jmms_uc_add_preview_rsp_screen();
            }
            else
            {
                mmi_jmms_pre_checks_mms_view();
            }

        }
    }

  ERROR_HANDLE:
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            g_jmms_context->parse_content_p->pFileName = NULL;
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }
    }
    mmi_jmms_uc_wap_mma_preview_rsp(mmi_jmms_uc_provide_mma_error_code(ret_code));
    DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
    DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_uc_pre_entery_view
 * DESCRIPTION
 *  
 * PARAMETERS
 *  content     [IN]        
 * RETURNS
 *  JC_RETCODE
 *****************************************************************************/
JC_RETCODE mmi_jmms_uc_pre_entery_view(CONTENT_DATA *content)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;
    U8 config_arg = JMMS_CONFIG_PREVIEW;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->view_context == NULL)
    {
        g_jmms_context->view_context =
            (mmi_jmms_view_context_struct*) jdd_MemAlloc(sizeof(mmi_jmms_view_context_struct), 1);
        if (g_jmms_context->view_context == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
    }

    g_jmms_context->view_context->view_config_arg = JMMS_CONFIG_PREVIEW;

    if (g_jmms_context->msg_handle != NULL)
    {
        ret_code = mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
    }

    if (ret_code == JC_OK)
    {
        g_jmms_context->msg_handle = NULL;
        ret_code = mmi_jmms_jdi_msg_init(&g_jmms_context->msg_handle, (void*)config_arg);
    }

    if (ret_code == JC_ERR_MEMORY_ALLOCATION)
    {
        goto ERROR_HANDLE;
    }

    g_jmms_context->view_context->curr_view_state = PRESENTATION_START_STATE;

    g_jmms_context->view_context->view_navigate_state = NAVIGATION_STOP_STATE;
#ifdef __DRM_SUPPORT__
    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_IND,
                (void*)mmi_jmms_drm_indication_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_UPDATE_RIGHTS,
                (void*)mmi_jmms_drm_rights_update_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_INFO_LIST,
                (void*)mmi_jmms_drm_info_list_ind_handler);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_DRM_CANCEL,
                (void*)mmi_jmms_drm_cancel_parse_handler);
#endif /* __DRM_SUPPORT__ */ 

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_ERROR_IND,
                (void*)mmi_jmms_error_ind_cb);

    ret_code = mmi_jmms_jdi_msg_register_callback(
                g_jmms_context->msg_handle,
                E_CB_REPLY_CHARGING,
                (void*)mmi_jmms_reply_charging_ind_cb);

    if (g_jmms_context->parse_content_p != NULL)
    {
        jdd_MemFree(g_jmms_context->parse_content_p);
    }
    g_jmms_context->parse_content_p = (CONTENT_DATA*) jdd_MemAlloc(sizeof(CONTENT_DATA), 1);

    memcpy(g_jmms_context->parse_content_p, content, sizeof(CONTENT_DATA));

    ret_code = mmi_jmms_jdi_msg_view(g_jmms_context->msg_handle, g_jmms_context->parse_content_p);

    if (ret_code == JC_ERR_MMS_PARSE_PENDING)
    {
        mmi_jmms_parse_continue_start_timer(
            g_jmms_context->msg_handle,
            mmi_jmms_uc_pre_entry_mms_view_async_callback,
            mmi_jmms_only_abort_view_progress);
        return ret_code;
    }
    mmi_jmms_uc_pre_entry_mms_view_async_callback(ret_code);
    return ret_code;

  ERROR_HANDLE:

    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }

        mmi_jmms_view_handle_error(ret_code);
    }
    return ret_code;
}
#endif /* __MMI_UNIFIED_COMPOSER__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_media_layer_buffer
 * DESCRIPTION
 *  Free Media Layer Buffer
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_media_layer_buffer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_VIDEO_PLAYER__
    mmi_jdd_video_layer_buffer_deinitialize();
#endif 
}

#endif /* (defined (JATAAYU_SUPPORT) && defined(MMS_SUPPORT)) */ 

