/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/

/*****************************************************************************
 *
 * Filename:
 * ---------
 *  JMMSMainMMSUI.C
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  This is main mms file
 *
 * Author:
 * -------
 * -------
 *
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
#include "MMI_include.h"
#ifndef _MMI_JMMSSECONDARYMMI_C
#define _MMI_JMMSSECONDARYMMI_C

/***************************************************************************** 
* Include
*****************************************************************************/

#if (defined (JATAAYU_SUPPORT) && defined(MMS_SUPPORT))

#include "SettingProfile.h"
#include "CommonScreens.h"
#include "wgui_inputs.h"
#include "wgui_datetime.h"
#include "MainMenuDef.h"
#include "JMMSStoreHandling.h"
#include "JMMSConfig.h"
#include "JMMSMainMMS.h"
#include "JMMSUseDetails.h"
#include "JMMSJSRHandler.h"

#include <ddl.h>
#include <jcal.h>
#include <jcalnet.h>
#include "jdi_wspdatatype.h"
#include "jdi_transport.h"
#include <jdi_communicator.h>
#include "jdd_memapi.h"
#include "jdd_fileapi.h"

#include <MessagingDatatypes.h>
#include <MessagingAPI.h>
#ifdef __MMI_USB_SUPPORT__
#include "USBDeviceGprot.h"
#endif 
#include "JMMSExdcl.h"
#include "JBrowserResDef.h"
#include "MessagesResourceData.h"
#include "JMMSCoreAPI.h"
#include "JMMSResDef.h"
#include "PrvStoreDataTypes.h"
#include "PrvStoreHandleInterfaces.h"

#include "JMMSCoreAPI.h"
#include "JMMSDrafts.h"
#include "JMMSExdcl.h"
/* /#include "JMMSGdcl.h" */
#include "JMMSCompose.h"
#include "JMMSGprot.h"
#include "JMMSInbox.h"
#include "JMMSJSRHandler.h"
#include "JMMSMainMMS.h"
#include "JMMSMessageSettingsUtils.h"
#include "JMMSOutbox.h"
#include "JMMSProtocols.h"
#include "JMMSPushHandling.h"
#include "JMMSSent.h"
#include "JMMSStoreHandling.h"
#include "JMMSStructs.h"
#include "JMMSTemplates.h"
#include "JMMSUseDetails.h"
#include "JMMSView.h"
#include "JMMSWriteMMS.h"

#include "JSRProts.h"
#include "miscutils.h"
#include "DateTimeGprot.h"
#include "DateTimeType.h"
#include "JMMSPlutoMMIInterface.h"
#include "CallManagementGprot.h"

#include "FileMgr.h"

#ifdef __MMI_UNIFIED_MESSAGE__
#include "UnifiedMessageResDef.h"
#include "UnifiedMessageProt.h"
#include "JMMSUMHandling.h"
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
#ifdef __MMI_UNIFIED_COMPOSER__
#include "UnifiedComposerResDef.h"
#include "JMMSUCInterfaceProt.h"
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
#include "PhoneBookGprot.h"
/***************************************************************************** 
* Define
*****************************************************************************/

/***************************************************************************** 
* Typedef 
*****************************************************************************/

/***************************************************************************** 
* Local Variable
*****************************************************************************/

/***************************************************************************** 
* Local Function
*****************************************************************************/
void mmi_jmms_reset_fw_flag_of_message(void);

/***************************************************************************** 
* Global Variable
*****************************************************************************/

/***************************************************************************** 
* Global Function
*****************************************************************************/
extern int wap_is_ready(void);

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_highlight_main_mms
 * DESCRIPTION
 *  This function is gihlight handler of main MMS menu item.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_highlight_main_mms(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetLeftSoftkeyFunction(mmi_jmms_entry_main_menu, KEY_EVENT_UP);
    SetKeyHandler(mmi_jmms_entry_main_menu, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_jmms_entry_main_menu, KEY_WAP, KEY_EVENT_DOWN);

}   /* end of mmi_mms_highlight_main_mms */


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_main_mms_init
 * DESCRIPTION
 *  This function init the hilight handlers of main MMS menu items.
 *  This is called at boot up time
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_main_mms_init(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetHiliteHandler(MENU_ID_JMMS_WRITE_MESSAGE, mmi_jmms_highlight_write_message);
    SetHiliteHandler(MENU_ID_JMMS_INBOX, mmi_jmms_highlight_inbox);
    SetHiliteHandler(MENU_ID_JMMS_OUTBOX, mmi_jmms_highlight_outbox);
    SetHiliteHandler(MENU_ID_JMMS_SENT, mmi_jmms_highlight_sent);
    SetHiliteHandler(MENU_ID_JMMS_DRAFTS, mmi_jmms_highlight_drafts);
    SetHiliteHandler(MENU_ID_JMMS_TEMPLATES, mmi_jmms_highlight_templates);
    SetHiliteHandler(MENU_ID_JMMS_MMS_SETTINGS, mmi_jmms_highlight_messages_settings);
    SetHintHandler(MENU_ID_JMMS_INBOX, mmi_jmms_hint_inbox);
    SetHintHandler(MENU_ID_JMMS_OUTBOX, mmi_jmms_hint_outbox);
    SetHintHandler(MENU_ID_JMMS_SENT, mmi_jmms_hint_sent);
    SetHintHandler(MENU_ID_JMMS_DRAFTS, mmi_jmms_hint_drafts);

}

#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_main_menu
 * DESCRIPTION
 *  This is the entry fn for main mms screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_main_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 gui_buffer_p;                   /* Buffer holding history data */
    U16 str_item_list[MAX_SUB_MENUS];   /* Stores the strings id of submenus returned */
    U16 num_item;                       /* Stores no of children in the submenu */
    U16 item_icons[MAX_SUB_MENUS];
    PU8 popup_list_p[MAX_SUB_MENUS];

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_entry_main_menu");
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);

    if (!wap_is_ready())
    {
        DisplayPopup((U8*) GetString(STR_ID_JMMS_NOT_READY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, (U8) ERROR_TONE);
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "JMMS: WAP is not ready");
        return;
    }
    if (mmi_jmms_is_ready_without_store(1))
    {
        WCHAR wpath[8];
        FS_DiskInfo diskinfo;
        U64 freebytes = 0;

        jc_tcsprintf(wpath, "%s", "C:\\");
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_entry_main_menu mmi_jmms_is_ready_without_store: FAILED");
        FS_GetDiskInfo(wpath, &diskinfo, FS_DI_FREE_SPACE | FS_DI_BASIC_INFO);
        freebytes = diskinfo.FreeClusters * diskinfo.SectorsPerCluster * diskinfo.BytesPerSector;
        PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s%d", "Free space in system drive is:", freebytes);
        return;
    }

    EntryNewScreen(SCR_ID_JMMS_MAIN_MENU, NULL, mmi_jmms_entry_main_menu, NULL);
    mmi_jmms_reset_fw_flag_of_message();

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_MAIN_MENU);
    num_item = GetNumOfChild(MESSAGES_MENU_MMS_MENUID);
    GetSequenceStringIds_Ext(MESSAGES_MENU_MMS_MENUID, str_item_list);
    GetSequenceImageIds_Ext(MESSAGES_MENU_MMS_MENUID, item_icons);
    SetParentHandler(MESSAGES_MENU_MMS_MENUID);
    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ConstructHintsList(MESSAGES_MENU_MMS_MENUID, popup_list_p);

    /* reset the open msg status- for At delete */
    g_jmms_context->msg_open_status[0] = 0;
    g_jmms_context->msg_open_status[1] = 0;
    g_jmms_context->curr_scr_hilited_index = 0;

    ShowCategory52Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        num_item,
        str_item_list,
        item_icons,
        (U8 **) popup_list_p,
        0,
        0,
        gui_buffer_p);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    mmi_jmms_delete_compose_temp_files();
}

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_exit_main_menu
 * DESCRIPTION
 *  THis is the exit fn for main mms screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_exit_main_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* /deinit_the store_module(gmsgcontext->store handle) */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_hint_inbox
 * DESCRIPTION
 *  This is the hint handler of inbox menu item
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_hint_inbox(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 value[10];
    U8 number = 0;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_mms_get_number_of_messages(MMI_JMMS_INBOX, &number);
    if (ret_code != JC_OK)
    {
        number = 0;
    }
    /* MAUI_00018221 Start */
    memset((PS8) hintData[index], 0, sizeof(hintData[index]));  /* sanjeev added */
    sprintf((S8*) value, "%d ", number);
    mmi_asc_to_ucs2((S8*) hintData[index], (S8*) value);
    mmi_ucs2cat((PS8) hintData[index], (S8*) GetString(STR_ID_JMMS_MSGS));
    /* MAUI_00018221 End */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_hint_outbox
 * DESCRIPTION
 *  This is the hint handler of outbox menu item
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_hint_outbox(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 value[10];
    U8 number = 0;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_mms_get_number_of_messages(MMI_JMMS_OUTBOX, &number);
    if (ret_code != JC_OK)
    {
        number = 0;
    }
    /* MAUI_00018221 Start */
    memset((PS8) hintData[index], 0, sizeof(hintData[index]));  /* sanjeev added */
    sprintf((S8*) value, "%d ", number);
    mmi_asc_to_ucs2((S8*) hintData[index], (S8*) value);
    mmi_ucs2cat((PS8) hintData[index], (S8*) GetString(STR_ID_JMMS_MSGS));
    /* MAUI_00018221 End */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_hint_sent
 * DESCRIPTION
 *  This is the hint handler of sent menu item
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_hint_sent(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 value[10];
    U8 number = 0;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_mms_get_number_of_messages(MMI_JMMS_SENT, &number);
    if (ret_code != JC_OK)
    {
        number = 0;
    }

    /* MAUI_00018221 Start */
    memset((PS8) hintData[index], 0, sizeof(hintData[index]));  /* sanjeev added */
    sprintf((S8*) value, "%d ", number);
    mmi_asc_to_ucs2((S8*) hintData[index], (S8*) value);
    mmi_ucs2cat((PS8) hintData[index], (S8*) GetString(STR_ID_JMMS_MSGS));
    /* MAUI_00018221 End */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_hint_drafts
 * DESCRIPTION
 *  This is the hint handler of drafts menu item
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_hint_drafts(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 value[10];
    U8 number = 0;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_mms_get_number_of_messages(MMI_JMMS_DRAFTS, &number);
    if (ret_code != JC_OK)
    {
        number = 0;
    }

    /* MAUI_00018221 Start */
    memset((PS8) hintData[index], 0, sizeof(hintData[index]));  /* sanjeev added */
    sprintf((S8*) value, "%d ", number);
    mmi_asc_to_ucs2((S8*) hintData[index], (S8*) value);
    mmi_ucs2cat((PS8) hintData[index], (S8*) GetString(STR_ID_JMMS_MSGS));
    /* MAUI_00018221 End */
}

#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_folder_list_highlight_hdlr
 * DESCRIPTION
 *  This is the highlight handler menu items of main mms screen
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_folder_list_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->curr_scr_hilited_index = (U8) index;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_get_folder_msg_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msgs_list_p         [IN]        
 *  foldername_p        [IN]        
 *  total_num_msgs      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_get_folder_msg_list(
            mmi_jmms_folder_msgs_list_struct **msgs_list_p,
            S8 *foldername_p,
            U8 total_num_msgs)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;
    RETRIEVE_FILTERS store_ret_filter = {0, };
    MESSAGE_LIST *message_list_p = NULL;
    MESSAGE_LIST *temp_msg_list_p = NULL;
    mmi_jmms_folder_msgs_list_struct *msgs_list_node_p = NULL;

#ifdef __MMI_UNIFIED_MESSAGE__
    S32 msg_counter = 0;
    mmi_jmms_um_jmms_attachment_present_list_struct *temp_pending_list_p = NULL;
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    store_ret_filter.uiStartIndex = g_jmms_context->store_context->jmms_start_index;
    store_ret_filter.eRetrieve = E_RETRIEVE_BY_INDEX;

    if (g_jmms_context->store_context->jmms_start_index <= total_num_msgs)
    {

        if ((store_ret_filter.uiStartIndex + NUM_MSGS_IN_ONE_UNIT - 1) < total_num_msgs)
        {
            store_ret_filter.uiNumMessage = NUM_MSGS_IN_ONE_UNIT;
        }
        else
        {
            store_ret_filter.uiNumMessage = total_num_msgs - store_ret_filter.uiStartIndex + 1;
        }

        ret_code = mmi_jmms_get_messages_list(foldername_p, &temp_msg_list_p, &store_ret_filter);
        if (ret_code != JC_OK || temp_msg_list_p == NULL)
        {
            return JC_ERR_MEMORY_ALLOCATION;
        }

    }

    message_list_p = temp_msg_list_p;
#ifdef __MMI_UNIFIED_MESSAGE__
    msg_counter = total_num_msgs;   /* store_ret_filter.uiStartIndex + store_ret_filter.uiNumMessage - 1; */
#endif 
    while (message_list_p != NULL)
    {
    #ifdef __MMI_UNIFIED_MESSAGE__
        MMI_BOOL is_parsing_check_required = MMI_FALSE;
    #endif 
        msgs_list_node_p =
            (mmi_jmms_folder_msgs_list_struct*) jdd_MemAlloc(sizeof(mmi_jmms_folder_msgs_list_struct), 1);
        if (msgs_list_node_p == NULL)
        {
            return JC_ERR_MEMORY_ALLOCATION;
        }
    #ifdef __MMI_UNIFIED_MESSAGE__
        msgs_list_node_p->um_msg_info_p = (mmi_um_msg_info_struct*) jdd_MemAlloc(sizeof(mmi_um_msg_info_struct), 1);
        if (msgs_list_node_p->um_msg_info_p == NULL)
        {
            mmi_jmms_free_attacment_pending_status_list();
            temp_pending_list_p = NULL;
            return JC_ERR_MEMORY_ALLOCATION;
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        switch (message_list_p->pMessageHeaders->eMsgType)
        {
            case E_MSG_TYPE_NOTIFICATION:
            {
                MESSAGE_NOTIFICATION *notification_p;

            #ifndef __MMI_UNIFIED_MESSAGE__
                S32 len = 0;
            #endif 

                notification_p = (MESSAGE_NOTIFICATION*) (message_list_p->pMessageHeaders->pHeaders);
                msgs_list_node_p->msg_type = E_MSG_NOTIFICATION;

                if (notification_p->pSubject == NULL)
                {
                #ifdef __MMI_UNIFIED_MESSAGE__
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        (JC_CHAR*) GetString(STR_ID_NO_SUBJECT),
                        (msg_counter - store_ret_filter.uiStartIndex));
                #else /* __MMI_UNIFIED_MESSAGE__ */ 
                    msgs_list_node_p->subject_as_caption_p = (S8*) GetString(STR_ID_NO_SUBJECT);
                #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                }
                else
                {
                #ifdef __MMI_UNIFIED_MESSAGE__
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        (JC_CHAR*) (notification_p->pSubject),
                        (msg_counter - store_ret_filter.uiStartIndex));
                #else /* __MMI_UNIFIED_MESSAGE__ */ 
                    len = (mmi_ucs2strlen((S8*) (notification_p->pSubject)) + 1) * ENCODING_LENGTH;

                    if (len > (MAX_SUBJECT_LENGTH * ENCODING_LENGTH))
                    {
                        len = (MAX_SUBJECT_LENGTH + 1) * ENCODING_LENGTH;
                    }

                    msgs_list_node_p->subject_as_caption_p = (S8*) jdd_MemAlloc(sizeof(S8), len);
                    if (msgs_list_node_p->subject_as_caption_p == NULL)
                    {
                        jdd_MemFree(msgs_list_node_p);
                        return JC_ERR_MEMORY_ALLOCATION;
                    }
                    memcpy(
                        (S8*) (msgs_list_node_p->subject_as_caption_p),
                        (S8*) (notification_p->pSubject),
                        len - ENCODING_LENGTH);
                #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                }

            #ifdef __MMI_UNIFIED_MESSAGE__
                if (notification_p->pFrom != NULL)
                {
                    mmi_um_jmms_add_mms_address_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        notification_p->pFrom,
                        (msg_counter - store_ret_filter.uiStartIndex));
                }
                msgs_list_node_p->um_msg_info_p->timestamp = (*notification_p).uiReceivedTime;
                is_parsing_check_required = MMI_FALSE;
            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                if (notification_p->pFrom != NULL)
                {
                    len = (mmi_ucs2strlen((S8*) (notification_p->pFrom)) + 1) * ENCODING_LENGTH;

                    msgs_list_node_p->address_as_hint_p = (S8*) jdd_MemAlloc(sizeof(S8), len);
                    if (msgs_list_node_p->address_as_hint_p == NULL)
                    {
                        jdd_MemFree(msgs_list_node_p);
                        return JC_ERR_MEMORY_ALLOCATION;
                    }

                    memcpy(
                        (S8*) (msgs_list_node_p->address_as_hint_p),
                        (S8*) (notification_p->pFrom),
                        len - ENCODING_LENGTH);
                }
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                break;
            }

            case E_MSG_TYPE_RECEIVE:
            {
                MESSAGE_RETRIEVAL *retrieval_p;

            #ifndef __MMI_UNIFIED_MESSAGE__
                S32 len = 0;
            #endif 
                MMI_BOOL is_java_mms = MMI_FALSE;

                retrieval_p = (MESSAGE_RETRIEVAL*) (message_list_p->pMessageHeaders->pHeaders);

                if ((message_list_p->uiExtraBytes & 0x00FFFFFF) > 0 &&
                    (message_list_p->uiExtraBytes & 0x00FFFFFF) < MMI_JMMS_MAX_JAVA_MSG_ID)
                {
                    is_java_mms = MMI_TRUE;
                }
                /* is_java_mms = mmi_jsr_is_java_msg(message_list_p->uiExtraBytes); */
                if (is_java_mms == MMI_TRUE)
                {
                    msgs_list_node_p->msg_type = E_MSG_JAVA_MESSAGE;
                #ifdef __MMI_UNIFIED_MESSAGE__
                    is_parsing_check_required = MMI_FALSE;
                #endif 
                }
                else
                {
                    msgs_list_node_p->msg_type = E_MSG_RECEIVE;
                #ifdef __MMI_UNIFIED_MESSAGE__
                    is_parsing_check_required = MMI_TRUE;
                #endif 
                }
            #ifdef __MMI_UNIFIED_MESSAGE__
                if (retrieval_p->pSubject == NULL)
                {
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        (JC_CHAR*) GetString(STR_ID_NO_SUBJECT),
                        (msg_counter - store_ret_filter.uiStartIndex));
                }
                else
                {
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        retrieval_p->pSubject,
                        (msg_counter - store_ret_filter.uiStartIndex));
                }

            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                if (retrieval_p->pSubject == NULL)
                {
                    msgs_list_node_p->subject_as_caption_p = (S8*) GetString(STR_ID_NO_SUBJECT);
                }
                else
                {
                    len = (mmi_ucs2strlen((S8*) (retrieval_p->pSubject)) + 1) * ENCODING_LENGTH;

                    if (len > (MAX_SUBJECT_LENGTH * ENCODING_LENGTH))
                    {
                        len = (MAX_SUBJECT_LENGTH + 1) * ENCODING_LENGTH;
                    }

                    msgs_list_node_p->subject_as_caption_p = (S8*) jdd_MemAlloc(sizeof(S8), len);
                    if (msgs_list_node_p->subject_as_caption_p == NULL)
                    {
                        jdd_MemFree(msgs_list_node_p);
                        return JC_ERR_MEMORY_ALLOCATION;
                    }

                    memcpy(
                        (S8*) (msgs_list_node_p->subject_as_caption_p),
                        (S8*) (retrieval_p->pSubject),
                        len - ENCODING_LENGTH);
                }
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
            #ifdef __MMI_UNIFIED_MESSAGE__
                if (retrieval_p->pFrom != NULL)
                {
                    mmi_um_jmms_add_mms_address_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        retrieval_p->pFrom,
                        (msg_counter - store_ret_filter.uiStartIndex));
                }
                msgs_list_node_p->um_msg_info_p->timestamp = retrieval_p->uiDate;

            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                if (retrieval_p->pFrom != NULL)
                {
                    len = (mmi_ucs2strlen((S8*) (retrieval_p->pFrom)) + 1) * ENCODING_LENGTH;

                    msgs_list_node_p->address_as_hint_p = (S8*) jdd_MemAlloc(sizeof(S8), len);
                    if (msgs_list_node_p->address_as_hint_p == NULL)
                    {
                        jdd_MemFree(msgs_list_node_p);
                        return JC_ERR_MEMORY_ALLOCATION;
                    }

                    memcpy(
                        (S8*) (msgs_list_node_p->address_as_hint_p),
                        (S8*) (retrieval_p->pFrom),
                        len - ENCODING_LENGTH);
                }
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                break;
            }

            case E_MSG_TYPE_DELIVERY_REPORT:
            {
            #ifdef __MMI_UNIFIED_MESSAGE__
                DELIVERY_REPORT *delivery_p;

                delivery_p = (DELIVERY_REPORT*) (message_list_p->pMessageHeaders->pHeaders);
                mmi_um_jmms_add_mms_sub_for_list_info(
                    &msgs_list_node_p->um_msg_info_p,
                    (JC_CHAR*) GetString(STR_ID_JMMS_DELIVERY_REPORT),
                    (msg_counter - store_ret_filter.uiStartIndex));

                msgs_list_node_p->um_msg_info_p->timestamp = delivery_p->uiDate;
                is_parsing_check_required = MMI_FALSE;

            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                msgs_list_node_p->subject_as_caption_p = (S8*) GetString(STR_ID_JMMS_DELIVERY_REPORT);
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                msgs_list_node_p->msg_type = E_MSG_DELIVERY_REPORT;

                break;
            }

            case E_MSG_TYPE_READ_REPORT_RESPONSE:
            {
            #ifdef __MMI_UNIFIED_MESSAGE__
                READ_REPORT_RESPONSE *read_report_p;

                read_report_p = (READ_REPORT_RESPONSE*) (message_list_p->pMessageHeaders->pHeaders);
                mmi_um_jmms_add_mms_sub_for_list_info(
                    &msgs_list_node_p->um_msg_info_p,
                    (JC_CHAR*) GetString(STR_ID_SETTINGS_READ_REPORT),
                    (msg_counter - store_ret_filter.uiStartIndex));
                if (read_report_p->pFrom != NULL)
                {
                    mmi_um_jmms_add_mms_address_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        read_report_p->pFrom,
                        (msg_counter - store_ret_filter.uiStartIndex));
                }

                msgs_list_node_p->um_msg_info_p->timestamp = (*read_report_p).uiReceivedTime;
                is_parsing_check_required = MMI_FALSE;

            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                msgs_list_node_p->subject_as_caption_p = (S8*) GetString(STR_ID_SETTINGS_READ_REPORT);
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                msgs_list_node_p->msg_type = E_MSG_READ_REPORT;
                break;
            }

            case E_MSG_TYPE_SEND:
            {
                MESSAGE_SEND *send_p;

            #ifndef __MMI_UNIFIED_MESSAGE__
                S32 len = 0;
            #endif 

                send_p = (MESSAGE_SEND*) (message_list_p->pMessageHeaders->pHeaders);

            #ifdef __MMI_UNIFIED_MESSAGE__
                if (send_p->pSubject == NULL)
                {
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        (JC_CHAR*) GetString(STR_ID_NO_SUBJECT),
                        (msg_counter - store_ret_filter.uiStartIndex));
                }
                else
                {
                    mmi_um_jmms_add_mms_sub_for_list_info(
                        &msgs_list_node_p->um_msg_info_p,
                        send_p->pSubject,
                        (msg_counter - store_ret_filter.uiStartIndex));
                }
                if (send_p->uiDate != 0)
                {
                    msgs_list_node_p->um_msg_info_p->timestamp = send_p->uiDate;
                }
                else
                {
                    U32 extra_byte_1 = 0;
                    JC_RETCODE return_code;

                    msgs_list_node_p->um_msg_info_p->timestamp = 0;
                    /* Deepali: PMTSW00004395 */
                    return_code = mmi_jmms_jdi_store_get_extra_byte_1(
                                    g_jmms_context->store_handle,
                                    (total_num_msgs - (msg_counter - store_ret_filter.uiStartIndex)),
                                    &extra_byte_1);
                    if (return_code == JC_OK)
                    {
                        msgs_list_node_p->um_msg_info_p->timestamp = extra_byte_1;
                    }

                }
                mmi_um_jmms_create_new_mms_hint_for_sent(
                    &msgs_list_node_p->um_msg_info_p,
                    send_p->pTo,
                    send_p->pCc,
                    send_p->pBcc,
                    (msg_counter - store_ret_filter.uiStartIndex));
                is_parsing_check_required = MMI_TRUE;

            #else /* __MMI_UNIFIED_MESSAGE__ */ 
                if (send_p->pSubject == NULL)
                {
                    msgs_list_node_p->subject_as_caption_p = (S8*) GetString(STR_ID_NO_SUBJECT);
                }
                else
                {
                    len = (mmi_ucs2strlen((S8*) (send_p->pSubject)) + 1) * ENCODING_LENGTH;

                    if (len > (MAX_SUBJECT_LENGTH * ENCODING_LENGTH))
                    {
                        len = (MAX_SUBJECT_LENGTH + 1) * ENCODING_LENGTH;
                    }

                    msgs_list_node_p->subject_as_caption_p = (S8*) jdd_MemAlloc(sizeof(S8), len);
                    if (msgs_list_node_p->subject_as_caption_p == NULL)
                    {
                        jdd_MemFree(msgs_list_node_p);
                        return JC_ERR_MEMORY_ALLOCATION;
                    }

                    memcpy(
                        (S8*) (msgs_list_node_p->subject_as_caption_p),
                        (S8*) (send_p->pSubject),
                        len - ENCODING_LENGTH);
                }

                mmi_jmms_create_new_mms_hint(&msgs_list_node_p, send_p->pTo, send_p->pCc, send_p->pBcc);
            #endif /* __MMI_UNIFIED_MESSAGE__ */ 
                msgs_list_node_p->msg_type = E_MSG_NEW_MMS_SEND;
                break;
            }
        }   /* /end of switch */
    #ifdef __MMI_UNIFIED_MESSAGE__
        /* Attachment handling */
        if ((message_list_p->uiExtraBytes) >> 28 == 0 && MMI_TRUE == is_parsing_check_required)
        {
            temp_pending_list_p =
                (mmi_jmms_um_jmms_attachment_present_list_struct*)
                jdd_MemAlloc(sizeof(mmi_jmms_um_jmms_attachment_present_list_struct), 1);
            if (temp_pending_list_p == NULL)
            {
                mmi_jmms_free_attacment_pending_status_list();
                return JC_ERR_MEMORY_ALLOCATION;
            }
            temp_pending_list_p->index_to_parse = msg_counter - store_ret_filter.uiStartIndex;
            temp_pending_list_p->next_p = NULL;
            mmi_um_jmms_add_new_node_attachment_pending_list(temp_pending_list_p);
            msgs_list_node_p->attachment_status = 0;
        }
        else
        {
            if (((*message_list_p).uiExtraBytes) >> 28 == 0 && MMI_FALSE == is_parsing_check_required)
            {
                msgs_list_node_p->attachment_status = E_JMMS_ATTACHMENT_NOT_PRESENT;
            }
            else
            {
                msgs_list_node_p->attachment_status = ((*message_list_p).uiExtraBytes) >> 28;   /* attachment_status */
            }
        }
        /* Attachment handling End */
        msgs_list_node_p->um_msg_info_p->msg_index = msg_counter - store_ret_filter.uiStartIndex;
        msgs_list_node_p->msg_index = msgs_list_node_p->um_msg_info_p->msg_index;
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        if ((*msgs_list_p) == NULL)
        {
            *msgs_list_p = msgs_list_node_p;
            msgs_list_node_p = NULL;
        }
        else
        {
        #ifdef __MMI_UNIFIED_MESSAGE__
            /* To sort the message list on bases of timestamp */
            if (msgs_list_node_p->um_msg_info_p->timestamp > (*msgs_list_p)->um_msg_info_p->timestamp)
            {
                mmi_jmms_folder_msgs_list_struct *temp;

                temp = (*msgs_list_p);
                *msgs_list_p = msgs_list_node_p;

                (*msgs_list_p)->next_p = temp;
                msgs_list_node_p = NULL;
            }
            else
            {
                mmi_jmms_folder_msgs_list_struct *temp_message_list = NULL;
                mmi_jmms_folder_msgs_list_struct *temp = NULL, *prev = NULL;

                temp_message_list = (*msgs_list_p);

                while (temp_message_list != NULL)
                {
                    if (msgs_list_node_p->um_msg_info_p->timestamp > temp_message_list->um_msg_info_p->timestamp)
                    {
                        break;
                    }
                    prev = temp_message_list;
                    temp_message_list = temp_message_list->next_p;
                }

                temp = temp_message_list;
                prev->next_p = msgs_list_node_p;

                msgs_list_node_p->next_p = temp;
                msgs_list_node_p = NULL;
            }
        #else /* __MMI_UNIFIED_MESSAGE__ */ 
            ///implement the link list as stack so that last msg can be shown
            //as first
            mmi_jmms_folder_msgs_list_struct *temp;

            temp = (*msgs_list_p);
            *msgs_list_p = msgs_list_node_p;

            (*msgs_list_p)->next_p = temp;
            msgs_list_node_p = NULL;
        #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        }
    #ifdef __MMI_UNIFIED_MESSAGE__
        msg_counter--;
    #endif 
        message_list_p = message_list_p->pNext;

    }

    if ((store_ret_filter.uiStartIndex + store_ret_filter.uiNumMessage - 1) >= total_num_msgs)
    {
    #ifndef __MMI_UNIFIED_MESSAGE__
        U16 currScrenID = 0;

        currScrenID = GetActiveScreenId();

        if (currScrenID != SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN)
        {
            if (strcmp((S8*) MMI_JMMS_INBOX, (S8*) foldername_p) == 0)
            {
                HistoryReplace(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN, SCR_ID_JMMS_INBOX, mmi_jmms_entry_inbox_screen);
            }
            else if (strcmp((S8*) MMI_JMMS_OUTBOX, (S8*) foldername_p) == 0)
            {
                HistoryReplace(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN, SCR_ID_JMMS_OUTBOX, mmi_jmms_entry_outbox_screen);
            }
            else if (strcmp((S8*) MMI_JMMS_SENT, (S8*) foldername_p) == 0)
            {
                HistoryReplace(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN, SCR_ID_JMMS_SENT, mmi_jmms_entry_sent_screen);
            }
            else if (strcmp((S8*) MMI_JMMS_DRAFTS, (S8*) foldername_p) == 0)
            {
                HistoryReplace(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN, SCR_ID_JMMS_DRAFTS, mmi_jmms_entry_drafts_screen);
            }

            return ret_code;
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
    #ifdef __MMI_UNIFIED_MESSAGE__

        mmi_um_jmms_folder_list_callback();
        mmi_um_jmms_set_folder_list_callback_function(mmi_um_jmms_dummy_folder_list_callback);
    #else /* __MMI_UNIFIED_MESSAGE__ */ 
        if (strcmp((S8*) MMI_JMMS_INBOX, (S8*) foldername_p) == 0)
        {
            mmi_jmms_entry_inbox_screen();
        }
        else if (strcmp((S8*) MMI_JMMS_OUTBOX, (S8*) foldername_p) == 0)
        {
            mmi_jmms_entry_outbox_screen();
        }
        else if (strcmp((S8*) MMI_JMMS_SENT, (S8*) foldername_p) == 0)
        {
            mmi_jmms_entry_sent_screen();
        }
        else if (strcmp((S8*) MMI_JMMS_DRAFTS, (S8*) foldername_p) == 0)
        {
            mmi_jmms_entry_drafts_screen();
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 

        DeleteScreenIfPresent(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN);
        g_jmms_context->store_context->jmms_start_index = 1;
    }
    else
    {
        g_jmms_context->store_context->jmms_start_index =
            g_jmms_context->store_context->jmms_start_index + store_ret_filter.uiNumMessage;
        ret_code = mmi_jmms_send_get_msg_list_event(foldername_p, total_num_msgs);
    }

    return ret_code;

}

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_new_mms_hint
 * DESCRIPTION
 *  
 * PARAMETERS
 *  node_p      [IN]        
 *  to_p        [IN]        
 *  cc_p        [IN]        
 *  bcc_p       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_create_new_mms_hint(
        mmi_jmms_folder_msgs_list_struct **node_p,
        JC_CHAR *to_p,
        JC_CHAR *cc_p,
        JC_CHAR *bcc_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S8 *str_p = NULL;
    S32 len = 0;
    S32 start_index = 0;
    MMI_BOOL is_email = MMI_FALSE;
    S32 len_to_copy = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (to_p != NULL)
    {
        str_p = (S8*) (to_p);
        len = 0;
        start_index = 0;

        while (((*str_p) != ';') && ((*str_p) != '\0'))
        {
            if ((*str_p) == '@')
            {
                is_email = MMI_TRUE;
            }

            len++;
            str_p = str_p + ENCODING_LENGTH;

        }

        if (is_email == MMI_FALSE && len > (MAX_POSSIBLE_NUMBER_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_NUMBER_LENGHT_SENT;
        }
        else if (is_email == MMI_TRUE && len > (MAX_POSSIBLE_EMAIL_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_EMAIL_LENGHT_SENT;
        }
        else
        {
            len_to_copy = len;
        }

        (*node_p)->address_as_hint_p = (S8*) jdd_MemAlloc(sizeof(S8), (len_to_copy + 1) * ENCODING_LENGTH);
        if ((*node_p)->address_as_hint_p == NULL)
        {
            goto END;
        }
        mmi_ucs2ncpy((S8*) ((*node_p)->address_as_hint_p), (S8*) (to_p + start_index), len_to_copy);

        return;

    }

    if (cc_p != NULL)
    {

        str_p = (S8*) (cc_p);
        len = 0;
        start_index = 0;
        is_email = MMI_FALSE;

        while (((*str_p) != ';') && ((*str_p) != '\0'))
        {
            len++;

            if ((*str_p) == '@')
            {
                is_email = MMI_TRUE;
            }

            str_p = str_p + ENCODING_LENGTH;
        }

        if (is_email == MMI_FALSE && len > (MAX_POSSIBLE_NUMBER_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_NUMBER_LENGHT_SENT;
        }
        else if (is_email == MMI_TRUE && len > (MAX_POSSIBLE_EMAIL_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_EMAIL_LENGHT_SENT;
        }
        else
        {
            len_to_copy = len;
        }

        (*node_p)->address_as_hint_p = (S8*) jdd_MemAlloc(sizeof(S8), (len_to_copy + 1) * ENCODING_LENGTH);
        if ((*node_p)->address_as_hint_p == NULL)
        {
            goto END;
        }
        mmi_ucs2ncpy((S8*) ((*node_p)->address_as_hint_p), (S8*) (cc_p + start_index), len_to_copy);

        return;

    }

    /* /Make the BCc Addresses list */
    if (bcc_p != NULL)
    {
        str_p = (S8*) (bcc_p);
        len = 0;
        start_index = 0;
        is_email = MMI_FALSE;

        while (((*str_p) != ';') && ((*str_p) != '\0'))
        {
            len++;
            if ((*str_p) == '@')
            {
                is_email = MMI_TRUE;
            }
            str_p = str_p + ENCODING_LENGTH;
        }

        if (is_email == MMI_FALSE && len > (MAX_POSSIBLE_NUMBER_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_NUMBER_LENGHT_SENT;
        }
        else if (is_email == MMI_TRUE && len > (MAX_POSSIBLE_EMAIL_LENGHT_SENT))
        {
            len_to_copy = MAX_POSSIBLE_EMAIL_LENGHT_SENT;
        }
        else
        {
            len_to_copy = len;
        }

        (*node_p)->address_as_hint_p = (S8*) jdd_MemAlloc(sizeof(S8), (len_to_copy + 1) * ENCODING_LENGTH);
        if ((*node_p)->address_as_hint_p == NULL)
        {
            goto END;
        }
        mmi_ucs2ncpy((S8*) ((*node_p)->address_as_hint_p), (S8*) (bcc_p + start_index), len_to_copy);

        return;
    }

    return;

  END:
    mmi_jmms_free_msgs_list(&(g_jmms_context->store_context->messages_list));

}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
#ifdef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_set_msg_type
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index           [IN]        
 *  msg_type        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_jmms_set_msg_type(U8 index, U16 msg_type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_folder_msgs_list_struct *msgs_list_node_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msgs_list_node_p = g_jmms_context->store_context->messages_list;
    while (msgs_list_node_p != NULL)
    {
        if (msgs_list_node_p->msg_index == index)
        {
            break;
        }
        msgs_list_node_p = msgs_list_node_p->next_p;
    }
    if (msgs_list_node_p == NULL)
    {
        return E_MSG_UNKNOWN;
    }
    msgs_list_node_p->msg_type = msg_type;
    return msgs_list_node_p->msg_type;

}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_get_msg_type
 * DESCRIPTION
 *  
 * PARAMETERS
 *  index       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
U16 mmi_jmms_get_msg_type(U8 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_folder_msgs_list_struct *msgs_list_node_p = NULL;

#ifndef __MMI_UNIFIED_MESSAGE__
    U8 count = 0;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    msgs_list_node_p = g_jmms_context->store_context->messages_list;
#ifdef __MMI_UNIFIED_MESSAGE__
    while (msgs_list_node_p != NULL)
    {
        if (msgs_list_node_p->msg_index == index)
        {
            break;
        }
        msgs_list_node_p = msgs_list_node_p->next_p;
    }
#else /* __MMI_UNIFIED_MESSAGE__ */ 
    while (count != index && msgs_list_node_p != NULL)
    {
        msgs_list_node_p = msgs_list_node_p->next_p;
        count++;
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    if (msgs_list_node_p == NULL)
    {
        return E_MSG_UNKNOWN;
    }

    return msgs_list_node_p->msg_type;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_msgs_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msgs_list_p     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_msgs_list(mmi_jmms_folder_msgs_list_struct **msgs_list_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_folder_msgs_list_struct *list_p;
    mmi_jmms_folder_msgs_list_struct *list1_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    list1_p = *msgs_list_p;
    list_p = *msgs_list_p;

    while (list_p != NULL)
    {
        list1_p = list_p->next_p;
    #ifdef __MMI_UNIFIED_MESSAGE__
        if (list_p->um_msg_info_p != NULL)
        {
            jdd_MemFree(list_p->um_msg_info_p);
            list_p->um_msg_info_p = NULL;
        }
    #else /* __MMI_UNIFIED_MESSAGE__ */ 
        if (list_p->address_as_hint_p != NULL)
        {
            jdd_MemFree(list_p->address_as_hint_p);
            list_p->address_as_hint_p = NULL;
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        /* nedd to strcmp all static subjects, Don't call jdd_memfree for them */
    #ifndef __MMI_UNIFIED_MESSAGE__
        if (list_p->subject_as_caption_p != NULL
            && (mmi_ucs2cmp((S8*) (list_p->subject_as_caption_p), (S8*) GetString(STR_ID_NO_SUBJECT)) != 0)
            && (mmi_ucs2cmp((S8*) (list_p->subject_as_caption_p), (S8*) GetString(STR_ID_JMMS_DELIVERY_REPORT))
                != 0) &&
            (mmi_ucs2cmp((S8*) (list_p->subject_as_caption_p), (S8*) GetString(STR_ID_SETTINGS_READ_REPORT)) != 0))
        {
            jdd_MemFree(list_p->subject_as_caption_p);
            list_p->subject_as_caption_p = NULL;
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
        jdd_MemFree(list_p);
        list_p = NULL;
        list_p = list1_p;
    }
    *msgs_list_p = NULL;
}

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_back_from_msgs_list_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_back_from_msgs_list_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_free_msgs_list(&(g_jmms_context->store_context->messages_list));

    GoBackToHistory(SCR_ID_JMMS_MAIN_MENU);
}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_deinit
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_deinit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_deinit Enter");
    if (g_jmms_context != NULL)
    {
        if (!jmms_is_ready())
        {
            return;
        }
    #ifdef __MMI_UNIFIED_COMPOSER__
        if (g_jmms_context->uc_creation_req == JMMS_UC_BACKGROUND_SAVING)
        {
            return;
        }
        mmi_jmms_uc_wap_send_failure_msg_rsp(g_jmms_context->msg_id);
    #endif /* __MMI_UNIFIED_COMPOSER__ */ 
        mmi_jmms_parse_continue_stop_timer();
        mmi_jmms_deinit_view();
        mmi_jmms_end_comm();
        mmi_jmms_deinit_mms_context(g_jmms_context);

        StopTimer(JMMS_ASYNC_SEND_TIMER);
        StopTimer(JMMS_ASYNC_SAVE_TIMER);
        mmi_jmms_clean_send_callback_list();
        mmi_jmms_clean_save_callback_list();

        if (g_jmms_context->orig_file_name_replace_mms)
        {
            jdd_MemFree(g_jmms_context->orig_file_name_replace_mms);
            g_jmms_context->orig_file_name_replace_mms = NULL;
        }

        if (g_jmms_context->store_context != NULL && g_jmms_context->store_context->messages_list != NULL)
        {
            mmi_jmms_free_msgs_list(&(g_jmms_context->store_context->messages_list));
        }

        mmi_jmms_free_use_details_adrresses_list();

        /* free msg headers- properties */
        mmi_jmms_free_recieved_msg_header();
        mmi_jmms_free_notification_header();
        mmi_jmms_free_delivery_report_header();
        mmi_jmms_free_report_report_header();
        mmi_jmms_free_new_mms_sent_header();

        /* reset the open msg status- for At delete */
        g_jmms_context->msg_open_status[0] = 0;
        g_jmms_context->msg_open_status[1] = 0;
        g_jmms_context->is_add_media_warning = 0;
        g_jmms_context->progress_screen_in_history = 0;
        if (g_jmms_context->activated_mmsc_url_p)   /* remove memory leak */
        {
            jdd_MemFree(g_jmms_context->activated_mmsc_url_p);
            g_jmms_context->activated_mmsc_url_p = NULL;
        }
    }
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_deinit Exit");
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_send_get_msg_list_event
 * DESCRIPTION
 *  
 * PARAMETERS
 *  foldername_p        [IN]        
 *  total_num_msgs      [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_send_get_msg_list_event(S8 *foldername_p, U8 total_num_msgs)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    JC_RETCODE ret_code = JC_OK;

    JC_EVENT_DATA event_data = {0, };
    mmi_jmms_get_msg_list_queue_event_struct folder_info = {0, };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    event_data.destTaskInfo.iAppID = E_TASK_MMS_UI;
    event_data.destTaskInfo.iTaskID = E_TASK_MMS_UI;

    event_data.srcTaskInfo.iAppID = E_TASK_MMS_UI;
    event_data.srcTaskInfo.iTaskID = E_TASK_MMS_UI;

    event_data.uiEventInfoSize = sizeof(mmi_jmms_get_msg_list_queue_event_struct);

    event_data.iEventType = E_MMS_GET_MSG_LIST_EVENT;

    if (strcmp((S8*) MMI_JMMS_INBOX, (S8*) foldername_p) == 0)
    {
        folder_info.folder_name = E_JMMS_INBOX;
    }
    else if (strcmp((S8*) "Outbox", (S8*) foldername_p) == 0)
    {
        folder_info.folder_name = E_JMMS_OUTBOX;
    }
    else if (strcmp((S8*) "Sent", (S8*) foldername_p) == 0)
    {
        folder_info.folder_name = E_JMMS_SENT;
    }
    else if (strcmp((S8*) "Drafts", (S8*) foldername_p) == 0)
    {
        folder_info.folder_name = E_JMMS_DRAFTS;
    }

    folder_info.total_num_msgs = total_num_msgs;

    ret_code = jdd_QueueAlloc(&event_data);
    if (JC_OK != ret_code)
    {
        return ret_code;
    }

    jc_memcpy(event_data.pEventInfo, &folder_info, sizeof(mmi_jmms_get_msg_list_queue_event_struct));

    ret_code = jdd_QueueSend(&event_data);
    if (JC_OK != ret_code)
    {
        jdd_QueueFree(&event_data); /* remove memory leak */
        return ret_code;
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_recieve_get_msg_list_event
 * DESCRIPTION
 *  
 * PARAMETERS
 *  event_data_p        [OUT]       
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_recieve_get_msg_list_event(mmi_jmms_get_msg_list_queue_event_struct *event_data_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_get_msg_list_queue_event_struct *folder_info_p;
    JC_RETCODE ret_code = JC_OK;
    U16 curr_scr_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    folder_info_p = (mmi_jmms_get_msg_list_queue_event_struct*) (event_data_p);

    if (folder_info_p->folder_name == E_JMMS_INBOX)
    {
        ret_code = mmi_jmms_get_folder_msg_list(
                    &(g_jmms_context->store_context->messages_list),
                    MMI_JMMS_INBOX,
                    folder_info_p->total_num_msgs);
    }
    else if (folder_info_p->folder_name == E_JMMS_OUTBOX)
    {
        ret_code = mmi_jmms_get_folder_msg_list(
                    &(g_jmms_context->store_context->messages_list),
                    MMI_JMMS_OUTBOX,
                    folder_info_p->total_num_msgs);
    }
    else if (folder_info_p->folder_name == E_JMMS_DRAFTS)
    {
        ret_code = mmi_jmms_get_folder_msg_list(
                    &(g_jmms_context->store_context->messages_list),
                    MMI_JMMS_DRAFTS,
                    folder_info_p->total_num_msgs);
    }
    else if (folder_info_p->folder_name == E_JMMS_SENT)
    {
        ret_code = mmi_jmms_get_folder_msg_list(
                    &(g_jmms_context->store_context->messages_list),
                    MMI_JMMS_SENT,
                    folder_info_p->total_num_msgs);
    }

    if (ret_code != JC_OK)
    {
        curr_scr_id = GetActiveScreenId();

        mmi_jmms_free_msgs_list(&(g_jmms_context->store_context->messages_list));
    #ifndef __MMI_UNIFIED_MESSAGE__
        if (curr_scr_id == SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN)
        {
            DisplayPopup(
                (U8*) GetString(STR_ID_JMMS_ERROR_GET_MSG_LIST),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                (U8) ERROR_TONE);
            DeleteUptoScrID(SCR_ID_JMMS_MAIN_MENU);
        }
        else
        {

            /* to avoid the show of pop up over Phone call or some other screen */
            HistoryReplace(
                SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN,
                SCR_ID_JMMS_GET_MSGS_ERROR_SCREEN,
                mmi_jmms_entry_msgs_get_error_screen);
        }
    #endif /* __MMI_UNIFIED_MESSAGE__ */ 
    }

    return;
}

#ifndef __MMI_UNIFIED_MESSAGE__


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_get_msgs_progress_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_get_msgs_progress_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_GET_MSGS_PROGRESS_SCREEN, NULL, mmi_jmms_entry_get_msgs_progress_screen, NULL);

    // TODO::put an animated image
    ShowCategory8Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        0,
        0,
        STR_ID_JMMS_LOADING_MMS,
        IMG_GLOBAL_PROGRESS,
        NULL);

    ClearAllKeyHandler();
    ClearKeyHandler(KEY_END, KEY_EVENT_UP);
    ClearKeyHandler(KEY_END, KEY_EVENT_DOWN);
    ClearKeyHandler(KEY_END, KEY_LONG_PRESS);
    ClearKeyHandler(KEY_END, KEY_REPEAT);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_msgs_get_error_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_msgs_get_error_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_GET_MSGS_ERROR_SCREEN, NULL, mmi_jmms_entry_msgs_get_error_screen, NULL);

    ShowCategory2Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        STR_ID_JMMS_ERROR_GET_MSG_LIST,
        NULL);

    SetRightSoftkeyFunction(mmi_jmms_back_from_msgs_list_screen, KEY_EVENT_UP);

}
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
//PMT VIKAS START 20060325
//Function store and return the size of MMS base on type pass


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_save_size_of_mms
 * DESCRIPTION
 *  
 * PARAMETERS
 *  temp_size_p     [IN/OUT]        
 *  type            [IN]            
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_save_size_of_mms(S32 *temp_size_p, S32 type)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    static S32 message_size = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (type == MMS_SIZE_STORE)
    {
        message_size = *temp_size_p;
    }
    else
    {
        *temp_size_p = message_size;
    }
}

/* PMT VIKAS END 20060325 */


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_show_mms_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_type            [IN]        
 *  folder_name_p       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_show_mms_properties(U16 msg_type, S8 *folder_name_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;
    U8 number = 0;
    RETRIEVE_FILTERS store_ret_filter = {0, };
    MESSAGE_LIST *message_list_p = NULL;
    MESSAGE_LIST *temp_message_list = NULL;

#if !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT)
    JC_INT32 index = 0;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* mmi_mms_get_number_of_messages(folder_name_p, &number); */
    number = g_jmms_context->store_context->num_msg_in_curr_folder;

    if (strcmp((S8*) folder_name_p, (S8*) MMI_JMMS_TEMPLATES) == 0)
    {
        store_ret_filter.uiStartIndex = g_jmms_context->curr_scr_hilited_index + 1;
    }
    else
    {
        store_ret_filter.uiStartIndex = number - g_jmms_context->curr_scr_hilited_index;
    }
    store_ret_filter.eRetrieve = E_RETRIEVE_BY_INDEX;
    store_ret_filter.uiNumMessage = 1;

    ret_code = mmi_jmms_get_messages_list(folder_name_p, &temp_message_list, &store_ret_filter);

    message_list_p = temp_message_list;

    if (ret_code != JC_OK || message_list_p == NULL)
    {
        mmi_jmms_error_handler(ret_code);
        return;
    }
    mmi_jmms_save_size_of_mms((S32*) & message_list_p->uiBufferLen, MMS_SIZE_STORE);
    if (msg_type == E_MSG_NEW_MMS_TEMPLATES)
    {
        if (message_list_p->pMessageHeaders->eMsgType != E_MSG_TYPE_SEND)
        {
            DisplayPopup((U8*) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, (U8) ERROR_TONE);
            return;
        }
        ret_code = mmi_jmms_create_new_mms_sent_header(message_list_p->pMessageHeaders->pHeaders);
        if (ret_code != JC_OK)
        {
            mmi_jmms_error_handler(ret_code);
            return;
        }
        mmi_jmms_entry_new_mms_template_properties();
        return;
    }
    else
    {
    #if !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT)
        mmi_jmms_deinit_mms_context(g_jmms_context);

        if (g_jmms_context->parse_content_p == NULL)
        {
            g_jmms_context->parse_content_p = (CONTENT_DATA*) jdd_MemAlloc(sizeof(CONTENT_DATA), 1);
        }

        g_jmms_context->parse_content_p->bIsStream = E_TRUE;
        index =
            (JC_INT32) (g_jmms_context->store_context->num_msg_in_curr_folder - g_jmms_context->curr_scr_hilited_index);

        ret_code = mmi_jmms_get_message(folder_name_p, g_jmms_context->parse_content_p, index);
        if (ret_code != JC_OK)
        {
            mmi_jmms_error_handler(ret_code);
            goto END;
        }

        if (ret_code != JC_OK || message_list_p == NULL)
        {
            mmi_jmms_error_handler(ret_code);
            goto END;
        }

        mmi_jmms_parsing_progressing_screen();
        ret_code = mmi_jmms_jdi_parse_msg_buffer(
                    &(g_jmms_context->msg_handle),
                    g_jmms_context->parse_content_p,
                    E_TYPE_MMS,
                    E_TRUE);

        if (ret_code == JC_ERR_MMS_PARSE_PENDING)
        {
            mmi_jmms_parse_continue_start_timer(
                g_jmms_context->msg_handle,
                mmi_jmms_show_mms_properties_asyn_callback,
                mmi_jmms_only_abort_parsing_progress);
            return;
        }
        mmi_jmms_show_mms_properties_asyn_callback(ret_code);
    #else /* !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT) */ 
        mmi_jmms_pre_entry_properties_screen();
    #endif /* !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT) */ 
    }
#if !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT)
  END:
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            g_jmms_context->parse_content_p->pFileName = NULL;
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }
    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }
    }
#endif /* !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT) */ 
    return;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_new_mms_sent_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  send_msg_header_p       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_create_new_mms_sent_header(MESSAGE_SEND *send_msg_header_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_SEND *send_msg_p = NULL;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    send_msg_p = (MESSAGE_SEND*) jdd_MemAlloc(sizeof(MESSAGE_SEND), 1);
    if (send_msg_p == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto ERROR_HANDLE;
    }

    if (send_msg_header_p->pTo != NULL)
    {
        send_msg_p->pTo = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(send_msg_header_p->pTo) + 1);
        if (send_msg_p->pTo == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(send_msg_p->pTo, send_msg_header_p->pTo);
    }

    if (send_msg_header_p->pCc != NULL)
    {
        send_msg_p->pCc = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(send_msg_header_p->pCc) + 1);
        if (send_msg_p->pCc == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(send_msg_p->pCc, send_msg_header_p->pCc);
    }

    if (send_msg_header_p->pBcc != NULL)
    {
        send_msg_p->pBcc = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(send_msg_header_p->pBcc) + 1);
        if (send_msg_p->pBcc == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(send_msg_p->pBcc, send_msg_header_p->pBcc);
    }

    if (send_msg_header_p->pSubject != NULL)
    {
        send_msg_p->pSubject = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(send_msg_header_p->pSubject) + 1);
        if (send_msg_p->pSubject == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(send_msg_p->pSubject, send_msg_header_p->pSubject);
    }

    send_msg_p->eMsgPriority = send_msg_header_p->eMsgPriority;
    send_msg_p->eMsgClass = send_msg_header_p->eMsgClass;
    send_msg_p->uiDate = send_msg_header_p->uiDate;

    g_jmms_context->send_msg_p = (MESSAGE_SEND*) (send_msg_p);

  ERROR_HANDLE:

    if (ret_code != JC_OK && send_msg_p != NULL)
    {
        mmi_jmms_free_new_mms_sent_header();
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_new_mms_sent_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_new_mms_sent_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_SEND *send_msg_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    send_msg_p = (MESSAGE_SEND*) g_jmms_context->send_msg_p;

    if (send_msg_p == NULL)
    {
        return;
    }

    if (send_msg_p->pTo != NULL)
    {
        jdd_MemFree(send_msg_p->pTo);
        send_msg_p->pTo = NULL;
    }

    if (send_msg_p->pCc != NULL)
    {
        jdd_MemFree(send_msg_p->pCc);
        send_msg_p->pCc = NULL;
    }

    if (send_msg_p->pBcc != NULL)
    {
        jdd_MemFree(send_msg_p->pBcc);
        send_msg_p->pBcc = NULL;
    }

    if (send_msg_p->pSubject != NULL)
    {
        jdd_MemFree(send_msg_p->pSubject);
        send_msg_p->pSubject = NULL;
    }

    jdd_MemFree(send_msg_p);
    send_msg_p = NULL;
    g_jmms_context->send_msg_p = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_read_report_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  read_report_header_p        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_create_read_report_header(READ_REPORT_RESPONSE *read_report_header_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    READ_REPORT_RESPONSE *read_report_p = NULL;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    read_report_p = (READ_REPORT_RESPONSE*) jdd_MemAlloc(sizeof(READ_REPORT_RESPONSE), 1);
    if (read_report_p == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto ERROR_HANDLE;
    }

    read_report_p->eReadStatus = read_report_header_p->eReadStatus;

    if (read_report_header_p->pTo != NULL)
    {
        read_report_p->pTo = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(read_report_header_p->pTo) + 1);
        if (read_report_p->pTo == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(read_report_p->pTo, read_report_header_p->pTo);
    }

    if (read_report_header_p->pFrom != NULL)
    {
        read_report_p->pFrom = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(read_report_header_p->pFrom) + 1);
        if (read_report_p->pFrom == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(read_report_p->pFrom, read_report_header_p->pFrom);
    }

    if (read_report_header_p->pMessageID != NULL)
    {
        read_report_p->pMessageID = (JC_INT8*) jdi_UtilsStrdup(read_report_header_p->pMessageID);
    }

    read_report_p->uiReceivedTime = read_report_header_p->uiReceivedTime;

    g_jmms_context->read_report_p = (READ_REPORT_RESPONSE*) (read_report_p);

  ERROR_HANDLE:

    if (ret_code != JC_OK && read_report_p != NULL)
    {
        mmi_jmms_free_report_report_header();
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_report_report_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_report_report_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    READ_REPORT_RESPONSE *read_report_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    read_report_p = (READ_REPORT_RESPONSE*) g_jmms_context->read_report_p;

    if (read_report_p == NULL)
    {
        return;
    }

    if (read_report_p->pTo != NULL)
    {
        jdd_MemFree(read_report_p->pTo);
        read_report_p->pTo = NULL;
    }

    if (read_report_p->pFrom != NULL)
    {
        jdd_MemFree(read_report_p->pFrom);
        read_report_p->pFrom = NULL;
    }

    if (read_report_p->pMessageID != NULL)
    {
        jdd_MemFree(read_report_p->pMessageID);
        read_report_p->pMessageID = NULL;
    }

    jdd_MemFree(read_report_p);
    read_report_p = NULL;
    g_jmms_context->read_report_p = NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_delivery_report_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  delivery_header_p       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_create_delivery_report_header(DELIVERY_REPORT *delivery_header_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    DELIVERY_REPORT *delivery_p = NULL;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    delivery_p = (DELIVERY_REPORT*) jdd_MemAlloc(sizeof(DELIVERY_REPORT), 1);
    if (delivery_p == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto ERROR_HANDLE;
    }

    delivery_p->eDeliveryStatus = delivery_header_p->eDeliveryStatus;

    if (delivery_header_p->pTo != NULL)
    {
        delivery_p->pTo = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(delivery_header_p->pTo) + 1);
        if (delivery_p->pTo == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(delivery_p->pTo, delivery_header_p->pTo);
    }

    if (delivery_header_p->pMessageID != NULL)
    {
        delivery_p->pMessageID = (JC_INT8*) jdi_UtilsStrdup(delivery_header_p->pMessageID);
    }

    delivery_p->uiDate = delivery_header_p->uiDate;

    g_jmms_context->delivery_p = (DELIVERY_REPORT*) (delivery_p);

  ERROR_HANDLE:

    if (ret_code != JC_OK && delivery_p != NULL)
    {
        mmi_jmms_free_delivery_report_header();
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_delivery_report_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_delivery_report_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    DELIVERY_REPORT *delivery_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    delivery_p = (DELIVERY_REPORT*) g_jmms_context->delivery_p;

    if (delivery_p == NULL)
    {
        return;
    }

    if (delivery_p->pTo != NULL)
    {
        jdd_MemFree(delivery_p->pTo);
        delivery_p->pTo = NULL;
    }

    if (delivery_p->pMessageID != NULL)
    {
        jdd_MemFree(delivery_p->pMessageID);
        delivery_p->pMessageID = NULL;
    }

    jdd_MemFree(delivery_p);
    delivery_p = NULL;
    g_jmms_context->delivery_p = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_notification_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  notf_header_p       [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_create_notification_header(MESSAGE_NOTIFICATION *notf_header_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_NOTIFICATION *notification_p = NULL;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    notification_p = (MESSAGE_NOTIFICATION*) jdd_MemAlloc(sizeof(MESSAGE_NOTIFICATION), 1);
    if (notification_p == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto ERROR_HANDLE;
    }

    if (notf_header_p->pFrom != NULL)
    {
        notification_p->pFrom = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(notf_header_p->pFrom) + 1);
        if (notification_p->pFrom == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(notification_p->pFrom, notf_header_p->pFrom);
    }

    if (notf_header_p->pSubject != NULL)
    {
        notification_p->pSubject = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(notf_header_p->pSubject) + 1);
        if (notification_p->pSubject == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(notification_p->pSubject, notf_header_p->pSubject);
    }

    notification_p->uiExpiryTime = notf_header_p->uiExpiryTime;
    notification_p->uiMessageSize = notf_header_p->uiMessageSize;
    notification_p->eMsgPriority = notf_header_p->eMsgPriority;
    notification_p->eMsgClass = notf_header_p->eMsgClass;
    notification_p->uiReceivedTime = notf_header_p->uiReceivedTime;

    g_jmms_context->notification_p = (MESSAGE_NOTIFICATION*) (notification_p);

  ERROR_HANDLE:

    if (ret_code != JC_OK && notification_p != NULL)
    {
        mmi_jmms_free_notification_header();
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_notification_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_notification_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_NOTIFICATION *notification_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    notification_p = (MESSAGE_NOTIFICATION*) (g_jmms_context->notification_p);

    if (notification_p == NULL)
    {
        return;
    }

    if (notification_p->pFrom != NULL)
    {
        jdd_MemFree(notification_p->pFrom);
        notification_p->pFrom = NULL;
    }

    if (notification_p->pSubject != NULL)
    {
        jdd_MemFree(notification_p->pSubject);
        notification_p->pSubject = NULL;
    }

    jdd_MemFree(notification_p);
    notification_p = NULL;
    g_jmms_context->notification_p = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_create_recieved_msg_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  recieve_header_p        [IN]        
 * RETURNS
 *  
 *****************************************************************************/
JC_RETCODE mmi_jmms_create_recieved_msg_header(MESSAGE_RETRIEVAL *recieve_header_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_RETRIEVAL *retrieval_p = NULL;
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    retrieval_p = (MESSAGE_RETRIEVAL*) jdd_MemAlloc(sizeof(MESSAGE_RETRIEVAL), 1);
    if (retrieval_p == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto ERROR_HANDLE;
    }

    if (recieve_header_p->pFrom != NULL)
    {
        retrieval_p->pFrom = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(recieve_header_p->pFrom) + 1);
        if (retrieval_p->pFrom == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(retrieval_p->pFrom, recieve_header_p->pFrom);
    }

    if (recieve_header_p->pTo != NULL)
    {
        retrieval_p->pTo = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(recieve_header_p->pTo) + 1);
        if (retrieval_p->pTo == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(retrieval_p->pTo, recieve_header_p->pTo);
    }

    if (recieve_header_p->pCc != NULL)
    {
        retrieval_p->pCc = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(recieve_header_p->pCc) + 1);
        if (retrieval_p->pCc == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(retrieval_p->pCc, recieve_header_p->pCc);
    }

    if (recieve_header_p->pSubject != NULL)
    {
        retrieval_p->pSubject = (JC_CHAR*) jdd_MemAlloc(sizeof(JC_CHAR), jc_tcslen(recieve_header_p->pSubject) + 1);
        if (retrieval_p->pSubject == NULL)
        {
            ret_code = JC_ERR_MEMORY_ALLOCATION;
            goto ERROR_HANDLE;
        }
        jc_tcscpy(retrieval_p->pSubject, recieve_header_p->pSubject);
    }

    retrieval_p->eMsgPriority = recieve_header_p->eMsgPriority;
    retrieval_p->eMsgClass = recieve_header_p->eMsgClass;
    retrieval_p->uiDate = recieve_header_p->uiDate;

    g_jmms_context->retrieval_p = (MESSAGE_RETRIEVAL*) (retrieval_p);

  ERROR_HANDLE:

    if (ret_code != JC_OK && retrieval_p != NULL)
    {
        mmi_jmms_free_recieved_msg_header();
    }

    return ret_code;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_free_recieved_msg_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_free_recieved_msg_header(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MESSAGE_RETRIEVAL *retrieval_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    retrieval_p = (MESSAGE_RETRIEVAL*) (g_jmms_context->retrieval_p);

    if (retrieval_p == NULL)
    {
        return;
    }

    if (retrieval_p->pFrom != NULL)
    {
        jdd_MemFree(retrieval_p->pFrom);
        retrieval_p->pFrom = NULL;
    }

    if (retrieval_p->pTo != NULL)
    {
        jdd_MemFree(retrieval_p->pTo);
        retrieval_p->pTo = NULL;
    }

    if (retrieval_p->pCc != NULL)
    {
        jdd_MemFree(retrieval_p->pCc);
        retrieval_p->pCc = NULL;
    }

    if (retrieval_p->pSubject != NULL)
    {
        jdd_MemFree(retrieval_p->pSubject);
        retrieval_p->pSubject = NULL;
    }

    jdd_MemFree(retrieval_p);
    retrieval_p = NULL;
    g_jmms_context->retrieval_p = NULL;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_common_exit_property_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_common_exit_property_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->property_display_buffer_p != NULL)
    {
        jdd_MemFree(g_jmms_context->property_display_buffer_p);
        g_jmms_context->property_display_buffer_p = NULL;
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_new_mms_sent_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_new_mms_sent_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    PU8 gui_buffer_p;   /* Buffer holding history data */
    S8 temp[14];
    MYTIME time, time1;

    /* PMT VIKAS START 20060325 */
    S32 size = 0, size_kb = 0, size_bytes = 0, len_to_copy = 0;

#ifdef META_HANDLING_SUPPORT
    JC_RETCODE ret_code = JC_OK;
#endif 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* PMT VIKAS END 20060325 */

    EntryNewScreen(
        SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES,
        mmi_jmms_common_exit_property_screen,
        mmi_jmms_entry_new_mms_sent_properties,
        NULL);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
        return;
    }

    /* /TO */
    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_TO));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pTo == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pTo,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /CC */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_CC));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pCc == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pCc,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /BCC */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_BCC));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pBcc == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pBcc,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /Subject */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SUBJECT));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pSubject == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        len_to_copy = mmi_ucs2strlen((S8*) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pSubject);
        if (len_to_copy > MAX_SUBJECT_LENGTH)
        {
            len_to_copy = MAX_SUBJECT_LENGTH;
        }
        mmi_ucs2ncat(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->pSubject,
            len_to_copy);
    }

    /* /Priority */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_PRIORITY));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* MAUI_00017989 Start */
    /* MAUI_00018625 Start */
    switch (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->eMsgPriority)
        /* MAUI_00018625 End */
        /* MAUI_00017989 End */
    {
        case E_MSG_PRIORITY_LOW:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_LOW));
            break;
        case E_MSG_PRIORITY_NORMAL:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_NORMAL));
            break;
        case E_MSG_PRIORITY_HIGH:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_HIGH));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* //message class */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MSG_CLASS));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    switch (((MESSAGE_SEND*) g_jmms_context->send_msg_p)->eMsgClass)
    {
        case E_MSG_PERSONAL_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_PERSONEL_MSG_CLASS));
            break;
        case E_MSG_ADVERTISEMENT_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_SETTINGS_ADVERTISMENT));
            break;
        case E_MSG_INFORMATION_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_INFORMATIONAL_MSG_CLASS));
            break;
        case E_MSG_AUTO_CLASS:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_AUTO_MSG_CLASS));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* /Creation Date */

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_SEND*) (g_jmms_context->send_msg_p))->uiDate == 0)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        U8 dttemp[40];
        FLOAT timezone;

        timezone = mmi_dt_get_tz();
        mmi_dt_utc_sec_2_mytime((U32) ((MESSAGE_SEND*) g_jmms_context->send_msg_p)->uiDate, &time1, MMI_TRUE);
        mmi_dt_utc_to_rtc(timezone, time1, time);
        /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
        /* Date */
        memset(dttemp, 0x00, 40);
        date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

        memset(temp, 0x00, 6);
        mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        /* Time */
        memset(dttemp, 0x00, 40);
        time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);
        /* END of changes - RAJ KUMAR GUPTA */
    }
    //PMT VIKAS START 20060325
    ///MMS Size            
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SIZE));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_jmms_save_size_of_mms(&size, MMS_SIZE_RETRIVE);
    size_kb = size / 1024;
    size_bytes = size % 1024;

    if (size_kb >= 1)
    {
        size_kb++;
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_kb, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_KB));

    }
    else
    {
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_bytes, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_BYTES));
    }
    /* PMT VIKAS END 20060325 */
#ifdef META_HANDLING_SUPPORT
    ret_code = mmi_jmms_get_meta_info(g_jmms_context);
    if (ret_code != JC_OK)
    {
        mmi_jmms_error_handler(ret_code);
        DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
        return;
    }
#endif /* META_HANDLING_SUPPORT */ 
    ShowCategory78Screen(
        /* MAUI_00018481 Start */ STR_ID_JMMS_OPTIONS_PROPERTIES,
        /* MAUI_00018481 End */ GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        NULL,
        NULL,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        NULL,
        (U8*) g_jmms_context->property_display_buffer_p,
        mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p),
        gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_sent_msg_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_sent_msg_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_sent_msg_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  dest_buffer_p               [IN]        
 *  source_address_buffer_p     [IN]        
 *  max_limit_number            [IN]        
 *  max_limit_email             [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
        PS8 dest_buffer_p,
        PS8 source_address_buffer_p,
        U32 max_limit_number,
        U32 max_limit_email)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 temp_address = NULL;
    PS8 address_buffer_locater_p = source_address_buffer_p;
    PS8 name;
    U32 len_to_copy = 0;
    U32 max_limit;
    PS8 temp_add_p = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    max_limit = (max_limit_number >= max_limit_email) ? max_limit_number : max_limit_email;
    temp_address = (S8*) jdd_MemAlloc(sizeof(S8), (max_limit + 1) * ENCODING_LENGTH);
    if (temp_address == NULL)
    {
        mmi_ucs2cat((S8*) dest_buffer_p, (S8*) source_address_buffer_p);
        return;
    }
    while (address_buffer_locater_p != NULL)
    {
        temp_add_p = NULL;
        memset(temp_address, 0, (max_limit + 1) * ENCODING_LENGTH);
        temp_add_p = mmi_ucs2chr((S8*) address_buffer_locater_p, L';');
        if (temp_add_p != NULL)
        {
            len_to_copy = (temp_add_p - address_buffer_locater_p) / ENCODING_LENGTH;
        }
        else
        {
            len_to_copy = mmi_ucs2strlen(address_buffer_locater_p);
        }
        len_to_copy = (len_to_copy >= max_limit) ? max_limit : len_to_copy;
        mmi_ucs2ncpy((S8*) temp_address, (S8*) address_buffer_locater_p, len_to_copy);

        if (!mmi_ucs2chr((S8*) temp_address, L'@'))
        {
            temp_address[max_limit_number * ENCODING_LENGTH] = 0;
            temp_address[max_limit_number * ENCODING_LENGTH + 1] = 0;
        #ifdef __MMI_JATAAYU_MMS_DISPLAY_NAME_FROM_PHB__
            name = (PS8) lookUpNumber((PS8) temp_address);
        #else 
            name = temp_address;
        #endif 
            if (name != NULL && mmi_ucs2strlen(name) > 0)
            {
                mmi_ucs2cat((S8*) dest_buffer_p, (S8*) name);
            }
            else
            {
                mmi_ucs2ncat((S8*) dest_buffer_p, (S8*) temp_address, len_to_copy);
            }
        }
        else
        {
            mmi_ucs2ncat((S8*) dest_buffer_p, (S8*) temp_address, len_to_copy);
        }

        if (temp_add_p != NULL)
        {
            address_buffer_locater_p = temp_add_p + ENCODING_LENGTH;

            mmi_ucs2cat((S8*) dest_buffer_p, (S8*) L";");
        }
        else
        {
            address_buffer_locater_p = NULL;
        }
    }   /* End of while */
    jdd_MemFree(temp_address);
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_sent_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_sent_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_free_new_mms_sent_header();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_sent_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_sent_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_free_new_mms_sent_header();
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_show_notification_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_show_notification_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 gui_buffer_p;   /* Buffer holding history data */
    S8 temp[14];
    U8 dttemp[40];
    MYTIME time1, time;
    FLOAT timezone;
    S32 expiry_secs = 0, expiry_hrs = 0, expiry_mins = 0, expiry_days = 0;
    S32 size = 0, size_kb = 0, size_bytes = 0, len_to_copy = 0;

#ifdef __MMI_UNIFIED_MESSAGE__
    U16 left_softkey_property = NULL;
    U16 left_softkey_icon_property = NULL;
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    timezone = mmi_dt_get_tz();
    EntryNewScreen(
        SCR_ID_JMMS_NOTIFICATION_PROPERTIES,
        mmi_jmms_common_exit_property_screen,
        mmi_jmms_show_notification_properties,
        NULL);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_NOTIFICATION_PROPERTIES);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_NOTIFICATION_PROPERTIES);
        return;
    }

    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_FROM));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->pFrom == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->pFrom,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /Subject */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SUBJECT));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->pSubject == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        len_to_copy = mmi_ucs2strlen((S8*) ((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->pSubject);
        if (len_to_copy > MAX_SUBJECT_LENGTH)
        {
            len_to_copy = MAX_SUBJECT_LENGTH;
        }
        mmi_ucs2ncat(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->pSubject,
            len_to_copy);
    }

    /* Expiry Time */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_EXPIRE_TIME));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    expiry_secs = (S32) (((MESSAGE_NOTIFICATION*) (g_jmms_context->notification_p))->uiExpiryTime);
    expiry_hrs = (S32) (expiry_secs / 3600);

    if (expiry_hrs > 24)    /* /> 1 day */
    {

        expiry_days = expiry_hrs / 24;
        expiry_hrs = expiry_hrs % 24;

        /* /expiry days */
        memset(temp, 0x00, 14);
        gui_itoa((S32) expiry_days, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DAYS));

        if (expiry_hrs > 0)
        {
            memset(temp, 0x00, 4);
            mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            /* /expiry hrs */
            memset(temp, 0x00, 14);
            gui_itoa((S32) expiry_hrs, (UI_string_type) temp, 10);
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
            memset(temp, 0x00, 4);
            mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_HRS));
        }
    }
    else
    {

        /* /expiry hrs */
        memset(temp, 0x00, 14);
        gui_itoa((S32) expiry_hrs, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_HRS));

        /* /expiry mins */
        expiry_mins = (S32) ((expiry_secs % 3600) / 60);
        if (expiry_mins > 0)
        {
            memset(temp, 0x00, 4);
            mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            memset(temp, 0x00, 14);
            gui_itoa((S32) expiry_mins, (UI_string_type) temp, 10);
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
            memset(temp, 0x00, 4);
            mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MINS));
        }
    }

    /* /Size of MMS */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SIZE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    size = (S32) (((MESSAGE_NOTIFICATION*) (g_jmms_context->notification_p))->uiMessageSize);
    size_kb = size / 1024;
    size_bytes = size % 1024;

    if (size_kb >= 1)
    {
        size_kb++;
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_kb, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_KB));

    }
    else
    {
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_bytes, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_BYTES));
    }

    /* /Priority */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_PRIORITY));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* MAUI_00017989 Start */
    /* MAUI_00018625 Start */
    switch (((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->eMsgPriority)
        /* MAUI_00018625 End */
        /* MAUI_00017989 End */
    {
        case E_MSG_PRIORITY_LOW:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_LOW));
            break;
        case E_MSG_PRIORITY_NORMAL:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_NORMAL));
            break;
        case E_MSG_PRIORITY_HIGH:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_HIGH));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* //message class */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MSG_CLASS));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    switch (((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->eMsgClass)
    {
        case E_MSG_PERSONAL_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_PERSONEL_MSG_CLASS));
            break;
        case E_MSG_ADVERTISEMENT_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_SETTINGS_ADVERTISMENT));
            break;
        case E_MSG_INFORMATION_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_INFORMATIONAL_MSG_CLASS));
            break;
        case E_MSG_AUTO_CLASS:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_AUTO_MSG_CLASS));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* /Recieve Date */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_dt_utc_sec_2_mytime(
        (U32) ((MESSAGE_NOTIFICATION*) g_jmms_context->notification_p)->uiReceivedTime,
        &time1,
        MMI_TRUE);
    mmi_dt_utc_to_rtc(timezone, time1, time);

    /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
    /* Date */
    memset(dttemp, 0x00, 40);
    date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* Time */
    memset(dttemp, 0x00, 40);
    time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);
    /* END of changes - RAJ KUMAR GUPTA */
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id == SCR_ID_JMMS_INBOX_OPTIONS)
    {
        left_softkey_property = NULL;
        left_softkey_icon_property = NULL;
    }
    else
    {
        left_softkey_property = STR_GLOBAL_OPTIONS;
        left_softkey_icon_property = IMG_GLOBAL_OPTIONS;
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    /* MAUI_00018481 Start */
    ShowCategory78Screen(STR_ID_JMMS_OPTIONS_PROPERTIES, GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
                         /* MAUI_00018481 End */
#ifdef __MMI_UNIFIED_MESSAGE__
                         left_softkey_property, left_softkey_icon_property,
#else 
                         NULL, NULL,
#endif 
                         STR_GLOBAL_BACK,
                         IMG_GLOBAL_BACK, NULL, (U8*) g_jmms_context->property_display_buffer_p,
                         mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p), gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_noification_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_noification_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id != SCR_ID_JMMS_INBOX_OPTIONS)
    {
        SetKeyHandler(mmi_jmms_pre_entry_inbox_options_scren, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetLeftSoftkeyFunction(mmi_jmms_pre_entry_inbox_options_scren, KEY_EVENT_UP);
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_notification_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_noification_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_noification_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_notification_header();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_notification_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_notification_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_notification_header();
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_java_mms_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_java_mms_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    PU8 gui_buffer_p;   /* Buffer holding history data */
    S8 temp[14];
    U8 dttemp[40];
    MYTIME time1, time;
    FLOAT timezone;

    /* PMT VIKAS START 20060325 */
    S32 size = 0, size_kb = 0, size_bytes = 0, len_to_copy = 0;

    /* PMT VIKAS END 20060325 */
    S8 *app_id_p = NULL, *reply_to_app_id_p = NULL;
    MM1_HDR_PARAM *content_type_params_p = NULL;
    U32 len = 0;

#ifdef __MMI_UNIFIED_MESSAGE__
    U16 left_softkey_property = NULL;
    U16 left_softkey_icon_property = NULL;
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    timezone = mmi_dt_get_tz();
    EntryNewScreen(
        SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES,
        mmi_jmms_common_exit_property_screen,
        mmi_jmms_entry_java_mms_properties,
        NULL);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
        return;
    }

    /* From */
    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_FROM));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pFrom == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pFrom,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /TO */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_TO));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pTo == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pTo,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /CC */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_CC));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pCc == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pCc,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /Subject */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SUBJECT));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pSubject == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        len_to_copy = mmi_ucs2strlen((S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pSubject);
        if (len_to_copy > MAX_SUBJECT_LENGTH)
        {
            len_to_copy = MAX_SUBJECT_LENGTH;
        }
        mmi_ucs2ncat(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->pSubject,
            len_to_copy);
    }

    /* /Priority */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_PRIORITY));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* MAUI_00017989 Start */
    /* MAUI_00018625 Start */
    switch (((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->eMsgPriority)
        /* MAUI_00018625 End */
        /* MAUI_00017989 End */
    {
        case E_MSG_PRIORITY_LOW:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_LOW));
            break;
        case E_MSG_PRIORITY_NORMAL:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_NORMAL));
            break;
        case E_MSG_PRIORITY_HIGH:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_HIGH));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    jdi_MsgGetContentTypeParams(g_jmms_context->msg_handle, &content_type_params_p);

    while (content_type_params_p != NULL)
    {
        if (mmi_jmms_jsr_get_application_string_from_content_type(content_type_params_p->pszName, JSR_APPLICATION_ID) !=
            NULL)
        {
            len = strlen((S8*) (content_type_params_p->pszValue));
            app_id_p = (S8*) jdd_MemAlloc(sizeof(S8), len * ENCODING_LENGTH + ENCODING_LENGTH);
            if (app_id_p == NULL)
            {
                return;
            }

            mmi_asc_to_ucs2((PS8) app_id_p, (PS8) (content_type_params_p->pszValue));

            memset(temp, 0x00, 14);
            mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_APPLICATION_ID));

            memset(temp, 0x00, 14);
            mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) app_id_p);

        }
        else if (mmi_jmms_jsr_get_application_string_from_content_type
                 (content_type_params_p->pszName, JSR_REPLY_TO_APPLICATION_ID) != NULL)
        {
            len = strlen((S8*) (content_type_params_p->pszValue));
            reply_to_app_id_p = (S8*) jdd_MemAlloc(sizeof(S8), len * ENCODING_LENGTH + ENCODING_LENGTH);
            if (reply_to_app_id_p == NULL)
            {
                return;
            }

            mmi_asc_to_ucs2((PS8) reply_to_app_id_p, (PS8) (content_type_params_p->pszValue));

            memset(temp, 0x00, 14);
            mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_REPLY_TO_APPLICATION_ID));

            memset(temp, 0x00, 14);
            mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) reply_to_app_id_p);

        }

        content_type_params_p = content_type_params_p->pNext;
    }

    if (app_id_p != NULL)
    {
        jdd_MemFree(app_id_p);
    }

    if (reply_to_app_id_p != NULL)
    {
        jdd_MemFree(reply_to_app_id_p);
    }

    /* /Recieved Date */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_dt_utc_sec_2_mytime((U32) ((MESSAGE_RETRIEVAL*) g_jmms_context->msg_header_type_p)->uiDate, &time1, MMI_TRUE);
    mmi_dt_utc_to_rtc(timezone, time1, time);

    /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
    /* Date */
    memset(dttemp, 0x00, 40);
    date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* Time */
    memset(dttemp, 0x00, 40);
    time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);
    /* END of Changes - RAJ KUMAR GUPTA */

    //PMT VIKAS START 20060325
    ///MMS Size            
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SIZE));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_jmms_save_size_of_mms(&size, MMS_SIZE_RETRIVE);
    size_kb = size / 1024;
    size_bytes = size % 1024;

    if (size_kb >= 1)
    {
        size_kb++;
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_kb, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_KB));

    }
    else
    {
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_bytes, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_BYTES));
    }
    /* PMT VIKAS END 20060325 */
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id == SCR_ID_JMMS_INBOX_OPTIONS)
    {
        left_softkey_property = NULL;
        left_softkey_icon_property = NULL;
    }
    else
    {
        left_softkey_property = STR_GLOBAL_OPTIONS;
        left_softkey_icon_property = IMG_GLOBAL_OPTIONS;
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    /* MAUI_00018481 Start */
    ShowCategory78Screen(STR_ID_JMMS_OPTIONS_PROPERTIES, GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
                         /* MAUI_00018481 End */
#ifdef __MMI_UNIFIED_MESSAGE__
                         left_softkey_property, left_softkey_icon_property,
#else 
                         NULL, NULL,
#endif 
                         STR_GLOBAL_BACK,
                         IMG_GLOBAL_BACK, NULL, (U8*) g_jmms_context->property_display_buffer_p,
                         mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p), gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_java_msg_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_java_msg_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id != SCR_ID_JMMS_INBOX_OPTIONS)
    {
        SetKeyHandler(mmi_jmms_pre_entry_inbox_options_scren, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetLeftSoftkeyFunction(mmi_jmms_pre_entry_inbox_options_scren, KEY_EVENT_UP);
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_java_msg_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;

}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_java_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_java_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_deinit_mms_context(g_jmms_context);
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_java_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_java_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_deinit_mms_context(g_jmms_context);
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_show_retrieved_mms_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_show_retrieved_mms_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 gui_buffer_p = NULL;    /* Buffer holding history data */
    S8 temp[14];
    U8 dttemp[40];
    MYTIME time1, time;
    FLOAT timezone;

    /* PMT VIKAS START 20060325 */
    S32 size = 0, size_kb = 0, size_bytes = 0, len_to_copy = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* PMT VIKAS END 20060325 */
#ifdef META_HANDLING_SUPPORT
    JC_RETCODE ret_code = JC_OK;
#endif 

    timezone = mmi_dt_get_tz();
    EntryNewScreen(
        SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES,
        mmi_jmms_common_exit_property_screen,
        mmi_jmms_show_retrieved_mms_properties,
        NULL);

    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
        return;
    }

    /* From */
    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_FROM));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pFrom == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pFrom,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /TO */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_TO));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pTo == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pTo,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /CC */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_CC));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pCc == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pCc,
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /Subject */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SUBJECT));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pSubject == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        len_to_copy = mmi_ucs2strlen((S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pSubject);
        if (len_to_copy > MAX_SUBJECT_LENGTH)
        {
            len_to_copy = MAX_SUBJECT_LENGTH;
        }
        mmi_ucs2ncat(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8*) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->pSubject,
            len_to_copy);
    }

    /* /Priority */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_PRIORITY));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* MAUI_00017989 Start */
    /* MAUI_00018625 Start */
    switch (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->eMsgPriority)
        /* MAUI_00018625 End */
        /* MAUI_00017989 End */
    {
        case E_MSG_PRIORITY_LOW:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_LOW));
            break;
        case E_MSG_PRIORITY_NORMAL:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_NORMAL));
            break;
        case E_MSG_PRIORITY_HIGH:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_SETTINGS_HIGH));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* //message class */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MSG_CLASS));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    switch (((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->eMsgClass)
    {
        case E_MSG_PERSONAL_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_PERSONEL_MSG_CLASS));
            break;
        case E_MSG_ADVERTISEMENT_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_SETTINGS_ADVERTISMENT));
            break;
        case E_MSG_INFORMATION_CLASS:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_INFORMATIONAL_MSG_CLASS));
            break;
        case E_MSG_AUTO_CLASS:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_AUTO_MSG_CLASS));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* /Recieved Date */
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_dt_utc_sec_2_mytime((U32) ((MESSAGE_RETRIEVAL*) g_jmms_context->retrieval_p)->uiDate, &time1, MMI_TRUE);
    mmi_dt_utc_to_rtc(timezone, time1, time);

    /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
    /* Date */
    memset(dttemp, 0x00, 40);
    date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* Time */
    memset(dttemp, 0x00, 40);
    time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    /* END of Changes - RAJ KUMAR GUPTA */

    //PMT VIKAS START 20060325
    ///MMS Size            
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_SIZE));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_jmms_save_size_of_mms(&size, MMS_SIZE_RETRIVE);
    size_kb = size / 1024;
    size_bytes = size % 1024;

    if (size_kb >= 1)
    {
        size_kb++;
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_kb, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_KB));

    }
    else
    {
        memset(temp, 0x00, 14);
        gui_itoa((S32) size_bytes, (UI_string_type) temp, 10);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        memset(temp, 0x00, 4);
        mmi_asc_to_ucs2((PS8) temp, (PS8) " ");
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_BYTES));
    }
    /* PMT VIKAS END 20060325 */
#ifdef META_HANDLING_SUPPORT
    ret_code = mmi_jmms_get_meta_info(g_jmms_context);
    if (ret_code != JC_OK)
    {
        mmi_jmms_error_handler(ret_code);
        DeleteScreenIfPresent(SCR_ID_JMMS_RETRIEVED_MMS_PROPERTIES);
        return;
    }
#endif /* META_HANDLING_SUPPORT */ 
    ShowCategory78Screen(
        /* MAUI_00018481 Start */ STR_ID_JMMS_OPTIONS_PROPERTIES,
        /* MAUI_00018481 End */ GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        NULL,
        NULL,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        NULL,
        (U8*) g_jmms_context->property_display_buffer_p,
        mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p),
        gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_recive_msg_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_recive_msg_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_recive_msg_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;

}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_recive_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_recive_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_free_recieved_msg_header();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_recive_msg_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_recive_msg_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_free_recieved_msg_header();
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_view_delivery_report
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_view_delivery_report(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 gui_buffer_p;   /* Buffer holding history data */
    S8 temp[14];
    U8 dttemp[40];
    MYTIME time1, time;
    FLOAT timezone;

#ifdef __MMI_UNIFIED_MESSAGE__
    U16 left_softkey_property = NULL;
    U16 left_softkey_icon_property = NULL;
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    timezone = mmi_dt_get_tz();

    EntryNewScreen(
        SCR_ID_JMMS_NEW_MMS,
        mmi_jmms_common_exit_property_screen,
        mmi_jmms_entry_view_delivery_report,
        NULL);
#ifdef __MMI_UNIFIED_MESSAGE__
    DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
#endif 
    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_NEW_MMS);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
        return;
    }

    /* STATUS */
    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_STATUS));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    switch (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->eDeliveryStatus)
    {
        case E_MSG_EXPIRED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_EXPIRED));
            break;
        case E_MSG_RETRIEVED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_RETRIEVED));
            break;
        case E_MSG_REJECTED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_REJECTED));
            break;
        case E_MSG_DEFERRED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_DEFFERED));
            break;
        case E_MSG_UNRECOGNIZED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_UNRECOGNISED));
            break;
        case E_MSG_INDETERMINATE:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_INDETERMINATE));
            break;
        case E_MSG_FORWARDED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_FORWARDED));
            break;
        case E_MSG_UNREACHABLE:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_DELIVERY_STATUS_UNREACHABLE));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;
    }

    /* TO */
    memset(temp, 0x00, 4);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_TO));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->pTo == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8 *) (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->pTo),
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* /message id */
    memset(temp, 0x00, 4);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MESSAGE_ID));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->pMessageID == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        S32 len = 0;
        S8 *msg_id = NULL;

        len = strlen((S8*) ((DELIVERY_REPORT*) g_jmms_context->delivery_p)->pMessageID);
        msg_id = (S8*) jdd_MemAlloc(sizeof(S8), len * ENCODING_LENGTH + ENCODING_LENGTH);
        if (msg_id == NULL)
        {
            return;
        }
        /* len=mmi_ucs2strlen((S8*)g_jmms_context->property_display_buffer_p); */
        mmi_asc_to_ucs2((PS8) (msg_id), (PS8) (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->pMessageID));
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) (msg_id));
        if (msg_id != NULL)
        {
            jdd_MemFree(msg_id);
            msg_id = NULL;
        }
    }

    /* /Date */
    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_dt_utc_sec_2_mytime((U32) (((DELIVERY_REPORT*) g_jmms_context->delivery_p)->uiDate), &time1, MMI_TRUE);
    mmi_dt_utc_to_rtc(timezone, time1, time);

    /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
    /* Date */
    memset(dttemp, 0x00, 40);
    date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* Time */
    memset(dttemp, 0x00, 40);
    time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);
    /* END of Changes - RAJ KUMAR GUPTA */
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id == SCR_ID_JMMS_INBOX_OPTIONS)
    {
        left_softkey_property = NULL;
        left_softkey_icon_property = NULL;
    }
    else
    {
        left_softkey_property = STR_GLOBAL_OPTIONS;
        left_softkey_icon_property = IMG_GLOBAL_OPTIONS;
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    ShowCategory78Screen(STR_ID_JMMS_DELIVERY_REPORT, GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
#ifdef __MMI_UNIFIED_MESSAGE__
                         left_softkey_property, left_softkey_icon_property,
#else 
                         NULL, NULL,
#endif 
                         STR_GLOBAL_BACK,
                         IMG_GLOBAL_BACK, NULL, (U8*) g_jmms_context->property_display_buffer_p,
                         mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p), gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_delivery_report_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_delivery_report_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id != SCR_ID_JMMS_INBOX_OPTIONS)
    {
        SetKeyHandler(mmi_jmms_pre_entry_inbox_options_scren, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetLeftSoftkeyFunction(mmi_jmms_pre_entry_inbox_options_scren, KEY_EVENT_UP);
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_delivery_report_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_delivery_report_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_delivery_report_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_delivery_report_header();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_delivery_report_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_delivery_report_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_delivery_report_header();
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_view_read_report
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_view_read_report(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PU8 gui_buffer_p;   /* Buffer holding history data */
    S8 temp[14];
    U8 dttemp[40];
    MYTIME time1, time;
    FLOAT timezone;

#ifdef __MMI_UNIFIED_MESSAGE__
    U16 left_softkey_property = NULL;
    U16 left_softkey_icon_property = NULL;
#endif /* __MMI_UNIFIED_MESSAGE__ */ 

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    timezone = mmi_dt_get_tz();

    EntryNewScreen(SCR_ID_JMMS_NEW_MMS, mmi_jmms_common_exit_property_screen, mmi_jmms_entry_view_read_report, NULL);
#ifdef __MMI_UNIFIED_MESSAGE__
    DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
#endif 
    gui_buffer_p = GetCurrGuiBuffer(SCR_ID_JMMS_NEW_MMS);

    g_jmms_context->property_display_buffer_p =
        (U8*) jdd_MemAlloc(
                sizeof(U8),
                (MAX_BUFFER_SIZE_FOR_PROPERTY + 1 + (MAX_NO_OF_ALLOWABLE_ADDRESSES * MAX_POSSIBLE_EMAIL_LENGHT_SENT)) * ENCODING_LENGTH);
    if (g_jmms_context->property_display_buffer_p == NULL)
    {
        DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
        DeleteScreenIfPresent(SCR_ID_JMMS_NEW_MMS);
        return;
    }

    /* STATUS */
    mmi_ucs2cpy((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_STATUS));
    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    switch (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->eReadStatus)
    {
        case E_STATUS_READ:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_READ_REPORT_READ));
            break;
        case E_STATUS_DELETED:
            mmi_ucs2cat(
                (S8*) g_jmms_context->property_display_buffer_p,
                (S8*) GetString(STR_ID_JMMS_READ_REPORT_DELETED));
            break;
        default:
            mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_UNKNOWN));
            break;

    }

    /* FROM */
    memset(temp, 0x00, 4);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_FROM));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pFrom == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8 *) (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pFrom),
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* TO */
    memset(temp, 0x00, 4);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_TO));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pTo == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {
        mmi_jmms_copy_email_number_or_name_of_number_from_phb_to_buffer(
            (S8*) g_jmms_context->property_display_buffer_p,
            (S8 *) (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pTo),
            MAX_POSSIBLE_NUMBER_LENGHT_SENT,
            MAX_POSSIBLE_EMAIL_LENGHT_SENT);
    }

    /* message id */
    memset(temp, 0x00, 4);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_MESSAGE_ID));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    if (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pMessageID == NULL)
    {
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
    }
    else
    {

        S32 len = 0;
        S8 *msg_id = NULL;

        len = strlen((S8*) ((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pMessageID);
        msg_id = (S8*) jdd_MemAlloc(sizeof(S8), len * ENCODING_LENGTH + ENCODING_LENGTH);
        if (msg_id == NULL)
        {
            return;
        }
        /* len=mmi_ucs2strlen((S8*)g_jmms_context->property_display_buffer_p); */
        mmi_asc_to_ucs2(
            (PS8) (msg_id),
            (PS8) (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->pMessageID));
        mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) (msg_id));
        if (msg_id != NULL)
        {
            jdd_MemFree(msg_id);
            msg_id = NULL;
        }
    }

    /* /Date */
    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) GetString(STR_ID_JMMS_DATE));

    memset(temp, 0x00, 14);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n----\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    mmi_dt_utc_sec_2_mytime(
        (U32) (((READ_REPORT_RESPONSE*) g_jmms_context->read_report_p)->uiReceivedTime),
        &time1,
        MMI_TRUE);
    mmi_dt_utc_to_rtc(timezone, time1, time);

    /* PMT RAJ KUMAR GUPTA on Sep 05, 2006 */
    /* Date */
    memset(dttemp, 0x00, 40);
    date_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);

    memset(temp, 0x00, 6);
    mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) temp);

    /* Time */
    memset(dttemp, 0x00, 40);
    time_string(&time, (UI_string_type) dttemp, DT_IDLE_SCREEN);
    mmi_ucs2cat((S8*) g_jmms_context->property_display_buffer_p, (S8*) dttemp);
    /* END of Changes - RAJ KUMAR GUPTA */
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id == SCR_ID_JMMS_INBOX_OPTIONS)
    {
        left_softkey_property = NULL;
        left_softkey_icon_property = NULL;
    }
    else
    {
        left_softkey_property = STR_GLOBAL_OPTIONS;
        left_softkey_icon_property = IMG_GLOBAL_OPTIONS;
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    ShowCategory78Screen(STR_ID_SETTINGS_READ_REPORT, GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
#ifdef __MMI_UNIFIED_MESSAGE__
                         left_softkey_property, left_softkey_icon_property,
#else 
                         NULL, NULL,
#endif 
                         STR_GLOBAL_BACK,
                         IMG_GLOBAL_BACK, NULL, (U8*) g_jmms_context->property_display_buffer_p,
                         mmi_ucs2strlen((S8*) g_jmms_context->property_display_buffer_p), gui_buffer_p);

    SetRightSoftkeyFunction(mm_jmms_back_from_read_report_properties, KEY_EVENT_UP);
    SetKeyHandler(mm_jmms_back_from_read_report_properties, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
#ifdef __MMI_UNIFIED_MESSAGE__
    if (g_jmms_context->last_scr_id != SCR_ID_JMMS_INBOX_OPTIONS)
    {
        SetKeyHandler(mmi_jmms_pre_entry_inbox_options_scren, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        SetLeftSoftkeyFunction(mmi_jmms_pre_entry_inbox_options_scren, KEY_EVENT_UP);
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    if (isInCall() == FALSE)
    {
        SetKeyHandler(mm_jmms_end_from_read_report_properties, KEY_END, KEY_EVENT_DOWN);
    }

    return;

}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_back_from_read_report_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_back_from_read_report_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_report_report_header();
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mm_jmms_end_from_read_report_properties
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mm_jmms_end_from_read_report_properties(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->last_scr_id = 0;
#endif 
    mmi_jmms_free_report_report_header();
    DisplayIdleScreen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_wap_not_ready
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_wap_not_ready(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_WAP_NOT_READY, mmi_jmms_exit_wap_not_ready, NULL, NULL);
    StartTimer(JMMS_WAP_NOT_READY_TIMER, 2000, mmi_jmms_wait_and_go_back);

    ShowCategory66Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        (U8*) GetString(STR_ID_JMMS_NOT_READY),
        IMG_ID_JMMS_PROGRESS,
        NULL);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_exit_wap_not_ready
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_exit_wap_not_ready(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_WAP_NOT_READY_TIMER);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_wait_and_go_back
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_wait_and_go_back(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_WAP_NOT_READY_TIMER);
    if (GetActiveScreenId() == SCR_ID_JMMS_WAP_NOT_READY)
    {
        GoBackHistory();
    }
    else
    {
        DeleteScreenIfPresent(SCR_ID_JMMS_WAP_NOT_READY);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_error_handler
 * DESCRIPTION
 *  
 * PARAMETERS
 *  error_code      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_error_handler(JC_RETCODE error_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "Enter Function mmi_jmms_error_handler");
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s%d", "error_code =", error_code);

#ifdef __MMI_UNIFIED_MESSAGE__
    g_jmms_context->edit_error_code = error_code;
#endif 
    switch (error_code)
    {
            /* Compose Module Related Errors */
        case JC_ERR_MSG_INVALID_HANDLE:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MESSAGE_HANDLE),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_INVALID_PAGE_INDEX:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_PAGE_INDEX),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;

        case JC_ERR_MSG_MORE_THAN_MAX_PAGE:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_TOO_MANY_SLIDES),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_INVALID_MEDIA_INDEX:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MEDIA_ID),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_MEDIA_RESTRICTED:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_RESTRICTED_MODE_MEDIA),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_MAX_REACHED:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_MAX_MSG_REACHED),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_UNSUPPORTED:
            DisplayPopup(
                (PU8) GetString(STR_GLOBAL_UNSUPPORTED_FORMAT),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_MMS_UNSUPPORTED_TYPE:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MEDIA_TYPE),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_INVALID_MEDIA_INFO:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MEDIA_INFO),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_MMS_CONTENT_RESTRICTED:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_MMS_ERR_RESTRICTED_CONTENT_CLASS),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;

            /* SMIL-VIEW Module Related Errors */
        case JC_ERR_MSG_PRESENTATION_NOT_SET:
        case JC_ERR_PRESENTATION_NOT_SET:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_PRESENTATION_NOT_SET),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_SMIL_REGION_NOT_SET:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_SMIL_REGION_NOT_SET),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_SMIL_INVALID_ROOTLAYOUT:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_SMIL_INVALID_ROOTLAYOUT),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_VIEW_INVALID_RENDERING_RECT:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_RENDERING_RECT),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_VIEW_CORRUPTED_CONTENT:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_CORRUPTED_CONTENT),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;

            /* JC_ERR_MMS_DECODING */
        case JC_ERR_MMS_DECODING:
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            break;

            /* Store Module Related Errors */
        case JC_ERR_STORE_INVALID_HANDLE:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_STORE_INVALID_HANDLE),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_STORE_INVALID_FOLDER_NAME:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_FOLDER_NAME),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_STORE_FOLDER_ALREADY_EXIST:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_FOLDER_ALREADY_EXIST),
                IMG_GLOBAL_WARNING,
                1,
                JMMS_POPUP_TIME,
                WARNING_TONE);
            break;
        case JC_ERR_STORE_ACTIVE_FOLDER_NOT_SET:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_ACTIVE_FOLDER_NOT_SET),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_STORE_FOLDER_NOT_FOUND:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_FOLDER_NOT_FOUND),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_STORE_INVALID_MSG_INDEX:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_MSG_INDEX),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_STORE_FILE_CORRUPTED:
        case JC_ERR_FILE_READ:
        case JC_ERR_NOT_SUPPORTED:
            DisplayPopup((PU8) GetString(STR_ID_JMMS_FILE_CORRUPTED), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            break;

        case JC_ERR_MEMORY_ALLOCATION:
            DisplayPopup((PU8) GetString(STR_ID_JMMS_OUT_OF_MEMORY), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            break;
        case JC_ERR_NULL_POINTER:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_INVALID_POINTER),
                IMG_GLOBAL_ERROR,
                1,
                JMMS_POPUP_TIME,
                ERROR_TONE);
            break;
        case JC_ERR_MSG_DRM_FORWARD_RESTRICTED:
            DisplayPopup(
                (PU8) GetString(STR_ID_JMMS_FORWARD_LOCK_DRM),
                IMG_GLOBAL_WARNING,
                1,
                JMMS_POPUP_TIME,
                WARNING_TONE);
            break;
        case JC_ERR_MMS_INVALID_CONTENT_TYPE:
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            break;
        default:
            DisplayPopup((PU8) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
            /* {
               U8 error_str[20];
               S8 temp[10] = {0, };
               
               memset(error_str, 0x00, 20);
               sprintf((S8*) temp, "%d", error_code);
               
               mmi_asc_to_ucs2((PS8) (error_str), (PS8) temp);
               
               DisplayPopup((PU8) (error_str), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, ERROR_TONE);
               
               break;
               } */

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_parse_continue_stop_timer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_parse_continue_stop_timer(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_ASYNC_PARSE_TIMER);
    g_jmms_context->async_parse_context.callback = NULL;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_parse_continue_start_timer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  h_msg           [IN]        
 *  err_cb          [IN]        
 *  abort_cb        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_parse_continue_start_timer(MSG_HANDLE h_msg, error_callback err_cb, abort_callback abort_cb)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->async_parse_context.is_re_entrant = 1;
    if (g_jmms_context->async_parse_context.callback != NULL && g_jmms_context->async_parse_context.callback != err_cb)
    {
        g_jmms_context->async_parse_context.callback = NULL;
        if (GetActiveScreenId() == SCR_ID_JMMS_PARSING_PROGRESS)
        {
            mmi_jmms_entry_parse_result_fail();
            DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_PROGRESS);
        }
        else if (GetActiveScreenId() == SCR_ID_JMMS_PARSING_SUCCESS_SCREEN)
        {
            mmi_jmms_entry_parse_result_fail();
            DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_SUCCESS_SCREEN);
        }
        else
        {
            DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_SUCCESS_SCREEN);
            DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_FAIL_SCREEN);
            DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_PROGRESS);
        }
        if (g_jmms_context->async_parse_context.abort_cb)
        {
            g_jmms_context->async_parse_context.abort_cb();
        }
    }
    g_jmms_context->async_parse_context.msg_handle = h_msg;
    g_jmms_context->async_parse_context.callback = err_cb;
    g_jmms_context->async_parse_context.abort_cb = abort_cb;
    StartTimer(JMMS_ASYNC_PARSE_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_parse_continue_callback);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_parse_call_error_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_parse_call_error_callback(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_parse_context.callback != NULL)
    {
        g_jmms_context->async_parse_context.is_re_entrant = 0;
        g_jmms_context->async_parse_context.callback(ret_code);
        if (!g_jmms_context->async_parse_context.is_re_entrant)
        {
            g_jmms_context->async_parse_context.callback = NULL;
        }
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_parse_continue_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_parse_continue_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_ASYNC_PARSE_TIMER);
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ret_code = mmi_jmms_jdi_msg_parse_continue(g_jmms_context->async_parse_context.msg_handle);
    if (ret_code == JC_ERR_MMS_PARSE_PENDING)
    {
        StartTimer(JMMS_ASYNC_PARSE_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_parse_continue_callback);
    }
    else
    {
        if (GetActiveScreenId() != SCR_ID_JMMS_PARSING_PROGRESS &&
            IsScreenPresent(SCR_ID_JMMS_PARSING_PROGRESS) == MMI_TRUE)
        {
            historyNode *saved_history;

            if (ret_code != JC_OK)
            {
                HistoryReplace(
                    SCR_ID_JMMS_PARSING_PROGRESS,
                    SCR_ID_JMMS_PARSING_FAIL_SCREEN,
                    mmi_jmms_entry_parse_result_fail);
                GetHistoryPointer(SCR_ID_JMMS_PARSING_FAIL_SCREEN, &saved_history);
                if (saved_history->isSmallScreen == 1)
                {
                    saved_history->isSmallScreen = 0;
                }
            }
            else
            {
                HistoryReplace(
                    SCR_ID_JMMS_PARSING_PROGRESS,
                    SCR_ID_JMMS_PARSING_SUCCESS_SCREEN,
                    mmi_jmms_entry_parse_result_pass);
                GetHistoryPointer(SCR_ID_JMMS_PARSING_SUCCESS_SCREEN, &saved_history);
                if (saved_history->isSmallScreen == 1)
                {
                    saved_history->isSmallScreen = 0;
                }

            }
            return;
        }

        mmi_jmms_parse_call_error_callback(ret_code);

    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_parse_result_fail
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_parse_result_fail(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_PARSING_FAIL_SCREEN, NULL, mmi_jmms_entry_parse_result_fail, NULL);

    ShowCategory2Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        STR_ID_MMS_PARSING_FAIL,
        NULL);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

    mmi_jmms_parse_call_error_callback(JC_ERR_GENERAL_FAILURE);

    DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_FAIL_SCREEN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_parse_result_pass
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_parse_result_pass(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->msg_handle == NULL)
    {
        mmi_jmms_entry_parse_result_fail();
        return;
    }

    EntryNewScreen(SCR_ID_JMMS_PARSING_SUCCESS_SCREEN, NULL, mmi_jmms_entry_parse_result_pass, NULL);

    ShowCategory2Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        0,
        0,
        STR_ID_MMS_PARSING_SUCCESS,
        NULL);

    SetLeftSoftkeyFunction(mmi_jmms_entry_parse_result_pass_lsk, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_entry_parse_result_pass_lsk
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_entry_parse_result_pass_lsk(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_parse_context.callback != NULL)
    {
        ClearExitHandler(); /* No avoid saving of the Error in parsing screen in history */
        mmi_jmms_parse_call_error_callback(JC_OK);
        DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_SUCCESS_SCREEN);
    }
    else
    {
        GoBackHistory();
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_send_continue_start_timer
 * DESCRIPTION
 *  this function is used to start the MMS encapsulation
 * PARAMETERS
 *  h_msg       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_send_continue_start_timer(MSG_HANDLE h_msg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->async_send_context.msg_handle = h_msg;
    StartTimer(JMMS_ASYNC_SEND_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_send_continue_callback);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_send_continue_callback
 * DESCRIPTION
 *  This callback is used to continue the MMS encapsulation.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_send_continue_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_ASYNC_SEND_TIMER);
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ret_code = mmi_jmms_jdi_msg_encapsulate_continue(g_jmms_context->async_send_context.msg_handle);
    if (ret_code == JC_ERR_MMS_ENCODE_PENDING)
    {
        StartTimer(JMMS_ASYNC_SEND_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_send_continue_callback);
    }
    else
    {
        mmi_jmms_decrement_send_callback_node(ret_code);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_clean_send_callback_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_clean_send_callback_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *next_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_send_context.callback_list != NULL)
    {
        while (g_jmms_context->async_send_context.callback_list->next_p != NULL)
        {
            next_head_p = g_jmms_context->async_send_context.callback_list->next_p;
            jdd_MemFree(g_jmms_context->async_send_context.callback_list);
            g_jmms_context->async_send_context.callback_list = next_head_p;
        }
        jdd_MemFree(g_jmms_context->async_send_context.callback_list);
        g_jmms_context->async_send_context.callback_list = NULL;

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_add_send_callback_node
 * DESCRIPTION
 *  
 * PARAMETERS
 *  new_err_cb      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_add_send_callback_node(error_callback new_err_cb)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *new_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    new_head_p = (mmi_jmms_async_callback_list_struct*) jdd_MemAlloc(sizeof(mmi_jmms_async_callback_list_struct), 1);

    new_head_p->err_cb = new_err_cb;
    if (g_jmms_context->async_send_context.callback_list != NULL)
    {
        new_head_p->next_p = g_jmms_context->async_send_context.callback_list;
    }
    else
    {
        new_head_p->next_p = NULL;
    }

    g_jmms_context->async_send_context.callback_list = new_head_p;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_decrement_send_callback_node
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_decrement_send_callback_node(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *old_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_send_context.callback_list != NULL)
    {
        old_head_p = g_jmms_context->async_send_context.callback_list;
        if (old_head_p->next_p != NULL)
        {
            g_jmms_context->async_send_context.callback_list = old_head_p->next_p;
        }
        else
        {
            g_jmms_context->async_send_context.callback_list = NULL;
        }

        old_head_p->err_cb(ret_code);
        if (old_head_p != NULL)
        {
            jdd_MemFree(old_head_p);
        }

    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_save_continue_start_timer
 * DESCRIPTION
 *  
 * PARAMETERS
 *  h_msg       [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_save_continue_start_timer(MSG_HANDLE h_msg)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->async_save_context.msg_handle = h_msg;
    StartTimer(JMMS_ASYNC_SAVE_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_save_continue_callback);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_save_continue_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_save_continue_callback(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    StopTimer(JMMS_ASYNC_SAVE_TIMER);
    jdd_MemSetActiveModuleID(E_TASK_MMS_UI);
    ret_code = mmi_jmms_jdi_msg_encapsulate_continue(g_jmms_context->async_save_context.msg_handle);
    if (ret_code == JC_ERR_MMS_ENCODE_PENDING)
    {
        StartTimer(JMMS_ASYNC_SAVE_TIMER, JMMS_ASYNC_EVENT_TIME, mmi_jmms_save_continue_callback);
    }
    else
    {
        mmi_jmms_decrement_save_callback_node(ret_code);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_clean_save_callback_list
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_clean_save_callback_list(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *next_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_save_context.callback_list != NULL)
    {
        while (g_jmms_context->async_save_context.callback_list->next_p != NULL)
        {
            next_head_p = g_jmms_context->async_save_context.callback_list->next_p;
            jdd_MemFree(g_jmms_context->async_save_context.callback_list);
            g_jmms_context->async_save_context.callback_list = next_head_p;
        }
        jdd_MemFree(g_jmms_context->async_save_context.callback_list);
        g_jmms_context->async_save_context.callback_list = NULL;

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_add_save_callback_node
 * DESCRIPTION
 *  
 * PARAMETERS
 *  new_err_cb      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_add_save_callback_node(error_callback new_err_cb)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *new_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    new_head_p = (mmi_jmms_async_callback_list_struct*) jdd_MemAlloc(sizeof(mmi_jmms_async_callback_list_struct), 1);

    new_head_p->err_cb = new_err_cb;
    if (g_jmms_context->async_save_context.callback_list != NULL)
    {
        new_head_p->next_p = g_jmms_context->async_save_context.callback_list;
    }
    else
    {
        new_head_p->next_p = NULL;
    }

    g_jmms_context->async_save_context.callback_list = new_head_p;

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_decrement_save_callback_node
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code        [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_decrement_save_callback_node(JC_RETCODE ret_code)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mmi_jmms_async_callback_list_struct *old_head_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_jmms_context->async_save_context.callback_list != NULL)
    {
        old_head_p = g_jmms_context->async_save_context.callback_list;
        if (old_head_p->next_p != NULL)
        {
            g_jmms_context->async_save_context.callback_list = old_head_p->next_p;
        }
        else
        {
            g_jmms_context->async_save_context.callback_list = NULL;
        }

        old_head_p->err_cb(ret_code);
        if (old_head_p != NULL)
        {
            jdd_MemFree(old_head_p);
        }

    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_is_message_to_fwd
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  
 *****************************************************************************/
MMI_BOOL mmi_jmms_is_message_to_fwd(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return g_jmms_context->message_to_fw;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_set_fw_flag_of_message
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_set_fw_flag_of_message(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->message_to_fw = MMI_TRUE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_reset_fw_flag_of_message
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_reset_fw_flag_of_message(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_jmms_context->message_to_fw = MMI_FALSE;
}

 /* __USB_IN_NORMAL_MODE__ */ /* #ifdef __USB_IN_NORMAL_MODE__ */

#ifdef META_HANDLING_SUPPORT


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_get_meta_info
 * DESCRIPTION
 *  
 * PARAMETERS
 *  jmms_context_p      [IN]
 * RETURNS
 *  JC_RETCODE
 *****************************************************************************/
JC_RETCODE mmi_jmms_get_meta_info(mmi_jmms_context_struct *jmms_context_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    JC_RETCODE ret_code = JC_OK;
    S16 *meta_name = NULL;
    U8 *Temp = NULL;
    S8 temp1[40] = {0};
    S8 temp[14];
    META_INFO *meta_info = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_get_meta_info(jmms_context_p->msg_handle, &meta_info);
    if (ret_code != JC_OK)
    {
        goto ERROR_HANDLER;
    }
    if (meta_info != NULL)
    {
        memset(temp, 0x00, 14);
        mmi_asc_to_ucs2((PS8) temp, (PS8) "\n\n");
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) temp);

        memset(temp1, 0x00, 40);
        mmi_ucs2cpy((PS8) temp1, (S8*) GetString(STR_ID_JMMS_META_PRESENTATION_INFO));
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) temp1);

        memset(temp1, 0x00, 40);
        mmi_asc_to_ucs2((PS8) temp1, (PS8) "\n----");
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) temp1);
    }
    while (meta_info != NULL)
    {
        memset(temp, 0x00, 14);
        mmi_asc_to_ucs2((PS8) temp, (PS8) "\n");
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) temp);

        if (NULL != meta_info->name_value)
        {
            meta_name = (S16*) jdi_UtilsTcsDup(meta_info->name_value);
            if (meta_name == NULL)
            {
                ret_code = JC_ERR_MEMORY_ALLOCATION;
                goto ERROR_HANDLER;
            }
        }
        else
        {
            meta_info = meta_info->pNext;
            continue;
        }
        Temp = (U8*) meta_name;
        if (jc_islower(*Temp) && (U8) * (Temp + 1) == '\0')
        {
            *meta_name = (U8) jc_toupper(*meta_name);
        }
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) meta_name);
        memset(temp, 0x00, 14);
        mmi_asc_to_ucs2((PS8) temp, (PS8) ": ");
        mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) temp);

        if (mmi_ucs2strlen((S8*) meta_info->content_value))
        {
            mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) meta_info->content_value);
        }
        else
        {
            mmi_ucs2cat((S8*) jmms_context_p->property_display_buffer_p, (S8*) GetString(STR_GLOBAL_EMPTY_LIST));
        }
        if (meta_name)
        {
            jdd_MemFree(meta_name);
            meta_name = NULL;
        }
        meta_info = meta_info->pNext;
    }
  ERROR_HANDLER:
    return ret_code;
}
#endif /* META_HANDLING_SUPPORT */ 

#if !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT)


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_show_mms_properties_asyn_callback
 * DESCRIPTION
 *  
 * PARAMETERS
 *  ret_code                [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_show_mms_properties_asyn_callback(JC_RETCODE ret_code)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (JC_OK != ret_code)
    {
        if (GetActiveScreenId() == SCR_ID_JMMS_PARSING_PROGRESS)
        {
            mmi_jmms_error_handler(ret_code);
        }
        goto END;
    }
    else
    {
        mmi_jmms_pre_entry_properties_screen();
    }
  END:
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            g_jmms_context->parse_content_p->pFileName = NULL;
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }
    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }
    }

    DeleteScreenIfPresent(SCR_ID_JMMS_PARSING_PROGRESS);
    return;
}
#endif /* !defined(__MMI_UNIFIED_MESSAGE__) && defined(META_HANDLING_SUPPORT) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_pre_entry_properties_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_pre_entry_properties_screen(void)
{

    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    RETRIEVE_FILTERS store_ret_filter = {0, };
    MESSAGE_LIST *message_list_p = NULL;
    U32 extra_byte_1 = 0;
    JC_RETCODE ret_code = JC_OK;
    JC_CHAR *tmp_folder_name_p = NULL;
    U8 number = 0;
    S8 *folder_name = NULL;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_get_active_folder(g_jmms_context->store_handle, &(tmp_folder_name_p), NULL);

    if (ret_code != JC_OK)
    {
        mmi_jmms_error_handler(ret_code);
        return;
    }
    folder_name = jdd_MemAlloc((mmi_ucs2strlen((S8*) tmp_folder_name_p) + 1), 1);
    if (folder_name == NULL)
    {
        ret_code = JC_ERR_MEMORY_ALLOCATION;
        goto END;
    }

    mmi_ucs2_to_asc(folder_name, (S8*) tmp_folder_name_p);

    number = g_jmms_context->store_context->num_msg_in_curr_folder;
    if (strcmp((S8*) folder_name, (S8*) MMI_JMMS_TEMPLATES) == 0)
    {
        store_ret_filter.uiStartIndex = g_jmms_context->curr_scr_hilited_index + 1;
    }
    else
    {
        store_ret_filter.uiStartIndex = number - g_jmms_context->curr_scr_hilited_index;
    }
    store_ret_filter.eRetrieve = E_RETRIEVE_BY_INDEX;
    store_ret_filter.uiNumMessage = 1;

    ret_code = mmi_jmms_get_messages_list(folder_name, &message_list_p, &store_ret_filter);

    switch (message_list_p->pMessageHeaders->eMsgType)
    {
        case E_MSG_TYPE_NOTIFICATION:
            ret_code = mmi_jmms_create_notification_header(message_list_p->pMessageHeaders->pHeaders);
            if (ret_code != JC_OK)
            {
                mmi_jmms_error_handler(ret_code);
                return;
            }
            mmi_jmms_show_notification_properties();
            break;

        case E_MSG_TYPE_RECEIVE:
            ret_code = mmi_jmms_create_recieved_msg_header(message_list_p->pMessageHeaders->pHeaders);
            if (ret_code != JC_OK)
            {
                mmi_jmms_error_handler(ret_code);
                return;
            }
            mmi_jmms_show_retrieved_mms_properties();
            break;

        case E_MSG_JAVA_MESSAGE:
        {
            JC_RETCODE ret_code = JC_OK;
            CONTENT_DATA Content = {0, };

            if (message_list_p->pMessageHeaders->eMsgType != E_MSG_TYPE_RECEIVE)
            {
                DisplayPopup((U8*) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, (U8) ERROR_TONE);
                return;
            }
            Content.bIsStream = E_TRUE;
            ret_code = mmi_jmms_get_message(MMI_JMMS_INBOX, &Content, store_ret_filter.uiStartIndex);
            if (ret_code != JC_OK)
            {
                goto CaseEnd;
            }

        #ifdef __MMI_UNIFIED_MESSAGE__
            if (g_jmms_context->msg_handle)
            {
                ret_code = mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
                g_jmms_context->msg_handle = NULL;
            }
        #else /* __MMI_UNIFIED_MESSAGE__ */ 
            mmi_jmms_deinit_mms_context(g_jmms_context);
        #endif /* __MMI_UNIFIED_MESSAGE__ */ 

            ret_code = mmi_jmms_jdi_parse_msg_buffer(&g_jmms_context->msg_handle, &Content, E_TYPE_MMS, E_FALSE);
            /* Async changes begin */
            while (ret_code == JC_ERR_MMS_PARSE_PENDING)
            {
                ret_code = mmi_jmms_jdi_msg_parse_continue(g_jmms_context->msg_handle);
            };
            /* Async changes end */

            if (ret_code != JC_OK)
            {
                goto CaseEnd;
            }
            ret_code = mmi_jmms_jdi_get_msg_headers(
                        g_jmms_context->msg_handle,
                        (MESSAGE_HEADERS **) (&(g_jmms_context->msg_headers_p)));
            if (JC_OK != ret_code)
            {
                goto CaseEnd;
            }
            g_jmms_context->msg_header_type_p =
                (MESSAGE_RETRIEVAL*) ((MESSAGE_HEADERS*) g_jmms_context->msg_headers_p)->pHeaders;
            /* umesh end */
            mmi_jmms_entry_java_mms_properties();

          CaseEnd:
            if (Content.pFileName != NULL)
            {
                jdd_MemFree(Content.pFileName);
                Content.pFileName = NULL;
            }

            if (ret_code != JC_OK)
            {
                DisplayPopup((U8*) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, (U8) ERROR_TONE);
                mmi_jmms_deinit_mms_context(g_jmms_context);
            }

            break;
        }
        case E_MSG_TYPE_DELIVERY_REPORT:
            mmi_jmms_update_status_icon_indicator();
            ret_code = mmi_jmms_create_delivery_report_header(message_list_p->pMessageHeaders->pHeaders);
            if (ret_code != JC_OK)
            {
                mmi_jmms_error_handler(ret_code);
                return;
            }
            mmi_jmms_entry_view_delivery_report();
            break;

        case E_MSG_TYPE_READ_REPORT_RESPONSE:
            mmi_jmms_update_status_icon_indicator();
            ret_code = mmi_jmms_create_read_report_header(message_list_p->pMessageHeaders->pHeaders);
            if (ret_code != JC_OK)
            {
                mmi_jmms_error_handler(ret_code);
                return;
            }
            mmi_jmms_entry_view_read_report();
            break;

        case E_MSG_TYPE_SEND:
        {
            ret_code = mmi_jmms_create_new_mms_sent_header(message_list_p->pMessageHeaders->pHeaders);
            if (ret_code != JC_OK)
            {
                mmi_jmms_error_handler(ret_code);
                return;
            }
            if (g_jmms_context->msg_handle && ((MESSAGING_HANDLER*) g_jmms_context->msg_handle)->mms_file_handle)
            {
                mmi_jmms_jdi_store_get_extra_byte_open_mms(
                    g_jmms_context->store_handle,
                    ((MESSAGING_HANDLER*) g_jmms_context->msg_handle)->mms_file_handle,
                    &extra_byte_1);
            }
            else
            {
                mmi_jmms_jdi_store_get_extra_byte_1(
                    g_jmms_context->store_handle,
                    store_ret_filter.uiStartIndex,
                    &extra_byte_1);
            }
            if (((MESSAGE_SEND*) (g_jmms_context->send_msg_p))->uiDate == 0)
            {
                ((MESSAGE_SEND*) (g_jmms_context->send_msg_p))->uiDate = extra_byte_1;
            }
            mmi_jmms_entry_new_mms_sent_properties();
            break;
        }
        default:
            DisplayPopup((U8*) GetString(STR_GLOBAL_ERROR), IMG_GLOBAL_ERROR, 1, JMMS_POPUP_TIME, (U8) ERROR_TONE);
            return;
    }
  END:
    if (folder_name)
    {
        jdd_MemFree(folder_name);
    }
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }
    if (ret_code != JC_OK)
    {
        if (g_jmms_context->msg_handle != NULL)
        {
            mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
            g_jmms_context->msg_handle = NULL;
        }

    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_deinit_mms_context
 * DESCRIPTION
 *  Used to deinit MMS context
 * PARAMETERS
 *  jmms_context_p      [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_deinit_mms_context(mmi_jmms_context_struct *jmms_context_p)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    JC_RETCODE ret_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_deinit_mms_context START");

    if (jmms_context_p != NULL)
    {
        mmi_jmms_free_addresses_list();

        if (jmms_context_p->msg_handle)
        {
            ret_code = mmi_jmms_jdi_msg_deinit(jmms_context_p->msg_handle);
            jmms_context_p->msg_handle = NULL;
        }
        jmms_context_p->to_p = NULL;
        jmms_context_p->cc_p = NULL;
        jmms_context_p->bcc_p = NULL;
        jmms_context_p->from_p = NULL;
        jmms_context_p->msg_header_type_p = NULL;
        jmms_context_p->msg_headers_p = NULL;
        g_jmms_context->subject_p = NULL;
        jmms_context_p->version = NULL;

        jmms_context_p->sent_retry_counter = 0;

        jmms_context_p->msg_handle = NULL;

        jmms_context_p->curr_focused_media_type = 0;
        jmms_context_p->num_attachments = 0;

        jmms_context_p->sent_retry_counter = 0;

        jmms_context_p->is_unread_msg_deleted = 0;

        memset(jmms_context_p->subject_input_buffer, 0x00, (MAX_SUBJECT_LENGTH + 1) * ENCODING_LENGTH);

        if (g_jmms_context->rc_info != NULL)
        {
            if (g_jmms_context->rc_info->pReplyMsgID != NULL)
            {
                jdd_MemFree(g_jmms_context->rc_info->pReplyMsgID);
            }
            jdd_MemFree(g_jmms_context->rc_info);
            g_jmms_context->rc_info = NULL;
        }

        if (g_jmms_context->send_content_p != NULL)
        {
            if (g_jmms_context->send_content_p->bIsStream == E_FALSE)
            {
                jdd_MemFree(g_jmms_context->send_content_p->pBuffer);
                g_jmms_context->send_content_p->pBuffer = NULL;
            }
            if (g_jmms_context->send_content_p->pStream != NULL)
            {
                if (g_jmms_context->jmms_fs_handle == NULL)
                {
                    jdd_FSInitialize(&g_jmms_context->jmms_fs_handle);
                }

                jdd_FSDelete(g_jmms_context->jmms_fs_handle, g_jmms_context->send_content_p->pStream);

                jdd_MemFree(g_jmms_context->send_content_p->pStream);
            }
            jdd_MemFree(g_jmms_context->send_content_p);
            g_jmms_context->send_content_p = NULL;
        }

        if (g_jmms_context->save_content_p != NULL)
        {
            if (g_jmms_context->save_content_p->bIsStream == E_FALSE)
            {
                jdd_MemFree(g_jmms_context->save_content_p->pBuffer);
                g_jmms_context->save_content_p->pBuffer = NULL;
            }
            if (g_jmms_context->save_content_p->pStream != NULL)
            {
                if (g_jmms_context->jmms_fs_handle == NULL)
                {
                    jdd_FSInitialize(&g_jmms_context->jmms_fs_handle);
                }

                jdd_FSDelete(g_jmms_context->jmms_fs_handle, g_jmms_context->save_content_p->pStream);

                jdd_MemFree(g_jmms_context->save_content_p->pStream);
            }
            jdd_MemFree(g_jmms_context->save_content_p);
            g_jmms_context->save_content_p = NULL;
        }

        if (g_jmms_context->parse_content_p != NULL)
        {
            if (g_jmms_context->parse_content_p->pFileName != NULL)
            {
                jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            }
            jdd_MemFree(g_jmms_context->parse_content_p);
            g_jmms_context->parse_content_p = NULL;
        }

        mmi_jmms_deinit_view();

        // #ifdef __MMI_MMS_SIGNATURE__
        mmi_jmms_reset_fw_flag_of_inbox();
        g_jmms_context->auto_signature_added = MMI_FALSE;
        // #endif /* __MMI_MMS_SIGNATURE__ */
    #ifdef __MMI_UNIFIED_MESSAGE__
        mmi_jmms_reset_fw_flag_of_message();
    #endif 
        if (g_jmms_context->async_send_context.params != NULL)
        {
            jdd_MemFree(g_jmms_context->async_send_context.params);
            g_jmms_context->async_send_context.params = NULL;
        }

        if (g_jmms_context->async_save_context.params != NULL)
        {
            jdd_MemFree(g_jmms_context->async_save_context.params);
            g_jmms_context->async_save_context.params = NULL;
        }

        mmi_jmms_delete_compose_temp_files();

        if (g_jmms_context->compose_context != NULL)
        {
            if (g_jmms_context->compose_context->media_path_p != NULL)
            {
                jdd_MemFree(g_jmms_context->compose_context->media_path_p);
                g_jmms_context->compose_context->media_path_p = NULL;
            }
            jdd_MemFree(g_jmms_context->compose_context);
            g_jmms_context->compose_context = NULL;

        }
        if (g_jmms_context->jmms_fs_handle != NULL)
        {
            jdd_FSDeinitialize(g_jmms_context->jmms_fs_handle);
            g_jmms_context->jmms_fs_handle = NULL;
        }
        /* MAUI_00421253 START */
        if (g_jmms_context->content_fwd_callback)
        {
            g_jmms_context->content_fwd_callback(g_jmms_context->content_fwd_callback_param);
            g_jmms_context->content_fwd_callback = NULL;
            g_jmms_context->content_fwd_callback_param = NULL;
        }
        /* MAUI_00421253 END */

    }
    /* Himanshu 21/11/2006 Free the media buffer used in Compose Screen */
    if (g_jmms_context->g_media_buffer_p != NULL)
    {
        jdd_MemFree(g_jmms_context->g_media_buffer_p);
        g_jmms_context->g_media_buffer_p = NULL;
    }

    PRINT_INFORMATION_2(MMI_TRACE_INFO, "%s", "mmi_jmms_deinit_mms_context END");
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_parsing_progressing_screen
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_parsing_progressing_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_JMMS_PARSING_PROGRESS, NULL, mmi_jmms_parsing_progressing_screen, NULL);

    ShowCategory154Screen(
        STR_MMS_MENUENTRY,
        GetRootTitleIcon(MAIN_MENU_MESSAGES_MENUID),
        0,
        0,
        STR_GLOBAL_CANCEL,
        0,
        (PU8) GetString(STR_ID_JMMS_PARSING_MMS),
        NULL,
        IMG_ID_JMMS_PROGRESS_FULL,
        NULL);

    SetRightSoftkeyFunction(mmi_jmms_abort_parsing_progress, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_only_abort_parsing_progress
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_only_abort_parsing_progress(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_parse_continue_stop_timer();
    if (g_jmms_context->parse_content_p != NULL)
    {
        if (g_jmms_context->parse_content_p->pFileName != NULL)
        {
            jdd_MemFree(g_jmms_context->parse_content_p->pFileName);
            g_jmms_context->parse_content_p->pFileName = NULL;
        }
        jdd_MemFree(g_jmms_context->parse_content_p);
        g_jmms_context->parse_content_p = NULL;
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_abort_parsing_progress
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_abort_parsing_progress(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_jmms_only_abort_parsing_progress();
    if (g_jmms_context->msg_handle != NULL)
    {
        mmi_jmms_jdi_msg_deinit(g_jmms_context->msg_handle);
        g_jmms_context->msg_handle = NULL;
    }

    g_jmms_context->is_add_media_warning = 0;

    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_delete_mms_screens
 * DESCRIPTION
 *  Used to delete MMS screens
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_jmms_delete_mms_screens(void)
{
#ifndef __MMI_UNIFIED_COMPOSER__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 screen_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    screen_id = GetActiveScreenId();
#ifdef __MMI_UNIFIED_MESSAGE__
    if (IsScreenPresent(SCR_ID_UM_INBOX))
    {
        DeleteUptoScrID(SCR_ID_UM_INBOX);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_UM_DRAFT))
    {
        DeleteUptoScrID(SCR_ID_UM_DRAFT);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_UM_UNSENT))
    {
        DeleteUptoScrID(SCR_ID_UM_UNSENT);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_UM_SENT))
    {
        DeleteUptoScrID(SCR_ID_UM_SENT);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_JMMS_TEMPLATES))
    {
        DeleteUptoScrID(SCR_ID_JMMS_TEMPLATES);
        GoBackHistory();
    }
#else /* __MMI_UNIFIED_MESSAGE__ */ 
    if (IsScreenPresent(SCR_ID_JMMS_INBOX))
    {
        DeleteUptoScrID(SCR_ID_JMMS_INBOX);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_JMMS_DRAFTS))
    {
        DeleteUptoScrID(SCR_ID_JMMS_DRAFTS);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_JMMS_OUTBOX))
    {
        DeleteUptoScrID(SCR_ID_JMMS_OUTBOX);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_JMMS_SENT))
    {
        DeleteUptoScrID(SCR_ID_JMMS_SENT);
        GoBackHistory();
    }
    else if (IsScreenPresent(SCR_ID_JMMS_TEMPLATES))
    {
        DeleteUptoScrID(SCR_ID_JMMS_TEMPLATES);
        GoBackHistory();
    }
#endif /* __MMI_UNIFIED_MESSAGE__ */ 
    /* this condition is same for UM/NON-UM */
    else if (IsScreenPresent(SCR_ID_JMMS_WRITE_MMS) || screen_id == SCR_ID_JMMS_WRITE_MMS)
    {
        DeleteUptoScrID(SCR_ID_JMMS_WRITE_MMS);
        /* we have to delete this screen also if
           user goes through file manager etc. */
        DeleteScreenIfPresent(SCR_ID_JMMS_WRITE_MMS);
        /* this is to remove current screen */
        GoBackHistory();
    }

    /* This is done to stop all the processes like in the 
       background sending, saving etc and stop all timers */
    mmi_jmms_init_msg_context_struct();
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
}


/*****************************************************************************
 * FUNCTION
 *  mms_is_re_entrant
 * DESCRIPTION
 *  Tells whether MMS is re entring
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
U16 mms_is_re_entrant(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 i, total_screens;
    S32 check_screens[] = 
    {
        SCR_ID_JMMS_WRITE_MMS,
        SCR_ID_JMMS_PREVIEW,
        SCR_ID_JMMS_PROGRESS,
        SCR_ID_JMMS_INBOX_OPTIONS,
        SCR_ID_JMMS_OUTBOX_OPTIONS,
        SCR_ID_JMMS_DRAFTS_OPTIONS,
        SCR_ID_JMMS_SENT_OPTIONS,
        SCR_ID_JMMS_MESSAGE_SETTINGS,
        SCR_ID_JMMS_TEMPLATES
    };

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    total_screens = sizeof(check_screens) / sizeof(S32);
    for (i = 0; i < total_screens; i++)
    {
        if (IsScreenPresent((U16) check_screens[i]))
        {
            return check_screens[i];
        }
    }
#ifdef __MMI_UNIFIED_COMPOSER__
    if (g_jmms_context->uc_creation_req == JMMS_UC_BACKGROUND_SAVING)
    {
        return IDLE_SCREEN_ID;
    }
#endif /* __MMI_UNIFIED_COMPOSER__ */ 
    return FALSE;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_jdi_msg_deinit
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_handle      [IN]        
 * RETURNS
 *  JC_RETCODE
 *****************************************************************************/
JC_RETCODE mmi_jmms_jdi_msg_deinit(MSG_HANDLE msg_handle)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    JC_RETCODE ret_code;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ret_code = mmi_jmms_jdi_message_deinit(msg_handle);
    g_jmms_context->msg_header_type_p = NULL;
    g_jmms_context->msg_headers_p = NULL;
    return ret_code;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_jmms_jdi_msg_deinit_without_header
 * DESCRIPTION
 *  
 * PARAMETERS
 *  msg_handle      [IN]        
 * RETURNS
 *  JC_RETCODE
 *****************************************************************************/
JC_RETCODE mmi_jmms_jdi_msg_deinit_without_header(MSG_HANDLE msg_handle)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    return mmi_jmms_jdi_message_deinit(msg_handle);
}

#endif /* (defined (JATAAYU_SUPPORT) && defined(MMS_SUPPORT)) */ 

#endif /* _MMI_JMMSSECONDARYMMI_C */ 

