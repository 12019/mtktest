/*****************************************************************************
*  Copyright Statement:
*  --------------------
*  This software is protected by Copyright and the information contained
*  herein is confidential. The software may not be copied and the information
*  contained herein may not be used or disclosed except with the written
*  permission of MediaTek Inc. (C) 2005
*
*  BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES
*  THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")
*  RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON
*  AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,
*  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF
*  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.
*  NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE
*  SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR
*  SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH
*  THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO
*  NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S
*  SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.
*
*  BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE
*  LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,
*  AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,
*  OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO
*  MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE. 
*
*  THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE
*  WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF
*  LAWS PRINCIPLES.  ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND
*  RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER
*  THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).
*
*****************************************************************************/
/*****************************************************************************
 *
 * Filename:
 * ---------
 *  CameraMenu.c
 *
 * Project:
 * --------
 *  MAUI
 *
 * Description:
 * ------------
 *  Header of Camera Menus
 *
 * Author:
 * -------
 * -------
 *                      
 *============================================================================
 *             HISTORY
 * Below this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *------------------------------------------------------------------------------
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 * removed!
 * removed!
 * removed!
 *
 *------------------------------------------------------------------------------
 * Upper this line, this part is controlled by PVCS VM. DO NOT MODIFY!!
 *============================================================================
 ****************************************************************************/
#include "MMI_include.h"
#ifdef __MMI_CAMERA__



#include "nvram_data_items.h"   /* ID to store file path */

#include "lcd_if.h"     /* LCD layer enable flag */
#include "lcd_sw_rnd.h" /* for LCD size */
#include "MMI_features_camera.h"        /* camera features */

#include "gui_setting.h"
#include "gui.h"        /* Gui functions */
#include "SettingDefs.h"        /* ST_NOTIFYDURATION define */
#include "SettingProfile.h"     /* SUCCESS_TONE define */
#include "gui_scrollbars.h"
#include "wgui.h"       /* for GetDateTime() */
#include "gpioInc.h"    /* LED */
#include "SettingProfile.h"
#include "CommonScreens.h"      /* DisplayPopup() */
#include "MainMenuDef.h"        /* Multi-media icon */

#include "gui.h"        /* Gui functions */
#include "SettingDefs.h"        /* ST_NOTIFYDURATION define */
#include "SettingProfile.h"     /* SUCCESS_TONE define */
#include "wgui.h"       /* for GetDateTime() */
#include "gpioInc.h"    /* LED */
#include "SettingProfile.h"
#include "SubLCDHistoryGprot.h "

#include "wgui_status_icons.h"

#include "mdi_datatype.h"
#include "med_api.h"    /* media task */
#include "mdi_camera.h" /* camera module */

#ifdef __MMI_TVOUT__
#include "mdi_tv.h"
#endif 

#include "FileManagerGProt.h"   /* file path / file error */
#include "FileManagerDef.h"     /* for ImageViewer's Screen ID - SCR_FMGR_EXPLORER */
#include "FileMgr.h"    /* get user define file path */
#include "ImageViewer.h"        /* ImageViewer */
#include "nvram_data_items.h"   /* ID to store file path */
#include "ImageViewerResDef.h"

#include "resource_camera_skins.h"      /* UI custom config */
#include "CameraApp.h"  /* camera app data */
#include "CameraMenu.h" /* function declare */
#include "CameraResDef.h"      /* resource ID def */

#if defined(__CAMERA_OSD_HORIZONTAL__)
#include "ScreenRotationGprot.h"
#endif 

#ifdef __MMI_AUDIO_REVERB_EFFECT__
#include "SoundEffect.h"
#endif
#include "ae_awb.h"

/***************************************************************************** 
* Define
*****************************************************************************/
#if !defined(ISP_SUPPORT)
#define TV_NO 1
#define AV_NO 1
#endif /* ISP_SUPPORT */ 

/****************************************************************************
* Enum                                                                 
*****************************************************************************/
typedef enum
{
    CUSTOM_FX_BRIGHTNESS,
    CUSTOM_FX_SATURATION,
    CUSTOM_FX_CONTRAST,
    CUSTOM_FX_HUE
} custom_fx_edit_enum;

/****************************************************************************
* Struct                                                                 
*****************************************************************************/
typedef struct
{
    /* strings for inline selection display */
    /* +1 avoid this feature's item is zero */
    UI_string_type flash_str[CAMERA_FLASH_ITEM_COUNT + 1];
    UI_string_type led_highlight_str[CAMERA_LCD_HIGHLIGHT_ITEM_COUNT + 1];
    UI_string_type shutter_sound_str[CAMERA_SHUTTER_SOUND_ITEM_COUNT + 1];
    UI_string_type ev_str[CAMERA_EV_ITEM_COUNT + 1];
    UI_string_type night_str[CAMERA_NIGHT_ITEM_COUNT + 1];
    UI_string_type ae_meter_str[CAMERA_AE_METER_ITEM_COUNT + 1];
    UI_string_type closeup_str[CAMERA_CLOSEUP_ITEM_COUNT + 1];
    UI_string_type banding_str[CAMERA_BANDING_ITEM_COUNT + 1];
    UI_string_type delay_timer_str[CAMERA_DELAY_TIMER_ITEM_COUNT + 1];
    UI_string_type cont_shot_str[CAMERA_CONT_SHOT_ITEM_COUNT + 1];

    /* selected item */
    S32 flash_selected;
    S32 led_highlight_selected;
    S32 shutter_sound_selected;
    S32 ev_selected;
    S32 night_selected;
    S32 ae_meter_selected;
    S32 closeup_selected;
    S32 banding_selected;
    S32 delay_timer_selected;
    S32 cont_shot_selected;

    S32 ori_cont_shot;
} camera_camera_setting_inline_data_struct;

typedef struct
{
    /* strings for inline selection display */
    UI_string_type image_size_str[CAMERA_IMAGE_SIZE_ITEM_COUNT];
    UI_string_type image_qty_str[CAMERA_IMAGE_QTY_ITEM_COUNT];

    /* selected item */
    S32 image_size_selected;
    S32 image_qty_selected;
} camera_image_setting_inline_data_struct;

typedef struct
{
    S32 wb_selected;
    pBOOL is_first_in;
    camera_ui_touch_struct left_arrow;
    camera_ui_touch_struct right_arrow;
    camera_ui_touch_struct capture_icon;
    U16 preview_width;
    U16 preview_height;
} camera_wb_data_struct;

typedef struct
{
    /* inline selection */
    camera_camera_setting_inline_data_struct camera_setting_inline;
    camera_image_setting_inline_data_struct image_setting_inline;
    camera_wb_data_struct wb_setting;

    camera_add_frame_kind cur_select_add_frame_idx;
    S32 cur_select_flash_idx;
    S32 cur_select_add_frame_idx_normal;
    S32 cur_select_add_frame_idx_tileshot;
    S32 cur_select_add_frame_idx_color_idx;
    S32 cur_select_storage_idx;

    UI_string_type dsc_mode_shutter_pri_str[TV_NO + 1];
    UI_string_type dsc_mode_aperture_pri_str[AV_NO + 1];
//    UI_string_type iso_str[CAMERA_ISO_ITEM_COUNT + 1];

    S32 dsc_mode_shutter_pri_selected;
    S32 dsc_mode_aperture_pri_selected;
//    S32 dsc_mode_iso_selected;
} camera_menu_contex_struct;

typedef struct
{
    horizontal_slide slide_bar;
    S32 offset_x;
    S32 offset_y;
    S32 width;
    S32 height;
    U16 value;
} custom_fx_slider_struct;

typedef struct
{
    custom_fx_slider_struct brightness_slider;
    custom_fx_slider_struct saturation_slider;
    custom_fx_slider_struct contrast_slider;
    custom_fx_slider_struct hue_slider;

    S32 text_box_offset_x;
    S32 text_box_offset_y;
    S32 text_box_width;
    S32 text_box_height;
    S32 spacing;
    S32 num_width;
    S32 num_height;
    gdi_handle preview_wnd_layer;
    gdi_handle base_layer;
    BOOL is_left_arrow_press;
    BOOL is_right_arrow_press;
    U16 select_idx;
    U16 fx_idx;
} custom_fx_edit_struct;

/****************************************************************************
* Local Variable                                                                 
*****************************************************************************/
camera_menu_contex_struct g_camera_menu_cntx;
custom_fx_edit_struct g_camera_custom_fx_cntx;

/****************************************************************************
* Global Variable                                                                 
*****************************************************************************/
extern wgui_inline_item wgui_inline_items[];
extern BOOL r2lMMIFlag;

extern const U8 camera_ev_command_map[];
extern const U8 camera_zoom_command_map[];
extern const U8 camera_effect_command_map[];
extern const U8 camera_preview_size_command_map[];
extern const U8 camera_jpg_size_command_map[];
extern const U8 camera_image_qty_command_map[];
extern const U8 camera_banding_command_map[];
extern const U8 camera_flash_command_map[];
extern const U8 camera_ae_meter_command_map[];
extern const U8 camera_iso_command_map[];
extern const U8 camera_wb_command_map[];
extern const U8 camera_dsc_mode_command_map[];
extern const U8 camera_autofocus_command_map[];
extern const U8 camera_autofocus_mode_command_map[];

/****************************************************************************
* Golbal Function
*****************************************************************************/
extern void AudioStopReq(U16 soundId);
extern U16 GetCurKeypadTone(void);

/****************************************************************************
* Local function        
*****************************************************************************/

/* Image Viewer */
void mmi_camera_highlight_to_imgview(void);

/* Camera Setting */
void mmi_camera_highlight_camera_setting(void);
void mmi_camera_entry_camera_setting_screen(void);

/* Image Setting */
void mmi_camera_highlight_image_setting(void);
void mmi_camera_entry_image_setting_screen(void);

/* Effect Setting */
void mmi_camera_hint_effect_setting(U16 index);
void mmi_camera_highlight_effect(void);
void mmi_camera_set_effect_setting_value(void);
void mmi_camera_set_effect_setting_hdlr(S32 index);
void mmi_camera_effect_setting_highlight_hdlr(S32 idx);
void mmi_camera_entry_effect_setting_screen(void);
void mmi_camera_wb_check_osd_orientation(void);

/* WB Setting */
void mmi_camera_highlight_wb(void);
void mmi_camera_hint_wb(U16 index);
void mmi_camera_set_wb_value(void);
void mmi_camera_exit_wb_without_saving(void);
void mmi_camera_wb_init_touch_object(void);

#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
void mmi_camera_wb_touch_scr_pen_down_hdlr(mmi_pen_point_struct pos);
void mmi_camera_wb_touch_scr_pen_up_hdlr(mmi_pen_point_struct pos);
void mmi_camera_wb_touch_scr_pen_move_hdlr(mmi_pen_point_struct pos);
BOOL mmi_camera_wb_touch_scr_hit_test(S32 pos_x, S32 pos_y, camera_ui_touch_struct *touch_obj);
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 

#ifdef __CAMERA_FEATURE_WB_MANUAL__
void mmi_camera_entry_wb_manual_screen(void);
void mmi_camera_entry_wb_manual_help_screen(void);
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 
void mmi_camera_entry_wb_screen(void);
void mmi_camera_exit_wb_screen(void);
void mmi_camera_entry_wb_preview_state(void);
void mmi_camera_exit_wb_preview_state(void);

void mmi_camera_wb_create_resource(void);
void mmi_camera_wb_free_resource(void);

void mmi_camera_wb_preview_start(void);

static void mmi_camera_wb_dummy_func(void);
void mmi_camera_wb_highlight_hdlr(S32 idx);
void mmi_camera_wb_register_key_handler(void);
void mmi_camera_wb_draw_bg(void);
void mmi_camera_wb_preview_draw_softkey(void);
void mmi_camera_wb_draw_style_text(PS8 str, S32 offset_x, S32 offset_y, camera_style_text_struct *style_txt);

/* util, which could be external use */
void mmi_camera_preview_clear_wb_bg(void);
void mmi_camera_wb_display_error_popup(void);

/* key handler function */
void mmi_camera_wb_left_softkey_pressed(void);
void mmi_camera_wb_left_softkey_released(void);
void mmi_camera_wb_right_softkey_pressed(void);
void mmi_camera_wb_right_softkey_released(void);
void mmi_camera_wb_left_arrow_pressed(void);
void mmi_camera_wb_left_arrow_released(void);
void mmi_camera_wb_right_arrow_pressed(void);
void mmi_camera_wb_right_arrow_released(void);

#ifdef __CAMERA_FEATURE_WB_MANUAL__
void mmi_camera_wb_capture_pressed(void);
void mmi_camera_wb_capture_released(void);
void mmi_camera_wb_adjust_parameters(void);
void mmi_camera_wb_show_mwb_cal_animation(void);
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

/* Auto Focus */
#ifdef __CAMERA_AUTOFOCUS__
void mmi_camera_highlight_autofocus(void);
void mmi_camera_hint_autofocus(U16 index);
void mmi_camera_set_autofocus_value(void);
void mmi_camera_entry_autofocus_screen(void);
#endif /* __CAMERA_AUTOFOCUS__ */ 
#ifdef __CAMERA_AUTOFOCUS_MODE__
void mmi_camera_highlight_autofocus_mode(void);
void mmi_camera_hint_autofocus_mode(U16 index);
void mmi_camera_set_autofocus_mode_value(void);
void mmi_camera_entry_autofocus_mode_screen(void);
#endif /* __CAMERA_AUTOFOCUS_MODE__ */ 

/* DSC Mode */
#ifdef __CAMERA_DSC_MODE__
void mmi_camera_hint_dsc_mode(U16 index);
void mmi_camera_highlight_dsc_mode(void);
void mmi_camera_set_dsc_mode_value(void);
void mmi_camera_dsc_mode_highlight_hdlr(S32 idx);
void mmi_camera_entry_dsc_mode_screen(void);

   /* Shot Mode Setting */
void mmi_camera_exit_dsc_mode_setting_screen(void);
void mmi_camera_dsc_mode_setting_set_value(void);
void mmi_camera_entry_dsc_mode_setting_screen(void);
void mmi_camera_dsc_mode_setting_highlight_hdlr(S32 index);

    #ifdef __CAMERA_FEATURE_ISO_SUPPORT__
        static void mmi_camera_entry_iso_screen(void);
        static void mmi_camera_highlight_iso(void);
        static void mmi_camera_hint_iso(U16 index);
        static void mmi_camera_set_iso_value(void);
        static void mmi_camera_iso_highlight_hdlr(S32 idx);
    #endif

#endif /* __CAMERA_DSC_MODE__ */ 

/* Add Frame */
static void mmi_camera_entry_add_frame_screen2(void);
static void mmi_camera_entry_add_frame_screen(void);
static void mmi_camera_hint_add_frame_normal(U16 index);
static void mmi_camera_hint_add_frame_tileshot(U16 index);
static void mmi_camera_hint_add_frame_color_idx(U16 index);
static void mmi_camera_highlight_add_frame(void);
static void mmi_camera_highlight_add_frame2(void);
static void mmi_camera_set_add_frame_value(void);
static void mmi_camera_add_frame_goto_previous_frame(void);
static void mmi_camera_add_frame_goto_next_frame(void);
static void mmi_camera_entry_add_frame_view_screen(void);
static void mmi_camera_add_frame_highlight_hdlr2(S32 idx);
static void mmi_camera_add_frame_highlight_hdlr(S32 idx);

/* Restore default */
void mmi_camera_highlight_restore_default(void);
void mmi_camera_entry_restore_default_confirm_screen(void);
void mmi_camera_entry_restore_default_confirm_yes(void);

void mmi_camera_highlight_to_imgview(void);
void mmi_camera_highlight_camera_setting(void);
void mmi_camera_highlight_image_setting(void);
void mmi_camera_highlight_effect_setting(void);



void mmi_camera_highlight_self_capture(void);
void mmi_camera_highlight_restore_default(void);

void mmi_camera_highlight_custom_fx_set(void);
void mmi_camera_highlight_custom_fx_edit(void);

/* storage */
void mmi_camera_hint_storage(U16 index);
void mmi_camera_highlight_storage(void);
void mmi_camera_highlight_storage_hdlr(S32 idx);
void mmi_camera_set_storage_value(void);
void mmi_camera_set_storage_callback(S8 drv_letter);
void mmi_camera_exit_select_storage_screen_without_selecting(void);

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_right_arrow_press(void);
void mmi_camera_custom_fx_edit_left_arrow_press(void);

void mmi_camera_custom_fx_edit_draw_value(U16 idx);

void mmi_camera_entry_custom_fx_edit_sublcd_screen(void);
void mmi_camera_custom_fx_edit_draw_title(void);

#ifdef __MMI_SUBLCD__
void mmi_camera_entry_custom_fx_edit_sublcd_screen(void);
void mmi_camera_exit_custom_fx_edit_sublcd_screen(void);
#endif /* __MMI_SUBLCD__ */ 
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#ifdef __MMI_CLAMSHELL__
U8 mmi_camera_custom_fx_clam_close_hdlr(mmi_frm_int_event_type interrupt_event);
#endif 

#if defined(__CAMERA_OSD_HORIZONTAL__)
#define DISPLAY_POPUP_DONE() \
    DisplayPopupRotated((PU8) GetString(STR_GLOBAL_DONE),IMG_GLOBAL_ACTIVATED,1,ST_NOTIFYDURATION,SUCCESS_TONE,g_camera_cntx.osd_rotate)
#else
#define DISPLAY_POPUP_DONE() \
    DisplayPopup((PU8) GetString(STR_GLOBAL_DONE), IMG_GLOBAL_ACTIVATED, 1, ST_NOTIFYDURATION, SUCCESS_TONE)
#endif


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_init_option_menu
 * DESCRIPTION
 *  Init menus hdlr
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_init_option_menu(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetHiliteHandler(MENU_ID_CAMERA_TO_IMGVIEW, mmi_camera_highlight_to_imgview);
    SetHiliteHandler(MENU_ID_CAMERA_CAMERA_SETTING, mmi_camera_highlight_camera_setting);
    SetHiliteHandler(MENU_ID_CAMERA_IMAGE_SETTING, mmi_camera_highlight_image_setting);

    SetHiliteHandler(MENU_ID_CAMERA_WB, mmi_camera_highlight_wb);
    SetHintHandler(MENU_ID_CAMERA_WB, mmi_camera_hint_wb);

#ifdef __CAMERA_AUTOFOCUS__
    SetHiliteHandler(MENU_ID_CAMERA_AUTOFOCUS_METERING, mmi_camera_highlight_autofocus);
    SetHintHandler(MENU_ID_CAMERA_AUTOFOCUS_METERING, mmi_camera_hint_autofocus);
    SetHiliteHandler(MENU_ID_CAMERA_AUTOFOCUS_MODE, mmi_camera_highlight_autofocus_mode);
    SetHintHandler(MENU_ID_CAMERA_AUTOFOCUS_MODE, mmi_camera_hint_autofocus_mode);
#endif /* __CAMERA_AUTOFOCUS__ */ 

#ifdef __CAMERA_DSC_MODE__
    SetHiliteHandler(MENU_ID_CAMERA_DSC_MODE, mmi_camera_highlight_dsc_mode);
    SetHintHandler(MENU_ID_CAMERA_DSC_MODE, mmi_camera_hint_dsc_mode);

#ifdef __CAMERA_FEATURE_ISO_SUPPORT__
    SetHiliteHandler(MENU_ID_CAMERA_ISO, mmi_camera_highlight_iso);
    SetHintHandler(MENU_ID_CAMERA_ISO, mmi_camera_hint_iso);
#endif /* __CAMERA_DSC_MODE_APERTURE_PRI__ */ 

#endif /* __CAMERA_DSC_MODE__ */ 

    SetHiliteHandler(MENU_ID_CAMERA_SELF_CAPTURE, mmi_camera_highlight_self_capture);
    SetHiliteHandler(MENU_ID_CAMERA_STORAGE, mmi_camera_highlight_storage);
    SetHiliteHandler(MENU_ID_CAMERA_RESTORE_DEFAULT, mmi_camera_highlight_restore_default);

    SetHiliteHandler(MENU_ID_CAMERA_EFFECT_SETTING, mmi_camera_highlight_effect_setting);
    SetHintHandler(MENU_ID_CAMERA_EFFECT_SETTING, mmi_camera_hint_effect_setting);

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
    SetHiliteHandler(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET, mmi_camera_highlight_custom_fx_set);
    SetHiliteHandler(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_EDIT_EFFECT, mmi_camera_highlight_custom_fx_edit);
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#ifdef __CAMERA_FEATURE_ADD_FRAME__
    SetHiliteHandler(MENU_ID_CAMERA_ADD_FRAME, mmi_camera_highlight_add_frame);
    SetHintHandler(MENU_ID_CAMERA_ADD_FRAME_NORMAL, mmi_camera_hint_add_frame_normal);
    SetHintHandler(MENU_ID_CAMERA_ADD_FRAME_TILESHOT, mmi_camera_hint_add_frame_tileshot);
    SetHintHandler(MENU_ID_CAMERA_ADD_FRAME_COLOR_IDX, mmi_camera_hint_add_frame_color_idx);
    SetHiliteHandler(MENU_ID_CAMERA_ADD_FRAME_NORMAL, mmi_camera_highlight_add_frame2);
    SetHiliteHandler(MENU_ID_CAMERA_ADD_FRAME_TILESHOT, mmi_camera_highlight_add_frame2);
    SetHiliteHandler(MENU_ID_CAMERA_ADD_FRAME_COLOR_IDX, mmi_camera_highlight_add_frame2);
#endif /* __CAMERA_FEATURE_ADD_FRAME__ */ 

    SetHintHandler(MENU_ID_CAMERA_STORAGE, mmi_camera_hint_storage);
}

/*****************************************************************************
*
* Camera WB Setting
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_wb
 * DESCRIPTION
 *  wb setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_wb(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_WB_START + g_camera_cntx.setting.wb + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_init_touch_object
 * DESCRIPTION
 *  init touch object for WB
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_init_touch_object()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_image_get_dimension_id(
        (U16) (IMG_ID_CAMERA_OSD_WB_RIGHT_ARROW_UP),
        &g_camera_menu_cntx.wb_setting.right_arrow.width,
        &g_camera_menu_cntx.wb_setting.right_arrow.height);
    g_camera_menu_cntx.wb_setting.right_arrow.is_press = FALSE;
    g_camera_menu_cntx.wb_setting.right_arrow.offset_x = g_camera_cntx.active_camera_osd_ptr->right_arrow.offset_x;
    g_camera_menu_cntx.wb_setting.right_arrow.offset_y = g_camera_cntx.active_camera_osd_ptr->right_arrow.offset_y;

    gdi_image_get_dimension_id(
        (U16) (IMG_ID_CAMERA_OSD_WB_LEFT_ARROW_UP),
        &g_camera_menu_cntx.wb_setting.left_arrow.width,
        &g_camera_menu_cntx.wb_setting.left_arrow.height);
    g_camera_menu_cntx.wb_setting.left_arrow.is_press = FALSE;
    g_camera_menu_cntx.wb_setting.left_arrow.offset_x = g_camera_cntx.active_camera_osd_ptr->left_arrow.offset_x;
    g_camera_menu_cntx.wb_setting.left_arrow.offset_y = g_camera_cntx.active_camera_osd_ptr->left_arrow.offset_y;

    gdi_image_get_dimension_id(
        (U16) (IMG_ID_CAMERA_OSD_CAPTURE),
        &g_camera_menu_cntx.wb_setting.capture_icon.width,
        &g_camera_menu_cntx.wb_setting.capture_icon.height);
    g_camera_menu_cntx.wb_setting.capture_icon.is_press = FALSE;
    g_camera_menu_cntx.wb_setting.capture_icon.offset_x = g_camera_cntx.active_camera_osd_ptr->capture.offset_x;
    g_camera_menu_cntx.wb_setting.capture_icon.offset_y = g_camera_cntx.active_camera_osd_ptr->capture.offset_y;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_wb
 * DESCRIPTION
 *  wb setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_wb(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_wb_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_wb_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

#ifdef __CAMERA_FEATURE_WB_MANUAL__
    g_camera_menu_cntx.wb_setting.is_first_in = TRUE;
#endif 
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}

#ifdef __CAMERA_FEATURE_WB_MANUAL__


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_capture_pressed
 * DESCRIPTION
 *  wb captuer pressed
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_capture_pressed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (g_camera_menu_cntx.wb_setting.wb_selected == CAMERA_SETTING_WB_MANUAL)
    {
        /* capture only works if camera is ready, otherwise will ignore this action */
        if (mdi_camera_is_ready_to_capture() == TRUE)
        {
            mmi_camera_wb_adjust_parameters();
        }
    }
    ClearKeyEvents();
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_capture_released
 * DESCRIPTION
 *  wb capture release
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_capture_released(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* flush all key event */
    ClearKeyEvents();
}
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_wb_screen
 * DESCRIPTION
 *  entry effect setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_wb_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_WB, NULL, mmi_camera_entry_wb_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_WB);

    nItems = GetNumOfChild(MENU_ID_CAMERA_WB);
    GetSequenceStringIds(MENU_ID_CAMERA_WB, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_WB, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_WB);

    RegisterHighlightHandler(mmi_camera_wb_highlight_hdlr);

    ShowCategory11Screen(
        STR_ID_CAMERA_WB,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.wb,   /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_wb_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

#ifdef __CAMERA_FEATURE_WB_MANUAL__


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_wb_manual_help_screen
 * DESCRIPTION
 *  wb setting entry screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_wb_manual_help_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    PS8 buffer;
    S32 bufferSize;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_WB_MANUAL_HELP, NULL, mmi_camera_entry_wb_manual_help_screen, NULL);

    buffer = GetString(STR_ID_CAMERA_WB_HELP);
    bufferSize = mmi_ucs2strlen(buffer);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    ShowCategory74Screen(
        STR_ID_CAMERA_WB_MANUAL,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        (PU8) buffer,
        bufferSize,
        NULL);

    SetKeyHandler(mmi_camera_entry_wb_manual_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetLeftSoftkeyFunction(mmi_camera_entry_wb_manual_screen, KEY_EVENT_UP);

    /* go back to game menu */
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_wb_manual_screen
 * DESCRIPTION
 *  wb setting entry screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_wb_manual_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   /************ entry screen ************/

    /* entry new screen */
    EntryNewScreen(SCR_ID_CAMERA_WB_MANUAL, mmi_camera_exit_wb_screen, mmi_camera_entry_wb_manual_screen, NULL);

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_WB_MANUAL);

   /************ init/config framework's environment  ************/
#ifdef __MMI_AUDIO_REVERB_EFFECT__
    g_camera_cntx.is_3d_sound_on = mmi_settings_audio_reverb_get_status();

    if (g_camera_cntx.is_3d_sound_on ==TRUE)
        mdi_audio_reverb_turn_off();
#endif /* __MMI_AUDIO_REVERB_EFFECT__ */

    /* entry full screen app */
    entry_full_screen();

    gdi_layer_reset_clip();
    gdi_layer_reset_text_clip();

    /* stop bg music */
    mdi_audio_suspend_background_play();

    /* 
     * This is used to solve a very rare situation. When playing a IMELODY 
     * with backlight on/off, and the screen previous to this screen is a 
     * horizontal screen. Before enter this screen, the IMELODY turn off the
     * backlight. While exit previous screen, the layer rotate back to normal
     * size and the content is not correct. So when calling TurnOnBacklight, 
     * LCD is in sleepin state and draw wrong content to LCD.
     * So we need to clear the buffer first to avoid this situation.
     */
    gdi_layer_clear(GDI_COLOR_BLACK);

    /* stop MMI sleep */
    TurnOnBacklight(0);

    /* force all playing keypad tone off */
    AudioStopReq(GetCurKeypadTone());

    /* disable key pad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_DISABLED);

    /* disalbe align timer  */
    UI_disable_alignment_timers();

    /* stop LED patten */
    /* GpioCtrlReq(MMIAPI_DEV_CTRL_GET); */

    /* enable multi-layer */
    gdi_layer_multi_layer_enable();

   /*********** init layer var ************/
    /* get mainlcd based layer handle */
    gdi_layer_get_base_handle(&g_camera_cntx.base_layer_handle);

    /* get sublcd base layer handle */
#ifdef __MMI_SUBLCD__
    gdi_lcd_set_active(GDI_LCD_SUB_LCD_HANDLE);
    gdi_layer_get_base_handle(&g_camera_cntx.sublcd_base_layer_handle);
    gdi_lcd_set_active(GDI_LCD_MAIN_LCD_HANDLE);
#endif /* __MMI_SUBLCD__ */ 

   /************ draw sublcd and hook msg hdlr ************/

#ifdef __MMI_SUBLCD__
    ForceSubLCDScreen(mmi_camera_entry_sublcd_screen);
#endif 

#if defined(__MMI_CLAMSHELL__) && !defined(__MMI_SLIDE__)
    /* register event hdlr */
    /* SetInterruptEventHandler(mmi_camera_clam_close_event_hdlr, NULL, MSG_ID_MMI_EQ_GPIO_DETECT_IND); */
#endif /* defined(__MMI_CLAMSHELL__) && !defined(__MMI_SLIDE__) */ 

   /************ init camera app environment ************/
    /* init some flags */
    g_camera_cntx.last_error = MDI_RES_CAMERA_SUCCEED;
    g_camera_cntx.is_dis_clam_open = FALSE;
    g_camera_cntx.lcm_rotate = CAMERA_LCM_MAINLCD_ROTATE;

    if (!g_camera_cntx.is_force_self_capture)
    {
        g_camera_cntx.is_clam_close = FALSE;
    }

    /* power on and init hardware module */
    if (g_camera_cntx.last_error == MDI_RES_CAMERA_SUCCEED)
    {
        g_camera_cntx.last_error = mdi_camera_power_on();
    }

    /* create preview resource */
    mmi_camera_wb_create_resource();

#if defined(__CAMERA_OSD_HORIZONTAL__)
    gdi_lcd_set_rotate_by_layer(TRUE);
    g_camera_cntx.previous_osd_rotate = CAMERA_DISPLAY_ROTATE_RESET;
    mmi_camera_check_sensor_orientation();
    mmi_camera_wb_check_osd_orientation();
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    mmi_camera_wb_init_touch_object();

#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
    wgui_register_pen_down_handler(mmi_camera_wb_touch_scr_pen_down_hdlr);
    wgui_register_pen_up_handler(mmi_camera_wb_touch_scr_pen_up_hdlr);
    wgui_register_pen_move_handler(mmi_camera_wb_touch_scr_pen_move_hdlr);
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 

#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (g_camera_menu_cntx.wb_setting.is_first_in == TRUE)
    {
        mdi_camera_backup_mwb();
        g_camera_menu_cntx.wb_setting.is_first_in = FALSE;
    }
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

#if defined(__CAMERA_OSD_HORIZONTAL__)

#ifdef __MMI_TVOUT__

    /*  
     * Vertical | Horizontal |
     * -------------------------
     * w/o TV | LCD      | LCD        |
     * w   TV | LCD      | LCM        |
     * -------------------------      
     * 
     * * vertical = full sceren play
     * 
     * * gdi_lcd_set_rotate_by_layer(TRUE) = LCD Rotate
     * * gdi_lcd_set_rotate_by_layer(FALSE) = LCM Rotat
     */

    if (!mdi_tvout_is_enable())
    {
        /* tvout not enable */
        gdi_lcd_set_rotate_by_layer(TRUE);
    }
    else if (g_camera_cntx.is_fullscreen)
    {
        /* tv-out is enable and is vertical display */
        gdi_lcd_set_rotate_by_layer(TRUE);
    }
    else
    {
        gdi_lcd_set_rotate_by_layer(FALSE);
    }
#else /* __MMI_TVOUT__ */ 
    /* if no tvout, we always use LCD rotate */
    gdi_lcd_set_rotate_by_layer(TRUE);
#endif /* __MMI_TVOUT__ */ 
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    mmi_camera_entry_wb_preview_state();

}
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_check_osd_orientation
 * DESCRIPTION
 *  update display rotate (0 | 90 | 180 | 270 )
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#if defined(__CAMERA_OSD_HORIZONTAL__)
void mmi_camera_wb_check_osd_orientation(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_cntx.previous_osd_rotate != g_camera_cntx.osd_rotate)
    {
        switch (g_camera_cntx.osd_rotate)
        {
            case CAMERA_DISPLAY_ROTATE_0:
                g_camera_cntx.active_camera_osd_ptr = &g_camera_osd_cntx;
                g_camera_cntx.osd_UI_device_height = LCD_HEIGHT;
                g_camera_cntx.osd_UI_device_width = LCD_WIDTH;
                gdi_layer_push_and_set_active(g_camera_cntx.osd_layer_handle0);
                gdi_layer_toggle_double();
                gdi_layer_set_rotate(GDI_LAYER_ROTATE_270);
                gdi_layer_resize(g_camera_cntx.osd_UI_device_width, g_camera_cntx.osd_UI_device_height);
                gdi_layer_clear_background(GDI_COLOR_TRANSPARENT);
                gdi_layer_pop_and_restore_active();
                break;

            case CAMERA_DISPLAY_ROTATE_270:
                g_camera_cntx.active_camera_osd_ptr = &g_camera_osd_cntx_270;
                g_camera_cntx.osd_UI_device_height = LCD_WIDTH;
                g_camera_cntx.osd_UI_device_width = LCD_HEIGHT;
                gdi_layer_push_and_set_active(g_camera_cntx.osd_layer_handle0);
                gdi_layer_toggle_double();
                gdi_layer_set_rotate(GDI_LAYER_ROTATE_0);
                gdi_layer_resize(g_camera_cntx.osd_UI_device_width, g_camera_cntx.osd_UI_device_height);
                gdi_layer_clear_background(GDI_COLOR_TRANSPARENT);
                gdi_layer_pop_and_restore_active();
                break;

            default:
                ASSERT(0);
                break;
        }

        g_camera_cntx.previous_osd_rotate = g_camera_cntx.osd_rotate;

    }
}

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_preview_clear_wb_bg
 * DESCRIPTION
 *  wb setting entry screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_preview_clear_wb_bg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    gdi_color bg_color;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_and_set_active(g_camera_cntx.base_layer_handle);

    if (g_camera_cntx.active_camera_osd_ptr->bg.is_draw_bg_color)
    {
        bg_color = GDI_RGB_TO_BUFFER_FORMAT(
                    g_camera_cntx.active_camera_osd_ptr->bg.r,
                    g_camera_cntx.active_camera_osd_ptr->bg.g,
                    g_camera_cntx.active_camera_osd_ptr->bg.b);

        gdi_layer_clear(bg_color);
    }

    if (g_camera_cntx.active_camera_osd_ptr->bg.is_draw_bg_image)
    {
        gdi_image_draw_id(0, 0, IMG_ID_CAMERA_PREVIEW_BACKGROUND);
    }

    if (!g_camera_cntx.active_camera_osd_ptr->bg.is_draw_bg_color &&
        !g_camera_cntx.active_camera_osd_ptr->bg.is_draw_bg_image)
    {
        gdi_layer_clear(GDI_COLOR_BLACK);
    }

    gdi_layer_pop_and_restore_active();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_wb_preview_state
 * DESCRIPTION
 *  wb setting entry preview screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_wb_preview_state(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* hide title bar */
    hide_status_icon_bar(0);

    /* clear background */
    mmi_camera_preview_clear_wb_bg();

#ifdef __CAMERA_FEATURE_SELF_CAPTURE__
    /* draw sublcd icon */
    mmi_camera_sublcd_draw_icon();
#endif /* __CAMERA_FEATURE_SELF_CAPTURE__ */ 

    /* draw mode */
    g_camera_cntx.is_lsk_pressed = FALSE;
    g_camera_cntx.is_rsk_pressed = FALSE;
    mmi_camera_wb_draw_bg();

    /* init key handler */
    mmi_camera_wb_register_key_handler();

    /* blt lcd */
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

    /* set blt layer */
    gdi_layer_set_blt_layer(g_camera_cntx.preview_layer_handle, g_camera_cntx.osd_layer_handle0, 0, 0);

    /* blt lcd */
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

    mmi_camera_wb_preview_start();

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_register_key_handler
 * DESCRIPTION
 *  wb setting entry screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_register_key_handler(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ClearInputEventHandler(MMI_DEVICE_KEY);

    /* register soft keys */
    SetKeyHandler(mmi_camera_wb_right_softkey_pressed, KEY_RSK, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_wb_right_softkey_released, KEY_RSK, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_wb_left_softkey_pressed, KEY_LSK, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_wb_left_softkey_released, KEY_LSK, KEY_EVENT_UP);

    /*
     * if(g_camera_cntx.osd_rotate ==CAMERA_DISPLAY_ROTATE_270)
     * {
     * SetKeyHandler(mmi_camera_wb_right_arrow_pressed,   KEY_DOWN_ARROW,   KEY_EVENT_DOWN);
     * SetKeyHandler(mmi_camera_wb_right_arrow_released,  KEY_DOWN_ARROW,   KEY_EVENT_UP);
     * SetKeyHandler(mmi_camera_wb_left_arrow_pressed,    KEY_UP_ARROW,  KEY_EVENT_DOWN);
     * SetKeyHandler(mmi_camera_wb_left_arrow_released,   KEY_UP_ARROW,  KEY_EVENT_UP); 
     * }
     * else
     * {
     * SetKeyHandler(mmi_camera_wb_right_arrow_pressed,      KEY_RIGHT_ARROW,  KEY_EVENT_DOWN);
     * SetKeyHandler(mmi_camera_wb_right_arrow_released,  KEY_RIGHT_ARROW,  KEY_EVENT_UP);
     * SetKeyHandler(mmi_camera_wb_left_arrow_pressed,    KEY_LEFT_ARROW,   KEY_EVENT_DOWN);
     * SetKeyHandler(mmi_camera_wb_left_arrow_released,   KEY_LEFT_ARROW,   KEY_EVENT_UP); 
     * }
     */
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (CAMERA_CAPTURE_KEY != -1)
    {
        SetKeyHandler(mmi_camera_wb_capture_pressed, CAMERA_CAPTURE_KEY, KEY_EVENT_DOWN);
        SetKeyHandler(mmi_camera_wb_capture_released, CAMERA_CAPTURE_KEY, KEY_EVENT_UP);
    }
    if (CAMERA_CAPTURE_EXTRA_KEY1 != -1)
    {
        SetKeyHandler(mmi_camera_wb_capture_pressed, (U16)CAMERA_CAPTURE_EXTRA_KEY1, KEY_EVENT_DOWN);
        SetKeyHandler(mmi_camera_wb_capture_released, (U16)CAMERA_CAPTURE_EXTRA_KEY1, KEY_EVENT_UP);
    }
    if (CAMERA_CAPTURE_EXTRA_KEY2 != -1)
    {
        SetKeyHandler(mmi_camera_wb_capture_pressed, (U16)CAMERA_CAPTURE_EXTRA_KEY2, KEY_EVENT_DOWN);
        SetKeyHandler(mmi_camera_wb_dummy_func, (U16)CAMERA_CAPTURE_EXTRA_KEY2, KEY_EVENT_REPEAT);
        SetKeyHandler(mmi_camera_wb_dummy_func, (U16)CAMERA_CAPTURE_EXTRA_KEY2, KEY_LONG_PRESS);
        SetKeyHandler(mmi_camera_wb_capture_pressed, (U16)CAMERA_CAPTURE_EXTRA_KEY2, KEY_EVENT_UP);
    }
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_preview_start
 * DESCRIPTION
 *  wb setting entry screen
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_preview_start()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    mdi_camera_setting_struct camera_setting_data;
    mdi_camera_preview_struct camera_preview_data;
    GDI_HANDLE preview_layer_handle;
    U32 preview_layer_flag;
    U32 blt_layer_flag;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* preview parametes */
    camera_setting_data.zoom = 10;
    camera_setting_data.wb = camera_wb_command_map[g_camera_menu_cntx.wb_setting.wb_selected];
    camera_setting_data.ev = camera_ev_command_map[g_camera_cntx.setting.ev];
    camera_setting_data.banding = camera_banding_command_map[g_camera_cntx.setting.banding];
    camera_setting_data.flash = camera_flash_command_map[g_camera_cntx.setting.flash];
    camera_setting_data.ae_meter = camera_ae_meter_command_map[g_camera_cntx.setting.ae_meter];
    camera_setting_data.iso = camera_iso_command_map[g_camera_cntx.setting.iso];
    camera_setting_data.night = g_camera_cntx.setting.night;
    camera_setting_data.dsc_mode = camera_dsc_mode_command_map[g_camera_cntx.setting.dsc_mode];
    camera_setting_data.osd_rotate = g_camera_cntx.osd_rotate;

#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (camera_setting_data.wb == MDI_CAMERA_WB_MANUAL)
    {
        camera_setting_data.manual_wb = TRUE;
    }
    else
    {
        camera_setting_data.manual_wb = FALSE;
    }
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

    /* default effect */
    camera_setting_data.effect = camera_effect_command_map[g_camera_cntx.setting.effect];
    camera_setting_data.brightness = 128;
    camera_setting_data.saturation = 128;
    camera_setting_data.contrast = 128;
    camera_setting_data.hue = 0;

    camera_setting_data.preview_width = g_camera_menu_cntx.wb_setting.preview_width;
    camera_setting_data.preview_height = g_camera_menu_cntx.wb_setting.preview_height;

    /* capture parameters */
    camera_setting_data.image_qty = camera_image_qty_command_map[g_camera_cntx.setting.image_qty];
    camera_setting_data.image_width = g_camera_cntx.image_width;
    camera_setting_data.image_height = g_camera_cntx.image_height;

    camera_setting_data.lcm = MDI_CAMERA_PREVIEW_LCM_MAINLCD;
    camera_setting_data.preview_rotate = CAMERA_PREVIEW_MAINLCD_ROTATE;
    camera_setting_data.lcm_rotate = CAMERA_LCM_MAINLCD_ROTATE;

    preview_layer_handle = g_camera_cntx.preview_layer_handle;
    blt_layer_flag = GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1;
    preview_layer_flag = GDI_LAYER_ENABLE_LAYER_0;

#ifdef __CAMERA_AUTOFOCUS__
    camera_setting_data.af_zone0_x = CAMERA_AF_POSITION_1_X;
    camera_setting_data.af_zone0_y = CAMERA_AF_POSITION_1_Y;
    camera_setting_data.af_zone1_x = CAMERA_AF_POSITION_2_X;
    camera_setting_data.af_zone1_y = CAMERA_AF_POSITION_2_Y;
    camera_setting_data.af_zone2_x = CAMERA_AF_POSITION_3_X;
    camera_setting_data.af_zone2_y = CAMERA_AF_POSITION_3_Y;
    camera_setting_data.af_zone3_x = CAMERA_AF_POSITION_4_X;
    camera_setting_data.af_zone3_y = CAMERA_AF_POSITION_4_Y;
    camera_setting_data.af_zone4_x = CAMERA_AF_POSITION_5_X;
    camera_setting_data.af_zone4_y = CAMERA_AF_POSITION_5_Y;
#endif /* __CAMERA_AUTOFOCUS__ */ 

#ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
    camera_setting_data.overlay_frame_mode = FALSE;
    camera_setting_data.overlay_frame_depth = 0;
    camera_setting_data.overlay_frame_width = 0;
    camera_setting_data.overlay_frame_height = 0;
    camera_setting_data.overlay_frame_source_key = 0;
    camera_setting_data.overlay_frame_buffer_address = 0;
#endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 

    camera_preview_data.preview_layer_handle = preview_layer_handle;
    camera_preview_data.preview_wnd_offset_x = 0;
    camera_preview_data.preview_wnd_offset_y = 0;
    camera_preview_data.preview_wnd_width = g_camera_menu_cntx.wb_setting.preview_width;
    camera_preview_data.preview_wnd_height = g_camera_menu_cntx.wb_setting.preview_height;
    camera_preview_data.blt_layer_flag = blt_layer_flag;
    camera_preview_data.preview_layer_flag = preview_layer_flag;
    camera_preview_data.is_lcd_update = TRUE;
    camera_preview_data.src_key_color = GDI_COLOR_TRANSPARENT;
    camera_preview_data.is_tvout = TRUE;
    camera_preview_data.xenon_flash_status_callback = NULL;

    g_camera_cntx.last_error
        = mdi_camera_preview_start(
            &camera_preview_data,
            &camera_setting_data);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_free_resource
 * DESCRIPTION
 *  free resource
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_free_resource(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   /****** free osd layer ******/
    if (g_camera_cntx.osd_layer_handle0 != GDI_LAYER_EMPTY_HANDLE)
    {
        gdi_layer_free(g_camera_cntx.osd_layer_handle0);
    }
    g_camera_cntx.osd_layer_handle0 = GDI_LAYER_EMPTY_HANDLE;

    mmi_frm_scrmem_free((void*)g_camera_cntx.osd_layer_buf_ptr0);
    g_camera_cntx.osd_layer_buf_ptr0 = NULL;

   /****** free preview layer ******/
    mmi_camera_preview_free_preview_resource();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_create_resource
 * DESCRIPTION
 *  wb create preview resource
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_create_resource(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
   /************ preview layer ************/
    {
    #ifdef HORIZONTAL_CAMERA
        g_camera_menu_cntx.wb_setting.preview_width = LCD_HEIGHT;
        g_camera_menu_cntx.wb_setting.preview_height = LCD_WIDTH;
    #else /* HORIZONTAL_CAMERA */ 
        g_camera_menu_cntx.wb_setting.preview_width = LCD_WIDTH;
        g_camera_menu_cntx.wb_setting.preview_height = LCD_HEIGHT;
    #endif /* HORIZONTAL_CAMERA */ 
        mmi_camera_preview_create_preview_resource(
            0,
            0,
            g_camera_menu_cntx.wb_setting.preview_width,
            g_camera_menu_cntx.wb_setting.preview_height,
            g_camera_cntx.lcm_rotate);
    }

   /************ osd layer ************/
    /* create a double layer frame from outside memory */
    g_camera_cntx.osd_layer_buf_ptr0 = mmi_frm_scrmem_alloc(CAMERA_OSD_BUFFER_SIZE);

    gdi_layer_create_double_using_outside_memory(
        0,
        0,
        UI_device_width,
        UI_device_height,
        &g_camera_cntx.osd_layer_handle0,
        (PU8) g_camera_cntx.osd_layer_buf_ptr0,
        (S32) (CAMERA_OSD_BUFFER_SIZE));

    gdi_layer_push_and_set_active(g_camera_cntx.osd_layer_handle0);
    gdi_layer_clear_background(GDI_COLOR_TRANSPARENT);
    gdi_layer_set_source_key(TRUE, GDI_COLOR_TRANSPARENT);
    gdi_layer_pop_and_restore_active();

    return;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_right_arrow_pressed
 * DESCRIPTION
 *  wb right arrow pressed
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_right_arrow_pressed()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.wb_setting.right_arrow.is_press = TRUE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

    if (g_camera_menu_cntx.wb_setting.wb_selected == 0)
    {
        g_camera_menu_cntx.wb_setting.wb_selected = CAMERA_SETTING_WB_COUNT - 1;
    }
    else
    {
        g_camera_menu_cntx.wb_setting.wb_selected--;
    }

    mdi_camera_update_para_wb(camera_wb_command_map[g_camera_menu_cntx.wb_setting.wb_selected]);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_right_arrow_released
 * DESCRIPTION
 *  wb right arrow released
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_right_arrow_released(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.wb_setting.right_arrow.is_press = FALSE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_left_arrow_pressed
 * DESCRIPTION
 *  wb left arrow pressed
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_left_arrow_pressed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.wb_setting.left_arrow.is_press = TRUE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

    if (g_camera_menu_cntx.wb_setting.wb_selected < CAMERA_SETTING_WB_COUNT - 1)
    {
        g_camera_menu_cntx.wb_setting.wb_selected++;
    }
    else
    {
        g_camera_menu_cntx.wb_setting.wb_selected = 0;
    }

    mdi_camera_update_para_wb(camera_wb_command_map[g_camera_menu_cntx.wb_setting.wb_selected]);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_left_arrow_released
 * DESCRIPTION
 *  left arrow released
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_left_arrow_released(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.wb_setting.left_arrow.is_press = FALSE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_draw_style_text
 * DESCRIPTION
 *  draw style text
 * PARAMETERS
 *  str             [IN]        String
 *  offset_x        [IN]        Offset x
 *  offset_y        [IN]        Offset y
 *  style_txt       [IN]        Text style
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_draw_style_text(PS8 str, S32 offset_x, S32 offset_y, camera_style_text_struct *style_txt)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (r2lMMIFlag)
    {
        offset_x += gui_get_string_width((UI_string_type) str);
    }

    if (style_txt->style == CAMERA_TEXT_STYLE_NORMAL)
    {

        gui_move_text_cursor(offset_x, offset_y);
        gui_set_text_color(gui_color(style_txt->r, style_txt->g, style_txt->b));
        gui_print_text((UI_string_type) str);
    }
    else if (style_txt->style == CAMERA_TEXT_STYLE_BORDER)
    {
        gui_move_text_cursor(offset_x, offset_y);
        gui_set_text_color(gui_color(style_txt->r, style_txt->g, style_txt->b));
        gui_set_text_border_color(gui_color(style_txt->style_r, style_txt->style_g, style_txt->style_b));
        gui_print_bordered_text((UI_string_type) str);
    }
    else if (style_txt->style == CAMERA_TEXT_STYLE_SHADOW)
    {
        gui_move_text_cursor(offset_x + 1, offset_y + 1);
        gui_set_text_color(gui_color(style_txt->style_r, style_txt->style_g, style_txt->style_b));
        gui_print_text((UI_string_type) str);

        gui_move_text_cursor(offset_x, offset_y);
        gui_set_text_color(gui_color(style_txt->r, style_txt->g, style_txt->b));
        gui_print_text((UI_string_type) str);
    }
    else
    {
        MMI_ASSERT(0);
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_preview_draw_softkey
 * DESCRIPTION
 *  draw preview softkey
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_preview_draw_softkey(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 lsk_offset_x = 0;
    S32 lsk_offset_y = 0;
    S32 rsk_offset_x = 0;
    S32 rsk_offset_y = 0;
    S32 str_width;
    S32 str_height;
    PS8 str_ptr;
    U16 lsk_id;
    U16 rsk_id;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    lsk_id = STR_GLOBAL_SAVE;
    rsk_id = STR_GLOBAL_BACK;

    gdi_layer_reset_clip();
    gdi_layer_reset_text_clip();

    gui_set_font(&MMI_medium_font);

    /* lsk */
    str_ptr = (PS8) GetString(lsk_id);

    gui_measure_string((UI_string_type) str_ptr, &str_width, &str_height);

    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        wgui_softkey_get_offset_ex((UI_string_type) str_ptr, &lsk_offset_x, &lsk_offset_y, MMI_LEFT_SOFTKEY, MMI_FRM_SCREEN_ROTATE_270);
    }
    else
    {
        wgui_softkey_get_offset((UI_string_type) str_ptr, &lsk_offset_x, &lsk_offset_y, MMI_LEFT_SOFTKEY);
    }

    /* check r2lMMIFlag flag to correct offset_x of string, due to we will do the change in 
     * mmi_camera_draw_style_text() */
    if (r2lMMIFlag)
    {
        lsk_offset_x -= gui_get_string_width((UI_string_type) str_ptr);
    }

    if (g_camera_cntx.is_lsk_pressed)
    {
        lsk_offset_x++;
        lsk_offset_y++;
    }

    mmi_camera_wb_draw_style_text(
        str_ptr,
        lsk_offset_x,
        lsk_offset_y,
        &g_camera_cntx.active_camera_osd_ptr->softkey.lsk);

#ifdef __CAMERA_FEATURE_TOUCH_SCREEN__
    g_camera_cntx.touch_lsk.offset_x = lsk_offset_x;
    g_camera_cntx.touch_lsk.offset_y = lsk_offset_y;
    g_camera_cntx.touch_lsk.width = str_width;
    g_camera_cntx.touch_lsk.height = str_height;
#endif /* __CAMERA_FEATURE_TOUCH_SCREEN__ */ 

    /* rsk */
    str_ptr = (PS8) GetString(rsk_id);

    gui_measure_string((UI_string_type) str_ptr, &str_width, &str_height);
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        wgui_softkey_get_offset_ex((UI_string_type) str_ptr, &rsk_offset_x, &rsk_offset_y, MMI_RIGHT_SOFTKEY, MMI_FRM_SCREEN_ROTATE_270);
    }
    else
    {
        wgui_softkey_get_offset((UI_string_type) str_ptr, &rsk_offset_x, &rsk_offset_y, MMI_RIGHT_SOFTKEY);
    }

    if (r2lMMIFlag)
    {
        rsk_offset_x -= gui_get_string_width((UI_string_type) str_ptr);
    }

    if (g_camera_cntx.is_rsk_pressed)
    {
        rsk_offset_x++;
        rsk_offset_y++;
    }

    mmi_camera_wb_draw_style_text(
        str_ptr,
        rsk_offset_x,
        rsk_offset_y,
        &g_camera_cntx.active_camera_osd_ptr->softkey.rsk);

#ifdef __CAMERA_FEATURE_TOUCH_SCREEN__
    g_camera_cntx.touch_rsk.offset_x = rsk_offset_x;
    g_camera_cntx.touch_rsk.offset_y = rsk_offset_y;
    g_camera_cntx.touch_rsk.width = str_width;
    g_camera_cntx.touch_rsk.height = str_height;
#endif /* __CAMERA_FEATURE_TOUCH_SCREEN__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_preview_draw_icon
 * DESCRIPTION
 *  draw preview icon
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_preview_draw_icon()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    S32 x1, y1, x2, y2;
    U8 str1[40];
    S32 img_width, img_height;
    S32 str1_width, str1_height, str1_offset_x;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    x1 = g_camera_menu_cntx.wb_setting.left_arrow.offset_x;
    x2 = g_camera_menu_cntx.wb_setting.right_arrow.offset_x;
    y1 = g_camera_menu_cntx.wb_setting.left_arrow.offset_y;
    y2 = g_camera_menu_cntx.wb_setting.right_arrow.offset_y;

    mmi_ucs2ncpy(
        (PS8) str1,
        (PS8) GetString((U16) (g_camera_menu_cntx.wb_setting.wb_selected + STR_ID_CAMERA_WB_START + 1)),
        CAMERA_HINT_CHAR_COUNT);

    gui_set_text_clip(x1, y1, x2, y2);

    gui_measure_string((UI_string_type) str1, &str1_width, &str1_height);

    gdi_layer_reset_clip();
    gui_reset_text_clip();

    gdi_image_get_dimension_id(IMG_ID_CAMERA_OSD_WB_LEFT_ARROW_DOWN, &img_width, &img_height);

    str1_offset_x = (x2 + x1 + img_width - str1_width) >> 1;

    mmi_camera_wb_draw_style_text(
        (PS8) str1,
        x1 + str1_offset_x,
        y1,
        &g_camera_cntx.active_camera_osd_ptr->hint_box.style_text);

    //      if(g_camera_menu_cntx.wb_setting.left_arrow.is_press == TRUE)
    //              gdi_image_draw_id(x1,y1,IMG_ID_CAMERA_OSD_WB_LEFT_ARROW_DOWN);
    //      else
    //              gdi_image_draw_id(x1,y1,IMG_ID_CAMERA_OSD_WB_LEFT_ARROW_UP);

    //      if(g_camera_menu_cntx.wb_setting.right_arrow.is_press == TRUE)
    //              gdi_image_draw_id(x2,y2,IMG_ID_CAMERA_OSD_WB_RIGHT_ARROW_DOWN);
    //      else
    //              gdi_image_draw_id(x2,y2,IMG_ID_CAMERA_OSD_WB_RIGHT_ARROW_UP);
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (g_camera_menu_cntx.wb_setting.wb_selected == CAMERA_SETTING_WB_MANUAL)
    {

        /* draw capture icon in the osd */
        gdi_image_draw_id(
            g_camera_cntx.active_camera_osd_ptr->capture.offset_x,
            g_camera_cntx.active_camera_osd_ptr->capture.offset_y,
            (U16) (IMG_ID_CAMERA_OSD_CAPTURE));
    }
#endif
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_draw_bg
 * DESCRIPTION
 *  draw background
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_draw_bg(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    gdi_layer_push_and_set_active(g_camera_cntx.osd_layer_handle0);
    gdi_layer_toggle_double();

    /* clear background */
    gdi_layer_clear(GDI_COLOR_TRANSPARENT);

    mmi_camera_wb_preview_draw_softkey();

    mmi_camera_wb_preview_draw_icon();

    gdi_layer_pop_and_restore_active();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_wb_without_saving
 * DESCRIPTION
 *  exit wb without setting
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_wb_without_saving(void)
{
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_menu_cntx.wb_setting.is_first_in == FALSE)
    {
        mdi_camera_restore_mwb();
    }
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

    DeleteNHistory(1);
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_wb_manual_value
 * DESCRIPTION
 *  set wb value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_wb_manual_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.setting.wb = g_camera_menu_cntx.wb_setting.wb_selected;

    DISPLAY_POPUP_DONE();
    DeleteNHistory(3);

    mmi_camera_store_setting();

    return;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_wb_value
 * DESCRIPTION
 *  set wb value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_wb_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (g_camera_menu_cntx.wb_setting.wb_selected == CAMERA_SETTING_WB_MANUAL)
    {
        mmi_camera_entry_wb_manual_help_screen();
        return;
    }
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

    g_camera_cntx.setting.wb = g_camera_menu_cntx.wb_setting.wb_selected;

    DISPLAY_POPUP_DONE();

    DeleteNHistory(1);
    mmi_camera_store_setting();

    return;
}

/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_dummy_func
 * DESCRIPTION
 *  dummy function
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_wb_dummy_func(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* empty function */
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_highlight_hdlr
 * DESCRIPTION
 *  
 * PARAMETERS
 *  idx     [IN]        
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set selected effect */
    g_camera_menu_cntx.wb_setting.wb_selected = idx;
#ifdef __CAMERA_FEATURE_WB_MANUAL__
    if (idx == CAMERA_SETTING_WB_MANUAL)
    {
        SetKeyHandler(mmi_camera_entry_wb_manual_help_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
    else
        SetKeyHandler(mmi_camera_wb_dummy_func, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_wb_screen
 * DESCRIPTION
 *  exit wb screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_wb_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* stop preview */
    mdi_camera_preview_stop();

	/* turn on/of 3D sound*/
#ifdef __MMI_AUDIO_REVERB_EFFECT__
    if (g_camera_cntx.is_3d_sound_on == TRUE)
        mdi_audio_reverb_turn_on();
#endif /* __MMI_AUDIO_REVERB_EFFECT__ */

    /* shut down camera */
    mdi_camera_power_off();

    /* resume alignment timer */
    UI_enable_alignment_timers();

    /* let MMI can sleep */
    TurnOffBacklight();

    /* enable multi-layer */
    gdi_layer_multi_layer_disable();

    /* resume background audio */
    mdi_audio_resume_background_play();

    /* re-enable keypad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_ENABLED);

    /* free buffer */
    gui_free(g_camera_cntx.storage_filepath);
    g_camera_cntx.storage_filepath = NULL;

    gdi_layer_push_and_set_active(g_camera_cntx.base_layer_handle);
    gdi_layer_resize(LCD_WIDTH, LCD_HEIGHT);
    gdi_layer_clear(GDI_COLOR_WHITE);
    gdi_layer_pop_and_restore_active();

#if defined(__CAMERA_OSD_HORIZONTAL__)
    gdi_lcd_set_rotate(GDI_LAYER_ROTATE_0);
    gdi_lcd_set_rotate_by_layer(FALSE);
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    #ifdef __MMI_TVOUT__
    if (mdi_tvout_is_enable())
    {
        mdi_tvout_set_mode(MDI_TV_MODE_LCD_SCR, 0, 0);
    }
    #endif /* __MMI_TVOUT__ */ 

    /* free resource */
    mmi_camera_wb_free_resource();

    /* this will force title status to redraw */
    entry_full_screen();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_wb_preview_state
 * DESCRIPTION
 *  exit wb preview state
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_wb_preview_state(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* there are some setting changed by using hotkey or preview panel, save them to NVRAM */
    mmi_camera_store_setting();
    return;
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_left_softkey_pressed
 * DESCRIPTION
 *  press left softkey
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_left_softkey_pressed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_lsk_pressed = TRUE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_left_softkey_released
 * DESCRIPTION
 *  release left softkey
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_left_softkey_released(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_lsk_pressed = FALSE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);
    mmi_camera_set_wb_manual_value();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_right_softkey_pressed
 * DESCRIPTION
 *  press right softkey
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_right_softkey_pressed(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_rsk_pressed = TRUE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_right_softkey_released
 * DESCRIPTION
 *  release right softkey
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_right_softkey_released(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_rsk_pressed = FALSE;
    mmi_camera_wb_draw_bg();
    gdi_layer_blt_previous(0, 0, g_camera_cntx.base_UI_device_width - 1, g_camera_cntx.base_UI_device_height - 1);
    mmi_camera_exit_wb_without_saving();
}

#ifdef __CAMERA_FEATURE_WB_MANUAL__


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_adjust_parameters
 * DESCRIPTION
 *  start adjust mwb
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_adjust_parameters(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_capturing = TRUE;

    g_camera_cntx.last_error
        = mdi_camera_adjust_mwb(
            GDI_LAYER_ENABLE_LAYER_0,
            0,
            0,
            g_camera_menu_cntx.wb_setting.preview_width,
            g_camera_menu_cntx.wb_setting.preview_height);
    mmi_camera_capture_play_sound();

    g_camera_cntx.is_capturing = FALSE;

    if (g_camera_cntx.last_error != MDI_RES_CAMERA_SUCCEED)
    {
        mmi_camera_wb_display_error_popup();
        return;
    }
    else
    {
        mmi_camera_wb_show_mwb_cal_animation();
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_display_error_popup
 * DESCRIPTION
 *  display error mesg.
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_display_error_popup(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    MMI_ID_TYPE string_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* if has error */
    if (g_camera_cntx.last_error != MDI_RES_CAMERA_SUCCEED)
    {
        ClearInputEventHandler(MMI_DEVICE_KEY);
        string_id = mmi_camera_get_error_string_by_error_enum((S32)g_camera_cntx.last_error);

        DISPLAY_POPUP_DONE();

        g_camera_cntx.last_error = MDI_RES_CAMERA_SUCCEED;
    }

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_show_mwb_cal_animation
 * DESCRIPTION
 *  show animation while cal mwb
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_wb_show_mwb_cal_animation()
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* play a 3 secs animation */

    mmi_camera_entry_wb_preview_state();
}
#endif /* __CAMERA_FEATURE_WB_MANUAL__ */ 

#ifdef __CAMERA_AUTOFOCUS__
/*****************************************************************************
*
* Camera Autofocus Setting
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_autofocus
 * DESCRIPTION
 *  autofocus setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_autofocus(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_AUTOFOCUS_START + g_camera_cntx.setting.af_meter + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_autofocus
 * DESCRIPTION
 *  autofocus setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_autofocus(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_autofocus_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_autofocus_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_autofocus_value
 * DESCRIPTION
 *  set autofocus
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_autofocus_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DISPLAY_POPUP_DONE();

    DeleteNHistory(1);

    g_camera_cntx.setting.af_meter = (U16) GetCurrHiliteID();
    mmi_camera_store_setting();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_autofocus_screen
 * DESCRIPTION
 *  entry autofocus setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_autofocus_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_AUTOFOCUS_METERING, NULL, mmi_camera_entry_autofocus_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_AUTOFOCUS_METERING);

    nItems = GetNumOfChild(MENU_ID_CAMERA_AUTOFOCUS_METERING);
    GetSequenceStringIds(MENU_ID_CAMERA_AUTOFOCUS_METERING, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_AUTOFOCUS_METERING, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_AUTOFOCUS_METERING);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory11Screen(
        STR_ID_CAMERA_AUTOFOCUS_METERING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.af_meter, /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_autofocus_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __CAMERA_AUTOFOCUS__ */ 

#ifdef __CAMERA_AUTOFOCUS_MODE__
/*****************************************************************************
*
* Camera Autofocus MODE Setting
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_autofocus_mode
 * DESCRIPTION
 *  autofocus setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_autofocus_mode(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_AUTOFOCUS_MODE_START + g_camera_cntx.setting.af_mode + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_autofocus_mode
 * DESCRIPTION
 *  autofocus setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_autofocus_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_autofocus_mode_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_autofocus_mode_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_autofocus_mode_value
 * DESCRIPTION
 *  set autofocus
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_autofocus_mode_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DISPLAY_POPUP_DONE();

    DeleteNHistory(1);

    g_camera_cntx.setting.af_mode = (U16) GetCurrHiliteID();

    mmi_camera_store_setting();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_autofocus_mode_screen
 * DESCRIPTION
 *  entry autofocus setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_autofocus_mode_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_AUTOFOCUS_MODE, NULL, mmi_camera_entry_autofocus_mode_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_AUTOFOCUS_MODE);

    nItems = GetNumOfChild(MENU_ID_CAMERA_AUTOFOCUS_MODE);
    GetSequenceStringIds(MENU_ID_CAMERA_AUTOFOCUS_MODE, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_AUTOFOCUS_MODE, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_AUTOFOCUS_MODE);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory11Screen(
        STR_ID_CAMERA_AUTOFOCUS_MODE,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.af_mode,  /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_autofocus_mode_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __CAMERA_AUTOFOCUS_MODE__ */ 

/*****************************************************************************
*
* Camera Option Menu     
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_to_imgview
 * DESCRIPTION
 *  link to image viewer
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_to_imgview(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_imgview_entry_app, KEY_EVENT_UP);
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_imgview_entry_app, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_option_menu_screen
 * DESCRIPTION
 *  option menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_option_menu_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[16];
    U16 ItemIcons[16];
    U16 nItems;
    U8 *guiBuffer;
    U8 *PopUpList[32];
    S32 i;
    BOOL is_hide = TRUE;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_OPTION, NULL, mmi_camera_entry_option_menu_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    if (g_camera_cntx.is_external_request == FALSE)
    {
        mmi_frm_unhide_menu_item(MENU_ID_CAMERA_TO_IMGVIEW);
    }
    else
    {
        mmi_frm_hide_menu_item(MENU_ID_CAMERA_TO_IMGVIEW);
    }

#ifdef __CAMERA_AUTOFOCUS__
    /* check dsc mode, if it is not ADVANCE mode, disable focus mode menu */
#if defined(__CAMERA_DSC_MODE_SHUTTER_PRI__)
    if (g_camera_cntx.setting.dsc_mode == CAMERA_SETTING_DSC_MODE_SHUTTER_PRI)
    {
        is_hide = FALSE;
    }
#endif /* defined(__CAMERA_DSC_MODE_SHUTTER_PRI__) */ 
#if defined(__CAMERA_DSC_MODE_APERTURE_PRI__)
    if (g_camera_cntx.setting.dsc_mode == CAMERA_SETTING_DSC_MODE_APERTURE_PRI)
    {
        is_hide = FALSE;
    }
#endif /* defined(__CAMERA_DSC_MODE_APERTURE_PRI__) */ 

    if (is_hide)
    {
        mmi_frm_hide_menu_item(MENU_ID_CAMERA_AUTOFOCUS_MODE);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_CAMERA_AUTOFOCUS_MODE);
    }

    /* if only support one focus metering, disable the option menu */
#ifdef __CAMERA_AUTOFOCUS_METERING__
    if (CAMERA_SETTING_AUTOFOCUS_COUNT < 2)
    {
        mmi_frm_hide_menu_item(MENU_ID_CAMERA_AUTOFOCUS_METERING);
    }
#endif /* __CAMERA_AUTOFOCUS_METERING__ */ 
#endif /* __CAMERA_AUTOFOCUS__ */ 

#ifdef __CAMERA_FEATURE_ISO_SUPPORT__    
    is_hide = TRUE;

    #if defined(__CAMERA_DSC_MODE_NIGHT__)
        if(g_camera_cntx.setting.dsc_mode != CAMERA_SETTING_DSC_MODE_NIGHT)
            is_hide = FALSE;
    #endif

    if (is_hide == TRUE)
    {
        mmi_frm_hide_menu_item(MENU_ID_CAMERA_ISO);
    }
    else
    {
        mmi_frm_unhide_menu_item(MENU_ID_CAMERA_ISO);
    }
#endif

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_OPTION);
    nItems = GetNumOfChild_Ext(MENU_ID_CAMERA_OPTION);
    GetSequenceStringIds_Ext(MENU_ID_CAMERA_OPTION, ItemList);
    GetSequenceImageIds_Ext(MENU_ID_CAMERA_OPTION, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_OPTION);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    for (i = 0; i < nItems; i++)
    {
        PopUpList[i] = NULL;
    }

    ConstructHintsList(MENU_ID_CAMERA_OPTION, PopUpList);

    ShowCategory52Screen(
        STR_GLOBAL_OPTIONS,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        ItemIcons,
        (U8 **) PopUpList,
        0,
        0,
        guiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

/*****************************************************************************
*
* Camera Storage Menu     
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_storage
 * DESCRIPTION
 *  storage hint
 * PARAMETERS
 *  index       [IN]        Storage id
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_storage(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    if (FS_NO_ERROR != FS_GetDevStatus(g_imgview_context.storage ,FS_MOUNT_STATE_ENUM))
    {
        g_imgview_context.storage = (U16) MMI_PUBLIC_DRV;
    }

    mmi_fmgr_get_drive_name((S8)g_imgview_context.storage, (S8*)hintData[(index)], (FMGR_MAX_DRIVE_NAME_LEN+1)*ENCODING_LENGTH);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_storage
 * DESCRIPTION
 *  storage highlight
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_storage(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_storage_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_storage_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_storage_value
 * DESCRIPTION
 *  set storage value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_storage_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    mmi_fmgr_get_drive_letter_by_inline_index((U8)g_camera_menu_cntx.cur_select_storage_idx, (S8*)&g_imgview_context.storage);

    g_imgview_context.imgview_rotate = g_camera_cntx.osd_rotate;
    mmi_imgview_get_drive_callback((S8)g_imgview_context.storage);
    /* Reset */
    g_imgview_context.imgview_rotate = 0;
}

void mmi_camera_highlight_storage_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.cur_select_storage_idx = idx;
    SetLeftSoftkeyFunction(mmi_camera_set_storage_value, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_set_storage_value, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_storage_callback
 * DESCRIPTION
 *  set storage callback
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_storage_callback(S8 drv_letter)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

    /***************************************************
     * for new storage error handling machenism 
     ***************************************************/
    if (drv_letter == 0 && !IsScreenPresent(SCR_ID_CAMERA_OPTION))
    {
        DeleteUptoScrID(SCR_ID_CAMERA_APP);
        DeleteNHistory(2);
        g_imgview_context.is_storage_ready = TRUE;
        return;
    }
    mmi_imgview_get_drive_callback(drv_letter);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_select_storage_screen_without_selecting
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_select_storage_screen_without_selecting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/    

    /***************************************************
     * for new storage error handling machenism 
     ***************************************************/
    if (IsScreenPresent(SCR_ID_CAMERA_OPTION)==MMI_FALSE)
    {
        DeleteUptoScrID(SCR_ID_CAMERA_APP);
        DeleteNHistory(1);
        g_imgview_context.is_storage_ready = TRUE;
    }

    GoBackHistory();
}



/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_storage_screen
 * DESCRIPTION
 *  entry storage screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_storage_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 icon_list[FMGR_TOTAL_STORAGE];
    PU8 pop_ptr_list[FMGR_TOTAL_STORAGE];
    U8 *guiBuffer;
    U8 storage_total_num;
    U32 *drv_inline_list_p;
    U8 highlight_idx;
    S32 i;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_STORAGE, NULL, mmi_camera_entry_storage_screen, NULL);
#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif
    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_STORAGE);

    mmi_fmgr_get_exist_storage_inline_list(
        (S8)g_imgview_context.storage,
        &storage_total_num,
        (PU32)&drv_inline_list_p,
        &highlight_idx);

    RegisterHighlightHandler(mmi_camera_highlight_storage_hdlr);

    for (i = 0; i < storage_total_num; i++)
    {
        icon_list[i] = (U16) (IMG_GLOBAL_L1 + i);
    }

    for (i = 0; i < storage_total_num; i++)
    {
        pop_ptr_list[i] = NULL;
    }

    ShowCategory353Screen(
        (U8*) GetString(STR_ID_CAMERA_STORAGE),
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        storage_total_num,
        (PU8*)drv_inline_list_p,
        icon_list,
        pop_ptr_list,
        0,
        (S32)highlight_idx,
        guiBuffer);

    SetRightSoftkeyFunction(mmi_camera_exit_select_storage_screen_without_selecting, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_exit_select_storage_screen_without_selecting, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

    SetLeftSoftkeyFunction(mmi_camera_set_storage_value, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_set_storage_value, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}

/***************************************************************************** 
*
* Custom FX
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_draw_hilight_item
 * DESCRIPTION
 *  redraw hilight item
 * PARAMETERS
 *  cur_idx             [IN]        Current selected index
 *  prev_idx            [IN]        
 *  previ_idx(?)        [IN]        Previous selected index
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_draw_hilight_item(U16 cur_idx, U16 prev_idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    custom_fx_slider_struct *slider_p = NULL;
    S32 x1, y1, x2, y2;
    S32 spacing;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* de hilight previous */
    switch (prev_idx)
    {
        case CUSTOM_FX_BRIGHTNESS:
            slider_p = &g_camera_custom_fx_cntx.brightness_slider;
            break;

        case CUSTOM_FX_SATURATION:
            slider_p = &g_camera_custom_fx_cntx.saturation_slider;
            break;

        case CUSTOM_FX_CONTRAST:
            slider_p = &g_camera_custom_fx_cntx.contrast_slider;
            break;

        case CUSTOM_FX_HUE:
            slider_p = &g_camera_custom_fx_cntx.hue_slider;
            break;
    }

    spacing = (g_camera_custom_fx_cntx.spacing >> 1);

    x1 = spacing;
    x2 = UI_device_width - spacing - 1;
    y1 = slider_p->offset_y - spacing;
    y2 = slider_p->offset_y + spacing + slider_p->height - 1;

    gdi_draw_rect(x1, y1, x2, y2, GDI_COLOR_WHITE);

    /* highlight */
    switch (cur_idx)
    {
        case CUSTOM_FX_BRIGHTNESS:
            slider_p = &g_camera_custom_fx_cntx.brightness_slider;
            break;

        case CUSTOM_FX_SATURATION:
            slider_p = &g_camera_custom_fx_cntx.saturation_slider;
            break;

        case CUSTOM_FX_CONTRAST:
            slider_p = &g_camera_custom_fx_cntx.contrast_slider;
            break;

        case CUSTOM_FX_HUE:
            slider_p = &g_camera_custom_fx_cntx.hue_slider;
            break;
    }

    spacing = (g_camera_custom_fx_cntx.spacing >> 1);

    x1 = spacing;
    x2 = UI_device_width - spacing - 1;
    y1 = slider_p->offset_y - spacing;
    y2 = slider_p->offset_y + spacing + slider_p->height - 1;

    gdi_draw_rect(x1, y1, x2, y2, GDI_COLOR_BLACK);

}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_key_press_cyclic
 * DESCRIPTION
 *  custom fx left or right arrow key long press cyclic handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_key_press_cyclic(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_custom_fx_cntx.is_right_arrow_press)
    {
        mmi_camera_custom_fx_edit_right_arrow_press();
        gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
    }

    if (g_camera_custom_fx_cntx.is_left_arrow_press)
    {
        mmi_camera_custom_fx_edit_left_arrow_press();
        gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
    }
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_right_arrow_release
 * DESCRIPTION
 *  custom fx left arrow key release
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_right_arrow_release(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_right_arrow_press = FALSE;
    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_right_arrow_press
 * DESCRIPTION
 *  custom fx right arrow key release
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_right_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_right_arrow_press = TRUE;

    gui_lock_double_buffer();

    switch (g_camera_custom_fx_cntx.select_idx)
    {
        case CUSTOM_FX_BRIGHTNESS:

            if (g_camera_custom_fx_cntx.brightness_slider.value + 5 <= 100)
            {
                g_camera_custom_fx_cntx.brightness_slider.value += 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.brightness_slider.slide_bar,
                g_camera_custom_fx_cntx.brightness_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.brightness_slider.slide_bar);
            mdi_camera_update_para_brightness((U16) (g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_SATURATION:

            if (g_camera_custom_fx_cntx.saturation_slider.value + 5 <= 100)
            {
                g_camera_custom_fx_cntx.saturation_slider.value += 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.saturation_slider.slide_bar,
                g_camera_custom_fx_cntx.saturation_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.saturation_slider.slide_bar);
            mdi_camera_update_para_saturation((U16) (g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_CONTRAST:

            if (g_camera_custom_fx_cntx.contrast_slider.value + 5 <= 100)
            {
                g_camera_custom_fx_cntx.contrast_slider.value += 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.contrast_slider.slide_bar,
                g_camera_custom_fx_cntx.contrast_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.contrast_slider.slide_bar);
            mdi_camera_update_para_contrast((U16) (g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_HUE:

            if (g_camera_custom_fx_cntx.hue_slider.value + 10 <= 360)
            {
                g_camera_custom_fx_cntx.hue_slider.value += 10;
            }
            else
            {
                g_camera_custom_fx_cntx.hue_slider.value = 0;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.hue_slider.slide_bar,
                g_camera_custom_fx_cntx.hue_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.hue_slider.slide_bar);
            mdi_camera_update_para_hue(g_camera_custom_fx_cntx.hue_slider.value);

            break;
    }

    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);

    gui_unlock_double_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);

    gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);

}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_left_arrow_release
 * DESCRIPTION
 *  custom fx left arrow key release
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_left_arrow_release(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_left_arrow_press = FALSE;
    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_left_arrow_press
 * DESCRIPTION
 *  custom fx left arrow key press
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_left_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_custom_fx_cntx.is_left_arrow_press = TRUE;

    gui_lock_double_buffer();

    switch (g_camera_custom_fx_cntx.select_idx)
    {
        case CUSTOM_FX_BRIGHTNESS:

            if (g_camera_custom_fx_cntx.brightness_slider.value - 5 >= 0)
            {
                g_camera_custom_fx_cntx.brightness_slider.value -= 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.brightness_slider.slide_bar,
                g_camera_custom_fx_cntx.brightness_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.brightness_slider.slide_bar);
            mdi_camera_update_para_brightness((U16) (g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_SATURATION:

            if (g_camera_custom_fx_cntx.saturation_slider.value - 5 >= 0)
            {
                g_camera_custom_fx_cntx.saturation_slider.value -= 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.saturation_slider.slide_bar,
                g_camera_custom_fx_cntx.saturation_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.saturation_slider.slide_bar);
            mdi_camera_update_para_saturation((U16) (g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_CONTRAST:

            if (g_camera_custom_fx_cntx.contrast_slider.value - 5 >= 0)
            {
                g_camera_custom_fx_cntx.contrast_slider.value -= 5;
            }
            else
            {
                gui_unlock_double_buffer();
                return;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.contrast_slider.slide_bar,
                g_camera_custom_fx_cntx.contrast_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.contrast_slider.slide_bar);
            mdi_camera_update_para_contrast((U16) (g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100));

            break;

        case CUSTOM_FX_HUE:

            if (g_camera_custom_fx_cntx.hue_slider.value - 10 >= 0)
            {
                g_camera_custom_fx_cntx.hue_slider.value -= 10;
            }
            else
            {
                g_camera_custom_fx_cntx.hue_slider.value = 360;
            }

            gui_set_horizontal_slide_value(
                &g_camera_custom_fx_cntx.hue_slider.slide_bar,
                g_camera_custom_fx_cntx.hue_slider.value);
            gui_show_horizontal_slide(&g_camera_custom_fx_cntx.hue_slider.slide_bar);
            mdi_camera_update_para_hue(g_camera_custom_fx_cntx.hue_slider.value);

            break;
    }

    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);
    gui_unlock_double_buffer();

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);

    gui_start_timer(100, mmi_camera_custom_fx_edit_key_press_cyclic);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_up_arrow_press
 * DESCRIPTION
 *  custom fx up arrow key press
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_up_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 prev_idx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prev_idx = g_camera_custom_fx_cntx.select_idx;

    if (g_camera_custom_fx_cntx.select_idx > CUSTOM_FX_BRIGHTNESS)
    {
        g_camera_custom_fx_cntx.select_idx--;
    }
    else
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_HUE;
    }

    gdi_layer_lock_frame_buffer();

    mmi_camera_custom_fx_edit_draw_title();
    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, prev_idx);
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);

    gdi_layer_unlock_frame_buffer();

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_down_arrow_press
 * DESCRIPTION
 *  custom fx down arrow key press
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_down_arrow_press(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 prev_idx;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    prev_idx = g_camera_custom_fx_cntx.select_idx;

    if (g_camera_custom_fx_cntx.select_idx < CUSTOM_FX_HUE)
    {
        g_camera_custom_fx_cntx.select_idx++;
    }
    else
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_BRIGHTNESS;
    }

    gdi_layer_lock_frame_buffer();

    mmi_camera_custom_fx_edit_draw_title();
    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, prev_idx);
    mmi_camera_custom_fx_edit_draw_value(g_camera_custom_fx_cntx.select_idx);

    gdi_layer_unlock_frame_buffer();

    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_draw_value
 * DESCRIPTION
 *  draw item's current value
 * PARAMETERS
 *  idx     [IN]        Index to be draw
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_draw_value(U16 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    custom_fx_slider_struct *slider_p = NULL;
    S32 offset_x;
    S32 offset_y;
    S32 width;
    S32 height;
    S8 buf[10];
    S8 buf_UCS2[20];
    S32 str_width;
    S32 str_height;
    U16 value = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (idx)
    {
        case CUSTOM_FX_BRIGHTNESS:
            slider_p = &g_camera_custom_fx_cntx.brightness_slider;
            value = g_camera_custom_fx_cntx.brightness_slider.value;
            break;

        case CUSTOM_FX_SATURATION:
            slider_p = &g_camera_custom_fx_cntx.saturation_slider;
            value = g_camera_custom_fx_cntx.saturation_slider.value;
            break;

        case CUSTOM_FX_CONTRAST:
            slider_p = &g_camera_custom_fx_cntx.contrast_slider;
            value = g_camera_custom_fx_cntx.contrast_slider.value;
            break;

        case CUSTOM_FX_HUE:
            slider_p = &g_camera_custom_fx_cntx.hue_slider;
            value = g_camera_custom_fx_cntx.hue_slider.value;
            break;
    }

    gui_reset_text_clip();
    gdi_layer_reset_clip();

    sprintf(buf, "%d", value);
    mmi_asc_to_ucs2(buf_UCS2, buf);
    gui_measure_string((UI_string_type) buf_UCS2, &str_width, &str_height);

    offset_x = slider_p->offset_x + slider_p->width + (g_camera_custom_fx_cntx.spacing >> 1);
    offset_y = slider_p->offset_y;
    width = g_camera_custom_fx_cntx.num_width;
    height = g_camera_custom_fx_cntx.num_height;

    gdi_draw_solid_rect(offset_x, offset_y, offset_x + width - 1, offset_y + height - 1, GDI_COLOR_WHITE);

    if (r2lMMIFlag)
    {
        offset_x += gui_get_string_width((UI_string_type) buf_UCS2);
    }

    offset_x += width - str_width;
    offset_y += ((height - str_height) >> 1);

    gui_move_text_cursor(offset_x, offset_y);
    gui_set_font(&MMI_medium_font);
    gui_set_text_color(gui_color(0, 0, 0));
    gui_print_text((UI_string_type) buf_UCS2);

}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_custom_fx_edit_save
 * DESCRIPTION
 *  save edited value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_entry_custom_fx_edit_save(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* rescale brightness contrast hue from 0-100 back to 0-255 */
    g_camera_cntx.setting.fx_brightness[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100;

    g_camera_cntx.setting.fx_saturation[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100;

    g_camera_cntx.setting.fx_contrast[g_camera_custom_fx_cntx.fx_idx] =
        g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100;

    g_camera_cntx.setting.fx_hue[g_camera_custom_fx_cntx.fx_idx] = g_camera_custom_fx_cntx.hue_slider.value;

    DISPLAY_POPUP_DONE();
    DeleteNHistory(1);

    mmi_camera_store_setting();
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_clam_close_hdlr
 * DESCRIPTION
 *  clam close handler
 * PARAMETERS
 *  ptr     [IN]        Pointer to message
 * RETURNS
 *  U8
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
U8 mmi_camera_custom_fx_clam_close_hdlr(mmi_frm_int_event_type interrupt_event)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__MMI_CLAMSHELL__) 
    if (interrupt_event & MMI_FRM_INT_CLAM_CLOSE)
    {
        GoBackHistory();
        return FALSE;
    }
#endif /* defined(__MMI_CLAMSHELL__) */ 

    /* return false means will pass this interrut to default handler */
    return FALSE;
}

#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_custom_fx_edit_sublcd_screen
 * DESCRIPTION
 *  exit sublcd screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
#ifdef __MMI_SUBLCD__
void mmi_camera_exit_custom_fx_edit_sublcd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SubLCDHistoryNode SubLCDHistory;

    /* someone may exit/draw sublcd first then exit mainlcd, this may cause driver assert */
    mdi_camera_preview_stop();

    SubLCDHistory.entryFuncPtr = mmi_camera_entry_custom_fx_edit_sublcd_screen;
    AddSubLCDHistory(&SubLCDHistory);
}
#endif /* __MMI_SUBLCD__ */ 
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_custom_fx_edit_sublcd_screen
 * DESCRIPTION
 *  entry sublcd screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
#ifdef __MMI_SUBLCD__
void mmi_camera_entry_custom_fx_edit_sublcd_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ExecSubLCDCurrExitHandler();
    ShowCategory331Screen();
    mmi_camera_sublcd_draw_icon();
    SetSubLCDExitHandler(mmi_camera_exit_custom_fx_edit_sublcd_screen);
}
#endif /* __MMI_SUBLCD__ */ 
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_custom_fx_edit_draw_title
 * DESCRIPTION
 *  draw custom fx's title, will draw current selected item's name
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_custom_fx_edit_draw_title(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_camera_custom_fx_cntx.select_idx)
    {
        case CUSTOM_FX_BRIGHTNESS:
            ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_BRIGHTNESS));
            break;

        case CUSTOM_FX_SATURATION:
            ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_SATURATION));
            break;

        case CUSTOM_FX_CONTRAST:
            ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_CONTRAST));
            break;

        case CUSTOM_FX_HUE:
            ChangeTitle(0, (PU8) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_HUE));
            break;
    }

    draw_title();

}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_custom_fx_edit_screen
 * DESCRIPTION
 *  exit edit screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_exit_custom_fx_edit_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* stop preview and power off */
    mdi_camera_preview_stop();
    mdi_camera_power_off();

    /* merge layers */
    gdi_layer_flatten_previous_to_base();

    /* free layers */
    gdi_layer_free(g_camera_custom_fx_cntx.preview_wnd_layer);
    gdi_layer_multi_layer_disable();

    gui_cancel_timer(mmi_camera_custom_fx_edit_key_press_cyclic);

    /* re-enable keypad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_ENABLED);

    /* un-hook clam close msg */
    mmi_frm_clear_interrupt_event_handler(MMI_FRM_INT_CLAM_CLOSE);
#ifdef __MMI_SUBLCD__
    /* leave sublcd screen */
    GoBackSubLCDHistory();
#endif /* __MMI_SUBLCD__ */ 
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_custom_fx_edit_screen
 * DESCRIPTION
 *  entry custom fx screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_entry_custom_fx_edit_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    S32 str_width;
    S32 str_height;
    S32 preview_wnd_height;
    S32 preview_wnd_width;
    S32 preview_wnd_offset_x;
    S32 preview_wnd_offset_y;
    S32 num_width;
    S32 num_height;
    S32 spacing;
    S32 image_width;
    S32 image_height;
    S32 image_spacing;
    S32 image_offset_x;
    S32 image_offset_y;
    S32 remain;

    mdi_camera_setting_struct camera_setting_data;
    mdi_camera_preview_struct camera_preview_data;
    custom_fx_slider_struct *slider_p;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(
        STR_ID_CAMERA_EFFECT_CUSTOM_FX_EDIT_EFFECT,
        mmi_camera_exit_custom_fx_edit_screen,
        mmi_camera_entry_custom_fx_edit_screen,
        NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    /* entry sublcd - avoid sulcd update */
#ifdef __MMI_SUBLCD__
    ForceSubLCDScreen(mmi_camera_entry_custom_fx_edit_sublcd_screen);
#endif 

    guiBuffer = GetCurrGuiBuffer(STR_ID_CAMERA_EFFECT_CUSTOM_FX_EDIT_EFFECT);

    /* force all playing keypad tone off */
    AudioStopReq(GetCurKeypadTone());

    /* disable key pad tone */
    mmi_frm_kbd_set_tone_state(MMI_KEY_TONE_DISABLED);

    g_camera_custom_fx_cntx.is_left_arrow_press = FALSE;
    g_camera_custom_fx_cntx.is_right_arrow_press = FALSE;

    /* if first time enter */
    if (guiBuffer == NULL)
    {
        g_camera_custom_fx_cntx.select_idx = CUSTOM_FX_BRIGHTNESS;

        /* rescale brightness contrast stauration from 0-255 to 0-100 */
        g_camera_custom_fx_cntx.brightness_slider.value =
            g_camera_cntx.setting.fx_brightness[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.saturation_slider.value =
            g_camera_cntx.setting.fx_saturation[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.contrast_slider.value =
            g_camera_cntx.setting.fx_contrast[g_camera_custom_fx_cntx.fx_idx] * 100 / 255;
        g_camera_custom_fx_cntx.hue_slider.value = g_camera_cntx.setting.fx_hue[g_camera_custom_fx_cntx.fx_idx];

        /* sometime rounding will get a value like 4, or 1, and we use 5 as out minium step */
        /* rounding them */

        /* brightness rounding */
        remain = g_camera_custom_fx_cntx.brightness_slider.value % 5;

        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.brightness_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.brightness_slider.value += (5 - remain);
            }
        }

        /* saturation rounding */
        remain = g_camera_custom_fx_cntx.saturation_slider.value % 5;

        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.saturation_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.saturation_slider.value += (5 - remain);
            }
        }

        /* contrast rounding */
        remain = g_camera_custom_fx_cntx.contrast_slider.value % 5;

        if (remain != 0)
        {
            if (remain < 3)
            {
                g_camera_custom_fx_cntx.contrast_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.contrast_slider.value += (5 - remain);
            }
        }

        /* hue rounding */
        remain = g_camera_custom_fx_cntx.hue_slider.value % 10;

        if (remain != 0)
        {
            if (remain < 5)
            {
                g_camera_custom_fx_cntx.hue_slider.value -= remain;
            }
            else
            {
                g_camera_custom_fx_cntx.hue_slider.value += (10 - remain);
            }
        }

    }

    /* avoid draw empty category first */
    gdi_layer_lock_frame_buffer();

    /* draw a emptry category */
    ShowCategory221Screen(
        STR_GLOBAL_OK,  /* just give it a string, for category221 to draw status and title bar */
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_SAVE,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        GDI_COLOR_WHITE,
        NULL);

    gdi_layer_unlock_frame_buffer();

    mmi_camera_custom_fx_edit_draw_title();

    SetKeyHandler(mmi_camera_custom_fx_edit_down_arrow_press, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_custom_fx_edit_up_arrow_press, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_custom_fx_edit_left_arrow_press, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_custom_fx_edit_right_arrow_press, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_custom_fx_edit_left_arrow_release, KEY_LEFT_ARROW, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_custom_fx_edit_right_arrow_release, KEY_RIGHT_ARROW, KEY_EVENT_UP);

    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_edit_save, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);

    gdi_layer_lock_frame_buffer();

    gui_set_font(&MMI_medium_font);
    gui_measure_string((UI_string_type) GetString(STR_ID_CAMERA_EFFECT_CUSTOM_FX_BRIGHTNESS), &str_width, &str_height);
    gui_measure_string((UI_string_type) L"255", &num_width, &num_height);

    spacing = str_height >> 1;
    g_camera_custom_fx_cntx.spacing = spacing;
    g_camera_custom_fx_cntx.num_width = num_width;
    g_camera_custom_fx_cntx.num_height = num_height;

    preview_wnd_height = MMI_content_height - (str_height * 4 + spacing * 6);
    preview_wnd_width = UI_device_width - spacing * 2;
    preview_wnd_offset_x = spacing;
    preview_wnd_offset_y = MMI_title_height + MMI_title_y + spacing;

    gdi_layer_create(
        preview_wnd_offset_x,
        preview_wnd_offset_y,
        preview_wnd_width,
        preview_wnd_height,
        &g_camera_custom_fx_cntx.preview_wnd_layer);

    gdi_layer_push_and_set_active(g_camera_custom_fx_cntx.preview_wnd_layer);
    gdi_layer_clear_background(GDI_COLOR_BLACK);
    gdi_layer_pop_and_restore_active();

    gdi_layer_get_base_handle(&g_camera_custom_fx_cntx.base_layer);

    gdi_layer_set_blt_layer(g_camera_custom_fx_cntx.base_layer, g_camera_custom_fx_cntx.preview_wnd_layer, 0, 0);

    /* brightness */
    slider_p = &g_camera_custom_fx_cntx.brightness_slider;

    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;

    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + spacing * 2;

    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);

    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_BIRIGHTNESS, &image_width, &image_height);

    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;

    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_BIRIGHTNESS);

    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_BRIGHTNESS);

    /* saturation */
    slider_p = &g_camera_custom_fx_cntx.saturation_slider;

    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;

    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height + spacing * 3;

    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);

    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_SATURATION, &image_width, &image_height);

    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;

    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_SATURATION);

    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_SATURATION);

    /* contrast */
    slider_p = &g_camera_custom_fx_cntx.contrast_slider;

    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;

    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height * 2 + spacing * 4;

    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 100);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);

    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_CONTRAST, &image_width, &image_height);

    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;

    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_CONTRAST);

    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_CONTRAST);

    /* Hue */
    slider_p = &g_camera_custom_fx_cntx.hue_slider;

    slider_p->width = UI_device_width - spacing * 4 - num_width * 2;
    slider_p->height = str_height;

    slider_p->offset_x = spacing * 2 + num_width;
    slider_p->offset_y = MMI_title_height + MMI_title_y + preview_wnd_height + str_height * 3 + spacing * 5;

    gui_create_horizontal_slide(
        &slider_p->slide_bar,
        slider_p->offset_x,
        slider_p->offset_y,
        slider_p->width,
        slider_p->height);
    gui_set_horizontal_slide_range(&slider_p->slide_bar, 360);
    gui_set_horizontal_slide_scale(&slider_p->slide_bar, 1);
    gui_set_horizontal_slide_value(&slider_p->slide_bar, slider_p->value);
    gui_show_horizontal_slide(&slider_p->slide_bar);

    gdi_image_get_dimension_id(IMG_ID_CAMERA_CUSTOM_FX_HUE, &image_width, &image_height);

    image_spacing = (slider_p->height - image_height) >> 1;
    image_offset_x = spacing + image_spacing + ((num_width - image_width) >> 1);
    image_offset_y = slider_p->offset_y + image_spacing;

    gdi_image_draw_id(image_offset_x, image_offset_y, IMG_ID_CAMERA_CUSTOM_FX_HUE);
    mmi_camera_custom_fx_edit_draw_value(CUSTOM_FX_HUE);

    mmi_camera_custom_fx_edit_draw_hilight_item(g_camera_custom_fx_cntx.select_idx, g_camera_custom_fx_cntx.select_idx);

    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);

   /*********** start preview ************/

    /* stop MMI sleep */
    TurnOnBacklight(0);

#if defined(__MMI_CLAMSHELL__)
    /* register event hdlr */
    mmi_frm_block_interrupt_event_handler(MMI_FRM_INT_CLAM_CLOSE, mmi_camera_custom_fx_clam_close_hdlr, NULL);
#endif /* defined(__MMI_CLAMSHELL__) */ 

    /* stop LCD patten */
    StopLEDPatternBackGround();

    /* power on and init hardware module */
    mdi_camera_power_on();

    camera_setting_data.zoom = 10;
    camera_setting_data.wb = camera_wb_command_map[g_camera_cntx.setting.wb];
    camera_setting_data.manual_wb = FALSE;

    camera_setting_data.ev = camera_ev_command_map[g_camera_cntx.setting.ev];
    camera_setting_data.banding = camera_banding_command_map[g_camera_cntx.setting.banding];

    camera_setting_data.night = g_camera_cntx.setting.night;
    camera_setting_data.flash = camera_flash_command_map[g_camera_cntx.setting.flash];
    camera_setting_data.ae_meter = camera_ae_meter_command_map[g_camera_cntx.setting.ae_meter];
    camera_setting_data.iso = camera_iso_command_map[g_camera_cntx.setting.iso];

    camera_setting_data.dsc_mode = camera_dsc_mode_command_map[g_camera_cntx.setting.dsc_mode];

    camera_setting_data.effect = camera_effect_command_map[CAMERA_SETTING_EFFECT_NORMAL];
    camera_setting_data.brightness = g_camera_custom_fx_cntx.brightness_slider.value * 255 / 100;
    camera_setting_data.saturation = g_camera_custom_fx_cntx.saturation_slider.value * 255 / 100;
    camera_setting_data.contrast = g_camera_custom_fx_cntx.contrast_slider.value * 255 / 100;
    camera_setting_data.hue = g_camera_custom_fx_cntx.hue_slider.value;

    camera_setting_data.preview_width = preview_wnd_width;
    camera_setting_data.preview_height = preview_wnd_height;

    /* capture parameters */
    camera_setting_data.image_qty = camera_image_qty_command_map[g_camera_cntx.setting.image_qty];
    camera_setting_data.image_width = g_camera_cntx.image_width;
    camera_setting_data.image_height = g_camera_cntx.image_height;

    camera_setting_data.lcm = MDI_CAMERA_PREVIEW_LCM_MAINLCD;
    camera_setting_data.preview_rotate = CAMERA_PREVIEW_MAINLCD_ROTATE;
    camera_setting_data.lcm_rotate = CAMERA_LCM_MAINLCD_ROTATE;

    camera_preview_data.preview_layer_handle = g_camera_custom_fx_cntx.preview_wnd_layer;
    camera_preview_data.preview_wnd_offset_x = 0;
    camera_preview_data.preview_wnd_offset_y = 0;
    camera_preview_data.preview_wnd_width = preview_wnd_width;
    camera_preview_data.preview_wnd_height = preview_wnd_height;
    camera_preview_data.blt_layer_flag = GDI_LAYER_ENABLE_LAYER_0 | GDI_LAYER_ENABLE_LAYER_1;
    camera_preview_data.src_key_color = 0;
    camera_preview_data.preview_layer_flag = GDI_LAYER_ENABLE_LAYER_1;
    camera_preview_data.is_lcd_update = TRUE;
    camera_preview_data.is_tvout = TRUE;
    camera_preview_data.xenon_flash_status_callback = NULL;

    /* start preview */
    mdi_camera_preview_start(
        &camera_preview_data,
        &camera_setting_data);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_custom_fx_set
 * DESCRIPTION
 *  entry custom fx screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_entry_custom_fx_set(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DISPLAY_POPUP_DONE();
    DeleteUptoScrID(SCR_ID_CAMERA_OPTION);

    g_camera_cntx.setting.effect = g_camera_cntx.selected_effect;

    mmi_camera_store_setting();
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_custom_fx_set
 * DESCRIPTION
 *  entry custom fx screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_highlight_custom_fx_set(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_set, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_custom_fx_edit
 * DESCRIPTION
 *  highlight hdlr of edit menu item
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_highlight_custom_fx_edit(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_custom_fx_edit_screen, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_custom_fx_option_screen
 * DESCRIPTION
 *  custom fx option screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
void mmi_camera_entry_custom_fx_option_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[16];
    U16 ItemIcons[16];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_EFFECT_SET_OPTION, NULL, mmi_camera_entry_custom_fx_option_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_EFFECT_SET_OPTION);
    nItems = GetNumOfChild(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION);
    GetSequenceStringIds(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_EFFECT_CUSTOM_FX_SET_OPTION);

    RegisterHighlightHandler(ExecuteCurrHiliteHandler);

    ShowCategory11Screen(
        STR_ID_CAMERA_EFFECT_SETTING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        0,
        guiBuffer);

}
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

/*****************************************************************************
*
* Camera Effect Setting Menu     
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_effect_setting
 * DESCRIPTION
 *  effect setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_effect_setting(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_EFFECT_START + g_camera_cntx.setting.effect + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_effect_setting
 * DESCRIPTION
 *  effect setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_effect_setting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_effect_setting_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_effect_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_effect_setting_value
 * DESCRIPTION
 *  set effect
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_effect_setting_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_1)
    {
        g_camera_custom_fx_cntx.fx_idx = 0;
        mmi_camera_entry_custom_fx_option_screen();
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_2)
    {
        g_camera_custom_fx_cntx.fx_idx = 1;
        mmi_camera_entry_custom_fx_option_screen();
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__ */ 

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__
    if (g_camera_cntx.selected_effect == CAMERA_SETTING_EFFECT_CUSTOM_FX_3)
    {
        g_camera_custom_fx_cntx.fx_idx = 2;
        mmi_camera_entry_custom_fx_option_screen();
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__ */ 

    DISPLAY_POPUP_DONE();
    DeleteNHistory(1);

    g_camera_cntx.setting.effect = g_camera_cntx.selected_effect;

    mmi_camera_store_setting();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_effect_setting_highlight_hdlr
 * DESCRIPTION
 *  effect setting highlight handler
 * PARAMETERS
 *  idx     [IN]        Selected index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_effect_setting_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set selected effect */
    g_camera_cntx.selected_effect = idx;

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__
    if (idx == CAMERA_SETTING_EFFECT_CUSTOM_FX_1)
    {
        g_camera_custom_fx_cntx.fx_idx = 0;
        SetKeyHandler(mmi_camera_entry_custom_fx_option_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_1__ */ 

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__
    if (idx == CAMERA_SETTING_EFFECT_CUSTOM_FX_2)
    {
        g_camera_custom_fx_cntx.fx_idx = 1;
        SetKeyHandler(mmi_camera_entry_custom_fx_option_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_2__ */ 

#ifdef __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__
    if (idx == CAMERA_SETTING_EFFECT_CUSTOM_FX_3)
    {
        g_camera_custom_fx_cntx.fx_idx = 2;
        SetKeyHandler(mmi_camera_entry_custom_fx_option_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
#endif /* __CAMERA_FEATURE_EFFECT_CUSTOM_FX_3__ */ 

    /* not custom fx */
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_effect_setting_screen
 * DESCRIPTION
 *  entry effect setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_effect_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_EFFECT_SETTING, NULL, mmi_camera_entry_effect_setting_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_EFFECT_SETTING);

    nItems = GetNumOfChild(MENU_ID_CAMERA_EFFECT_SETTING);
    GetSequenceStringIds(MENU_ID_CAMERA_EFFECT_SETTING, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_EFFECT_SETTING, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_EFFECT_SETTING);

    RegisterHighlightHandler(mmi_camera_effect_setting_highlight_hdlr);

    ShowCategory11Screen(
        STR_ID_CAMERA_EFFECT_SETTING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.effect,   /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_effect_setting_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}

#ifdef __CAMERA_DSC_MODE__
/*****************************************************************************
*
* Camera Shot Mode Menu     
*
*****************************************************************************/
/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_dsc_mode
 * DESCRIPTION
 *  effect setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_hint_dsc_mode(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_DSC_MODE_START + g_camera_cntx.setting.dsc_mode + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_dsc_mode
 * DESCRIPTION
 *  effect setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_dsc_mode(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_dsc_mode_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_dsc_mode_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


#ifdef __CAMERA_FEATURE_ISO_SUPPORT__
/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_iso
 * DESCRIPTION
 *  effect setting hint handler
 * PARAMETERS
 *  index       [IN]        Index of selected item
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_hint_iso(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_ISO_START + g_camera_cntx.setting.iso + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_iso_highlight_hdlr
 * DESCRIPTION
 *  iso setting highlight handler
 * PARAMETERS
 *  idx     [IN]        Selected index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_iso_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set selected effect */
    g_camera_cntx.selected_iso = idx;
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_iso
 * DESCRIPTION
 *  effect setting highlight handler
 * PARAMETERS
 *  void
 *  index(?)        [IN]        Index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_highlight_iso(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_iso_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_iso_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_iso_screen
 * DESCRIPTION
 *  entry iso setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_entry_iso_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_ISO, NULL, mmi_camera_entry_iso_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_ISO);

    nItems = GetNumOfChild(MENU_ID_CAMERA_ISO);
    GetSequenceStringIds(MENU_ID_CAMERA_ISO, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_ISO, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_ISO);

    RegisterHighlightHandler(mmi_camera_iso_highlight_hdlr);

    ShowCategory11Screen(
        STR_ID_CAMERA_ISO,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.iso, /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_iso_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_iso_value
 * DESCRIPTION
 *  set iso
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_set_iso_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    DISPLAY_POPUP_DONE();

    DeleteNHistory(1);
    g_camera_cntx.setting.iso = g_camera_cntx.selected_iso;
    mmi_camera_store_setting();
}

#endif

/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_dsc_mode_value
 * DESCRIPTION
 *  set effect
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_dsc_mode_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#ifdef __CAMERA_DSC_MODE_SHUTTER_PRI__
    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_SHUTTER_PRI)
    {
        mmi_camera_entry_dsc_mode_setting_screen();
        return;
    }
#endif /* __CAMERA_DSC_MODE_SHUTTER_PRI__ */ 

#ifdef __CAMERA_DSC_MODE_APERTURE_PRI__

    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_APERTURE_PRI)
    {
        mmi_camera_entry_dsc_mode_setting_screen();
        return;
    }
#endif /* __CAMERA_DSC_MODE_APERTURE_PRI__ */ 


    DISPLAY_POPUP_DONE();
    DeleteNHistory(1);
#ifdef __CAMERA_AUTOFOCUS_MODE__
    if (g_camera_cntx.selected_dsc_mode != CAMERA_SETTING_DSC_MODE_AUTO)
    {
        g_camera_cntx.setting.af_mode = CAMERA_SETTING_AUTOFOCUS_MODE_AUTO;
    }
#endif /* __CAMERA_AUTOFOCUS_MODE__ */ 
    g_camera_cntx.setting.dsc_mode = g_camera_cntx.selected_dsc_mode;


#ifdef __CAMERA_DSC_MODE_NIGHT__
    if(g_camera_cntx.setting.dsc_mode == CAMERA_SETTING_DSC_MODE_NIGHT)
        g_camera_cntx.setting.night = 1;
    else
        g_camera_cntx.setting.night = 0;
#endif 

    mmi_camera_store_setting();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_dsc_mode_highlight_hdlr
 * DESCRIPTION
 *  effect setting highlight handler
 * PARAMETERS
 *  idx     [IN]        Selected index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_dsc_mode_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* set selected effect */
    g_camera_cntx.selected_dsc_mode = idx;

#ifdef __CAMERA_DSC_MODE_SHUTTER_PRI__
    if (idx == CAMERA_SETTING_DSC_MODE_SHUTTER_PRI)
    {
        SetKeyHandler(mmi_camera_entry_dsc_mode_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
#endif /* __CAMERA_DSC_MODE_SHUTTER_PRI__ */ 

#ifdef __CAMERA_DSC_MODE_APERTURE_PRI__

    if (idx == CAMERA_SETTING_DSC_MODE_APERTURE_PRI)
    {
        SetKeyHandler(mmi_camera_entry_dsc_mode_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
        return;
    }
#endif /* __CAMERA_DSC_MODE_APERTURE_PRI__ */ 
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_dsc_mode_setting_screen
 * DESCRIPTION
 *  exit shot mode setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_dsc_mode_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 inputBufferSize;
    S16 nHistory = 0;
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_CAMERA_DSC_MODE_SETTING;
    h.entryFuncPtr = mmi_camera_entry_image_setting_screen;
    mmi_ucs2cpy((S8*) h.inputBuffer, (S8*) & nHistory);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57History(h.guiBuffer);
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_dsc_mode_setting_set_value
 * DESCRIPTION
 *  set shot mode setting value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_dsc_mode_setting_set_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/

#ifdef __CAMERA_DSC_MODE_SHUTTER_PRI__
    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_SHUTTER_PRI)
    {
        g_camera_cntx.setting.shutter_pri = g_camera_menu_cntx.dsc_mode_shutter_pri_selected;
    }
#endif /* __CAMERA_DSC_MODE_SHUTTER_PRI__ */ 

#ifdef __CAMERA_DSC_MODE_APERTURE_PRI__
    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_APERTURE_PRI)
    {
        g_camera_cntx.setting.aperture_pri = g_camera_menu_cntx.dsc_mode_aperture_pri_selected;
    }
#endif /* __CAMERA_DSC_MODE_APERTURE_PRI__ */ 
    g_camera_cntx.setting.dsc_mode = g_camera_cntx.selected_dsc_mode;

    mmi_camera_store_setting();

    DISPLAY_POPUP_DONE();
    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_dsc_mode_setting_highlight_hdlr
 * DESCRIPTION
 *  shot mode setting screen's highlight handler
 * PARAMETERS
 *  index       [IN]        Selected item's index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_dsc_mode_setting_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetCategory57LeftSoftkeyFunction(mmi_camera_dsc_mode_setting_set_value);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_dsc_mode_setting_screen
 * DESCRIPTION
 *  entry image setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_dsc_mode_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U8 *inputBuffer;
    U16 inputBufferSize;
    S32 item_offset = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ID_TYPE item_icons[2] = 
    {
        0,
        0,
    };

    EntryNewScreen(SCR_ID_CAMERA_DSC_MODE_SETTING, mmi_camera_exit_dsc_mode_setting_screen, NULL, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    InitializeCategory57Screen();

    /* g_camera_menu_cntx.camera_setting_inline.shot_mode_selected= g_camera_cntx.setting.shot_mode; */

   /****************************************************************************
   *  Create inline selection                                                               
   *****************************************************************************/

#ifdef __CAMERA_DSC_MODE_SHUTTER_PRI__
    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_SHUTTER_PRI)
    {
        S32 i;

        item_icons[0] = IMG_ID_CAMERA_DSC_MODE_SHUTTER_PRI;
        /* image size inline selection */

        for (i = 0; i < g_camera_dsc_mode_cntx.shutter_pri_count; i++)
        {
            /* combine a string ooxx for support shutter parameter . */
            g_camera_menu_cntx.dsc_mode_shutter_pri_str[i] = g_camera_dsc_mode_cntx.shutter_pri_str[i];
        }

        SetInlineItemCaption(
            &wgui_inline_items[item_offset++],
            (PU8) GetString((U16) (STR_ID_CAMERA_DSC_MODE_SHUTTER_PRI)));

        SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);
        g_camera_menu_cntx.dsc_mode_shutter_pri_selected = g_camera_cntx.setting.shutter_pri;

        SetInlineItemSelect(
            &wgui_inline_items[item_offset++],
            g_camera_dsc_mode_cntx.shutter_pri_count,
            (U8 **) g_camera_menu_cntx.dsc_mode_shutter_pri_str,
            &g_camera_menu_cntx.dsc_mode_shutter_pri_selected);

    }
#endif /* __CAMERA_DSC_MODE_SHUTTER_PRI__ */ 

#ifdef __CAMERA_DSC_MODE_APERTURE_PRI__

    if (g_camera_cntx.selected_dsc_mode == CAMERA_SETTING_DSC_MODE_APERTURE_PRI)
    {
        S32 i;

        item_icons[0] = IMG_ID_CAMERA_DSC_MODE_APERTURE_PRI;
        /* image size inline selection */
        for (i = 0; i < g_camera_dsc_mode_cntx.aperture_pri_count; i++)
        {
            g_camera_menu_cntx.dsc_mode_aperture_pri_str[i] = g_camera_dsc_mode_cntx.aperture_pri_str[i];
        }

        SetInlineItemCaption(
            &wgui_inline_items[item_offset++],
            (PU8) GetString((U16) (STR_ID_CAMERA_DSC_MODE_APERTURE_PRI)));

        SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);

        g_camera_menu_cntx.dsc_mode_aperture_pri_selected = g_camera_cntx.setting.aperture_pri;

        SetInlineItemSelect(
            &wgui_inline_items[item_offset++],
            g_camera_dsc_mode_cntx.aperture_pri_count,
            (U8 **) g_camera_menu_cntx.dsc_mode_aperture_pri_str,
            &g_camera_menu_cntx.dsc_mode_aperture_pri_selected);

    }
#endif /* __CAMERA_DSC_MODE_APERTURE_PRI__ */ 

    /* enter category */
    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_DSC_MODE_SETTING);
    inputBuffer = GetCurrNInputBuffer(SCR_ID_CAMERA_DSC_MODE_SETTING, &inputBufferSize);

    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, 2, inputBuffer);
    }

    RegisterHighlightHandler(mmi_camera_dsc_mode_setting_highlight_hdlr);

    /* show category */
    ShowCategory57Screen(
        STR_ID_CAMERA_DSC_MODE,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_offset,
        item_icons,
        wgui_inline_items,
        0,
        guiBuffer);

    /* set key hdlr */
    SetCategory57LeftSoftkeyFunction(mmi_camera_dsc_mode_setting_set_value);
    DisableCategory57ScreenDone();
    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_dsc_mode_screen
 * DESCRIPTION
 *  entry effect setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_dsc_mode_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[32];
    U16 ItemIcons[32];
    U16 nItems;
    U8 *guiBuffer;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_DSC_MODE, NULL, mmi_camera_entry_dsc_mode_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_DSC_MODE);

    nItems = GetNumOfChild(MENU_ID_CAMERA_DSC_MODE);
    GetSequenceStringIds(MENU_ID_CAMERA_DSC_MODE, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_DSC_MODE, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_DSC_MODE);

    RegisterHighlightHandler(mmi_camera_dsc_mode_highlight_hdlr);

    ShowCategory11Screen(
        STR_ID_CAMERA_DSC_MODE,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        g_camera_cntx.setting.dsc_mode, /* current index */
        guiBuffer);

    SetLeftSoftkeyFunction(mmi_camera_set_dsc_mode_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
}
#endif /* __CAMERA_DSC_MODE__ */ 

/***************************************************************************** 
*
* Add Frame
*
*****************************************************************************/

#ifdef __CAMERA_FEATURE_ADD_FRAME__


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_add_frame_normal
 * DESCRIPTION
 *  add frame hint handler
 * PARAMETERS
 *  index       [IN]        Selected item's index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_hint_add_frame_normal(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_ADD_FRAME_START + g_camera_cntx.setting.add_frame + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_add_frame_tileshot
 * DESCRIPTION
 *  add frame hint handler
 * PARAMETERS
 *  index       [IN]        Selected item's index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_hint_add_frame_tileshot(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_ADD_FRAME_START + g_camera_cntx.setting.add_frame_tileshot + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_hint_add_frame_color_idx
 * DESCRIPTION
 *  add frame hint handler
 * PARAMETERS
 *  index       [IN]        Selected item's index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_hint_add_frame_color_idx(U16 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    memset((PS8) hintData[(index)], 0, sizeof(hintData[(index)]));
    mmi_ucs2cpy(
        (S8*) hintData[index],
        (S8*) GetString((U16) (STR_ID_CAMERA_ADD_FRAME_START + g_camera_cntx.setting.add_frame_color_idx + 1)));
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_add_frame
 * DESCRIPTION
 *  add frame highlight handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_highlight_add_frame(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_add_frame_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_add_frame_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_add_frame2
 * DESCRIPTION
 *  add frame highlight handler
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_highlight_add_frame2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_add_frame_screen2, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_add_frame_screen2, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_add_frame_value
 * DESCRIPTION
 *  set add frame setting
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_set_add_frame_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* capture size not full screen */

    DISPLAY_POPUP_DONE();
    DeleteUptoScrID(SCR_ID_CAMERA_OPTION);

    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:  /* normal */
            g_camera_cntx.setting.add_frame = g_camera_menu_cntx.cur_select_add_frame_idx_normal;
            if (g_camera_cntx.is_fullscreen == TRUE)
            {
            #if defined(__CAMERA_OSD_HORIZONTAL__) && defined(__CAMERA_ADD_FRAME_HORIZONTAL__)
                if (g_camera_cntx.setting.add_frame == CAMERA_SETTING_ADD_FRAME_OFF)
                {
                    g_camera_cntx.capture_path = CAPTURE_FROM_MEMORY;
                }
                else
                {
                    g_camera_cntx.capture_path = CAPTURE_FROM_LAYER;
                #if defined(__CAMERA_FEATURE_CONT_SHOT_BURST__)
                    if (g_camera_cntx.setting.cont_shot == CAMERA_SETTING_CONT_SHOT_BURST)
                    {
                        g_camera_cntx.setting.cont_shot = CAMERA_SETTING_CONT_SHOT_OFF;
                    }
                #endif /* defined(__CAMERA_FEATURE_CONT_SHOT_BURST__) */ 
                }
            #else /* defined(__CAMERA_OSD_HORIZONTAL__) && defined(__CAMERA_ADD_FRAME_HORIZONTAL__) */ 
                g_camera_cntx.capture_path = CAPTURE_FROM_LAYER;
            #endif /* defined(__CAMERA_OSD_HORIZONTAL__) && defined(__CAMERA_ADD_FRAME_HORIZONTAL__) */ 
            }

            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            g_camera_cntx.setting.add_frame_tileshot = g_camera_menu_cntx.cur_select_add_frame_idx_tileshot;
            if (g_camera_cntx.is_tileshot == TRUE)
            {
                g_camera_cntx.capture_path = CAPTURE_FROM_LAYER;
            }
            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            g_camera_cntx.setting.add_frame_color_idx = g_camera_menu_cntx.cur_select_add_frame_idx_color_idx;
            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }
    mmi_camera_store_setting();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_add_frame_goto_previous_frame
 * DESCRIPTION
 *  go to previous frame
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_add_frame_goto_previous_frame(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:  /* normal */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_normal == 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_normal = CAMERA_SETTING_ADD_FRAME_COUNT - 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_normal--;
            }

            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_tileshot == 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_tileshot = CAMERA_SETTING_ADD_FRAME_COUNT - 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_tileshot--;
            }
            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_color_idx == 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_color_idx = CAMERA_ADD_FRAME_COLOR_IDX_ITEM_COUNT - 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_color_idx--;
            }

            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }

    mmi_camera_entry_add_frame_view_screen();
    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_add_frame_goto_next_frame
 * DESCRIPTION
 *  go to next frame
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_add_frame_goto_next_frame(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:  /* normal */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_normal >= CAMERA_SETTING_ADD_FRAME_COUNT - 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_normal = 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_normal++;
            }

            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_tileshot >= CAMERA_SETTING_ADD_FRAME_COUNT - 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_tileshot = 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_tileshot++;
            }
            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            if (g_camera_menu_cntx.cur_select_add_frame_idx_color_idx >= CAMERA_ADD_FRAME_COLOR_IDX_ITEM_COUNT - 1)
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_color_idx = 1;
            }
            else
            {
                g_camera_menu_cntx.cur_select_add_frame_idx_color_idx++;
            }

            break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }

    mmi_camera_entry_add_frame_view_screen();
    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_add_frame_view_screen
 * DESCRIPTION
 *  entry add frame viewer
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_entry_add_frame_view_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 img_id = 0;
    U16 str_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_ADD_FRAME_VIEW, NULL, mmi_camera_entry_add_frame_view_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    gdi_layer_lock_frame_buffer();

    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:      /* normal */
            str_id = (U16) (STR_ID_CAMERA_ADD_FRAME_OFF + g_camera_menu_cntx.cur_select_add_frame_idx_normal);
            img_id = (U16) (IMG_ID_CAMERA_ADD_FRAME_START + g_camera_menu_cntx.cur_select_add_frame_idx_normal);
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
    #ifdef __CAMERA_FEATURE_CONT_SHOT_TILE__
    #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            /* curretly use same id, can split in the future */
            str_id = (U16) (STR_ID_CAMERA_ADD_FRAME_OFF + g_camera_menu_cntx.cur_select_add_frame_idx_tileshot);
            img_id = (U16) (IMG_ID_CAMERA_TILE_ADD_FRAME_START + g_camera_menu_cntx.cur_select_add_frame_idx_tileshot);
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
    #endif /* __CAMERA_FEATURE_CONT_SHOT_TILE__ */ 
    #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            str_id = (U16) (STR_ID_CAMERA_ADD_FRAME_OFF + g_camera_menu_cntx.cur_select_add_frame_idx_color_idx);
            img_id =
                (U16) (IMG_ID_CAMERA_COLOR_IDX_ADD_FRAME_START + g_camera_menu_cntx.cur_select_add_frame_idx_color_idx);
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }

    ShowCategory221Screen(
        str_id,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_ID_CAMERA_ADD_FRAME_SET,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        GDI_COLOR_WHITE,
        NULL);

    draw_arrow_indication(0, 0, 1, 1);

    gdi_layer_set_clip(
        0,
        MMI_title_y + MMI_title_height,
        UI_device_width - 1,
        MMI_title_y + MMI_title_height + MMI_content_height - 1);
    {
        S32 offset_x, offset_y, img_width, img_height;

        offset_x = MMI_title_x;
        offset_y = MMI_title_y + MMI_title_height;

        gdi_image_get_dimension_id(img_id, &img_width, &img_height);

        if (img_width > img_height)
        {
            if (img_width > MMI_content_width)
            {
                float tmp = (float)img_width / MMI_content_width;

                img_height = (S32) (img_height / tmp);
                img_width = MMI_content_width;
            }
            else
            {
                offset_x += ((MMI_content_width - img_width) >> 1);
            }

            offset_y += ((MMI_content_height - img_height) >> 1);
        }
        else
        {
            if (img_height > MMI_content_height)
            {
                float tmp = (float)img_height / MMI_content_height;

                img_width = (S32) (img_width / tmp);
                img_height = MMI_content_height;
            }
            else
            {
                offset_y += ((MMI_content_height - img_height) >> 1);
            }

            offset_x += ((MMI_content_width - img_width) >> 1);
        }
        gdi_image_draw_resized_id(offset_x, offset_y, img_width, img_height, img_id);
    }

    gdi_layer_unlock_frame_buffer();
    gdi_layer_blt_base_layer(0, 0, UI_device_width - 1, UI_device_height - 1);

    SetLeftSoftkeyFunction(mmi_camera_set_add_frame_value, KEY_EVENT_UP);
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_add_frame_goto_previous_frame, KEY_UP_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_add_frame_goto_next_frame, KEY_DOWN_ARROW, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_add_frame_goto_previous_frame, KEY_VOL_UP, KEY_EVENT_DOWN);
    SetKeyHandler(mmi_camera_add_frame_goto_next_frame, KEY_VOL_DOWN, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_add_frame_highlight_hdlr
 * DESCRIPTION
 *  add frame highlight handler
 * PARAMETERS
 *  idx     [IN]        Highlight index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_add_frame_highlight_hdlr(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_menu_cntx.cur_select_add_frame_idx = idx;

    SetLeftSoftkeyFunction(mmi_camera_entry_add_frame_screen2, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_add_frame_screen2, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_add_frame_highlight_hdlr2
 * DESCRIPTION
 *  add frame highlight handler
 * PARAMETERS
 *  idx     [IN]        Highlight index
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_add_frame_highlight_hdlr2(S32 idx)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:      /* normal */
            g_camera_menu_cntx.cur_select_add_frame_idx_normal = idx;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
    #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            g_camera_menu_cntx.cur_select_add_frame_idx_tileshot = idx;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
    #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            g_camera_menu_cntx.cur_select_add_frame_idx_color_idx = idx;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }

    if (idx == 0)   /* off */
    {
        ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
        SetLeftSoftkeyFunction(mmi_camera_set_add_frame_value, KEY_EVENT_UP);
    }
    else    /* frame */
    {
        ChangeLeftSoftkey(STR_GLOBAL_VIEW, IMG_GLOBAL_OK);
        SetLeftSoftkeyFunction(mmi_camera_entry_add_frame_view_screen, KEY_EVENT_UP);
    }
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_add_frame_screen
 * DESCRIPTION
 *  entry add frame screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_entry_add_frame_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[16];
    U16 ItemIcons[16];
    U16 nItems;
    U8 *guiBuffer;
    U8 *PopUpList[32];
    U8 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_ADD_FRAME, NULL, mmi_camera_entry_add_frame_screen, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_ADD_FRAME);
    nItems = GetNumOfChild(MENU_ID_CAMERA_ADD_FRAME);

    GetSequenceStringIds(MENU_ID_CAMERA_ADD_FRAME, ItemList);
    GetSequenceImageIds(MENU_ID_CAMERA_ADD_FRAME, ItemIcons);
    SetParentHandler(MENU_ID_CAMERA_ADD_FRAME);

    RegisterHighlightHandler(mmi_camera_add_frame_highlight_hdlr);

    for (i = 0; i < nItems; i++)
    {
        PopUpList[i] = NULL;
    }

    ConstructHintsList(MENU_ID_CAMERA_ADD_FRAME, PopUpList);

    ShowCategory52Screen(
        STR_ID_CAMERA_ADD_FRAME,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        ItemIcons,
        (U8 **) PopUpList,
        0,
        0,
        guiBuffer);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_add_frame_screen2
 * DESCRIPTION
 *  
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
static void mmi_camera_entry_add_frame_screen2(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 ItemList[16];
    U16 ItemIcons[16];
    U16 nItems;
    U8 *guiBuffer;
    U16 selected_item = 0;
    U16 menu_id = 0;
    U16 title_id = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    EntryNewScreen(SCR_ID_CAMERA_ADD_FRAME_OPTION, NULL, mmi_camera_entry_add_frame_screen2, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    switch (g_camera_menu_cntx.cur_select_add_frame_idx)
    {
    #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
        case ADD_FRAME_NORMAL:      /* normal */
            menu_id = MENU_ID_CAMERA_ADD_FRAME_NORMAL;
            title_id = STR_ID_CAMERA_ADD_FRAME_NORMAL;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
    #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
        case ADD_FRAME_TILESHOT:    /* tileshot */
            menu_id = MENU_ID_CAMERA_ADD_FRAME_TILESHOT;
            title_id = STR_ID_CAMERA_ADD_FRAME_TILESHOT;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
    #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
        case ADD_FRAME_COLOR_IDX:   /* color idx */
            menu_id = MENU_ID_CAMERA_ADD_FRAME_COLOR_IDX;
            title_id = STR_ID_CAMERA_ADD_FRAME_COLOR_IDX;
            break;
    #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
    }

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_ADD_FRAME_OPTION);
    nItems = GetNumOfChild(menu_id);

    GetSequenceStringIds(menu_id, ItemList);
    GetSequenceImageIds(menu_id, ItemIcons);
    SetParentHandler(menu_id);

    RegisterHighlightHandler(mmi_camera_add_frame_highlight_hdlr2);

    /* !NULL measn back from view screen or interrupt */
    if (guiBuffer != NULL)
    {
        switch (g_camera_menu_cntx.cur_select_add_frame_idx)
        {
        #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
            case ADD_FRAME_NORMAL:      /* normal */
                selected_item = g_camera_menu_cntx.cur_select_add_frame_idx_normal;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
            case ADD_FRAME_TILESHOT:    /* tileshot */
                selected_item = g_camera_menu_cntx.cur_select_add_frame_idx_tileshot;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
            case ADD_FRAME_COLOR_IDX:   /* color idx */
                selected_item = g_camera_menu_cntx.cur_select_add_frame_idx_color_idx;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
        }

    }
    else
    {
        switch (g_camera_menu_cntx.cur_select_add_frame_idx)
        {
        #ifdef __CAMERA_FEATURE_ADD_FRAME_NORMAL__
            case ADD_FRAME_NORMAL:      /* normal */
                selected_item = g_camera_cntx.setting.add_frame;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_NORMAL__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_TILESHOT__
            case ADD_FRAME_TILESHOT:    /* tileshot */
                selected_item = g_camera_cntx.setting.add_frame_tileshot;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_TILESHOT__ */ 
        #ifdef __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__
            case ADD_FRAME_COLOR_IDX:   /* color idx */
                selected_item = g_camera_cntx.setting.add_frame_color_idx;
                break;
        #endif /* __CAMERA_FEATURE_ADD_FRAME_COLOR_IDX__ */ 
        }
    }

    ShowCategory11Screen(
        title_id,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        nItems,
        ItemList,
        selected_item,  /* current index */
        NULL);

    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetKeyHandler(GoBackHistory, KEY_LEFT_ARROW, KEY_EVENT_DOWN);

}

#endif /* __CAMERA_FEATURE_ADD_FRAME__ */ 

/***************************************************************************** 
*
* Camera Setting
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_camera_setting
 * DESCRIPTION
 *  highligh camera setting on option menu
 * PARAMETERS
 *  void
 *  idx(?)
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_camera_setting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_camera_setting_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_camera_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_camera_setting_set_value
 * DESCRIPTION
 *  set camera setting values
 * PARAMETERS
 *  void
 *  idx(?)
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_camera_setting_set_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.setting.flash = g_camera_menu_cntx.camera_setting_inline.flash_selected;
    g_camera_cntx.setting.led_highlight = g_camera_menu_cntx.camera_setting_inline.led_highlight_selected;
    g_camera_cntx.setting.shutter_sound = g_camera_menu_cntx.camera_setting_inline.shutter_sound_selected;
    g_camera_cntx.setting.ev = g_camera_menu_cntx.camera_setting_inline.ev_selected;
    g_camera_cntx.setting.night = g_camera_menu_cntx.camera_setting_inline.night_selected;
    g_camera_cntx.setting.ae_meter = g_camera_menu_cntx.camera_setting_inline.ae_meter_selected;
    g_camera_cntx.setting.closeup = g_camera_menu_cntx.camera_setting_inline.closeup_selected;
    g_camera_cntx.setting.banding = g_camera_menu_cntx.camera_setting_inline.banding_selected;
    g_camera_cntx.setting.delay_timer = g_camera_menu_cntx.camera_setting_inline.delay_timer_selected;
    g_camera_cntx.setting.cont_shot = g_camera_menu_cntx.camera_setting_inline.cont_shot_selected;

    mmi_camera_store_setting();

    DISPLAY_POPUP_DONE();

#if defined(__CAMERA_FEATURE_CONT_SHOT_BURST__)
/* while switching to burstshot mode, the menu should be changed from vertical to horizontal */
    if (g_camera_cntx.setting.cont_shot == CAMERA_SETTING_CONT_SHOT_BURST && g_camera_menu_cntx.camera_setting_inline.ori_cont_shot != CAMERA_SETTING_CONT_SHOT_BURST)
    {
        if (g_camera_cntx.setting.image_size != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
        {
            g_camera_cntx.image_size_before_burst = g_camera_cntx.setting.image_size;
            g_camera_cntx.setting.image_size = CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX;

            /* image size changed, update capture size and preview size */
            mmi_camera_preview_update_capture_size();
        }
    }
    else if (g_camera_cntx.setting.cont_shot != CAMERA_SETTING_CONT_SHOT_BURST && g_camera_menu_cntx.camera_setting_inline.ori_cont_shot == CAMERA_SETTING_CONT_SHOT_BURST)
    {

        if (g_camera_cntx.image_size_before_burst != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
        {
            /* restore preview */
            g_camera_cntx.setting.image_size = g_camera_cntx.image_size_before_burst;
        }        
            mmi_camera_preview_update_capture_size();
    }
#endif /* defined(__CAMERA_FEATURE_CONT_SHOT_BURST__) */ 

    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_camera_setting_highlight_hdlr
 * DESCRIPTION
 *  highlight handler for camera setting menu
 * PARAMETERS
 *  index       [IN]        Highlighted item index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_camera_setting_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetCategory57LeftSoftkeyFunction(mmi_camera_camera_setting_set_value);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_camera_setting_screen
 * DESCRIPTION
 *  exit camera setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_camera_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 inputBufferSize;
    history h;
    S16 nHistory = 0;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_CAMERA_CAMERA_SETTING;
    h.entryFuncPtr = mmi_camera_entry_camera_setting_screen;
    mmi_ucs2cpy((S8*) h.inputBuffer, (S8*) & nHistory);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57History(h.guiBuffer);
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_camera_setting_screen
 * DESCRIPTION
 *  entry camera setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_camera_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U8 *inputBuffer;
    U16 inputBufferSize;
    S32 item_offset = 0;
    S32 i;
    S32 item_count = CAMERA_CAMERA_SETTING_ITEM_COUNT;
    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ID_TYPE item_icons[CAMERA_CAMERA_SETTING_ITEM_COUNT * 2] = 
    {

    #ifdef __CAMERA_FEATURE_FLASH__
        IMG_ID_CAMERA_FLASH,
        0,
    #endif /* __CAMERA_FEATURE_FLASH__ */ 

    #ifdef __CAMERA_FEATURE_LED_HIGHLIGHT__
        IMG_ID_CAMERA_LED_HIGHLIGHT,
        0,
    #endif /* __CAMERA_FEATURE_LED_HIGHLIGHT__ */ 

    #ifdef __CAMERA_FEATURE_SHUTTER_SOUND__
        IMG_ID_CAMERA_SHUTTER_SOUND,
        0,
    #endif /* __CAMERA_FEATURE_SHUTTER_SOUND__ */ 

    #ifdef __CAMERA_FEATURE_EV__
        IMG_ID_CAMERA_EV,
        0,
    #endif /* __CAMERA_FEATURE_EV__ */ 

    #ifdef __CAMERA_FEATURE_NIGHT__
        IMG_ID_CAMERA_NIGHT,
        0,
    #endif /* __CAMERA_FEATURE_NIGHT__ */ 

    #ifdef __CAMERA_FEATURE_AE_METER__
        IMG_ID_CAMERA_AE_METER,
        0,
    #endif /* __CAMERA_FEATURE_AE_METER__ */ 

    #ifdef __CAMERA_FEATURE_CLOSEUP__
        IMG_ID_CAMERA_CLOSEUP,
        0,
    #endif /* __CAMERA_FEATURE_CLOSEUP__ */ 

    #ifdef __CAMERA_FEATURE_BANDING__
        IMG_ID_CAMERA_BANDING,
        0,
    #endif /* __CAMERA_FEATURE_BANDING__ */ 

    #ifdef __CAMERA_FEATURE_DELAY_TIMER__
        IMG_ID_CAMERA_DELAY_TIMER,
        0,
    #endif /* __CAMERA_FEATURE_DELAY_TIMER__ */ 

    #ifdef __CAMERA_FEATURE_CONT_SHOT__
        IMG_ID_CAMERA_CONT_SHOT,
        0,
    #endif /* __CAMERA_FEATURE_CONT_SHOT__ */ 
    };

    EntryNewScreen(SCR_ID_CAMERA_CAMERA_SETTING, mmi_camera_exit_camera_setting_screen, NULL, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    InitializeCategory57Screen();

    g_camera_menu_cntx.camera_setting_inline.flash_selected = g_camera_cntx.setting.flash;
    g_camera_menu_cntx.camera_setting_inline.led_highlight_selected = g_camera_cntx.setting.led_highlight;
    g_camera_menu_cntx.camera_setting_inline.shutter_sound_selected = g_camera_cntx.setting.shutter_sound;
    g_camera_menu_cntx.camera_setting_inline.ev_selected = g_camera_cntx.setting.ev;
    g_camera_menu_cntx.camera_setting_inline.night_selected = g_camera_cntx.setting.night;
    g_camera_menu_cntx.camera_setting_inline.ae_meter_selected = g_camera_cntx.setting.ae_meter;
    g_camera_menu_cntx.camera_setting_inline.closeup_selected = g_camera_cntx.setting.closeup;
    g_camera_menu_cntx.camera_setting_inline.banding_selected = g_camera_cntx.setting.banding;
    g_camera_menu_cntx.camera_setting_inline.delay_timer_selected = g_camera_cntx.setting.delay_timer;
    g_camera_menu_cntx.camera_setting_inline.ori_cont_shot = g_camera_menu_cntx.camera_setting_inline.cont_shot_selected = g_camera_cntx.setting.cont_shot;

   /******************************************************************
   *  MACRO to create inline selection. 
   ******************************************************************/
#define CREATE_CAMERA_SETTING_INLINE_SELECT(a, A)                                                                             \
   {                                                                                                                             \
      for(i = 0 ; i < CAMERA_SETTING_##A##_COUNT; i++)                                                                           \
      {                                                                                                                          \
         g_camera_menu_cntx.camera_setting_inline.##a##_str[i] = (UI_string_type)GetString((U16)(STR_ID_CAMERA_##A##_START+i+1));\
      }                                                                                                                          \
      SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8)GetString((U16)(STR_ID_CAMERA_##A)));                         \
      SetInlineItemActivation(\
        &wgui_inline_items[item_offset],\
        INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT,\
        0 );                                                                                               \
      SetInlineItemSelect( &wgui_inline_items[item_offset++],                                                                    \
                           CAMERA_SETTING_##A##_COUNT,                                                                           \
                           (U8**)g_camera_menu_cntx.camera_setting_inline.##a##_str,                                             \
                           &g_camera_menu_cntx.camera_setting_inline.##a##_selected);                                            \
   }

   /****************************************************************************
   *  Create inline selection                                                               
   *****************************************************************************/
    #ifdef __CAMERA_FEATURE_FLASH__
    CREATE_CAMERA_SETTING_INLINE_SELECT(flash, FLASH);
    #endif 

    #ifdef __CAMERA_FEATURE_LED_HIGHLIGHT__
    CREATE_CAMERA_SETTING_INLINE_SELECT(led_highlight, LED_HIGHLIGHT);
    #endif 

    #ifdef __CAMERA_FEATURE_SHUTTER_SOUND__
    CREATE_CAMERA_SETTING_INLINE_SELECT(shutter_sound, SHUTTER_SOUND);
    #endif 

    #ifdef __CAMERA_FEATURE_EV__
    CREATE_CAMERA_SETTING_INLINE_SELECT(ev, EV);
    #endif 

    #ifdef __CAMERA_FEATURE_NIGHT__
    CREATE_CAMERA_SETTING_INLINE_SELECT(night, NIGHT);
    #endif 

    #ifdef __CAMERA_FEATURE_AE_METER__
    CREATE_CAMERA_SETTING_INLINE_SELECT(ae_meter, AE_METER);
    #endif 

    #ifdef __CAMERA_FEATURE_CLOSEUP__
    CREATE_CAMERA_SETTING_INLINE_SELECT(closeup, CLOSEUP);
    #endif 

    #ifdef __CAMERA_FEATURE_BANDING__
    CREATE_CAMERA_SETTING_INLINE_SELECT(banding, BANDING);
    #endif 

    #ifdef __CAMERA_FEATURE_DELAY_TIMER__
    CREATE_CAMERA_SETTING_INLINE_SELECT(delay_timer, DELAY_TIMER);
    #endif 


    /*******************************************************************
     * IMPORTANT! Please leave CONT_SHOT the last, 
     * Due to camera external request by mms need to hide the function
     ******************************************************************/
    #ifdef __CAMERA_FEATURE_CONT_SHOT__
    if (g_camera_cntx.is_external_request == FALSE)
    {    
        CREATE_CAMERA_SETTING_INLINE_SELECT(cont_shot, CONT_SHOT);
    }
    else
    {
        item_count--;
    }
    #endif 

    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_CAMERA_SETTING);
    inputBuffer = GetCurrNInputBuffer(SCR_ID_CAMERA_CAMERA_SETTING, &inputBufferSize);

    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, item_count * 2, inputBuffer);
    }

    RegisterHighlightHandler(mmi_camera_camera_setting_highlight_hdlr);

    /* show category */
    ShowCategory57Screen(
        STR_ID_CAMERA_CAMERA_SETTING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_offset,
        item_icons,
        wgui_inline_items,
        0,
        guiBuffer);

    /* set key hdlr */
    SetCategory57LeftSoftkeyFunction(mmi_camera_camera_setting_set_value);
    DisableCategory57ScreenDone();
    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);
}

/***************************************************************************** 
*
* Image Setting
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_image_setting
 * DESCRIPTION
 *  highlight handler on camera's option menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_image_setting(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_image_setting_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_image_setting_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_image_setting_set_value
 * DESCRIPTION
 *  set image setting value
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_image_setting_set_value(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.setting.image_size = g_camera_menu_cntx.image_setting_inline.image_size_selected;
    g_camera_cntx.setting.image_qty = g_camera_menu_cntx.image_setting_inline.image_qty_selected;

    /* reset zoom to default since image size might changed */
    g_camera_cntx.setting.zoom_idx = CAMERA_DEFAULT_SETTING_ZOOM_IDX;

#ifdef __CAMERA_FEATURE_CONT_SHOT_TILE__
    if (g_camera_cntx.is_tileshot)
    {
        if (g_camera_cntx.setting.image_size != CAMERA_FEATURE_CONT_SHOT_TILE_IMAGE_IDX)
        {
            g_camera_cntx.is_tileshot = FALSE;
            g_camera_cntx.setting.cont_shot = CAMERA_SETTING_CONT_SHOT_OFF;
        }
    }
#endif /* __CAMERA_FEATURE_CONT_SHOT_TILE__ */ 

#ifdef __CAMERA_FEATURE_CONT_SHOT_BURST__
    if (g_camera_cntx.setting.cont_shot == CAMERA_SETTING_CONT_SHOT_BURST)
    {
        if (g_camera_cntx.setting.image_size != CAMERA_FEATURE_CONT_SHOT_BURST_IMAGE_IDX)
        {
            g_camera_cntx.setting.cont_shot = CAMERA_SETTING_CONT_SHOT_OFF;
        }
    }
#endif /* __CAMERA_FEATURE_CONT_SHOT_BURST__ */ 

    DISPLAY_POPUP_DONE();
    DeleteNHistory(1);

    mmi_camera_preview_update_capture_size();

    mmi_camera_store_setting();


}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_image_setting_highlight_hdlr
 * DESCRIPTION
 *  image setting screen's highlight handler
 * PARAMETERS
 *  index       [IN]        Selected item's index
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_image_setting_highlight_hdlr(S32 index)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    SetCategory57LeftSoftkeyFunction(mmi_camera_image_setting_set_value);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_exit_image_setting_screen
 * DESCRIPTION
 *  exit image setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_exit_image_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U16 inputBufferSize;
    S16 nHistory = 0;
    history h;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    CloseCategory57Screen();
    h.scrnID = SCR_ID_CAMERA_IMAGE_SETTING;
    h.entryFuncPtr = mmi_camera_entry_image_setting_screen;
    mmi_ucs2cpy((S8*) h.inputBuffer, (S8*) & nHistory);
    inputBufferSize = (U16) GetCategory57DataSize();
    GetCategory57History(h.guiBuffer);
    GetCategory57Data((U8*) h.inputBuffer);
    AddNHistory(h, inputBufferSize);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_image_setting_screen
 * DESCRIPTION
 *  entry image setting screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_image_setting_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    U8 *guiBuffer;
    U8 *inputBuffer;
    U16 inputBufferSize;
    S32 item_offset = 0;
    S32 i;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    MMI_ID_TYPE item_icons[CAMERA_IMAGE_SETTING_ITEM_COUNT * 2] = 
    {
        IMG_ID_CAMERA_IMAGE_SIZE,
        0,

        IMG_ID_CAMERA_IMAGE_QTY,
        0,
    };

    EntryNewScreen(SCR_ID_CAMERA_IMAGE_SETTING, mmi_camera_exit_image_setting_screen, NULL, NULL);

#if defined(__CAMERA_OSD_HORIZONTAL__)
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        mmi_frm_screen_rotate(MMI_FRM_SCREEN_ROTATE_270);
    }

#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 

    InitializeCategory57Screen();

    g_camera_menu_cntx.image_setting_inline.image_size_selected = g_camera_cntx.setting.image_size;
    g_camera_menu_cntx.image_setting_inline.image_qty_selected = g_camera_cntx.setting.image_qty;

   /****************************************************************************
   *  Create inline selection                                                               
   *****************************************************************************/
    /* image size inline selection */
    for (i = 0; i < CAMERA_SETTING_IMAGE_SIZE_COUNT; i++)
    {
        g_camera_menu_cntx.image_setting_inline.image_size_str[i]
            = (UI_string_type) GetString(g_camera_cntx.image_size_str_id[i]);
    }

    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString((U16) (STR_ID_CAMERA_IMAGE_SIZE)));

    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);

    SetInlineItemSelect(
        &wgui_inline_items[item_offset++],
        CAMERA_SETTING_IMAGE_SIZE_COUNT,
        (U8 **) g_camera_menu_cntx.image_setting_inline.image_size_str,
        &g_camera_menu_cntx.image_setting_inline.image_size_selected);

    /* image quality inline selection */
    for (i = 0; i < CAMERA_SETTING_IMAGE_QTY_COUNT; i++)
    {
        g_camera_menu_cntx.image_setting_inline.image_qty_str[i]
            = (UI_string_type) GetString((U16) (STR_ID_CAMERA_IMAGE_QTY_START + i + 1));
    }

    SetInlineItemCaption(&wgui_inline_items[item_offset++], (PU8) GetString((U16) (STR_ID_CAMERA_IMAGE_QTY)));

    SetInlineItemActivation(&wgui_inline_items[item_offset], INLINE_ITEM_ACTIVATE_WITHOUT_KEY_EVENT, 0);

    SetInlineItemSelect(
        &wgui_inline_items[item_offset++],
        CAMERA_SETTING_IMAGE_QTY_COUNT,
        (U8 **) g_camera_menu_cntx.image_setting_inline.image_qty_str,
        &g_camera_menu_cntx.image_setting_inline.image_qty_selected);

    /* enter category */
    guiBuffer = GetCurrGuiBuffer(SCR_ID_CAMERA_IMAGE_SETTING);
    inputBuffer = GetCurrNInputBuffer(SCR_ID_CAMERA_IMAGE_SETTING, &inputBufferSize);

    if (inputBuffer != NULL)
    {
        SetCategory57Data(wgui_inline_items, CAMERA_IMAGE_SETTING_ITEM_COUNT * 2, inputBuffer);
    }

    RegisterHighlightHandler(mmi_camera_image_setting_highlight_hdlr);

    /* show category */
    ShowCategory57Screen(
        STR_ID_CAMERA_IMAGE_SETTING,
        GetRootTitleIcon(MENU_ID_CAMERA_APP),
        STR_GLOBAL_OK,
        IMG_GLOBAL_OK,
        STR_GLOBAL_BACK,
        IMG_GLOBAL_BACK,
        item_offset,
        item_icons,
        wgui_inline_items,
        0,
        guiBuffer);

    /* set key hdlr */
    SetCategory57LeftSoftkeyFunction(mmi_camera_image_setting_set_value);
    DisableCategory57ScreenDone();
    SetCategory57RightSoftkeyFunctions(GoBackHistory, GoBackHistory);

}

/*****************************************************************************
*
* Restore Default
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_restore_default_confirm_yes
 * DESCRIPTION
 *  restore defualt confirm yes
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_restore_default_confirm_yes(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    /* restore default values */
    DISPLAY_POPUP_DONE();
    mmi_camera_restore_setting();
    DeleteNHistory(1);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_entry_restore_default_confirm_screen
 * DESCRIPTION
 *  entry restore default confirm screen
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_entry_restore_default_confirm_screen(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
#if defined(__CAMERA_OSD_HORIZONTAL__)
    DisplayConfirmRotated(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_ID_CAMERA_NOTIFY_RESTORE_DEFAULT_CONFIRM),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE,
        g_camera_cntx.osd_rotate);
#else /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    DisplayConfirm(
        STR_GLOBAL_YES,
        IMG_GLOBAL_YES,
        STR_GLOBAL_NO,
        IMG_GLOBAL_NO,
        get_string(STR_ID_CAMERA_NOTIFY_RESTORE_DEFAULT_CONFIRM),
        IMG_GLOBAL_QUESTION,
        WARNING_TONE);
#endif /* defined(__CAMERA_OSD_HORIZONTAL__) */ 
    SetRightSoftkeyFunction(GoBackHistory, KEY_EVENT_UP);
    SetLeftSoftkeyFunction(mmi_camera_entry_restore_default_confirm_yes, KEY_EVENT_UP);
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_restore_default
 * DESCRIPTION
 *  highlight handler for restore default menuitem
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_restore_default(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_entry_restore_default_confirm_screen, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_entry_restore_default_confirm_screen, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}

/*****************************************************************************
*
* Self Capture
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_set_self_capture
 * DESCRIPTION
 *  Set self capture
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_set_self_capture(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    g_camera_cntx.is_force_self_capture = TRUE;
    GoBackHistory();
}


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_highlight_self_capture
 * DESCRIPTION
 *  highlight handler of self capture on option menu
 * PARAMETERS
 *  void
 * RETURNS
 *  void
 *****************************************************************************/
void mmi_camera_highlight_self_capture(void)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    SetLeftSoftkeyFunction(mmi_camera_set_self_capture, KEY_EVENT_UP);
    SetKeyHandler(mmi_camera_set_self_capture, KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
    ChangeLeftSoftkey(STR_GLOBAL_OK, IMG_GLOBAL_OK);
    ClearKeyHandler(KEY_RIGHT_ARROW, KEY_EVENT_DOWN);
}

/*****************************************************************************
*
*  Touch Screen Support
*
*****************************************************************************/


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_touch_scr_hit_test
 * DESCRIPTION
 *  test if is within touch region
 * PARAMETERS
 *  pos_x           [IN]        Position x
 *  pos_y           [IN]        Position y
 *  touch_obj       [?]         
 *  touch(?)        [IN]        Touch object structure
 * RETURNS
 * BOOL
 *****************************************************************************/
#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
BOOL mmi_camera_wb_touch_scr_hit_test(S32 pos_x, S32 pos_y, camera_ui_touch_struct *touch_obj)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if ((pos_x >= touch_obj->offset_x) &&
        (pos_x < touch_obj->offset_x + touch_obj->width) &&
        (pos_y >= touch_obj->offset_y) && (pos_y < touch_obj->offset_y + touch_obj->height))
    {
        return TRUE;
    }
    else
    {
        return FALSE;
    }
}
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_touch_scr_pen_down_hdlr
 * DESCRIPTION
 *  touch screen hdlr when pen down
 * PARAMETERS
 *  pos     [IN]        Pen down position
 * RETURNS
 *  void
 *****************************************************************************/
#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
void mmi_camera_wb_touch_scr_pen_down_hdlr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        S32 tmp;

        tmp = pos.x;
        pos.x = pos.y;
        pos.y = (LCD_WIDTH - 1) - tmp;
    }

    /* LSK */
    if (mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_cntx.touch_lsk) == MMI_TRUE)
    {
        mmi_camera_wb_left_softkey_pressed();

        g_camera_cntx.touch_object = CAMERA_TOUCH_LSK;
        return;
    }

    /* RSK */
    if (mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_cntx.touch_rsk) == MMI_TRUE)
    {
        mmi_camera_wb_right_softkey_pressed();
        g_camera_cntx.touch_object = CAMERA_TOUCH_RSK;
        return;
    }

    /* capture */
    if (mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_menu_cntx.wb_setting.capture_icon) == MMI_TRUE)
    {
    #ifdef __CAMERA_FEATURE_WB_MANUAL__
        mmi_camera_wb_capture_pressed();
    #endif 
        g_camera_cntx.touch_object = CAMERA_TOUCH_CAPTURE;
        return;
    }

    /* left arrow */
    //      if(mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_menu_cntx.wb_setting.left_arrow) == MMI_TRUE)
    //      {
    //              mmi_camera_wb_left_arrow_pressed();
    //              g_camera_cntx.touch_object = CAMERA_TOUCH_WB_LEFT_ARROW;
    //              return;
    //      }

    /* right arrow */
    //      if(mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_menu_cntx.wb_setting.right_arrow) == MMI_TRUE)
    //      {
    //              mmi_camera_wb_right_arrow_pressed();
    //              g_camera_cntx.touch_object = CAMERA_TOUCH_WB_RIGHT_ARROW;
    //              return;
    //      }

    g_camera_cntx.touch_object = CAMERA_TOUCH_NONE;

}
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_touch_scr_pen_up_hdlr
 * DESCRIPTION
 *  touch screen hdlr when pen up
 * PARAMETERS
 *  pos     [IN]        Pen up position
 * RETURNS
 *  void
 *****************************************************************************/
#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
void mmi_camera_wb_touch_scr_pen_up_hdlr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        S32 tmp;

        tmp = pos.x;
        pos.x = pos.y;
        pos.y = (LCD_WIDTH - 1) - tmp;
    }

    {
        switch (g_camera_cntx.touch_object)
        {
            case CAMERA_TOUCH_LSK:
                mmi_camera_wb_left_softkey_released();
                break;
            case CAMERA_TOUCH_RSK:
                mmi_camera_wb_right_softkey_released();
                break;
                //                      case    CAMERA_TOUCH_WB_RIGHT_ARROW:
                //                              mmi_camera_wb_right_arrow_released();
                //                      break;
                //                      case    CAMERA_TOUCH_WB_LEFT_ARROW:
                //                              mmi_camera_wb_left_arrow_released();
                //                      break;
            case CAMERA_TOUCH_CAPTURE:
        #ifdef __CAMERA_FEATURE_WB_MANUAL__
                mmi_camera_wb_capture_released();
        #endif 
                break;

            default:
                break;
        }
    }
}
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 


/*****************************************************************************
 * FUNCTION
 *  mmi_camera_wb_touch_scr_pen_move_hdlr
 * DESCRIPTION
 *  touch screen hdlr when pen move
 * PARAMETERS
 *  pos     [IN]        Pen move position
 * RETURNS
 *  void
 *****************************************************************************/
#if defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__)
void mmi_camera_wb_touch_scr_pen_move_hdlr(mmi_pen_point_struct pos)
{
    /*----------------------------------------------------------------*/
    /* Local Variables                                                */
    /*----------------------------------------------------------------*/
    BOOL softkey_pressed;

    /*----------------------------------------------------------------*/
    /* Code Body                                                      */
    /*----------------------------------------------------------------*/
    softkey_pressed = FALSE;
    if (g_camera_cntx.osd_rotate == CAMERA_DISPLAY_ROTATE_270)
    {
        S32 tmp;

        tmp = pos.x;
        pos.x = pos.y;
        pos.y = (LCD_WIDTH - 1) - tmp;
    }

    switch (g_camera_cntx.touch_object)
    {
        case CAMERA_TOUCH_LSK:
            if (mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_cntx.touch_lsk))
            {
                softkey_pressed = TRUE;
            }
            else
            {
                softkey_pressed = FALSE;
            }

            if (softkey_pressed != g_camera_cntx.is_lsk_pressed)
            {
                g_camera_cntx.is_lsk_pressed = softkey_pressed;
                mmi_camera_wb_draw_bg();
                gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
            }
            break;

        case CAMERA_TOUCH_RSK:
            if (mmi_camera_wb_touch_scr_hit_test(pos.x, pos.y, &g_camera_cntx.touch_rsk))
            {
                softkey_pressed = TRUE;
            }
            else
            {
                softkey_pressed = FALSE;
            }

            if (softkey_pressed != g_camera_cntx.is_rsk_pressed)
            {
                g_camera_cntx.is_rsk_pressed = softkey_pressed;
                mmi_camera_wb_draw_bg();
                gdi_layer_blt_previous(0, 0, UI_device_width - 1, UI_device_height - 1);
            }
            break;
    }
}
#endif /* defined(__CAMERA_FEATURE_TOUCH_SCREEN__) && defined(__MMI_TOUCH_SCREEN__) */ 

#endif /* __MMI_CAMERA__ */ 

